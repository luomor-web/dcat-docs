<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>开发扩展 - My Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Welcome to MkDocs</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">2.x <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">dcat-admin</a>
</li>
                                    
<li>
    <a href="../1-x-upgrade/" class="dropdown-item">v1.x版本升级指南</a>
</li>
                                    
<li>
    <a href="../LICENSE/" class="dropdown-item">LICENSE</a>
</li>
                                    
<li>
    <a href="../action-form/" class="dropdown-item">数据表单动作</a>
</li>
                                    
<li>
    <a href="../action-grid/" class="dropdown-item">数据表格动作</a>
</li>
                                    
<li>
    <a href="../action-show/" class="dropdown-item">数据详情动作</a>
</li>
                                    
<li>
    <a href="../action-tree/" class="dropdown-item">模型树动作</a>
</li>
                                    
<li>
    <a href="../action/" class="dropdown-item">动作基本使用</a>
</li>
                                    
<li>
    <a href="../assets/" class="dropdown-item">静态资源加载</a>
</li>
                                    
<li>
    <a href="../beta-change-log/" class="dropdown-item">BETA版本更新日志</a>
</li>
                                    
<li>
    <a href="../change-log/" class="dropdown-item">Change log</a>
</li>
                                    
<li>
    <a href="../custom-authentication/" class="dropdown-item">自定义登陆</a>
</li>
                                    
<li>
    <a href="../custom-chart/" class="dropdown-item">自定义图表</a>
</li>
                                    
<li>
    <a href="../custom-navbar/" class="dropdown-item">自定义头部导航条</a>
</li>
                                    
<li>
    <a href="../custom-page/" class="dropdown-item">视图与自定义页面</a>
</li>
                                    
<li>
    <a href="../documentation/" class="dropdown-item">Documentation</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">开发扩展</a>
</li>
                                    
<li>
    <a href="../extension-dev/" class="dropdown-item">开发扩展</a>
</li>
                                    
<li>
    <a href="../extension-f/" class="dropdown-item">扩展基本使用</a>
</li>
                                    
<li>
    <a href="../extension-helpers/" class="dropdown-item">开发工具</a>
</li>
                                    
<li>
    <a href="../extension-theme/" class="dropdown-item">主题开发</a>
</li>
                                    
<li>
    <a href="../extension-upgrade/" class="dropdown-item">扩展版本与升级</a>
</li>
                                    
<li>
    <a href="../extensions/" class="dropdown-item">扩展</a>
</li>
                                    
<li>
    <a href="../function/" class="dropdown-item">帮助函数</a>
</li>
                                    
<li>
    <a href="../helpers/" class="dropdown-item">开发工具</a>
</li>
                                    
<li>
    <a href="../installation/" class="dropdown-item">安装</a>
</li>
                                    
<li>
    <a href="../introduction/" class="dropdown-item">Dcat Admin</a>
</li>
                                    
<li>
    <a href="../js/" class="dropdown-item">JS组件</a>
</li>
                                    
<li>
    <a href="../laravel-octane/" class="dropdown-item">Laravel Octane</a>
</li>
                                    
<li>
    <a href="../lazy/" class="dropdown-item">异步加载基本使用</a>
</li>
                                    
<li>
    <a href="../menu/" class="dropdown-item">菜单</a>
</li>
                                    
<li>
    <a href="../model-form-callback/" class="dropdown-item">表单回调</a>
</li>
                                    
<li>
    <a href="../model-form-data/" class="dropdown-item">表单数据源</a>
</li>
                                    
<li>
    <a href="../model-form-field-management/" class="dropdown-item">表单字段的管理</a>
</li>
                                    
<li>
    <a href="../model-form-fields/" class="dropdown-item">表单字段的使用</a>
</li>
                                    
<li>
    <a href="../model-form-init/" class="dropdown-item">表单初始化</a>
</li>
                                    
<li>
    <a href="../model-form-layout/" class="dropdown-item">表单布局</a>
</li>
                                    
<li>
    <a href="../model-form-modal/" class="dropdown-item">表单弹窗</a>
</li>
                                    
<li>
    <a href="../model-form-step/" class="dropdown-item">分步表单</a>
</li>
                                    
<li>
    <a href="../model-form-trans/" class="dropdown-item">表单字段翻译</a>
</li>
                                    
<li>
    <a href="../model-form-upload/" class="dropdown-item">图片/文件上传</a>
</li>
                                    
<li>
    <a href="../model-form-validation/" class="dropdown-item">表单验证</a>
</li>
                                    
<li>
    <a href="../model-form-when/" class="dropdown-item">表单字段动态显示</a>
</li>
                                    
<li>
    <a href="../model-form/" class="dropdown-item">表单基本使用</a>
</li>
                                    
<li>
    <a href="../model-grid-actions/" class="dropdown-item">行的使用和扩展</a>
</li>
                                    
<li>
    <a href="../model-grid-async/" class="dropdown-item">表格异步渲染</a>
</li>
                                    
<li>
    <a href="../model-grid-column-display/" class="dropdown-item">列的显示和扩展</a>
</li>
                                    
<li>
    <a href="../model-grid-column-filter/" class="dropdown-item">列过滤器</a>
</li>
                                    
<li>
    <a href="../model-grid-column/" class="dropdown-item">列的基本使用</a>
</li>
                                    
<li>
    <a href="../model-grid-combination/" class="dropdown-item">组合表头</a>
</li>
                                    
<li>
    <a href="../model-grid-custom-tools/" class="dropdown-item">工具栏</a>
</li>
                                    
<li>
    <a href="../model-grid-data/" class="dropdown-item">表格数据源</a>
</li>
                                    
<li>
    <a href="../model-grid-editable/" class="dropdown-item">数据表格行内编辑</a>
</li>
                                    
<li>
    <a href="../model-grid-events/" class="dropdown-item">数据表格事件</a>
</li>
                                    
<li>
    <a href="../model-grid-export/" class="dropdown-item">数据导出</a>
</li>
                                    
<li>
    <a href="../model-grid-exporter/" class="dropdown-item">自定义导出</a>
</li>
                                    
<li>
    <a href="../model-grid-filters/" class="dropdown-item">查询过滤</a>
</li>
                                    
<li>
    <a href="../model-grid-header/" class="dropdown-item">头部和脚部</a>
</li>
                                    
<li>
    <a href="../model-grid-quick-create/" class="dropdown-item">快捷创建</a>
</li>
                                    
<li>
    <a href="../model-grid-quick-search/" class="dropdown-item">表格快捷搜索</a>
</li>
                                    
<li>
    <a href="../model-grid-relationship/" class="dropdown-item">表格关联关系</a>
</li>
                                    
<li>
    <a href="../model-grid-selector/" class="dropdown-item">表格规格筛选器</a>
</li>
                                    
<li>
    <a href="../model-grid-softdelete/" class="dropdown-item">数据软删除</a>
</li>
                                    
<li>
    <a href="../model-grid-trans/" class="dropdown-item">表格字段翻译</a>
</li>
                                    
<li>
    <a href="../model-grid-tree/" class="dropdown-item">树状表格</a>
</li>
                                    
<li>
    <a href="../model-grid/" class="dropdown-item">表格基本使用</a>
</li>
                                    
<li>
    <a href="../model-json/" class="dropdown-item">JSON格式字段处理</a>
</li>
                                    
<li>
    <a href="../model-relationship/" class="dropdown-item">表单关联关系</a>
</li>
                                    
<li>
    <a href="../model-repository/" class="dropdown-item">数据仓库</a>
</li>
                                    
<li>
    <a href="../model-show-extend/" class="dropdown-item">详情字段显示扩展</a>
</li>
                                    
<li>
    <a href="../model-show-field/" class="dropdown-item">字段显示</a>
</li>
                                    
<li>
    <a href="../model-show-init/" class="dropdown-item">数据详情初始化</a>
</li>
                                    
<li>
    <a href="../model-show-relation/" class="dropdown-item">关联关系</a>
</li>
                                    
<li>
    <a href="../model-show-trans/" class="dropdown-item">数据详情字段翻译</a>
</li>
                                    
<li>
    <a href="../model-show/" class="dropdown-item">数据详情基本使用</a>
</li>
                                    
<li>
    <a href="../model-tree/" class="dropdown-item">模型树</a>
</li>
                                    
<li>
    <a href="../multi-app/" class="dropdown-item">多应用 (多后台)</a>
</li>
                                    
<li>
    <a href="../notice/" class="dropdown-item">开发前必读</a>
</li>
                                    
<li>
    <a href="../permission/" class="dropdown-item">权限控制</a>
</li>
                                    
<li>
    <a href="../qa/" class="dropdown-item">常见问题汇总</a>
</li>
                                    
<li>
    <a href="../quick-start/" class="dropdown-item">快速开始</a>
</li>
                                    
<li>
    <a href="../response/" class="dropdown-item">动作以及表单响应</a>
</li>
                                    
<li>
    <a href="../section/" class="dropdown-item">区块（section）</a>
</li>
                                    
<li>
    <a href="../theme/" class="dropdown-item">主题与颜色</a>
</li>
                                    
<li>
    <a href="../trans/" class="dropdown-item">多语言</a>
</li>
                                    
<li>
    <a href="../update/" class="dropdown-item">版本升级须知</a>
</li>
                                    
<li>
    <a href="../widgets-alert/" class="dropdown-item">警告框</a>
</li>
                                    
<li>
    <a href="../widgets-box/" class="dropdown-item">卡片</a>
</li>
                                    
<li>
    <a href="../widgets-charts/" class="dropdown-item">图表</a>
</li>
                                    
<li>
    <a href="../widgets-checkbox/" class="dropdown-item">单/复选框</a>
</li>
                                    
<li>
    <a href="../widgets-data-card/" class="dropdown-item">数据统计卡片</a>
</li>
                                    
<li>
    <a href="../widgets-dialog-form/" class="dropdown-item">Widgets dialog form</a>
</li>
                                    
<li>
    <a href="../widgets-dropdown/" class="dropdown-item">下拉菜单</a>
</li>
                                    
<li>
    <a href="../widgets-form/" class="dropdown-item">工具表单</a>
</li>
                                    
<li>
    <a href="../widgets-js/" class="dropdown-item">Widgets js</a>
</li>
                                    
<li>
    <a href="../widgets-markdown/" class="dropdown-item">Markdown</a>
</li>
                                    
<li>
    <a href="../widgets-modal/" class="dropdown-item">模态窗 (Modal)</a>
</li>
                                    
<li>
    <a href="../widgets-navbar/" class="dropdown-item">Widgets navbar</a>
</li>
                                    
<li>
    <a href="../widgets-tab/" class="dropdown-item">选项卡</a>
</li>
                                    
<li>
    <a href="../widgets-table/" class="dropdown-item">Widgets table</a>
</li>
                                    
<li>
    <a href="../widgets-tooltip/" class="dropdown-item">提示窗</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../documentation/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../extension-dev/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#_1" class="nav-link">开发扩展</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#_2" class="nav-link">新版本预告</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_3" class="nav-link">开始</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#composer" class="nav-link">创建composer包</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_4" class="nav-link">功能开发</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_10" class="nav-link">添加自定义安装逻辑</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_11" class="nav-link">代码逻辑开发</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#composerjson-readmemd" class="nav-link">修改 composer.json &amp; README.md</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_12" class="nav-link">安装</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_15" class="nav-link">导入和启用扩展</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="_1">开发扩展</h1>
<h2 id="_2">新版本预告</h2>
<p><code>Dcat Admin</code>计划在<code>2.0</code>版本上线插件市场功能，将对整个扩展功能进行重构，以提升用户体验。
新的扩展系统将可以让用户只需在管理页面点点鼠标即可完成插件的<code>安装</code>、<code>更新</code>和<code>卸载</code>等操作。
并且会上线插件付费功能，以激励开发者开发高质量的插件。</p>
<p>如果有任何建议，欢迎提<code>issue</code>或者私信我，<code>Dcat Admin</code>团队将会致力于构建一个于开发者和用户都有利的生态，感谢大家的支持！</p>
<p><a name="pre"></a></p>
<h2 id="_3">开始</h2>
<p><code>Dcat Admin</code>支持安装扩展工具来帮助丰富你的后台功能。</p>
<blockquote>
<p>需要注意的是，<code>Laravel Admin</code>原有的扩展无法直接在<code>Dcat Admin</code>中使用，但大部分扩展只需要做一些微小的调整就可以正常使用了，有兴趣的同学可以自行移植。</p>
</blockquote>
<p>如果大家在使用的过程中有在<code>Dcat Admin</code>的基础上添加一些自己的功能或者组件，不妨做成一个<code>Dcat Admin</code>扩展，这样可以给其它<code>Dcat Admin</code>使用者提供帮助，并且在其它人的使用反馈中的提升扩展的质量。</p>
<p>这篇文档将会以开发一个<code>干货集中营</code>扩展为例，一步一步的开发一个扩展，并且发布给他人使用，最终的效果参考<a href="">Demo</a>。</p>
<p><a name="composer"></a></p>
<h2 id="composer">创建composer包</h2>
<p><code>Dcat Admin</code>的包将会用<code>composer</code>安装，所以先要创建一个<code>composer</code>包，可以用内置的<code>admin:extend</code>命令来生成一个扩展的骨架。</p>
<p>运行命令的时候，可能会提示输入一个目录来存放你的扩展文件，你可以在<code>config/admin.php</code>里面增加一个配置<code>'extension_dir' =&gt; admin_path('Extensions')</code>，这样扩展文件将会存放在<code>app/Admin/Extensions目录下</code>,当然你也可以放在任何其它目录。</p>
<pre><code class="language-php">php artisan admin:extend dcat-admin-extensions/gank --namespace=&quot;Dcat\Admin\Extension\Gank&quot;
</code></pre>
<p>其中<code>dcat-admin-extensions/gank</code>是包名，<code>namespace</code>选项是这个包使用的顶级命名空间，运行这个命令之后, 将会在在<code>config/admin.php</code>中设置的扩展目录中生成目录<code>dcat-admin-extensions/gank</code>和下面的文件结构：</p>
<pre><code>├── LICENSE
├── README.md
├── composer.json
├── bootstrap.php
├── database
│   ├── migrations
│   └── seeds
├── resources
│   ├── assets
│   └── views
│       └── index.blade.php
├── routes
│   └── web.php
└── src
    ├── Gank.php
    ├── GankServiceProvider.php
    └── Http
        └── Controllers
            └── GankController.php
</code></pre>
<p><code>bootstrap.php</code>用于注册扩展，此文件的代码不需要做任何修改；<code>resources</code>用来放置视图文件和静态资源文件；<code>src</code>主要用来放置逻辑代码； <code>routes/web.php</code>用来存放这个扩展的路由设置，<code>database</code>用来放置数据库迁移文件和数据<code>seeders</code>。</p>
<p><a name="dev"></a></p>
<h2 id="_4">功能开发</h2>
<p>这个扩展的功能主要用来展示<a href="http://gank.io">gank.io</a>接口的内容，集成进<code>Dcat Admin</code>中，它将会有一个路由和一个控制器，没有数据库文件、模板和静态资源文件，我们可以将没有用到的文件或目录清理掉，清理之后的目录文件为：</p>
<pre><code>├── LICENSE
├── README.md
├── composer.json
├── bootstrap.php
├── routes
│   └── web.php
└── src
    ├── Gank.php
    ├── GankServiceProvider.php
    └── Http
        └── Controllers
            └── GankController.php
</code></pre>
<p>生成完扩展框架之后，你可能需要一边调试一边开发，所以可以参考下面的本地安装，先把扩展安装进系统中，继续开发</p>
<p><a name="route"></a></p>
<h3 id="_5">添加路由</h3>
<p>首先添加一个路由，在<code>routes/web.php</code>中已经自动生成好了一个路由配置</p>
<pre><code class="language-php">&lt;?php

use Dcat\Admin\Extension\Gank\Http\Controllers;

Route::get('gank', Controllers\GankController::class.'@index');
</code></pre>
<p>访问路径<code>http://localhost:8000/admin/gank</code>，将会由<code>Dcat\Admin\Extension\Gank\Http\Controllers\GankController</code>控制器的<code>index</code>方法来处理这个请求。</p>
<p><a name="attrs"></a></p>
<h3 id="_6">设置扩展属性</h3>
<p><code>src/Gank.php</code>作为扩展类，用来设置扩展的属性</p>
<pre><code class="language-php">&lt;?php

namespace Dcat\Admin\Extension\Gank;

use Dcat\Admin\Extension;

class Gank extends Extension
{
    // 扩展别名，用于在配置文件中获取配置信息
    const NAME = 'gank';

    // service provider类名，这个用自动生成的就行，不需要改
    public $serviceProvider = GankServiceProvider::class;

    // 静态资源目录，如果不需要静态资源可用删除掉  
//    public $assets = __DIR__.'/../resources/assets';

    // composer配置文件路径，用默认的即可
    public $composerJson = __DIR__.'/../composer.json';

    // 自定义属性
    public static $categoryColorsMap = [
        'App'      =&gt; 'var(--purple)',
        '前端'     =&gt; 'var(--primary)',
        '拓展资源' =&gt; 'var(--primary-dark)',
        '瞎推荐'   =&gt; 'var(--blue)',
        '福利'     =&gt; 'var(--danger)',
        'Android'  =&gt; 'var(--purple-dark)',
        'iOS'      =&gt; 'var(--info)',
        '休息视频' =&gt; 'var(--warning)',
    ];
}

</code></pre>
<p>这个文件用来设置这个扩展的一些属性，<code>$name</code>是这个扩展的别名，如果这个扩展有视图文件需要渲染，则必须指定这个扩展的<code>$views</code>属性，同样如果有静态资源文件需要发布，则必须设置<code>$assets</code>属性， 如果需要在左侧边栏增加一项菜单按钮，设置<code>$menu</code>属性，可以根据需要去掉不必要的属性。</p>
<p>然后打开<code>src/GankServiceProvider.php</code>，这个<code>ServiceProvider</code>将会在启用扩展的时候运行（不需要开发者自己添加），用来将这个扩展的一些服务注册进系统中。</p>
<p><a name="loadview"></a></p>
<h3 id="_7">加载视图</h3>
<p>如果这个扩展需要加载视图文件，在<code>src/GankServiceProvider.php</code>的<code>boot</code>方法中加入以下的代码：</p>
<pre><code class="language-php">$extension = Gank::make();

if ($extension-&gt;views) {
    $this-&gt;loadViewsFrom($extension-&gt;views, 'gank');
}
</code></pre>
<p><code>loadViewsFrom</code>方法的的第一个参数为在扩展类<code>src/Gank.php</code>中设置的视图属性，第二个参数是视图文件目录的命名空间，设置为<code>gank</code>之后，在控制器中用<code>view('gank::index')</code>来加载<code>resources/views</code>目录下的视图文件。</p>
<p><a name="loadassets"></a></p>
<h3 id="_8">引入静态资源</h3>
<p>如果你的项目中有静态资源文件需要引入，先把文件放在<code>resources/assets</code>目录中，比如放入<code>resources/assets/foo.js</code>和<code>resources/assets/bar.css</code>这两个文件。</p>
<p>接着在扩展类<code>src/Gank.php</code>中设置<code>$assets</code>属性即可：</p>
<pre><code class="language-php">public $assets = __DIR__.'/../resources/assets';
</code></pre>
<p>安装完成之后，文件将会复制到<code>public/vendor/dcat-admin-extensions/gank</code>目录中。</p>
<p>然后我们可以在需要使用这些静态资源的地方加上下面的代码即可</p>
<blockquote>
<p>{tip} 因为<code>Dcat Admin</code>支持静态资源按需加载，所以不推荐直接在<code>ServiceProvider</code>或者是<code>bootstrap.php</code>中引入静态资源，这样会拖慢所有页面的加载时间。</p>
</blockquote>
<pre><code class="language-php">use Dcat\Admin\Admin;

Admin::js('vendor/dcat-admin-extensions/gank/phpinfo/foo.js');
Admin::css('vendor/dcat-admin-extensions/gank/phpinfo/bar.css');
</code></pre>
<p>这样就完成了静态资源的引入，在<code>gank</code>这个扩展中，由于没有静态资源需要引入，所以可以忽略掉这一步。</p>
<p><a name="addmenu"></a></p>
<h3 id="_9">添加菜单</h3>
<p>添加菜单的方式有两种：
- 在<code>src/Gank.php</code>设置<code>$menu</code>属性，这种方式是把菜单写入到菜单表中，用户更易于控制
- 使用<code>Admin::menu</code>接口通过数组的方式添加菜单，这种方式更加方便，并且支持添加多级菜单</p>
<p>这里使用的是第二种方式添加菜单，在<code>src/GankServiceProvider.php</code>的<code>boot</code>方法加入下面的代码：</p>
<pre><code class="language-php">Admin::menu()-&gt;add([
    [
        'id'            =&gt; 1,
        'title'         =&gt; '干货集中营',
        'icon'          =&gt; ' fa-newspaper-o',
        'uri'           =&gt; 'gank',
        'parent_id'     =&gt; 0,
        'permission_id' =&gt; 'gank', // 绑定权限
        'roles'         =&gt; [['slug' =&gt; 'gank']], // 绑定角色
    ],
    [
        'id'            =&gt; 2,
        'title'         =&gt; '所有干货',
        'icon'          =&gt; 'fa-smile-o',
        'uri'           =&gt; 'gank',
        'parent_id'     =&gt; 1,
        'permission_id' =&gt; 'gank', // 绑定权限
        'roles'         =&gt; [['slug' =&gt; 'gank']], // 绑定角色
    ],
]);
</code></pre>
<p>最终的<code>src/GankServiceProvider.php</code>代码如下：</p>
<pre><code class="language-php">&lt;?php

namespace Dcat\Admin\Extension\Gank;

use Dcat\Admin\Admin;
use Illuminate\Support\ServiceProvider;

class GankServiceProvider extends ServiceProvider
{
    /**
     * {@inheritdoc}
     */
    public function boot()
    {
        $extension = Gank::make();

        if ($extension-&gt;views) {
            $this-&gt;loadViewsFrom($extension-&gt;views, 'gank');
        }

        if ($extension-&gt;lang) {
            $this-&gt;loadTranslationsFrom($extension-&gt;lang, 'gank');
        }

        if ($extension-&gt;migrations) {
            $this-&gt;loadMigrationsFrom($extension-&gt;migrations);
        }

        $this-&gt;app-&gt;booted(function () use ($extension) {
            $extension-&gt;routes(__DIR__.'/../routes/web.php');
        });

        // 添加菜单
        $this-&gt;registerMenus();
    }

    protected function registerMenus()
    {
        Admin::menu()-&gt;add([
            [
                'id'            =&gt; 1,
                'title'         =&gt; '干货集中营',
                'icon'          =&gt; ' fa-newspaper-o',
                'uri'           =&gt; 'gank',
                'parent_id'     =&gt; 0,
                'permission_id' =&gt; 'gank', // 绑定权限
                'roles'         =&gt; [['slug' =&gt; 'gank']], // 绑定角色
            ],
            [
                'id'            =&gt; 2,
                'title'         =&gt; '所有干货',
                'icon'          =&gt; 'fa-smile-o',
                'uri'           =&gt; 'gank',
                'parent_id'     =&gt; 1,
                'permission_id' =&gt; 'gank', // 绑定权限
                'roles'         =&gt; [['slug' =&gt; 'gank']], // 绑定角色
            ],
        ]);
    }
}
</code></pre>
<p><a name="importcode"></a></p>
<h2 id="_10">添加自定义安装逻辑</h2>
<p>如果你想在导入扩展时执行一些自定义逻辑，可以在<code>src/Gank.php</code>中添加以下代码：</p>
<blockquote>
<p>注意请保证重复执行导入命令不会报错</p>
</blockquote>
<pre><code class="language-php">...

    public function import(Command $command)
    {
        parent::import($command); // TODO: Change the autogenerated stub

        // 在这里写入你的导入逻辑

        $command-&gt;info('导入成功');

    }

</code></pre>
<p><a name="code"></a></p>
<h2 id="_11">代码逻辑开发</h2>
<p>这个扩展主要是调用<a href="">gank.io</a>提供的接口，再把数据展示出来。</p>
<p>我们需要新增一个数据仓库文件用于获取<a href="">gank.io</a>的数据，创建文件<code>src/Repositories/Ganks.php</code>：</p>
<pre><code class="language-php">&lt;?php

namespace Dcat\Admin\Extension\Gank\Repositories;

use Dcat\Admin\Grid;
use Dcat\Admin\Repositories\Repository;
use Illuminate\Pagination\LengthAwarePaginator;
use Illuminate\Support\Collection;

class Ganks extends Repository
{
    protected $api = 'http://gank.io/api/data/{category}/{limit}/{page}';

    protected $searchApi = 'http://gank.io/api/search/query/{key}/category/{category}/count/{limit}/page/{page}';

    /**
     * 查询表格数据
     *
     * @param Grid\Model $model
     * @return Collection
     */
    public function get(Grid\Model $model)
    {
        $currentPage = $model-&gt;getCurrentPage();
        $perPage = $model-&gt;getPerPage();

        // 获取筛选参数
        $category = $model-&gt;filter()-&gt;input(Grid\Filter\Scope::QUERY_NAME, 'all');
        $keyword = trim($model-&gt;filter()-&gt;input('keyword'));

        $api = $keyword ? $this-&gt;searchApi : $this-&gt;api;

        $client = new \GuzzleHttp\Client();

        $response = $client-&gt;get(str_replace(
            ['{category}', '{limit}', '{page}', '{key}'],
            [$category, $perPage, $currentPage, $keyword],
            $api
        ));
        $data = collect(
            json_decode((string)$response-&gt;getBody(), true)['results'] ?? []
        );

        $total = $keyword ? 400 : ($category == 'all' ? 1000 : 500);

        $paginator = new LengthAwarePaginator(
            $data,
            $category == '福利' ? 680 : $total,
            $perPage, // 传入每页显示行数
            $currentPage // 传入当前页码
        );

        $paginator-&gt;setPath(\url()-&gt;current());

        return $paginator;
    }

    public function getKeyName()
    {
        return '_id';
    }

}
</code></pre>
<p>修改控制器代码如下：</p>
<pre><code class="language-php">&lt;?php

namespace Dcat\Admin\Extension\Gank\Http\Controllers;

use Dcat\Admin\Extension\Gank\Gank;
use Dcat\Admin\Extension\Gank\Repositories\Ganks;
use Dcat\Admin\Grid;
use Dcat\Admin\Layout\Content;
use Dcat\Admin\Layout\Row;
use Illuminate\Routing\Controller;
use Dcat\Admin\Widgets\Navbar;

class GankController extends Controller
{
    public function index(Content $content)
    {
        $grid = $this-&gt;grid();

        $grid-&gt;disableFilter();
        $grid-&gt;filter()
            -&gt;withoutInputBorder()
            -&gt;expand()
            -&gt;resetPosition()
            -&gt;hiddenResetButtonText();

        return $content
            -&gt;header('所有干货')
            -&gt;description('每日分享妹子图 和 技术干货')
            -&gt;body($grid-&gt;filter())
            -&gt;body(function (Row $row) {
                $items = array_keys(Gank::$categoryColorsMap);

                array_unshift($items, '全部');

                $navbar = Navbar::make('#', array_combine($items, $items))
                    -&gt;checked(request(Grid\Filter\Scope::QUERY_NAME, '全部'))
                    -&gt;click()
                    -&gt;map(function ($v) {
                        if ($v == '全部') {
                            $url = '?';
                        } else {
                            $url = '?'.Grid\Filter\Scope::QUERY_NAME.'='.$v;
                        }

                        return &quot;&lt;a href='$url'&gt;$v&lt;/a&gt;&quot;;
                    })
                    -&gt;style('max-width:705px');

                $row-&gt;column(7, $navbar);

            })
            -&gt;body($grid);
    }

    protected function grid()
    {
        $this-&gt;define();

        $grid = new Grid(new Ganks);

        $grid-&gt;number();
        $grid-&gt;desc('描述')-&gt;width('300px');
        $grid-&gt;images('图片')-&gt;image(150);
        $grid-&gt;type('类别');
        $grid-&gt;who('作者')-&gt;label();
        $grid-&gt;publishedAt('发布于');

        $grid-&gt;disableActions();
        $grid-&gt;disableBatchDelete();
        $grid-&gt;disableExport();
        $grid-&gt;disableCreateButton();
        $grid-&gt;disableFilterButton();
        $grid-&gt;disableQuickCreateButton();
        $grid-&gt;perPages([]);

        return $grid-&gt;filter(function (Grid\Filter $filter) {
            $category = $filter-&gt;input(Grid\Filter\Scope::QUERY_NAME, '全部');

            if ($category != '福利') {
                $filter-&gt;like('keyword', ucfirst($category))-&gt;width('300px')-&gt;placeholder('请输入');
            }

        });
    }

    protected function define()
    {
        Grid\Column::define('desc', function ($v) {
            if ($this-&gt;type == '福利') {
                $width = '150';
                $height = '200';
                return &quot;&lt;img data-init='preview' src='{$this-&gt;url}' style='max-width:{$width}px;max-height:{$height}px;cursor:pointer' class='img img-thumbnail' /&gt;&quot;;
            }

            return sprintf('&lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;%s&lt;/a&gt;', $this-&gt;url, $v);
        });

        Grid\Column::define('publishedAt', function ($v) {
            return date('Y-m-d', strtotime($v));
        });
        Grid\Column::define('datetime', function ($v) {
            return date('Y-m-d H:i:s', strtotime($v));
        });

        Grid\Column::define('type', function ($v) {
            $map = Gank::$categoryColorsMap;

            return &quot;&lt;span class='label' style='background:{$map[$v]}'&gt;$v&lt;/span&gt;&quot;;
        });
    }
}
</code></pre>
<p>这样一个完整的扩展就开发完成了。</p>
<p><a name="updatejson"></a></p>
<h2 id="composerjson-readmemd">修改 composer.json &amp; README.md</h2>
<p>代码部分完成之后，需要修改<code>composer.json</code>里面的内容，将<code>description</code>、<code>keywords</code>、<code>license</code>、<code>authors</code>等内容替换为你的信息，然后不要忘记完善<code>README.md</code>，补充使用文档等相关信息。</p>
<p><a name="install"></a></p>
<h2 id="_12">安装</h2>
<p>完成了扩展开发之后，根据情况可以用下面的的方式安装你的扩展</p>
<p><a name="local"></a></p>
<h3 id="_13">本地安装</h3>
<p>在开发的过程中，一般需要一边调试一边开发，所以先按照下面的方式进行本地安装</p>
<p>打开你的项目中<code>composer.json</code>文件，在加入下面的配置</p>
<pre><code>&quot;repositories&quot;: [
    {
        &quot;type&quot;: &quot;path&quot;,
        &quot;url&quot;: &quot;app/Admin/Extensions/dcat-admin-extensions/gank&quot;
    }
]
</code></pre>
<p>然后运行<code>composer require dcat-admin-extensions/gank @dev</code>完成安装，如果有静态文件需要发布，运行下面的命令:</p>
<pre><code>php artisan vendor:publish --provider=Dcat\Admin\Extension\GankServiceProvider
</code></pre>
<p><a name="remote"></a></p>
<h3 id="_14">远程安装</h3>
<p>如果开发完成之后，希望开源出来给大家使用，按照下面的步骤进行</p>
<p><a name="github"></a></p>
<h4 id="github">上传到Github</h4>
<p>先登录你的Github，创建一个仓库，然后按照页面上的提示把你的代码push上去</p>
<pre><code>git init
git remote add origin https://github.com/&lt;your-name&gt;/&lt;your-repository&gt;.git
git add .
git commit -am &quot;Initial commit.&quot;
git push origin master
</code></pre>
<p><a name="release"></a></p>
<h4 id="release">发布release</h4>
<p>可以用下面的方式在本地发布版本</p>
<pre><code>git tag 0.0.1 &amp;&amp; git push --tags
</code></pre>
<p>也可以在Github的仓库页面的Releases页面手动设置</p>
<p><a name="packagist"></a></p>
<h4 id="packagistorg">发布到Packagist.org</h4>
<p>接下来就是发布你的项目到<code>Packagist.org</code>，如果没有账号的话，先注册一个，然后打开顶部导航的<code>Submit</code>, 填入仓库地址提交</p>
<p>默认情况下，当您推送新代码时，<code>Packagist.org</code>不会自动更新，所以，您需要创建一个GitHub服务钩子， 你也可以使用点击页面上的<code>Update</code>按钮手动更新它，但我建议自动执行这个过程</p>
<p>提交之后，由于各地的镜像同步时间的延迟，可能在用composer安装的时候，会暂时找不到你的项目，这个时候可能需要等待同步完成</p>
<p>发布完成之后就可以通过composer安装你的扩展了</p>
<p>加入到https://github.com/dcat-admin-extensions
如果想把你开发的扩展加入到<code>dcat-admin-extensions</code>，欢迎用各种方式联系我，这样可以让更多人看到并使用你开发的工具。</p>
<p><a name="import"></a></p>
<h2 id="_15">导入和启用扩展</h2>
<p><a name="importext"></a></p>
<h3 id="_16">导入扩展</h3>
<p>安装完成后，运行以下命令即可以导入扩展，导入的文件主要有：静态资源文件、菜单、权限等。</p>
<blockquote>
<p>视图、数据库迁移文件、语言包一般不需要导入。如果要导入其他文件，需要扩展开发者自行定义。
另外此命令允许重复执行。</p>
</blockquote>
<pre><code class="language-php">php artisan admin:import Dcat\Admin\Extension\Gank\Gank
</code></pre>
<p><a name="enable"></a></p>
<h3 id="_17">启用扩展</h3>
<p>扩展的启用与否是通过配置文件控制的，打开<code>/config/admin-extension.php</code>，加入以下代码：</p>
<pre><code class="language-php">return [
    'gank' =&gt; [
        'enable' =&gt; true,
    ],
];
</code></pre>
<p><a name="view"></a></p>
<h3 id="_18">可视化管理扩展</h3>
<p>访问<code>http://localhost:8000/admin/helpers/extensions</code>，可以通过页面操作启用或关闭扩展、导入扩展。</p>
<blockquote>
<p>如果<code>/config/admin-extension.php</code>不存在，系统会自动创建</p>
</blockquote>
<p>这样就完成了安装，打开<code>http://localhost/admin/gank</code>访问这个扩展。</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/jquery-3.6.0.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
