<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2.x/model-grid-selector" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-selector/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.975Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表格规格筛选器"><a href="#表格规格筛选器" class="headerlink" title="表格规格筛选器"></a>表格规格筛选器</h1><p>这个功能用来构建类似淘宝或京东商品的规格选择。</p>
<a href="/assets/img/screenshots/grid-selector.png" target="_blank">
    <img src="/assets/img/screenshots/grid-selector.png" style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="100%" >
</a>


<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><blockquote>
<p>{tip} <code>select</code>和<code>selectOne</code>方法的第二个参数为选择器<code>label</code>, 可以省略，如果省略的话将会自动使用翻译文件的翻译.</p>
</blockquote>
<p>如下代码所示，假设<code>brand</code>字段的4个取值分别对应4个品牌，下面的方式会构建出<code>brand</code>的规格选择器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">selector</span>(function (Grid\Tools\Selector <span class="variable">$selector</span>) &#123;</span><br><span class="line">    <span class="variable">$selector</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;brand&#x27;</span>, <span class="string">&#x27;品牌&#x27;</span>, [</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="string">&#x27;华为&#x27;</span>,</span><br><span class="line">        <span class="number">2</span> =&gt; <span class="string">&#x27;小米&#x27;</span>,</span><br><span class="line">        <span class="number">3</span> =&gt; <span class="string">&#x27;OPPO&#x27;</span>,</span><br><span class="line">        <span class="number">4</span> =&gt; <span class="string">&#x27;vivo&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>select</code>方法默认是多选的，在页面上点击每一个选项的右边的加号，这个字段的查询会增加一个查询选项，如果字段筛选只允许选择一项，使用<code>selectOne</code>方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$selector</span>-&gt;<span class="title function_ invoke__">selectOne</span>(<span class="string">&#x27;brand&#x27;</span>, <span class="string">&#x27;品牌&#x27;</span>, [</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&#x27;华为&#x27;</span>,</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="string">&#x27;小米&#x27;</span>,</span><br><span class="line">    <span class="number">3</span> =&gt; <span class="string">&#x27;OPPO&#x27;</span>,</span><br><span class="line">    <span class="number">4</span> =&gt; <span class="string">&#x27;vivo&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="关联关系字段查询"><a href="#关联关系字段查询" class="headerlink" title="关联关系字段查询"></a>关联关系字段查询</h3><p>如果安装了 <a target="_blank" rel="noopener" href="https://github.com/jqhph/laravel-wherehasin">dcat&#x2F;laravel-wherehasin</a>，则会优先使用<code>whereHasIn</code>方法进行查询操作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">selector</span>(function (Grid\Tools\Selector <span class="variable">$selector</span>) &#123;</span><br><span class="line">    <span class="variable">$selector</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;brand.id&#x27;</span>, <span class="string">&#x27;品牌&#x27;</span>, [</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="string">&#x27;华为&#x27;</span>,</span><br><span class="line">        <span class="number">2</span> =&gt; <span class="string">&#x27;小米&#x27;</span>,</span><br><span class="line">        <span class="number">3</span> =&gt; <span class="string">&#x27;OPPO&#x27;</span>,</span><br><span class="line">        <span class="number">4</span> =&gt; <span class="string">&#x27;vivo&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h3 id="自定义查询"><a href="#自定义查询" class="headerlink" title="自定义查询"></a>自定义查询</h3><p>上面的方式会使用在选择器上选定的值，作为查询条件进行查询，但是有些情况需要更灵活的控制查询方式，那么可以使用下面的方式自定义查询：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$selector</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;价格&#x27;</span>, [<span class="string">&#x27;0-999&#x27;</span>, <span class="string">&#x27;1000-1999&#x27;</span>, <span class="string">&#x27;2000-2999&#x27;</span>], function (<span class="variable">$query</span>, <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$between</span> = [</span><br><span class="line">        [<span class="number">0</span>, <span class="number">999</span>],</span><br><span class="line">        [<span class="number">1000</span>, <span class="number">1999</span>],</span><br><span class="line">        [<span class="number">2000</span>, <span class="number">2999</span>],</span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$value</span> = <span class="title function_ invoke__">current</span>(<span class="variable">$value</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">whereBetween</span>(<span class="string">&#x27;price&#x27;</span>, <span class="variable">$between</span>[<span class="variable">$value</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如上所示，传入一个匿名函数作为第四个参数，价格字段price选择之后，将会使用匿名函数中的逻辑进行数据查询，这样你可以定义任意的查询方式。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-selector/" data-id="clpdpxfkh001qywna4b9t450k" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-header" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-header/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.974Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="头部和脚部"><a href="#头部和脚部" class="headerlink" title="头部和脚部"></a>头部和脚部</h1><p>数据表格支持往头部和脚部两个区块填入你想要的内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">header</span>(function (<span class="variable">$collection</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;header&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">footer</span>(function (<span class="variable">$collection</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;footer&#x27;</span>; </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其中闭包函数的参数<code>$collection</code>为<code>Illuminate\Support\Collection</code>类实例，是当前页表格数据，下面是两个不同场景的使用举例</p>
<h2 id="头部"><a href="#头部" class="headerlink" title="头部"></a>头部</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">header</span>(function (<span class="variable">$collection</span>) <span class="keyword">use</span> ($<span class="title">grid</span>) &#123;</span><br><span class="line">	$<span class="title">query</span> = <span class="title">Model</span>::<span class="title">query</span>();</span><br><span class="line">    	</span><br><span class="line">	<span class="comment">// 拿到表格筛选 where 条件数组进行遍历</span></span><br><span class="line">	<span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">getQueries</span>()-&gt;<span class="title function_ invoke__">unique</span>()-&gt;<span class="title function_ invoke__">each</span>(function (<span class="variable">$value</span>) <span class="keyword">use</span> (&amp;$<span class="title">query</span>) &#123;</span><br><span class="line">		<span class="title">if</span> (<span class="title">in_array</span>($<span class="title">value</span>[&#x27;<span class="title">method</span>&#x27;], [&#x27;<span class="title">paginate</span>&#x27;, &#x27;<span class="title">get</span>&#x27;, &#x27;<span class="title">orderBy</span>&#x27;, &#x27;<span class="title">orderByDesc</span>&#x27;], <span class="title">true</span>)) &#123;</span><br><span class="line">			<span class="title">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="variable">$query</span> = <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$query</span>, <span class="variable">$value</span>[<span class="string">&#x27;method&#x27;</span>]], <span class="variable">$value</span>[<span class="string">&#x27;arguments&#x27;</span>] ?? []);</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 查出统计数据</span></span><br><span class="line">	<span class="variable">$data</span> = <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">get</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义组件</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Card</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>自定义头部展示的组件实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Support</span>\<span class="title">Renderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Card</span> <span class="keyword">implements</span> <span class="title">Renderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$js</span> = [</span><br><span class="line">		<span class="string">&#x27;xxx/js/card.min.js&#x27;</span>,</span><br><span class="line">	];</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$css</span> = [</span><br><span class="line">		<span class="string">&#x27;xxx/css/card.min.css&#x27;</span>,</span><br><span class="line">	];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="variable">$data</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$data</span></span>) </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	    <span class="variable language_">$this</span>-&gt;data = <span class="variable">$data</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">script</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">		console.log(&#x27;所有JS</span>脚本都加载完了<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">		$(&#x27;</span>xxx<span class="string">&#x27;).card();</span></span><br><span class="line"><span class="string">JS;		</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	public function render()</span></span><br><span class="line"><span class="string">	&#123;</span></span><br><span class="line"><span class="string">		// 在这里可以引入你的js或css文件</span></span><br><span class="line"><span class="string">		Admin::js(static::$js);</span></span><br><span class="line"><span class="string">		Admin::css(static::$css);</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">		// 需要在页面执行的JS代码</span></span><br><span class="line"><span class="string">		// 通过 Admin::script 设置的JS代码会自动在所有JS脚本都加载完毕后执行</span></span><br><span class="line"><span class="string">		Admin::script($this-&gt;script());</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">		return view(&#x27;</span>...<span class="string">&#x27;, [&#x27;</span>data<span class="string">&#x27; =&gt; $this-&gt;data])-&gt;render();</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>


<h2 id="脚部"><a href="#脚部" class="headerlink" title="脚部"></a>脚部</h2><p>一个比较常见的场景是在数据表格的脚部显示统计信息，比如在订单表格的脚部加入收入统计，可以参考下面的代码实现：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">footer</span>(function (<span class="variable">$collection</span>) <span class="keyword">use</span> ($<span class="title">grid</span>) &#123;</span><br><span class="line">	$<span class="title">query</span> = <span class="title">Model</span>::<span class="title">query</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 拿到表格筛选 where 条件数组进行遍历</span></span><br><span class="line">	<span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">getQueries</span>()-&gt;<span class="title function_ invoke__">unique</span>()-&gt;<span class="title function_ invoke__">each</span>(function (<span class="variable">$value</span>) <span class="keyword">use</span> (&amp;$<span class="title">query</span>) &#123;</span><br><span class="line">		<span class="title">if</span> (<span class="title">in_array</span>($<span class="title">value</span>[&#x27;<span class="title">method</span>&#x27;], [&#x27;<span class="title">paginate</span>&#x27;, &#x27;<span class="title">get</span>&#x27;, &#x27;<span class="title">orderBy</span>&#x27;, &#x27;<span class="title">orderByDesc</span>&#x27;], <span class="title">true</span>)) &#123;</span><br><span class="line">		    <span class="title">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="variable">$query</span> = <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$query</span>, <span class="variable">$value</span>[<span class="string">&#x27;method&#x27;</span>]], <span class="variable">$value</span>[<span class="string">&#x27;arguments&#x27;</span>] ?? []);</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 查出统计数据</span></span><br><span class="line">	<span class="variable">$data</span> = <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">get</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;div style=&#x27;padding: 10px;&#x27;&gt;总收入 ： <span class="subst">$data</span>&lt;/div&gt;&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果有比较复杂的脚部需要显示，也可以使用视图对象或者封装成一个类来实现。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-header/" data-id="clpdpxfjw001mywna4obo448f" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-quick-create" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-quick-create/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.974Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="快捷创建"><a href="#快捷创建" class="headerlink" title="快捷创建"></a>快捷创建</h1><p>在表格中开启这个功能之后，会在表格头部增加一个<code>form</code>表单来创建数据，对于一些简单的表格页面，可以方便快速创建数据，不用跳转到创建页面操作</p>
<a href="/assets/img/screenshots/quick-create.png" target="_blank">
    <img  src="/assets/img/screenshots/quick-create.png" style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="100%">
</a>


<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><blockquote>
<p>{tip} 需要注意的是，快捷创建表单中的每一项，在<code>form</code>表单页面要设置相同类型的表单项。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickCreate</span>(function (Grid\Tools\QuickCreate <span class="variable">$create</span>) &#123;</span><br><span class="line">    <span class="variable">$create</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;名称&#x27;</span>);</span><br><span class="line">    <span class="variable">$create</span>-&gt;<span class="title function_ invoke__">email</span>(<span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;邮箱&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置提交地址"><a href="#设置提交地址" class="headerlink" title="设置提交地址"></a>设置提交地址</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickCreate</span>(function (Grid\Tools\QuickCreate <span class="variable">$create</span>) &#123;</span><br><span class="line">    <span class="variable">$create</span>-&gt;<span class="title function_ invoke__">action</span>(<span class="string">&#x27;auth/users&#x27;</span>);</span><br><span class="line">    <span class="variable">$create</span>-&gt;<span class="title function_ invoke__">method</span>(<span class="string">&#x27;GET&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p>表单支持的表单项有下面的几种类型</p>
<h3 id="文本-text"><a href="#文本-text" class="headerlink" title="文本(text)"></a>文本(text)</h3><p>文本输入框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="隐藏表单-hidden"><a href="#隐藏表单-hidden" class="headerlink" title="隐藏表单(hidden)"></a>隐藏表单(hidden)</h3><p>文本输入框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">hidden</span>(<span class="string">&#x27;column_name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="邮箱-email"><a href="#邮箱-email" class="headerlink" title="邮箱(email)"></a>邮箱(email)</h3><p>邮箱输入框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">email</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="IP输入框"><a href="#IP输入框" class="headerlink" title="IP输入框"></a>IP输入框</h3><p>ip地址输入框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">ip</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="URL输入框"><a href="#URL输入框" class="headerlink" title="URL输入框"></a>URL输入框</h3><p>url输入框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">url</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h3 id="密码-password"><a href="#密码-password" class="headerlink" title="密码(password)"></a>密码(password)</h3><p>密码输入框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="手机号-mobile"><a href="#手机号-mobile" class="headerlink" title="手机号(mobile)"></a>手机号(mobile)</h3><p>手机号输入框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">mobile</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="整数-integer"><a href="#整数-integer" class="headerlink" title="整数(integer)"></a>整数(integer)</h3><p>整形数字输入框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="keyword">integer</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="下拉选框-select"><a href="#下拉选框-select" class="headerlink" title="下拉选框(select)"></a>下拉选框(select)</h3><p>单选框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>([</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>


<h3 id="下拉选框多选-multipleSelect"><a href="#下拉选框多选-multipleSelect" class="headerlink" title="下拉选框多选(multipleSelect)"></a>下拉选框多选(multipleSelect)</h3><p>多选框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">multipleSelect</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>([</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="标签-tags"><a href="#标签-tags" class="headerlink" title="标签(tags)"></a>标签(tags)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">tags</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>([</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="弹窗选择器-selectResource"><a href="#弹窗选择器-selectResource" class="headerlink" title="弹窗选择器(selectResource)"></a>弹窗选择器(selectResource)</h3><p>通过<code>selectResource</code>表单可以构建一个弹窗选择器，可以从弹窗里面选择表格数据，并且支持数据筛选等操作。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">selectResource</span>(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">path</span>(<span class="string">&#x27;auth/users&#x27;</span>) <span class="comment">// 设置表格页面链接</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">options</span>(function (<span class="variable">$v</span>) &#123; <span class="comment">// 显示已选中的数据</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$v</span>) <span class="keyword">return</span> <span class="variable">$v</span>;</span><br><span class="line">        <span class="variable">$userModel</span> = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;admin.database.users_model&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$userModel</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$v</span>)-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 设置为多选</span></span><br><span class="line"> <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">selectResource</span>(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">path</span>(<span class="string">&#x27;auth/users&#x27;</span>) </span><br><span class="line">    -&gt;<span class="title function_ invoke__">multiple</span>() <span class="comment">// 设置为多选</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">options</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;);  </span><br><span class="line">    </span><br><span class="line"><span class="comment">// 限制最大选择数量</span></span><br><span class="line"> <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">selectResource</span>(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">path</span>(<span class="string">&#x27;auth/users&#x27;</span>) </span><br><span class="line">    -&gt;<span class="title function_ invoke__">multiple</span>(<span class="number">3</span>) <span class="comment">// 最多选择3个选项</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">options</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;);       </span><br></pre></td></tr></table></figure>

<p>然后设置你的路由<code>app/Admin/routes.php</code></p>
<blockquote>
<p>{tip} 这里的添加路由只是示例，如果是新增的控制器需要加路由，如果路由已经存在则不需要再添加。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;<span class="title function_ invoke__">resource</span>(<span class="string">&#x27;auth/users&#x27;</span>, <span class="string">&#x27;UserController&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>auth/users</code>页面实现代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Models</span>\<span class="title">Administrator</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">IFrameGrid</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Controllers</span>\<span class="title">AdminController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">AdminController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">iFrameGrid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$grid</span> = <span class="keyword">new</span> <span class="title class_">IFrameGrid</span>(<span class="keyword">new</span> <span class="title class_">Administrator</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 指定行选择器选中时显示的值的字段名称</span></span><br><span class="line">        <span class="comment">// 指定行选择器选中时显示的值的字段名称</span></span><br><span class="line">        <span class="comment">// 指定行选择器选中时显示的值的字段名称</span></span><br><span class="line">        <span class="comment">// 如果表格数据中带有 “name”、“title”或“username”字段，则可以不用设置</span></span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">titleColumn</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$grid</span>-&gt;id-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">        <span class="variable">$grid</span>-&gt;username;</span><br><span class="line">        <span class="variable">$grid</span>-&gt;name;</span><br><span class="line">    </span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function (Grid\Filter <span class="variable">$filter</span>) &#123;</span><br><span class="line">            <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">            <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">            <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$grid</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<a href="/assets/img/screenshots/select-resource.png" target="_blank">
    <img  src="/assets/img/screenshots/select-resource.png" style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="100%">
</a>


<h3 id="日期时间选择"><a href="#日期时间选择" class="headerlink" title="日期时间选择"></a>日期时间选择</h3><p>时间日期输入框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">datetime</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="时间选择-time"><a href="#时间选择-time" class="headerlink" title="时间选择(time)"></a>时间选择(time)</h3><p>时间输入框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">time</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="日期选择"><a href="#日期选择" class="headerlink" title="日期选择"></a>日期选择</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$create</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;placeholder...&#x27;</span>);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-quick-create/" data-id="clpdpxfk7001nywna7vfq4rum" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-exporter" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-exporter/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.973Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="自定义导出"><a href="#自定义导出" class="headerlink" title="自定义导出"></a>自定义导出</h1><p>dcat-admin的数据表格默认支持导出csv文件，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Exporters</span>\<span class="title">AbstractExporter</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomExporter</span> <span class="keyword">extends</span> <span class="title">AbstractExporter</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">export</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getTable</span>().<span class="string">&#x27;.csv&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getData</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$output</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$headers</span> = [</span><br><span class="line">            <span class="string">&#x27;Content-Encoding&#x27;</span>    =&gt; <span class="string">&#x27;UTF-8&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>        =&gt; <span class="string">&#x27;text/csv;charset=UTF-8&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Content-Disposition&#x27;</span> =&gt; <span class="string">&quot;attachment; filename=\&quot;<span class="subst">$filename</span>\&quot;&quot;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">response</span>(<span class="title function_ invoke__">rtrim</span>(<span class="variable">$output</span>, <span class="string">&quot;\n&quot;</span>), <span class="number">200</span>, <span class="variable">$headers</span>)-&gt;<span class="title function_ invoke__">send</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-exporter/" data-id="clpdpxfjv001kywna625kfsnv" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-filters" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-filters/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.973Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="查询过滤"><a href="#查询过滤" class="headerlink" title="查询过滤"></a>查询过滤</h1><p><code>model-grid</code>提供了一系列的方法实现表格数据的查询过滤：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableFilter</span>();</span><br><span class="line"><span class="comment">// 显示</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showFilter</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用过滤器按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableFilterButton</span>();</span><br><span class="line"><span class="comment">// 显示过滤器按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showFilterButton</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function(<span class="variable">$filter</span>)&#123;</span><br><span class="line">    <span class="comment">// 展开过滤器</span></span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">expand</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 在这里添加字段过滤器</span></span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;产品序列号&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="过滤器布局"><a href="#过滤器布局" class="headerlink" title="过滤器布局"></a>过滤器布局</h2><p>默认布局方式为<code>rightSide</code></p>
<h3 id="rightSide"><a href="#rightSide" class="headerlink" title="rightSide"></a>rightSide</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function (Grid\Filter <span class="variable">$filter</span>) &#123;</span><br><span class="line">    <span class="comment">// 更改为 rightSide 布局</span></span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">rightSide</span>();</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>效果</p>
<p><img src="https://cdn.learnku.com/uploads/images/202004/26/38389/3g9EdvZTQA.png!large"></p>
<h3 id="panel"><a href="#panel" class="headerlink" title="panel"></a>panel</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function (Grid\Filter <span class="variable">$filter</span>) &#123;</span><br><span class="line">    <span class="comment">// 更改为 panel 布局</span></span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">panel</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注意切换为panel布局方式时需要重新调整表单字段的宽度</span></span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;id&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>效果</p>
<p><img src="https://cdn.learnku.com/uploads/images/202004/26/38389/vkPFs0Hnil.png!large"></p>
<h3 id="自定义布局-view"><a href="#自定义布局-view" class="headerlink" title="自定义布局 (view)"></a>自定义布局 (view)</h3><p>如果以上的布局无法满足需求，可以通过<code>view</code>方法自定义过滤器模板</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function (<span class="variable">$filter</span>) &#123;</span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">view</span>(<span class="string">&#x27;xxx&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p><a name="type"></a></p>
<h2 id="查询类型"><a href="#查询类型" class="headerlink" title="查询类型"></a>查询类型</h2><p>目前支持的过滤类型有下面这些:</p>
<p><a name="equal"></a></p>
<h3 id="equal"><a href="#equal" class="headerlink" title="equal"></a>equal</h3><p><code>sql: ... WHERE </code>column<code> = &quot;$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<p><a name="nequal"></a></p>
<h3 id="notEqual"><a href="#notEqual" class="headerlink" title="notEqual"></a>notEqual</h3><p><code>sql: ... WHERE </code>column<code> != &quot;$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">notEqual</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>
<p><a name="like"></a></p>
<h3 id="like"><a href="#like" class="headerlink" title="like"></a>like</h3><p><code>sql: ... WHERE </code>column<code> LIKE &quot;%$input%&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<h3 id="ilike"><a href="#ilike" class="headerlink" title="ilike"></a>ilike</h3><p><code>sql: ... WHERE </code>column<code> ILIKE &quot;%$input%&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">ilike</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>
<p><a name="startwith"></a></p>
<h3 id="startWith"><a href="#startWith" class="headerlink" title="startWith"></a>startWith</h3><p><code>sql: ... WHERE </code>column<code> LIKE &quot;$input%&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">startWith</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果需要使用“ilike”</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">startWith</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>)-&gt;<span class="title function_ invoke__">ilike</span>();</span><br></pre></td></tr></table></figure>

<p><a name="endwith"></a></p>
<h3 id="endWith"><a href="#endWith" class="headerlink" title="endWith"></a>endWith</h3><p><code>sql: ... WHERE </code>column<code> LIKE &quot;%$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">endWith</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果需要使用“ilike”</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">endWith</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>)-&gt;<span class="title function_ invoke__">ilike</span>();</span><br></pre></td></tr></table></figure>

<p><a name="gt"></a></p>
<h3 id="gt"><a href="#gt" class="headerlink" title="gt"></a>gt</h3><p><code>sql: ... WHERE </code>column<code> &gt; &quot;$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">gt</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<p><a name="lt"></a></p>
<h3 id="lt"><a href="#lt" class="headerlink" title="lt"></a>lt</h3><p><code>sql: ... WHERE </code>column<code> &lt; &quot;$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">lt</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<p><a name="ngt"></a></p>
<h3 id="ngt"><a href="#ngt" class="headerlink" title="ngt"></a>ngt</h3><p><code>sql: ... WHERE </code>column<code> &lt;= &quot;$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">ngt</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<p><a name="nlt"></a></p>
<h3 id="nlt"><a href="#nlt" class="headerlink" title="nlt"></a>nlt</h3><p><code>sql: ... WHERE </code>column<code> &gt;= &quot;$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">nlt</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<p><a name="between"></a></p>
<h3 id="between"><a href="#between" class="headerlink" title="between"></a>between</h3><p><code>sql: ... WHERE </code>column<code> BETWEEN &quot;$start&quot; AND &quot;$end&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">between</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置datetime类型</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">between</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>)-&gt;<span class="title function_ invoke__">datetime</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置time类型</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">between</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>)-&gt;<span class="title function_ invoke__">time</span>();</span><br></pre></td></tr></table></figure>

<p><a name="in"></a></p>
<h3 id="in"><a href="#in" class="headerlink" title="in"></a>in</h3><p><code>sql: ... WHERE </code>column<code> in (...$inputs)</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">in</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>)-&gt;<span class="title function_ invoke__">multipleSelect</span>([<span class="string">&#x27;key&#x27;</span> =&gt; <span class="string">&#x27;value&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="notIn"></a></p>
<h3 id="notIn"><a href="#notIn" class="headerlink" title="notIn"></a>notIn</h3><p><code>sql: ... WHERE </code>column<code> not in (...$inputs)</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">notIn</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>)-&gt;<span class="title function_ invoke__">multipleSelect</span>([<span class="string">&#x27;key&#x27;</span> =&gt; <span class="string">&#x27;value&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="date"></a></p>
<h3 id="date"><a href="#date" class="headerlink" title="date"></a>date</h3><p><code>sql: ... WHERE DATE(</code>column<code>) = &quot;$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<p><a name="day"></a></p>
<h3 id="day"><a href="#day" class="headerlink" title="day"></a>day</h3><p><code>sql: ... WHERE DAY(</code>column<code>) = &quot;$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">day</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<p><a name="month"></a></p>
<h3 id="month"><a href="#month" class="headerlink" title="month"></a>month</h3><p><code>sql: ... WHERE MONTH(</code>column<code>) = &quot;$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">month</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<p><a name="year"></a></p>
<h3 id="year"><a href="#year" class="headerlink" title="year"></a>year</h3><p><code>sql: ... WHERE YEAR(</code>column<code>) = &quot;$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">year</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<p><a name="findinset"></a></p>
<h3 id="findInSet"><a href="#findInSet" class="headerlink" title="findInSet"></a>findInSet</h3><p><code>sql: ... WHERE FIND_IN_SET(&quot;$input&quot;, $column)</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">findInSet</span>(<span class="string">&#x27;column&#x27;</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>

<p><a name="where"></a></p>
<h3 id="复杂查询where"><a href="#复杂查询where" class="headerlink" title="复杂查询where"></a>复杂查询where</h3><p>可以用where来构建比较复杂的查询过滤</p>
<p><code>sql: ... WHERE </code>title<code>LIKE &quot;%$input&quot; OR</code>content<code> LIKE &quot;%$input&quot;</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;search&#x27;</span>, function (<span class="variable">$query</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">&#123;$this-&gt;input&#125;</span>%&quot;</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">orWhere</span>(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">&#123;$this-&gt;input&#125;</span>%&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>sql: ... WHERE </code>rate<code>&gt;= 6 AND</code>created_at<code> = &#123;$input&#125;</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;Text&#x27;</span>, function (<span class="variable">$query</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">whereRaw</span>(<span class="string">&quot;`rate` &gt;= 6 AND `created_at` = <span class="subst">&#123;$this-&gt;input&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>关系查询，查询对应关系<code>profile</code>的字段：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;mobile&#x27;</span>, function (<span class="variable">$query</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">whereHas</span>(<span class="string">&#x27;profile&#x27;</span>, function (<span class="variable">$query</span>) &#123;</span><br><span class="line">        <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;address&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">&#123;$this-&gt;input&#125;</span>%&quot;</span>)-&gt;<span class="title function_ invoke__">orWhere</span>(<span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">&#123;$this-&gt;input&#125;</span>%&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;, <span class="string">&#x27;地址或手机号&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="whereBetween"></a></p>
<h3 id="复杂范围查询whereBetween"><a href="#复杂范围查询whereBetween" class="headerlink" title="复杂范围查询whereBetween"></a>复杂范围查询whereBetween</h3><p>通过<code>whereBetween</code>可以自定义范围查询</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">whereBetween</span>(<span class="string">&#x27;created_at&#x27;</span>, function (<span class="variable">$q</span>) &#123;</span><br><span class="line">	<span class="variable">$start</span> = <span class="variable language_">$this</span>-&gt;input[<span class="string">&#x27;start&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">	<span class="variable">$end</span> = <span class="variable language_">$this</span>-&gt;input[<span class="string">&#x27;end&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$q</span>-&gt;<span class="title function_ invoke__">whereHas</span>(<span class="string">&#x27;goods&#x27;</span>, function (<span class="variable">$q</span>) <span class="keyword">use</span> ($<span class="title">start</span>) &#123;</span><br><span class="line">		<span class="title">if</span> ($<span class="title">start</span> !== <span class="title">null</span>) &#123;</span><br><span class="line">			$<span class="title">q</span>-&gt;<span class="title">where</span>(&#x27;<span class="title">price</span>&#x27;, &#x27;&gt;=&#x27;, $<span class="title">start</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		 </span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$end</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="variable">$q</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;&lt;=&#x27;</span>, <span class="variable">$end</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);       </span><br></pre></td></tr></table></figure>

<p>同时这个方法也支持时间日期范围查询</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">whereBetween</span>(<span class="string">&#x27;created_at&#x27;</span>, function (<span class="variable">$q</span>) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">datetime</span>(); </span><br></pre></td></tr></table></figure>

<p><a name="group"></a></p>
<h3 id="过滤器组group"><a href="#过滤器组group" class="headerlink" title="过滤器组group"></a>过滤器组group</h3><p>有时候对同一个字段要设置多种筛选方式，可以通过下面的方式实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">group</span>(<span class="string">&#x27;rate&#x27;</span>, function (<span class="variable">$group</span>) &#123;</span><br><span class="line">    <span class="variable">$group</span>-&gt;<span class="title function_ invoke__">gt</span>(<span class="string">&#x27;大于&#x27;</span>);</span><br><span class="line">    <span class="variable">$group</span>-&gt;<span class="title function_ invoke__">lt</span>(<span class="string">&#x27;小于&#x27;</span>);</span><br><span class="line">    <span class="variable">$group</span>-&gt;<span class="title function_ invoke__">nlt</span>(<span class="string">&#x27;不小于&#x27;</span>);</span><br><span class="line">    <span class="variable">$group</span>-&gt;<span class="title function_ invoke__">ngt</span>(<span class="string">&#x27;不大于&#x27;</span>);</span><br><span class="line">    <span class="variable">$group</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;等于&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>有下面的几个方法可以调用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 等于</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">equal</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不等于</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">notEqual</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 大于</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">gt</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 小于</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">lt</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 大于等于</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">nlt</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 小于等于</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">ngt</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="keyword">match</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复杂条件</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">where</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// like查询</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">like</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// like查询</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">contains</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ilike查询</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">ilike</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以输入的内容开头</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">startWith</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以输入的内容结尾</span></span><br><span class="line"><span class="variable">$group</span>-&gt;<span class="title function_ invoke__">endWith</span>();</span><br></pre></td></tr></table></figure>

<p><a name="scope"></a></p>
<h3 id="范围查询scope"><a href="#范围查询scope" class="headerlink" title="范围查询scope"></a>范围查询scope</h3><p>可以把你最常用的查询定义为一个查询范围，它将会出现在筛选按钮的下拉菜单中，下面是几个例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">scope</span>(<span class="string">&#x27;male&#x27;</span>, <span class="string">&#x27;男性&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;m&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多条件查询</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">scope</span>(<span class="string">&#x27;new&#x27;</span>, <span class="string">&#x27;最近修改&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">whereDate</span>(<span class="string">&#x27;created_at&#x27;</span>, <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d&#x27;</span>))</span><br><span class="line">    -&gt;<span class="title function_ invoke__">orWhere</span>(<span class="string">&#x27;updated_at&#x27;</span>, <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关联关系查询</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">scope</span>(<span class="string">&#x27;address&#x27;</span>)-&gt;<span class="title function_ invoke__">whereHas</span>(<span class="string">&#x27;profile&#x27;</span>, function (<span class="variable">$query</span>) &#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">whereNotNull</span>(<span class="string">&#x27;address&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">scope</span>(<span class="string">&#x27;trashed&#x27;</span>, <span class="string">&#x27;被软删除的数据&#x27;</span>)-&gt;<span class="title function_ invoke__">onlyTrashed</span>();</span><br></pre></td></tr></table></figure>
<p>scope方法第一个参数为查询的key, 会出现的url参数中，第二个参数是下拉菜单项的label, 如果不填，第一个参数会作为label显示</p>
<p>scope方法可以链式调用任何eloquent查询条件，效果参考Demo</p>
<p><a name="form"></a></p>
<h2 id="表单类型"><a href="#表单类型" class="headerlink" title="表单类型"></a>表单类型</h2><p><a name="text"></a></p>
<h3 id="text"><a href="#text" class="headerlink" title="text"></a>text</h3><p>表单类型默认是<code>text input</code>，可以设置<code>placeholder</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">placeholder</span>(<span class="string">&#x27;请输入。。。&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>也可以通过下面的一些方法来限制用户输入格式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">url</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">email</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="keyword">integer</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">ip</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">mac</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">mobile</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// $options 参考 https://github.com/RobinHerbots/Inputmask/blob/4.x/README_numeric.md</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">decimal</span>(<span class="variable">$options</span> = []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $options 参考 https://github.com/RobinHerbots/Inputmask/blob/4.x/README_numeric.md</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">currency</span>(<span class="variable">$options</span> = []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $options 参考 https://github.com/RobinHerbots/Inputmask/blob/4.x/README_numeric.md</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">percentage</span>(<span class="variable">$options</span> = []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $options 参考 https://github.com/RobinHerbots/Inputmask, $icon为input前面的图标</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">inputmask</span>(<span class="variable">$options</span> = [], <span class="variable">$icon</span> = <span class="string">&#x27;pencil&#x27;</span>);</span><br></pre></td></tr></table></figure>


<p><a name="select-table"></a></p>
<h3 id="表格选择器-selectTable"><a href="#表格选择器-selectTable" class="headerlink" title="表格选择器 (selectTable)"></a>表格选择器 (selectTable)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">UserTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Models</span>\<span class="title">Administrator</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">selectTable</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; ...])) <span class="comment">// 设置渲染类实例，并传递自定义参数</span></span><br><span class="line">	-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;弹窗标题&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">dialogWidth</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 弹窗宽度，默认 800px</span></span><br><span class="line">	-&gt;<span class="title function_ invoke__">model</span>(<span class="title class_">Administrator</span>::<span class="variable language_">class</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>); <span class="comment">// 设置编辑数据显示</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">// 上面的代码等同于</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">selectTable</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; ...])) <span class="comment">// 设置渲染类实例，并传递自定义参数</span></span><br><span class="line">	-&gt;<span class="title function_ invoke__">options</span>(function (<span class="variable">$v</span>) &#123; <span class="comment">// 设置编辑数据显示</span></span><br><span class="line">		<span class="keyword">if</span> (! <span class="variable">$v</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> [];</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="title class_">Administrator</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$v</span>)-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>

<p>定义渲染类如下，需要继承<code>Dcat\Admin\Grid\LazyRenderable</code></p>
<blockquote>
<p>{tip} 这里使用了数据表格异步加载功能，详细用法请参考<a href="lazy.md">异步加载</a></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Renderable</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Models</span>\<span class="title">Administrator</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserTable</span> <span class="keyword">extends</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>): <span class="title">Grid</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取外部传递的参数</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Administrator</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Grid <span class="variable">$grid</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;created_at&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;updated_at&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 指定行选择器选中时显示的值的字段名称</span></span><br><span class="line">			<span class="comment">// 指定行选择器选中时显示的值的字段名称</span></span><br><span class="line">			<span class="comment">// 指定行选择器选中时显示的值的字段名称</span></span><br><span class="line">			<span class="comment">// 如果表格数据中带有 “name”、“title”或“username”字段，则可以不用设置</span></span><br><span class="line">			<span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">titleColumn</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>([<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">paginate</span>(<span class="number">10</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableActions</span>();</span><br><span class="line"></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function (Grid\Filter <span class="variable">$filter</span>) &#123;</span><br><span class="line">                <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;username&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="number">4</span>);</span><br><span class="line">                <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="number">4</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="多选-multipleSelectTable"><a href="#多选-multipleSelectTable" class="headerlink" title="多选 (multipleSelectTable)"></a>多选 (multipleSelectTable)</h4><p>多选的用法与上述<code>selectTable</code>方法一致</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">in</span>(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">multipleSelectTable</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getKey</span>()])) <span class="comment">// 设置渲染类实例，并传递自定义参数</span></span><br><span class="line">	-&gt;<span class="title function_ invoke__">max</span>(<span class="number">10</span>) <span class="comment">// 最多选择 10 个选项，不传则不限制</span></span><br><span class="line">	-&gt;<span class="title function_ invoke__">model</span>(<span class="title class_">Administrator</span>::<span class="variable language_">class</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>); <span class="comment">// 设置编辑数据显示</span></span><br></pre></td></tr></table></figure>



<p><a name="select"></a></p>
<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>([<span class="string">&#x27;key&#x27;</span> =&gt; <span class="string">&#x27;value&#x27;</span>...]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者从api获取数据，api的格式参考model-form的select组件</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;api/users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="multipleSelect"></a></p>
<h3 id="multipleSelect"><a href="#multipleSelect" class="headerlink" title="multipleSelect"></a>multipleSelect</h3><p>一般用来配合<code>in</code>和<code>notIn</code>两个需要查询数组的查询类型使用，也可以在<code>where</code>类型的查询中使用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">in</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">multipleSelect</span>([<span class="string">&#x27;key&#x27;</span> =&gt; <span class="string">&#x27;value&#x27;</span>...]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者从api获取数据，api的格式参考model-form的multipleSelect组件</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">in</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">multipleSelect</span>(<span class="string">&#x27;api/users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="datetime"></a></p>
<h3 id="datetime"><a href="#datetime" class="headerlink" title="datetime"></a>datetime</h3><p>通过日期时间组件来查询，<code>$options</code>的参数和值参考<a target="_blank" rel="noopener" href="http://eonasdan.github.io/bootstrap-datetimepicker/Options/">bootstrap-datetimepicker</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">datetime</span>(<span class="variable">$options</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// `date()` 相当于 `datetime([&#x27;format&#x27; =&gt; &#x27;YYYY-MM-DD&#x27;])`</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">date</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// `time()` 相当于 `datetime([&#x27;format&#x27; =&gt; &#x27;HH:mm:ss&#x27;])`</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">time</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// `day()` 相当于 `datetime([&#x27;format&#x27; =&gt; &#x27;DD&#x27;])`</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">day</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// `month()` 相当于 `datetime([&#x27;format&#x27; =&gt; &#x27;MM&#x27;])`</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">month</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// `year()` 相当于 `datetime([&#x27;format&#x27; =&gt; &#x27;YYYY&#x27;])`</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">year</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果你的时间日期字段在数据库中存储的是时间戳类型，那么可以通过<code>toTimestamp</code>方法把表单的值转化为时间戳</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">datetime</span>(<span class="variable">$options</span>)-&gt;<span class="title function_ invoke__">toTimestamp</span>();</span><br></pre></td></tr></table></figure>


<p><a name="method"></a></p>
<h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><p><a name="width"></a></p>
<h3 id="过滤器宽度-width"><a href="#过滤器宽度-width" class="headerlink" title="过滤器宽度 (width)"></a>过滤器宽度 (width)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置为“1-12”之间的值，默认值是“3”</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以写死宽度</span></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="string">&#x27;250px&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="default"></a></p>
<h3 id="设置默认值-default"><a href="#设置默认值-default" class="headerlink" title="设置默认值 (default)"></a>设置默认值 (default)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="keyword">default</span>(<span class="string">&#x27;text&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>([<span class="number">0</span> =&gt; <span class="string">&#x27;PHP&#x27;</span>, <span class="number">1</span> =&gt; <span class="string">&#x27;Java&#x27;</span>])-&gt;<span class="keyword">default</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><a name="expand"></a></p>
<h3 id="展开过滤器-expand"><a href="#展开过滤器-expand" class="headerlink" title="展开过滤器 (expand)"></a>展开过滤器 (expand)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">expand</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><a name="withoutInputBorder"></a></p>
<h3 id="不显示过滤器input输入框的边框"><a href="#不显示过滤器input输入框的边框" class="headerlink" title="不显示过滤器input输入框的边框"></a>不显示过滤器input输入框的边框</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">withoutInputBorder</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><a name="style"></a></p>
<h3 id="设置过滤器容器样式"><a href="#设置过滤器容器样式" class="headerlink" title="设置过滤器容器样式"></a>设置过滤器容器样式</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">style</span>(<span class="string">&#x27;padding:0&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><a name="padding"></a></p>
<h3 id="设置过滤器容器padding"><a href="#设置过滤器容器padding" class="headerlink" title="设置过滤器容器padding"></a>设置过滤器容器padding</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">padding</span>(<span class="string">&#x27;10px&#x27;</span>, <span class="string">&#x27;10px&#x27;</span>, <span class="string">&#x27;10px&#x27;</span>, <span class="string">&#x27;10px&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="忽略筛选项-ignore"><a href="#忽略筛选项-ignore" class="headerlink" title="忽略筛选项 (ignore)"></a>忽略筛选项 (ignore)</h3><p>通过<code>ignore</code>方法可以在提交表单时忽略当前筛选项</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">equal</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">ignore</span>();</span><br></pre></td></tr></table></figure>


<p><a name="relation"></a></p>
<h2 id="关联关系字段查询"><a href="#关联关系字段查询" class="headerlink" title="关联关系字段查询"></a>关联关系字段查询</h2><p>假设你的模型如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">profile</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">hasOne</span>(...);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">myPosts</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">hasMany</span>(...);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过下面的方法可以查询<code>profiles</code>表的<code>first_name</code>字段以及<code>posts</code>表的<code>title</code>字段</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function (<span class="variable">$filter</span>) &#123;</span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;profile.first_name&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;myPosts.title&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果安装了 <a target="_blank" rel="noopener" href="https://github.com/jqhph/laravel-wherehasin">dcat&#x2F;laravel-wherehasin</a>，则会优先使用<code>whereHasIn</code>方法进行查询操作</p>
<p><a name="extend"></a></p>
<h2 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h2><p>下面通过<code>between</code>的实现来讲解下怎么自定义过滤器。</p>
<p>首先新建一个过滤器类继承<code>Dcat\Admin\Grid\Filter\AbstractFilter</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Dcat</span>\<span class="title class_">Admin</span>\<span class="title class_">Grid</span>\<span class="title class_">Filter</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Filter</span>\<span class="title">Presenter</span>\<span class="title">DateTime</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Arr</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Between</span> <span class="keyword">extends</span> <span class="title">AbstractFilter</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 自定义你的过滤器显示模板</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$view</span> = <span class="string">&#x27;admin::filter.between&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这个方法用于生成过滤器字段的唯一id</span></span><br><span class="line">    <span class="comment">// 通过这个唯一id则可以用js代码对其进行操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">formatId</span>(<span class="params"><span class="variable">$column</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="variable">$id</span>   = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$column</span>);</span><br><span class="line">       <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span>-&gt;<span class="title function_ invoke__">getGrid</span>()-&gt;<span class="title function_ invoke__">getName</span>();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> [<span class="string">&#x27;start&#x27;</span> =&gt; <span class="string">&quot;<span class="subst">&#123;$name&#125;</span><span class="subst">&#123;$id&#125;</span>_start&quot;</span>, <span class="string">&#x27;end&#x27;</span> =&gt; <span class="string">&quot;<span class="subst">&#123;$name&#125;</span><span class="subst">&#123;$id&#125;</span>_end&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// form表单name属性格式化</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">formatName</span>(<span class="params"><span class="variable">$column</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$columns</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$column</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">count</span>(<span class="variable">$columns</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable">$name</span> = <span class="variable">$columns</span>[<span class="number">0</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$name</span> = <span class="title function_ invoke__">array_shift</span>(<span class="variable">$columns</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$columns</span> <span class="keyword">as</span> <span class="variable">$column</span>) &#123;</span><br><span class="line">                <span class="variable">$name</span> .= <span class="string">&quot;[<span class="subst">$column</span>]&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;start&#x27;</span> =&gt; <span class="string">&quot;<span class="subst">&#123;$name&#125;</span>[start]&quot;</span>, <span class="string">&#x27;end&#x27;</span> =&gt; <span class="string">&quot;<span class="subst">&#123;$name&#125;</span>[end]&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建条件</span></span><br><span class="line">    <span class="comment">// 这里构建的条件支持`Laravel query builder`即可。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">condition</span>(<span class="params"><span class="variable">$inputs</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title class_">Arr</span>::<span class="title function_ invoke__">has</span>(<span class="variable">$inputs</span>, <span class="variable">$this</span>-&gt;column)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;value = <span class="title class_">Arr</span>::<span class="title function_ invoke__">get</span>(<span class="variable">$inputs</span>, <span class="variable">$this</span>-&gt;column);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$value</span> = <span class="title function_ invoke__">array_filter</span>(<span class="variable">$this</span>-&gt;value, function (<span class="variable">$val</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$val</span> !== <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$value</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$value</span>[<span class="string">&#x27;start&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$value</span>[<span class="string">&#x27;end&#x27;</span>])) &#123;</span><br><span class="line">            <span class="comment">// 这里返回的数组相当于</span></span><br><span class="line">            <span class="comment">// $query-&gt;where($this-&gt;column, &#x27;&lt;=&#x27;, $value[&#x27;end&#x27;]);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildCondition</span>(<span class="variable">$this</span>-&gt;column, <span class="string">&#x27;&lt;=&#x27;</span>, <span class="variable">$value</span>[<span class="string">&#x27;end&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$value</span>[<span class="string">&#x27;end&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$value</span>[<span class="string">&#x27;start&#x27;</span>])) &#123;</span><br><span class="line">            <span class="comment">// 这里返回的数组相当于</span></span><br><span class="line">            <span class="comment">// $query-&gt;where($this-&gt;column, &#x27;&gt;=&#x27;, $value[&#x27;end&#x27;]);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildCondition</span>(<span class="variable">$this</span>-&gt;column, <span class="string">&#x27;&gt;=&#x27;</span>, <span class="variable">$value</span>[<span class="string">&#x27;start&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;query = <span class="string">&#x27;whereBetween&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里返回的数组相当于</span></span><br><span class="line">        <span class="comment">// $query-&gt;whereBetween($this-&gt;column, $value[&#x27;end&#x27;]);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">buildCondition</span>(<span class="variable">$this</span>-&gt;column, <span class="variable">$this</span>-&gt;value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义过滤器表单显示方式</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">datetime</span>(<span class="params"><span class="variable">$options</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;view = <span class="string">&#x27;admin::filter.betweenDatetime&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">DateTime</span>::<span class="title function_ invoke__">collectAssets</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setupDatetime</span>(<span class="variable">$options</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">setupDatetime</span>(<span class="params"><span class="variable">$options</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$options</span>[<span class="string">&#x27;format&#x27;</span>] = <span class="title class_">Arr</span>::<span class="title function_ invoke__">get</span>(<span class="variable">$options</span>, <span class="string">&#x27;format&#x27;</span>, <span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>);</span><br><span class="line">        <span class="variable">$options</span>[<span class="string">&#x27;locale&#x27;</span>] = <span class="title class_">Arr</span>::<span class="title function_ invoke__">get</span>(<span class="variable">$options</span>, <span class="string">&#x27;locale&#x27;</span>, <span class="title function_ invoke__">config</span>(<span class="string">&#x27;app.locale&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable">$startOptions</span> = <span class="title function_ invoke__">json_encode</span>(<span class="variable">$options</span>);</span><br><span class="line">        <span class="variable">$endOptions</span> = <span class="title function_ invoke__">json_encode</span>(<span class="variable">$options</span> + [<span class="string">&#x27;useCurrent&#x27;</span> =&gt; <span class="literal">false</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过上面格式化后的id对表单进行你想要的操作</span></span><br><span class="line">        <span class="variable">$script</span> = <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">            $(&#x27;#<span class="subst">&#123;$this-&gt;id[&#x27;start&#x27;]&#125;</span>&#x27;).datetimepicker(<span class="subst">$startOptions</span>);</span></span><br><span class="line"><span class="string">            $(&#x27;#<span class="subst">&#123;$this-&gt;id[&#x27;end&#x27;]&#125;</span>&#x27;).datetimepicker(<span class="subst">$endOptions</span>);</span></span><br><span class="line"><span class="string">            $(&quot;#<span class="subst">&#123;$this-&gt;id[&#x27;start&#x27;]&#125;</span>&quot;).on(&quot;dp.change&quot;, function (e) &#123;</span></span><br><span class="line"><span class="string">                $(&#x27;#<span class="subst">&#123;$this-&gt;id[&#x27;end&#x27;]&#125;</span>&#x27;).data(&quot;DateTimePicker&quot;).minDate(e.date);</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string">            $(&quot;#<span class="subst">&#123;$this-&gt;id[&#x27;end&#x27;]&#125;</span>&quot;).on(&quot;dp.change&quot;, function (e) &#123;</span></span><br><span class="line"><span class="string">                $(&#x27;#<span class="subst">&#123;$this-&gt;id[&#x27;start&#x27;]&#125;</span>&#x27;).data(&quot;DateTimePicker&quot;).maxDate(e.date);</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string">JS</span>;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Admin</span>::<span class="title function_ invoke__">script</span>(<span class="variable">$script</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>admin::filter.between</code>模板内容如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">filter</span>-<span class="title">input</span> <span class="title">col</span>-<span class="title">sm</span>-</span>&#123;&#123; <span class="variable">$width</span> &#125;&#125; <span class="string">&quot;  style=&quot;</span>&#123;!! <span class="variable">$style</span> !!&#125;<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>form-group<span class="string">&quot; &gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>input-group input-group-sm<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;span class=&quot;</span>input-group-addon<span class="string">&quot;&gt;&lt;b&gt;&#123;!! <span class="subst">$label</span> !!&#125;&lt;/b&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;</span>text<span class="string">&quot; class=&quot;</span>form-control<span class="string">&quot; placeholder=&quot;</span>&#123;&#123;<span class="variable">$label</span>&#125;&#125;<span class="string">&quot; name=&quot;</span>&#123;&#123;<span class="variable">$name</span>[<span class="string">&#x27;start&#x27;</span>]&#125;&#125;<span class="string">&quot; value=&quot;</span>&#123;&#123; <span class="title function_ invoke__">request</span>(<span class="variable">$name</span>[<span class="string">&#x27;start&#x27;</span>], <span class="title class_">\Illuminate\Support\Arr</span>::<span class="title function_ invoke__">get</span>(<span class="variable">$value</span>, <span class="string">&#x27;start&#x27;</span>)) &#125;&#125;<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;span class=&quot;</span>input-group-addon<span class="string">&quot; style=&quot;</span>border-left: <span class="number">0</span>; border-right: <span class="number">0</span>;<span class="string">&quot;&gt;To&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;</span>text<span class="string">&quot; class=&quot;</span>form-control<span class="string">&quot; placeholder=&quot;</span>&#123;&#123;<span class="variable">$label</span>&#125;&#125;<span class="string">&quot; name=&quot;</span>&#123;&#123;<span class="variable">$name</span>[<span class="string">&#x27;end&#x27;</span>]&#125;&#125;<span class="string">&quot; value=&quot;</span>&#123;&#123; <span class="title function_ invoke__">request</span>(<span class="variable">$name</span>[<span class="string">&#x27;end&#x27;</span>], <span class="title class_">\Illuminate\Support\Arr</span>::<span class="title function_ invoke__">get</span>(<span class="variable">$value</span>, <span class="string">&#x27;end&#x27;</span>)) &#125;&#125;<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>admin::filter.betweenDatetime</code>模板内容如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">filter</span>-<span class="title">input</span> <span class="title">col</span>-<span class="title">sm</span>-</span>&#123;&#123; <span class="variable">$width</span> &#125;&#125;<span class="string">&quot;  style=&quot;</span>&#123;!! <span class="variable">$style</span> !!&#125;<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>form-group<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>input-group input-group-sm<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;span class=&quot;</span>input-group-addon<span class="string">&quot;&gt;&lt;b&gt;&#123;<span class="subst">&#123;$label&#125;</span>&#125;&lt;/b&gt;  &amp;nbsp;&lt;i class=&quot;</span>fa fa-calendar<span class="string">&quot;&gt;&lt;/i&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;</span>text<span class="string">&quot; class=&quot;</span>form-control<span class="string">&quot; id=&quot;</span>&#123;&#123;<span class="variable">$id</span>[<span class="string">&#x27;start&#x27;</span>]&#125;&#125;<span class="string">&quot; placeholder=&quot;</span>&#123;&#123;<span class="variable">$label</span>&#125;&#125;<span class="string">&quot; name=&quot;</span>&#123;&#123;<span class="variable">$name</span>[<span class="string">&#x27;start&#x27;</span>]&#125;&#125;<span class="string">&quot; value=&quot;</span>&#123;&#123; <span class="title function_ invoke__">request</span>(<span class="variable">$name</span>[<span class="string">&#x27;start&#x27;</span>], <span class="title class_">\Illuminate\Support\Arr</span>::<span class="title function_ invoke__">get</span>(<span class="variable">$value</span>, <span class="string">&#x27;start&#x27;</span>)) &#125;&#125;<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;span class=&quot;</span>input-group-addon<span class="string">&quot; style=&quot;</span>border-left: <span class="number">0</span>; border-right: <span class="number">0</span>;<span class="string">&quot;&gt;To&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;</span>text<span class="string">&quot; class=&quot;</span>form-control<span class="string">&quot; id=&quot;</span>&#123;&#123;<span class="variable">$id</span>[<span class="string">&#x27;end&#x27;</span>]&#125;&#125;<span class="string">&quot; placeholder=&quot;</span>&#123;&#123;<span class="variable">$label</span>&#125;&#125;<span class="string">&quot; name=&quot;</span>&#123;&#123;<span class="variable">$name</span>[<span class="string">&#x27;end&#x27;</span>]&#125;&#125;<span class="string">&quot; value=&quot;</span>&#123;&#123; <span class="title function_ invoke__">request</span>(<span class="variable">$name</span>[<span class="string">&#x27;end&#x27;</span>], <span class="title class_">\Illuminate\Support\Arr</span>::<span class="title function_ invoke__">get</span>(<span class="variable">$value</span>, <span class="string">&#x27;end&#x27;</span>)) &#125;&#125;<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在只要调用<code>extend</code>方法可以使用了，打开<code>app/Admin/bootstrap.php</code>，加入以下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Filter</span>::<span class="title function_ invoke__">extend</span>(<span class="string">&#x27;customBetween&#x27;</span>, <span class="title class_">Filter\Between</span>::<span class="variable language_">class</span>);</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">customBetween</span>(<span class="string">&#x27;created_at&#x27;</span>)-&gt;<span class="title function_ invoke__">datetime</span>();</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-filters/" data-id="clpdpxfjv001lywna26y2dro4" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-events" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-events/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.972Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="数据表格事件"><a href="#数据表格事件" class="headerlink" title="数据表格事件"></a>数据表格事件</h1><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>通过 <code>Grid::resolving</code> 方法可以监听表格初始化事件。</p>
<p>开发者可以在这两个事件中改变 <code>Grid</code> 的一些设置或行为，比如需要禁用掉某些操作，可以在 <code>app/Admin/bootstrap.php</code> 加入下面的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Grid</span>::<span class="title function_ invoke__">resolving</span>(function (Grid <span class="variable">$grid</span>) &#123;</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableActions</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disablePagination</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableCreateButton</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableFilter</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableRowSelector</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableToolbar</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 只需要监听一次</span></span><br><span class="line"><span class="title class_">Grid</span>::<span class="title function_ invoke__">resolving</span>(function (Grid <span class="variable">$grid</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>这样就不用在每一个控制器的代码中来设置了。</p>
<p>如果全局设置后，要在其中某一个表格中开启设置，比如开启显示操作列，在对应的实例上调用 <code>$grid-&gt;disableActions(false);</code> 就可以了</p>
<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><p>通过 <code>Grid::composing</code> 方法可以监听表格被调用事件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Grid</span>::<span class="title function_ invoke__">composing</span>(function (Grid <span class="variable">$grid</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只需要监听一次</span></span><br><span class="line"><span class="title class_">Grid</span>::<span class="title function_ invoke__">composing</span>(function (Grid <span class="variable">$grid</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Fetching"><a href="#Fetching" class="headerlink" title="Fetching"></a>Fetching</h3><p>监听表格获取数据之前事件，此事件在 <code>composing</code> 事件之后触发。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">listen</span>(<span class="title class_">Grid\Events\Fetching</span>::<span class="variable language_">class</span>, function (<span class="variable">$grid</span>) &#123;</span><br><span class="line">	  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以在 composing 事件中使用</span></span><br><span class="line"><span class="title class_">Grid</span>::<span class="title function_ invoke__">composing</span>(function (Grid <span class="variable">$grid</span>) &#123;</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">listen</span>(<span class="title class_">Grid\Events\Fetching</span>::<span class="variable language_">class</span>, function (<span class="variable">$grid</span>) &#123;</span><br><span class="line">    	  </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Fetched"><a href="#Fetched" class="headerlink" title="Fetched"></a>Fetched</h3><p>监听表格获取数据之后事件，通过监听此事件可以批量修改数据, 参考下面实例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">listen</span>(<span class="title class_">Grid\Events\Fetched</span>::<span class="variable language_">class</span>, function (<span class="variable">$grid</span>, Collection <span class="variable">$rows</span>) &#123;</span><br><span class="line">	<span class="comment">// $collection 当前这一个表格数据的模型集合， 你可以根据你的需要来读取或者修改它的数据。</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$rows</span>-&gt;<span class="title function_ invoke__">transform</span>(function (<span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="comment">// 更改行数据</span></span><br><span class="line">        <span class="variable">$row</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;first_name&#x27;</span>].<span class="string">&#x27; &#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;last_name&#x27;</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$row</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="ApplyFilter"><a href="#ApplyFilter" class="headerlink" title="ApplyFilter"></a>ApplyFilter</h3><p>监听表格过滤器搜索事件，此事件只有在过滤器有搜索条件时才会触发</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">listen</span>(<span class="title class_">Grid\Events\ApplyFilter</span>::<span class="variable language_">class</span>, function (<span class="variable">$grid</span>, <span class="keyword">array</span> <span class="variable">$conditions</span>) &#123;</span><br><span class="line">	<span class="comment">// $conditions 当前过滤器生成的搜索条件数组</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">dd</span>(<span class="string">&#x27;表格过滤器&#x27;</span>, <span class="variable">$conditions</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h3 id="ApplyQuickSearch"><a href="#ApplyQuickSearch" class="headerlink" title="ApplyQuickSearch"></a>ApplyQuickSearch</h3><p>监听表格快捷搜索事件，此事件只有在快捷搜索输入框有值时才会触发</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">listen</span>(<span class="title class_">Grid\Events\ApplyQuickSearch</span>::<span class="variable language_">class</span>, function (<span class="variable">$grid</span>, <span class="variable">$input</span>) &#123;</span><br><span class="line">	<span class="comment">// $input 搜索关键字</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">dd</span>(<span class="string">&#x27;表格快捷搜索&#x27;</span>, <span class="variable">$input</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="ApplySelector"><a href="#ApplySelector" class="headerlink" title="ApplySelector"></a>ApplySelector</h3><p>监听表格规格筛选器事件，此事件只有在规格筛选器选中选项时才会触发</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">listen</span>(<span class="title class_">Grid\Events\ApplySelector</span>::<span class="variable language_">class</span>, function (<span class="variable">$grid</span>, <span class="keyword">array</span> <span class="variable">$input</span>) &#123;</span><br><span class="line">	<span class="comment">// $input 筛选器选中的选项数组</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">dd</span>(<span class="string">&#x27;表格规格筛选器&#x27;</span>, <span class="variable">$input</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="rows回调"><a href="#rows回调" class="headerlink" title="rows回调"></a>rows回调</h3><p>通过 <code>Grid::rows</code> 方法可以监听表格获取数据之后事件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Row</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Collection</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rows</span>(function (Collection <span class="variable">$rows</span>) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取第一行数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Row $firstRow</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable">$firstRow</span> = <span class="variable">$rows</span>-&gt;<span class="title function_ invoke__">first</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置 tr html属性</span></span><br><span class="line">    <span class="variable">$firstRow</span>-&gt;<span class="title function_ invoke__">setAttributes</span>([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;....&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$firstRow</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取第一行的 id</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$firstRow</span>-&gt;id;</span><br><span class="line">        <span class="comment">// 转化为数组</span></span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$firstRow</span>-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-events/" data-id="clpdpxfju001iywna0mog4liz" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-export" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-export/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.972Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="数据导出"><a href="#数据导出" class="headerlink" title="数据导出"></a>数据导出</h1><p>系统默认使用<a href="https://github.com/jqhph/easy-excel" target="__blank">Easy Excel</a>作为导出工具，支持导出 <code>csv</code>、 <code>xlsx</code> 和 <code>ods</code> 等格式文件。</p>
<p>使用前必须先安装<a href="https://github.com/jqhph/easy-excel" target="__blank">Easy Excel</a>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require dcat/easy-excel</span><br></pre></td></tr></table></figure>

<blockquote>
<p>{tip} 默认不开启导出功能。</p>
</blockquote>
<h3 id="启用导出功能"><a href="#启用导出功能" class="headerlink" title="启用导出功能"></a>启用导出功能</h3><p>启用或禁用导出功能</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>();</span><br></pre></td></tr></table></figure>

<p>禁用 <code>导出所有</code> 选项</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>()-&gt;<span class="title function_ invoke__">disableExportAll</span>();</span><br></pre></td></tr></table></figure>

<p>禁用 <code>导出选中行</code> 选项</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>()-&gt;<span class="title function_ invoke__">disableExportSelectedRow</span>();</span><br></pre></td></tr></table></figure>

<p>禁用 <code>导出当前页</code> 选项</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>()-&gt;<span class="title function_ invoke__">disableExportCurrentPage</span>();</span><br></pre></td></tr></table></figure>

<h3 id="导出文件类型"><a href="#导出文件类型" class="headerlink" title="导出文件类型"></a>导出文件类型</h3><blockquote>
<p>{tip} 默认导出 <code>xlsx</code> 格式文件。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// csv</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>()-&gt;<span class="title function_ invoke__">csv</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// xlsx</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>()-&gt;<span class="title function_ invoke__">xlsx</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ods</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>()-&gt;<span class="title function_ invoke__">ods</span>();</span><br></pre></td></tr></table></figure>

<h3 id="设置列标题"><a href="#设置列标题" class="headerlink" title="设置列标题"></a>设置列标题</h3><blockquote>
<p>{tip} 如果设置了标题，那么导出的文件的<strong>列数</strong>与标题的<strong>列数</strong>相同，且列的<strong>排序</strong>也相同。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只导出 id, name和email 三列数据</span></span><br><span class="line"><span class="variable">$titles</span> = [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="string">&#x27;ID&#x27;</span>, <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;名称&#x27;</span>, <span class="string">&#x27;email&#x27;</span> =&gt; <span class="string">&#x27;邮箱&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>(<span class="variable">$titles</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以这么使用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>()-&gt;<span class="title function_ invoke__">titles</span>(<span class="variable">$titles</span>);</span><br></pre></td></tr></table></figure>

<h3 id="处理导出数据"><a href="#处理导出数据" class="headerlink" title="处理导出数据"></a>处理导出数据</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>()-&gt;<span class="title function_ invoke__">rows</span>(function (<span class="keyword">array</span> <span class="variable">$rows</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$rows</span> <span class="keyword">as</span> <span class="variable">$index</span> =&gt; &amp;<span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="variable">$row</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;first_name&#x27;</span>].<span class="string">&#x27; &#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;last_name&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$rows</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置导出文件名"><a href="#设置导出文件名" class="headerlink" title="设置导出文件名"></a>设置导出文件名</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>()-&gt;<span class="title function_ invoke__">filename</span>(<span class="string">&#x27;管理员数据&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="disable-export-extend"></a></p>
<h2 id="扩展导出功能"><a href="#扩展导出功能" class="headerlink" title="扩展导出功能"></a>扩展导出功能</h2><p>如果系统内置的导出功能不了自己的需求，可以按照下面的步骤来自定义导出功能</p>
<p>本示例用<a target="_blank" rel="noopener" href="https://github.com/Maatwebsite/Laravel-Excel">Laravel-Excel</a>作为excel操作库，当然也可以使用任何其他excel库</p>
<p>首先安装好它：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">composer require maatwebsite/excel:~2.1.0</span><br><span class="line"></span><br><span class="line">php artisan vendor:publish --provider=&quot;Maatwebsite\Excel\ExcelServiceProvider&quot;</span><br></pre></td></tr></table></figure>

<p>然后新建自定义导出类，比如<code>app/Admin/Extensions/ExcelExpoter.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Exporters</span>\<span class="title">AbstractExporter</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Maatwebsite</span>\<span class="title">Excel</span>\<span class="title">Facades</span>\<span class="title">Excel</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExcelExpoter</span> <span class="keyword">extends</span> <span class="title">AbstractExporter</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">export</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title class_">Excel</span>::<span class="title function_ invoke__">create</span>(<span class="string">&#x27;Filename&#x27;</span>, function(<span class="variable">$excel</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$excel</span>-&gt;<span class="title function_ invoke__">sheet</span>(<span class="string">&#x27;Sheetname&#x27;</span>, function(<span class="variable">$sheet</span>) &#123;</span><br><span class="line">                </span><br><span class="line">                 <span class="comment">// 最多导出10W条数据</span></span><br><span class="line">                 <span class="comment">// 必须设置maxSize，当否则选择导出所有选项时只能导出默认的20条数据。</span></span><br><span class="line">                <span class="variable">$maxSize</span> = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 这段逻辑是从表格数据中取出需要导出的字段</span></span><br><span class="line">                <span class="variable">$rows</span> = <span class="title function_ invoke__">collect</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">buildData</span>(<span class="number">1</span>, <span class="variable">$maxSize</span>))-&gt;<span class="title function_ invoke__">map</span>(function (<span class="variable">$item</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_ invoke__">array_only</span>(<span class="variable">$item</span>, [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;rate&#x27;</span>, <span class="string">&#x27;keywords&#x27;</span>]);</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="variable">$sheet</span>-&gt;<span class="title function_ invoke__">rows</span>(<span class="variable">$rows</span>);</span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;)-&gt;<span class="title function_ invoke__">export</span>(<span class="string">&#x27;xls&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在<code>model-grid</code>中使用这个导出类：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Extensions</span>\<span class="title">ExcelExpoter</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">export</span>(<span class="keyword">new</span> <span class="title class_">ExcelExpoter</span>());</span><br></pre></td></tr></table></figure>

<p>有关更多<code>Laravel-Excel</code>的使用方法，参考<a target="_blank" rel="noopener" href="http://www.maatwebsite.nl/laravel-excel/docs">laravel-excel&#x2F;docs</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-export/" data-id="clpdpxfju001jywnah6x2fc9c" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-data" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-data/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.971Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表格数据源"><a href="#表格数据源" class="headerlink" title="表格数据源"></a>表格数据源</h1><p>数据仓库(<code>Repository</code>)是一个可以提供特定接口对数据进行读写操作的类，通过数据仓库的引入，可以让页面的构建不再关心数据读写功能的具体实现，开发者只需要实现特定的操作接口即可轻松切换数据源。关于数据仓库的详细用法请参考文档<a href="model-repository.md">数据仓库</a>。</p>
<blockquote>
<p>{tip} 表格的数据是通过 <code>Dcat\Admin\Contracts\Repository::get</code> 接口获取的。</p>
</blockquote>
<p><a name="model"></a></p>
<h2 id="数据来自模型"><a href="#数据来自模型" class="headerlink" title="数据来自模型"></a>数据来自模型</h2><blockquote>
<p>{tip} 如果你的数据来自<code>Model</code>，那么你也可以直接使用<code>Model</code>实例，底层会自动把<code>Model</code>转化为数据仓库实例。</p>
</blockquote>
<p>当数据源支持<code>Eloquent Model</code>时，只需创建一个简单的<code>Repository</code>类继承<code>Dcat\Admin\Repositories\EloquentRepository</code>即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">EloquentRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Movie</span> <span class="keyword">as</span> <span class="title">MovieModel</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">EloquentRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 这里定义你的模型类名</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$eloquentClass</span> = <span class="title class_">MovieModel</span>::<span class="variable language_">class</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过这个方法可以指定查询的字段，默认&quot;*&quot;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getGridColumns</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKeyName</span>(), <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="直接使用模型"><a href="#直接使用模型" class="headerlink" title="直接使用模型"></a>直接使用模型</h3><p>如果你还觉得创建 <code>Repository</code> 类麻烦，也可以直接把 <code>Eloquent Model</code> 的实例传递到 <code>Grid</code> 中，底层会自动把 <code>Eloquent Model</code> 转化为 <code>EloquentRepository</code> 实例 </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Movie</span> <span class="keyword">as</span> <span class="title">MovieModel</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span> = <span class="keyword">new</span> <span class="title class_">Grid</span>(<span class="keyword">new</span> <span class="title class_">MovieModel</span>());</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>


<h3 id="修改来源数据"><a href="#修改来源数据" class="headerlink" title="修改来源数据"></a>修改来源数据</h3><p>1、使用 <code>Grid\Model</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Movie</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span> = <span class="keyword">new</span> <span class="title class_">Grid</span>(<span class="keyword">new</span> <span class="title class_">Movie</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加默认查询条件</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置初始排序条件</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">orderBy</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其它查询方法可以参考<code>eloquent</code>的查询方法。</p>
<p>2、使用 <code>Model Query</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Movie</span> <span class="keyword">as</span> <span class="title">MovieModel</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span> = <span class="keyword">new</span> <span class="title class_">Grid</span>(<span class="title class_">MovieModel</span>::<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>


<h3 id="关联数据"><a href="#关联数据" class="headerlink" title="关联数据"></a>关联数据</h3><p>有以下三种方式让你的表格支持关联数据</p>
<p>1、使用Repository</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Movie</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于 MovieModel::with(&#x27;categories&#x27;)</span></span><br><span class="line"><span class="variable">$grid</span> = <span class="keyword">new</span> <span class="title class_">Grid</span>(<span class="keyword">new</span> <span class="title class_">Movie</span>([<span class="string">&#x27;categories&#x27;</span>]));</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;categories;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>


<p>2、使用 <code>Grid\Model</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Movie</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span> = <span class="keyword">new</span> <span class="title class_">Grid</span>(<span class="keyword">new</span> <span class="title class_">Movie</span>());</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">with</span>(<span class="string">&#x27;categories&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;categories;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>


<p>3、使用 <code>Model Query</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Movie</span> <span class="keyword">as</span> <span class="title">MovieModel</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span> = <span class="keyword">new</span> <span class="title class_">Grid</span>(<span class="title class_">MovieModel</span>::<span class="title function_ invoke__">with</span>(<span class="string">&#x27;categories&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;categories;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<p><a name="api"></a></p>
<h2 id="数据来自外部API"><a href="#数据来自外部API" class="headerlink" title="数据来自外部API"></a>数据来自外部API</h2><p><a name="example"></a></p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>如果数据是来自外部的API，只需要覆写<code>Repository</code>中的<code>get</code>方法既可, 具体用法可参考下面的示例，采用<code>豆瓣电影</code>API获取并展示数据：</p>
<blockquote>
<p>{tip} 需要注意的是分页和不分页的情况下<code>get</code>方法返回的参数值类型是不同的，具体使用可参考<a href="model-repository.md#get">数据仓库 - get</a>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Repository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Pagination</span>\<span class="title">LengthAwarePaginator</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComingSoon</span> <span class="keyword">extends</span> <span class="title">Repository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$api</span> = <span class="string">&#x27;https://api.douban.com/v2/movie/coming_soon&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义主键字段名称 </span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPrimaryKeyColumn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;_id&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询表格数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Grid\Model $model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> LengthAwarePaginator</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">Grid\Model <span class="variable">$model</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 当前页数</span></span><br><span class="line">		<span class="variable">$currentPage</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">getCurrentPage</span>();</span><br><span class="line">		<span class="comment">// 每页显示行数</span></span><br><span class="line">		<span class="variable">$perPage</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">getPerPage</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取排序字段</span></span><br><span class="line">		[<span class="variable">$orderColumn</span>, <span class="variable">$orderType</span>] = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">getSort</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取&quot;scope&quot;筛选值</span></span><br><span class="line">		<span class="variable">$city</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">filter</span>()-&gt;<span class="title function_ invoke__">input</span>(<span class="title class_">Grid\Filter\Scope</span>::<span class="variable constant_">QUERY_NAME</span>, <span class="string">&#x27;广州&#x27;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 如果设置了其他过滤器字段，也可以通过“input”方法获取值，如：</span></span><br><span class="line">		<span class="variable">$title</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">filter</span>()-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$title</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="comment">// 执行你的筛选逻辑</span></span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="variable">$start</span> = (<span class="variable">$currentPage</span> - <span class="number">1</span>) * <span class="variable">$perPage</span>;</span><br><span class="line"></span><br><span class="line">		<span class="variable">$client</span> = <span class="keyword">new</span> <span class="title class_">\GuzzleHttp\Client</span>();</span><br><span class="line"></span><br><span class="line">		<span class="variable">$response</span> = <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&quot;<span class="subst">&#123;$this-&gt;api&#125;</span>?<span class="subst">&#123;$this-&gt;apiKey&#125;</span>&amp;city=<span class="subst">$city</span>&amp;start=<span class="subst">$start</span>&amp;count=<span class="subst">$perPage</span>&quot;</span>);</span><br><span class="line">		<span class="variable">$data</span> = <span class="title function_ invoke__">json_decode</span>((<span class="keyword">string</span>)<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">getBody</span>(), <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">makePaginator</span>(</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">&#x27;total&#x27;</span>] ?? <span class="number">0</span>, // 传入总记录数</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">&#x27;subjects&#x27;</span>] ?? [] // 传入数据二维数组</span><br><span class="line">		);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="grid-model"></a></p>
<h3 id="Grid-Model-常用方法"><a href="#Grid-Model-常用方法" class="headerlink" title="Grid\Model 常用方法"></a>Grid\Model 常用方法</h3><p><a name="getCurrentPage"></a></p>
<h4 id="获取当前页数-getCurrentPage"><a href="#获取当前页数-getCurrentPage" class="headerlink" title="获取当前页数 (getCurrentPage)"></a>获取当前页数 (getCurrentPage)</h4><p>获取当前页码</p>
<ul>
<li>返回值： <code>int|null</code> 如果不允许分页返回null<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$page</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">getCurrentPage</span>();</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a name="getPerPage"></a></p>
<h4 id="获取每页显示行数-getPerPage"><a href="#获取每页显示行数-getPerPage" class="headerlink" title="获取每页显示行数 (getPerPage)"></a>获取每页显示行数 (getPerPage)</h4><p>获取每页显示行数</p>
<ul>
<li>返回值： <code>int|null</code> 如果不允许分页返回null<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$limit</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">getPerPage</span>();</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a name="getSort"></a></p>
<h4 id="获取排序字段-getSort"><a href="#获取排序字段-getSort" class="headerlink" title="获取排序字段 (getSort)"></a>获取排序字段 (getSort)</h4><p>获取排序字段</p>
<ul>
<li>返回值： <code>array</code> <code>[$orderColumn, &#39;desc&#39;|&#39;asc&#39;]</code> || <code>[null, null]</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $orderColumn 字段名称，如没有进行排序则为 null</span></span><br><span class="line"><span class="comment">// $orderType 正序或倒序： &quot;desc&quot;、&quot;asc&quot;，如没有进行排序则为 null</span></span><br><span class="line"><span class="keyword">list</span>(<span class="variable">$orderColumn</span>, <span class="variable">$orderType</span>) = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">getSort</span>();</span><br></pre></td></tr></table></figure>

<p><a name="getFilter"></a></p>
<h4 id="获取过滤器对象-filter"><a href="#获取过滤器对象-filter" class="headerlink" title="获取过滤器对象 (filter)"></a>获取过滤器对象 (filter)</h4><p>获取过滤器对象，通过过滤器对象可以获取到搜索表单的值，用法如下</p>
<ul>
<li>返回值 <code>Dcat\Admin\Grid\Filter</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取&quot;scope&quot;筛选值</span></span><br><span class="line"><span class="variable">$city</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">filter</span>()-&gt;<span class="title function_ invoke__">input</span>(<span class="title class_">Grid\Filter\Scope</span>::<span class="variable constant_">QUERY_NAME</span>, <span class="string">&#x27;广州&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果设置了其他过滤器字段，也可以通过“input”方法获取值，如：</span></span><br><span class="line"><span class="variable">$title</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">filter</span>()-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$title</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// 执行你的筛选逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="获取快捷搜索表单值"><a href="#获取快捷搜索表单值" class="headerlink" title="获取快捷搜索表单值"></a>获取快捷搜索表单值</h4><p>通过以下方式可以获取到快捷搜索表单值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$quickSearch</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">grid</span>()-&gt;<span class="title function_ invoke__">quickSearch</span>()-&gt;<span class="title function_ invoke__">value</span>();</span><br></pre></td></tr></table></figure>


<p><a name="sql"></a></p>
<h2 id="数据来自复杂SQL查询"><a href="#数据来自复杂SQL查询" class="headerlink" title="数据来自复杂SQL查询"></a>数据来自复杂SQL查询</h2><p>如果来源数据需要执行比较复杂的SQL语句获取，那么有两个办法, 第一个办法就是上面的方法，覆盖掉<code>Repository</code>的<code>get</code>方法实现。</p>
<blockquote>
<p>{tip} 需要注意的是分页和不分页的情况下<code>get</code>方法返回的参数值类型是不同的，具体使用可参考<a href="model-repository.md#get">数据仓库 - get</a>。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-data/" data-id="clpdpxfjs001gywna313lgyol" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-editable" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-editable/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.971Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="数据表格行内编辑"><a href="#数据表格行内编辑" class="headerlink" title="数据表格行内编辑"></a>数据表格行内编辑</h1><p>数据表格所有使用行内编辑的列字段，都必须在<code>form</code>表单中定义一个相同的表单字段，否则将无法进行编辑。</p>
<h3 id="文本-editable"><a href="#文本-editable" class="headerlink" title="文本 (editable)"></a>文本 (editable)</h3><p>启用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">editable</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编辑成功后刷新页面</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;nickname&#x27;</span>)-&gt;<span class="title function_ invoke__">editable</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>效果<br><img src="https://cdn.learnku.com/uploads/images/202109/14/38389/mX4Za4nj1y.png!large"></p>
<h3 id="开关-switch"><a href="#开关-switch" class="headerlink" title="开关 (switch)"></a>开关 (switch)</h3><p>快速将列变成开关组件，使用方法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;status&#x27;</span>)-&gt;<span class="keyword">switch</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置颜色</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;status&#x27;</span>)-&gt;<span class="keyword">switch</span>(<span class="title class_">Admin</span>::<span class="title function_ invoke__">color</span>()-&gt;<span class="title function_ invoke__">info</span>());</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;status&#x27;</span>)-&gt;<span class="keyword">switch</span>(<span class="string">&#x27;#333&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这个功能需要你在<code>form</code>表单方法中同样设置一个<code>status</code>字段</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">hidden</span>(<span class="string">&#x27;status&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$v</span> == <span class="string">&#x27;打开&#x27;</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">	&#125;)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$v</span> ? <span class="string">&#x27;打开&#x27;</span> : <span class="string">&#x27;关闭&#x27;</span>;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">switch</span>(<span class="string">&#x27;status&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$v</span> == <span class="string">&#x27;打开&#x27;</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">	&#125;)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$v</span> ? <span class="string">&#x27;打开&#x27;</span> : <span class="string">&#x27;关闭&#x27;</span>;</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>


<p>编辑成功后刷新页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;status&#x27;</span>)-&gt;<span class="keyword">switch</span>(<span class="string">&#x27;&#x27;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>


<h3 id="开关组-switchGroup"><a href="#开关组-switchGroup" class="headerlink" title="开关组 (switchGroup)"></a>开关组 (switchGroup)</h3><blockquote>
<p>{tip} 注意：在<code>grid</code>中对某字段设置<code>switchGroup</code>默认的保存结果是<code>0</code>或<code>1</code>，如需修改可以通过<code>$form-&gt;hidden(xxx)-&gt;saving(...)</code>方法修改。</p>
</blockquote>
<p>快速将列变成开关组件组，使用方法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;switch_group-&gt;<span class="title function_ invoke__">switchGroup</span>([</span><br><span class="line">    <span class="string">&#x27;hot&#x27;</span>        =&gt; <span class="string">&#x27;热门&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;new&#x27;</span>        =&gt; <span class="string">&#x27;最新&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;recommend&#x27;</span>  =&gt; <span class="string">&#x27;推荐&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;image.show&#x27;</span> =&gt; <span class="string">&#x27;显示图片&#x27;</span>, // 更新对应关联模型</span><br><span class="line">]);</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="comment">// 不写label会自动从翻译文件翻译，具体使用请参照 “字段翻译” 章节</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;switch_group-&gt;<span class="title function_ invoke__">switchGroup</span>([<span class="string">&#x27;is_new&#x27;</span>, <span class="string">&#x27;is_hot&#x27;</span>, <span class="string">&#x27;published&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>这个功能需要你在<code>form</code>表单方法中同样设置对应的字段</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">switch</span>(<span class="string">&#x27;hot&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$v</span> == <span class="string">&#x27;打开&#x27;</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">	&#125;)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$v</span> ? <span class="string">&#x27;打开&#x27;</span> : <span class="string">&#x27;关闭&#x27;</span>;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">switch</span>(<span class="string">&#x27;new&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$v</span> == <span class="string">&#x27;打开&#x27;</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">	&#125;)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$v</span> ? <span class="string">&#x27;打开&#x27;</span> : <span class="string">&#x27;关闭&#x27;</span>;</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>



<p>编辑成功后刷新页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;switch_group&#x27;</span>)-&gt;<span class="title function_ invoke__">switchGroup</span>([...], <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>


<p>![](&#x2F;assets&#x2F;img&#x2F;screenshots&#x2F;grid-column-switch-group.png)</p>
<h3 id="下拉选框-select"><a href="#下拉选框-select" class="headerlink" title="下拉选框 (select)"></a>下拉选框 (select)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;options&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>([</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&#x27;Sed ut perspiciatis unde omni&#x27;</span>,</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="string">&#x27;voluptatem accusantium doloremque&#x27;</span>,</span><br><span class="line">    <span class="number">3</span> =&gt; <span class="string">&#x27;dicta sunt explicabo&#x27;</span>,</span><br><span class="line">    <span class="number">4</span> =&gt; <span class="string">&#x27;laudantium, totam rem aperiam&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p><code>select</code> 也支持参数为闭包，使用方法和<code>editable</code>的<code>select</code>类似。</p>
<p>编辑成功后刷新页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;options&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>([...], <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>


<p>![](&#x2F;assets&#x2F;img&#x2F;screenshots&#x2F;grid-column-select.png)</p>
<h3 id="单选框-radio"><a href="#单选框-radio" class="headerlink" title="单选框 (radio)"></a>单选框 (radio)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;options&#x27;</span>)-&gt;<span class="title function_ invoke__">radio</span>([</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&#x27;Sed ut perspiciatis unde omni&#x27;</span>,</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="string">&#x27;voluptatem accusantium doloremque&#x27;</span>,</span><br><span class="line">    <span class="number">3</span> =&gt; <span class="string">&#x27;dicta sunt explicabo&#x27;</span>,</span><br><span class="line">    <span class="number">4</span> =&gt; <span class="string">&#x27;laudantium, totam rem aperiam&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p><code>radio</code> 也支持参数为闭包，使用方法和<code>editable</code>的<code>select</code>类似。</p>
<p>编辑成功后刷新页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;options&#x27;</span>)-&gt;<span class="title function_ invoke__">radio</span>([...], <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.learnku.com/uploads/images/202109/14/38389/6Bo4phkB3f.png!large"></p>
<h3 id="多选框-checkbox"><a href="#多选框-checkbox" class="headerlink" title="多选框 (checkbox)"></a>多选框 (checkbox)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;options&#x27;</span>)-&gt;<span class="title function_ invoke__">checkbox</span>([</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&#x27;Sed ut perspiciatis unde omni&#x27;</span>,</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="string">&#x27;voluptatem accusantium doloremque&#x27;</span>,</span><br><span class="line">    <span class="number">3</span> =&gt; <span class="string">&#x27;dicta sunt explicabo&#x27;</span>,</span><br><span class="line">    <span class="number">4</span> =&gt; <span class="string">&#x27;laudantium, totam rem aperiam&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p><code>checkbox</code> 也支持参数为闭包，使用方法和<code>editable</code>的<code>select</code>类似。</p>
<p>编辑成功后刷新页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;options&#x27;</span>)-&gt;<span class="title function_ invoke__">checkbox</span>([...], <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>![](&#x2F;assets&#x2F;img&#x2F;screenshots&#x2F;grid-column-checkbox.png)</p>
<h3 id="textarea"><a href="#textarea" class="headerlink" title="textarea"></a>textarea</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;...&#x27;</span>)-&gt;<span class="title function_ invoke__">textarea</span>();</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.learnku.com/uploads/images/202109/14/38389/wViO5EoPBg.png!large"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-editable/" data-id="clpdpxfjt001hywnachaggfl8" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-column" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-column/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.970Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="列的基本使用"><a href="#列的基本使用" class="headerlink" title="列的基本使用"></a>列的基本使用</h1><h3 id="设置列为可排序-sortable"><a href="#设置列为可排序-sortable" class="headerlink" title="设置列为可排序 (sortable)"></a>设置列为可排序 (sortable)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;id&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br></pre></td></tr></table></figure>

<p>表格字段支持关联关系表字段以及<code>json</code>字段的排序</p>
<blockquote>
<p>注意，关联关系仅支持<code>hasOne</code>以及<code>belongsTo</code>两种类型的字段排序，并且不支持多层级嵌套！</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关联关系表字段排序</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;profile.age&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定需要排序的字段名称</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;my_age&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>(<span class="string">&#x27;profile.age&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// json字段排序</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;options.price&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>(<span class="string">&#x27;options-&gt;price&#x27;</span>);</span><br><span class="line"><span class="comment">// 关联关系表的 json 字段排序</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;profile.options.price&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>(<span class="string">&#x27;profile.options-&gt;price&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>支持<code>MySql</code>的<code>order by cast(`&#123;field&#125;` as &#123;type&#125;)</code>用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;profile.age&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>(<span class="literal">null</span>, <span class="string">&#x27;SIGNED&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;profile.options.price&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>(<span class="string">&#x27;profile.options-&gt;price&#x27;</span>, <span class="string">&#x27;SIGNED&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="设置默认排序"><a href="#设置默认排序" class="headerlink" title="设置默认排序"></a>设置默认排序</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">orderBy</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>这个功能也支持关联关系表字段排序，注意这里仅支持<code>一对一</code>以及<code>一对多</code>关联关系</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">orderBy</span>(<span class="string">&#x27;profile.age&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h3 id="设置列的宽度-width"><a href="#设置列的宽度-width" class="headerlink" title="设置列的宽度 (width)"></a>设置列的宽度 (width)</h3><p>设置列的宽度，当字段内容过长时可以使用这个方法限制列宽度</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// px</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;long_text&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="string">&#x27;300px&#x27;</span>);</span><br><span class="line"><span class="comment">// 百分比</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;long_text&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="string">&#x27;15%&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="固定列-fixColumns"><a href="#固定列-fixColumns" class="headerlink" title="固定列 (fixColumns)"></a>固定列 (fixColumns)</h3><p>通过 <code>fixColumns</code> 方法可以给表格设置固定列，第一个参数表示固定从头开始的前三列，第二个参数表示固定从后往前数的两列，（第二个参数可不传，默认为-1）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">fixColumns</span>(<span class="number">2</span>, -<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src="https://cdn.learnku.com/uploads/images/202007/12/38389/8aKnpG11g4.gif!large"></p>
<h3 id="获取行序号-index"><a href="#获取行序号-index" class="headerlink" title="获取行序号 (index)"></a>获取行序号 (index)</h3><p>序号从 <code>0</code> 开始计算</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 display 回调中使用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;序号&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;_index + <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在行操作 action 中使用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">actions</span>(function (<span class="variable">$actions</span>) &#123;</span><br><span class="line">    <span class="variable">$index</span> = <span class="variable language_">$this</span>-&gt;_index;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h3 id="设置td标签HTML属性-setAttributes"><a href="#设置td标签HTML属性-setAttributes" class="headerlink" title="设置td标签HTML属性 (setAttributes)"></a>设置td标签HTML属性 (setAttributes)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;email&#x27;</span>)-&gt;<span class="title function_ invoke__">setAttributes</span>([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;...&#x27;</span>])</span><br></pre></td></tr></table></figure>


<h3 id="设置表格头HTML属性-setHeaderAttributes"><a href="#设置表格头HTML属性-setHeaderAttributes" class="headerlink" title="设置表格头HTML属性 (setHeaderAttributes)"></a>设置表格头HTML属性 (setHeaderAttributes)</h3><p>设标题的<code>html</code>属性</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改颜色</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">setHeaderAttributes</span>([<span class="string">&#x27;style&#x27;</span> =&gt; <span class="string">&#x27;color:#5b69bc&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="设置列选择器-字段显示或隐藏-showColumnSelector"><a href="#设置列选择器-字段显示或隐藏-showColumnSelector" class="headerlink" title="设置列选择器 (字段显示或隐藏 showColumnSelector)"></a>设置列选择器 (字段显示或隐藏 showColumnSelector)</h3><p>此功能默认不启用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启字段选择器功能</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showColumnSelector</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置默认隐藏字段</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">hideColumns</span>([<span class="string">&#x27;field1&#x27;</span>, ...]);</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.learnku.com/uploads/images/202004/26/38389/MTgikMeV1o.png!large"></p>
<p><a name="column-selector-store"></a></p>
<h4 id="存储驱动-持久化"><a href="#存储驱动-持久化" class="headerlink" title="存储驱动 (持久化)"></a>存储驱动 (持久化)</h4><p>在配置文件<code>config/admin.php</code>可以配置存储列选择器状态的方式，支持的存储方式如下</p>
<ul>
<li><code>Dcat\Admin\Grid\ColumnSelector\SessionStore</code> 列选择器状态数据保存在<code>session</code>中，仅在登陆状态中有效</li>
<li><code>Dcat\Admin\Grid\ColumnSelector\CacheStore</code>  列选择器状态数据保存在<a target="_blank" rel="noopener" href="https://laravel.com/docs/8.x/cache#driver-prerequisites">Laravel Cache</a>缓存系统中，最长可保存<code>300</code>天，并可以通过<code>admin.grid.column_selector.store_params.driver</code>可以配置缓存驱动，默认为<code>file</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;grid&#x27;</span> =&gt; [</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;column_selector&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;store&#x27;</span> =&gt; <span class="title class_">Dcat\Admin\Grid\ColumnSelector\SessionStore</span>::<span class="variable language_">class</span>,</span><br><span class="line">        <span class="string">&#x27;store_params&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">],</span><br></pre></td></tr></table></figure>


<h3 id="设置列提示信息-help"><a href="#设置列提示信息-help" class="headerlink" title="设置列提示信息 (help)"></a>设置列提示信息 (help)</h3><p><code>Grid\Column::help</code>参数：</p>
<ul>
<li>$help <code>string</code> 提示内容</li>
<li>$style <code>string</code> 提示窗背景颜色，支持<code>green</code>、 <code>blue</code>、<code>red</code>、<code>purple</code></li>
<li>$placement <code>string</code> 提示窗位置，支持<code>top</code>、<code>left</code>、<code>right</code>、<code>bottom</code></li>
</ul>
<p><img src="https://cdn.learnku.com/uploads/images/202004/26/38389/MTgikMeV1o.png!large"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;id&#x27;</span>)-&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;提示信息&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="设置列搜索"><a href="#设置列搜索" class="headerlink" title="设置列搜索"></a>设置列搜索</h3><p>通过<code>Grid\Column::filter</code>方法可以给列设置一个过滤器，可以很方便的根据这一列进行数据表格过滤操作，具体使用方法请参考<a href="model-grid-column-filter.md">列过滤器</a>。</p>
<p><img src="https://cdn.learnku.com/uploads/images/202004/26/38389/8zNK7CHS3V.png!large"></p>
<h3 id="扩展列功能"><a href="#扩展列功能" class="headerlink" title="扩展列功能"></a>扩展列功能</h3><p>通过<code>Grid\Column::macro</code>方法可以扩展列方法。</p>
<p>在 <code>app/Admin/bootstrap.php</code> 中添加以下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// $value 是当前字段的值</span></span><br><span class="line"><span class="comment">// $p1、$p2 是自定义参数</span></span><br><span class="line"><span class="title class_">Grid\Column</span>::<span class="title function_ invoke__">macro</span>(<span class="string">&#x27;myHeader&#x27;</span>, function (<span class="variable">$value</span>, <span class="variable">$p1</span>, <span class="variable">$p2</span> = <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// MyHeader 需要实现 Illuminate\Contracts\Support\Renderable 接口</span></span><br><span class="line">    <span class="comment">// 当然这里也可以直接传字符串</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">addHeader</span>(<span class="keyword">new</span> <span class="title class_">MyHeader</span>(<span class="variable">$this</span>, <span class="variable">$p1</span>, <span class="variable">$p2</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>MyHeader</code> 类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Column</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Support</span>\<span class="title">Renderable</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHeader</span> <span class="keyword">implements</span> <span class="title">Renderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Column <span class="variable">$column</span>, <span class="variable">$p1</span>, <span class="variable">$p2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;user&#x27;</span>)-&gt;<span class="title function_ invoke__">myHeader</span>(<span class="variable">$p1</span>, <span class="variable">$p2</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;first_name&#x27;</span>)-&gt;<span class="title function_ invoke__">myHeader</span>(<span class="variable">$p1</span>);</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-column/" data-id="clpdpxfjp001dywnad6bj7z0b" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/6/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-navbar/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-tab/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-table/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-tooltip/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-js/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>