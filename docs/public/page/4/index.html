<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2.x/model-repository" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-repository/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.979Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="数据仓库"><a href="#数据仓库" class="headerlink" title="数据仓库"></a>数据仓库</h1><p>数据仓库(<code>Repository</code>)是<code>Dcat Admin</code>中对数据增删改查操作接口的具体实现，通过<code>Repository</code>的介入可以让页面的构建不再关心数据读写功能的具体实现，开发者通过实现<code>Repository</code>接口即可对数据进行读写操作。</p>
<blockquote>
<p>{tip} 当然为了方便系统也保留了直接使用 <code>Model</code> 的功能，底层会自动把<code>Model</code>转化为数据仓库实例，毕竟大多数时候直接使用 <code>Model</code> 也能满足我们的需求。</p>
</blockquote>
<p>数据表格<code>Grid</code>、数据表单<code>Form</code>、数据详情<code>Show</code>、<code>Tree</code> 等组件不再直接依赖于<code>Model</code>，而是依赖于提供更简单清晰的接口的数据仓库，下面是<code>Repository</code>的所有接口：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Dcat</span>\<span class="title class_">Admin</span>\<span class="title class_">Contracts</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Show</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Collection</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Repository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取主键名称.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getKeyName</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取创建时间字段.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCreatedAtColumn</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取更新时间字段.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUpdatedAtColumn</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否使用软删除.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isSoftDeletes</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Grid表格数据.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Grid\Model $model</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Contracts\Pagination\LengthAwarePaginator|Collection|array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">Grid\Model <span class="variable">$model</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取编辑页面数据.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Form $form</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array|\Illuminate\Contracts\Support\Arrayable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span>(<span class="params">Form <span class="variable">$form</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取详情页面数据.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Show $show</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array|\Illuminate\Contracts\Support\Arrayable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detail</span>(<span class="params">Show <span class="variable">$show</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增记录.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Form $form</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Form <span class="variable">$form</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询更新前的行数据.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Form $form</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array|\Illuminate\Contracts\Support\Arrayable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">updating</span>(<span class="params">Form <span class="variable">$form</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新数据.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Form $form</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">Form <span class="variable">$form</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除数据.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Form  $form</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $deletingData</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span>(<span class="params">Form <span class="variable">$form</span>, <span class="keyword">array</span> <span class="variable">$deletingData</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询删除前的行数据.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Form $form</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array|\Illuminate\Contracts\Support\Arrayable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleting</span>(<span class="params">Form <span class="variable">$form</span></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果你的数据是多层级结构，则还需要实现以下接口</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Dcat</span>\<span class="title class_">Admin</span>\<span class="title class_">Contracts</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">TreeRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取主键字段名称.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPrimaryKeyColumn</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取父级ID字段名称.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getParentColumn</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取标题字段名称.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTitleColumn</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取排序字段名称.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getOrderColumn</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存层级数据排序.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $tree</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int   $parentId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">saveOrder</span>(<span class="params"><span class="variable">$tree</span> = [], <span class="variable">$parentId</span> = <span class="number">0</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置数据查询回调.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Closure|null $query</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> $this</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withQuery</span>(<span class="params"><span class="variable">$queryCallback</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取层级数据.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toTree</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Repository接口"><a href="#Repository接口" class="headerlink" title="Repository接口"></a>Repository接口</h2><h3 id="getKeyName"><a href="#getKeyName" class="headerlink" title="getKeyName"></a>getKeyName</h3><p>此接口要求返回数据的主键字段名称，需要返回<code>string</code>类型值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getKeyName</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="getCreatedAtColumn"><a href="#getCreatedAtColumn" class="headerlink" title="getCreatedAtColumn"></a>getCreatedAtColumn</h3><p>此接口要求返回数据的<code>created_at</code>字段名称，如果没有值可以返回空字符串或<code>null</code>值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果没有值可以返回空字符串或`null`值</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCreatedAtColumn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;created_at&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="getUpdatedAtColumn"><a href="#getUpdatedAtColumn" class="headerlink" title="getUpdatedAtColumn"></a>getUpdatedAtColumn</h3><p>此接口要求返回数据的<code>updated_at</code>字段名称，如果没有值可以返回空字符串或<code>null</code>值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果没有值可以返回空字符串或`null`值</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCreatedAtColumn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;updated_at&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="isSoftDeletes"><a href="#isSoftDeletes" class="headerlink" title="isSoftDeletes"></a>isSoftDeletes</h3><p>此接口要求返回数据是否支持软删除，请返回一个<code>bool</code>类型的值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isSoftDeletes</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="get"></a></p>
<h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><p>此接口要求返回数据表格<code>Grid</code>的数据，用于数据表格展示，要求返回一个<code>array</code>、<code>Illuminate\Support\Collection</code>或<code>LengthAwarePaginator</code>类型值。</p>
<h4 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h4><p>当数据需要分页时要求返回一个<code>\Illuminate\Contracts\Pagination\LengthAwarePaginator</code>类型值：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">Grid\Model <span class="variable">$model</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取当前页数</span></span><br><span class="line">    <span class="variable">$currentPage</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">getCurrentPage</span>();</span><br><span class="line">    <span class="comment">// 获取每页显示行数</span></span><br><span class="line">    <span class="variable">$perPage</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">getPerPage</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取筛选参数</span></span><br><span class="line">    <span class="variable">$city</span> = <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">filter</span>()-&gt;<span class="title function_ invoke__">input</span>(<span class="title class_">Grid\Filter\Scope</span>::<span class="variable constant_">QUERY_NAME</span>, <span class="string">&#x27;广州&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$start</span> = (<span class="variable">$currentPage</span> - <span class="number">1</span>) * <span class="variable">$perPage</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$client</span> = <span class="keyword">new</span> <span class="title class_">\GuzzleHttp\Client</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$response</span> = <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&quot;<span class="subst">&#123;$this-&gt;api&#125;</span>?<span class="subst">&#123;$this-&gt;apiKey&#125;</span>&amp;city=<span class="subst">$city</span>&amp;start=<span class="subst">$start</span>&amp;count=<span class="subst">$perPage</span>&quot;</span>);</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">json_decode</span>((<span class="keyword">string</span>)<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">getBody</span>(), <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">makePaginator</span>(</span><br><span class="line">        <span class="variable">$data</span>[<span class="string">&#x27;total&#x27;</span>] ?? <span class="number">0</span>, // 传入总记录数</span><br><span class="line">        <span class="variable">$data</span>[<span class="string">&#x27;subjects&#x27;</span>] ?? [] // 传入数据二维数组</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="不分页"><a href="#不分页" class="headerlink" title="不分页"></a>不分页</h4><p>如果不需要分页，则直接返回一个<code>array</code>或<code>Illuminate\Support\Collection</code>类型值即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">Grid\Model <span class="variable">$model</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>, <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;n1&#x27;</span>],</span><br><span class="line">        [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">2</span>, <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;n2&#x27;</span>]</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，<code>grid</code>需要禁用分页</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disablePagination</span>()</span><br></pre></td></tr></table></figure>

<h3 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h3><p>此接口要求返回表单编辑页面的数据，用于显示数据表单编辑页面，需要返回<code>array</code>类型值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span>(<span class="params">Form <span class="variable">$form</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取数据主键值</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getKey</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>, <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;n1&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="detail"><a href="#detail" class="headerlink" title="detail"></a>detail</h3><p>此接口要求返回数据详情页面的数据，用于显示数据详情，需要返回<code>array</code>类型值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detail</span>(<span class="params">Show <span class="variable">$show</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取数据主键值</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$show</span>-&gt;<span class="title function_ invoke__">getId</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>, <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;n1&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="store"><a href="#store" class="headerlink" title="store"></a>store</h3><p>此接口用于新增一条记录，可以返回<code>int</code>、<code>string</code>或<code>bool</code>类型值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Form <span class="variable">$form</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取待新增的数据</span></span><br><span class="line">    <span class="variable">$attributes</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">updates</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行你的新增逻辑</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回新增记录id或bool值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="updating"><a href="#updating" class="headerlink" title="updating"></a>updating</h3><p>此接口用于数据表单修改数据时查询原始记录，需要返回<code>array</code>或<code>Model</code>类型值。</p>
<blockquote>
<p>{tip} 此接口只有某些特殊字段会用到，如图片、文件上传字段，当更改了图片或文件时可以根据这个接口查出的数据删除旧文件。所以如果你的表单中没有用到此类特殊字段，此接口可以返回一个空数组。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public function updating(Form $form)</span><br><span class="line">&#123;</span><br><span class="line">    // 获取数据主键值</span><br><span class="line">    $id = $form-&gt;getKey();</span><br><span class="line"></span><br><span class="line">    return [&#x27;id&#x27; =&gt; 1, &#x27;name&#x27; =&gt; &#x27;n1&#x27;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="update"><a href="#update" class="headerlink" title="update"></a>update</h3><p>此接口用于数据表单修改记录，可以返回<code>int</code>、<code>string</code>或<code>bool</code>类型值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">Form <span class="variable">$form</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取待编辑的数据</span></span><br><span class="line">    <span class="variable">$attributes</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">updates</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行你的编辑逻辑</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回成功</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="deleting"><a href="#deleting" class="headerlink" title="deleting"></a>deleting</h3><p>此接口用于删除数据时查询原始记录，需要返回二维数组，或Collection model。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleting</span>(<span class="params">Form <span class="variable">$form</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 当批量删除时id为多个</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getKey</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行你的逻辑</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意这里需要返回二维数组</span></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>, <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;h1&#x27;</span>],</span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 也可以返回collection</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Modell</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$id</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="destroy"><a href="#destroy" class="headerlink" title="destroy"></a>destroy</h3><p>单行&#x2F;批量删除数据方法，成功返回<code>true</code>，失败返回<code>false</code>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span>(<span class="params">Form <span class="variable">$form</span>, <span class="keyword">array</span> <span class="variable">$deletingData</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 当批量删除时id为多个</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getKey</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// $deletingData 是 getDataWhenDeleting 接口返回的数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行你的逻辑</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="TreeRepository接口"><a href="#TreeRepository接口" class="headerlink" title="TreeRepository接口"></a>TreeRepository接口</h2><h3 id="getPrimaryKeyColumn"><a href="#getPrimaryKeyColumn" class="headerlink" title="getPrimaryKeyColumn"></a>getPrimaryKeyColumn</h3><p>此接口用于返回数据的主键字段名称，需要返回<code>string</code>类型值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPrimaryKeyColumn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKeyName</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="getParentColumn"><a href="#getParentColumn" class="headerlink" title="getParentColumn"></a>getParentColumn</h3><p>此接口用于返回数据的父ID字段名称，需要返回<code>string</code>类型值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getParentColumn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;parent_id&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="getTitleColumn"><a href="#getTitleColumn" class="headerlink" title="getTitleColumn"></a>getTitleColumn</h3><p>此接口用于返回数据标题字段名称，需要返回<code>string</code>类型值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTitleColumn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;title&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="getOrderColumn"><a href="#getOrderColumn" class="headerlink" title="getOrderColumn"></a>getOrderColumn</h3><p>此接口用于返回数据排序字段名称，需要返回<code>string</code>类型值。</p>
<blockquote>
<p>{tip} 此字段不是必须的，如果你的数据不支持或不需要排序，请返回空值！</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getOrderColumn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;order&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="saveOrder"><a href="#saveOrder" class="headerlink" title="saveOrder"></a>saveOrder</h3><p>此接口用于保存层级数据的排序，并且接收两个参数</p>
<ul>
<li><code>$tree</code> <code>array</code> 此字段是一个已分好层级的数组</li>
<li><code>$parentId</code> <code>int</code> 此字段主要用于递归时传递父ID使用</li>
</ul>
<blockquote>
<p>{tip} 如果你的数据不支持 <code>MySQL</code>，可参考 <code>Dcat\Admin\Traits\ModelTree::saveOrder</code> 方法自行实现。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tree</span> = [</span><br><span class="line">	[</span><br><span class="line">		<span class="string">&#x27;id&#x27;</span>        =&gt; <span class="number">1</span>,</span><br><span class="line">		<span class="string">&#x27;title&#x27;</span>     =&gt; <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;parent_id&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">		</span><br><span class="line">		<span class="string">&#x27;children&#x27;</span> =&gt; [</span><br><span class="line">			[</span><br><span class="line">				<span class="string">&#x27;id&#x27;</span>        =&gt; <span class="number">2</span>,</span><br><span class="line">				<span class="string">&#x27;title&#x27;</span>     =&gt; <span class="string">&#x27;child1&#x27;</span>,</span><br><span class="line">				<span class="string">&#x27;parent_id&#x27;</span> =&gt; <span class="number">1</span>,</span><br><span class="line">			],</span><br><span class="line">			[</span><br><span class="line">				<span class="string">&#x27;id&#x27;</span>        =&gt; <span class="number">3</span>,</span><br><span class="line">				<span class="string">&#x27;title&#x27;</span>     =&gt; <span class="string">&#x27;child2&#x27;</span>,</span><br><span class="line">				<span class="string">&#x27;parent_id&#x27;</span> =&gt; <span class="number">1</span>,</span><br><span class="line">			],</span><br><span class="line">		],</span><br><span class="line">	]</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存排序，内层逻辑请自行实现</span></span><br><span class="line"><span class="variable">$repository</span>-&gt;<span class="title function_ invoke__">saveOrder</span>(<span class="variable">$tree</span>);  </span><br></pre></td></tr></table></figure>

<h3 id="withQuery"><a href="#withQuery" class="headerlink" title="withQuery"></a>withQuery</h3><p>此接口需结合 <code>toTree</code> 接口使用，接收一个参数：主要用于设置数据查询操作的相关回调或参数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Contracts</span>\<span class="title">Repository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Contracts</span>\<span class="title">TreeRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">Helper</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span> <span class="keyword">implements</span> <span class="title">Repository</span>, <span class="title">TreeRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$queryCallbacks</span> = [];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withQuery</span>(<span class="params"><span class="variable">$queryCallback</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;queryCallbacks[] = <span class="variable">$queryCallback</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toTree</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	    <span class="comment">// 这里演示的代码只是为了说明 withQuery 方法的作用</span></span><br><span class="line">	    <span class="variable">$client</span> = ...;</span><br><span class="line">	    </span><br><span class="line">	    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;queryCallbacks <span class="keyword">as</span> <span class="variable">$callback</span>) &#123;</span><br><span class="line">	    	<span class="variable">$callback</span>(<span class="variable">$client</span>);</span><br><span class="line">	    &#125;</span><br><span class="line">	    </span><br><span class="line">	    <span class="keyword">return</span> <span class="title class_">Helper</span>::<span class="title function_ invoke__">buildNestedArray</span>(<span class="variable">$client</span>-&gt;<span class="title function_ invoke__">get</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<h3 id="toTree"><a href="#toTree" class="headerlink" title="toTree"></a>toTree</h3><p>此接口主要用于查询数据并分好层级返回，需要返回 <code>array</code> 类型值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toTree</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$client</span> = ...;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;queryCallbacks <span class="keyword">as</span> <span class="variable">$callback</span>) &#123;</span><br><span class="line">    	<span class="variable">$callback</span>(<span class="variable">$client</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Helper</span>::<span class="title function_ invoke__">buildNestedArray</span>(<span class="variable">$client</span>-&gt;<span class="title function_ invoke__">get</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p><code>Dcat Admin</code>已经内置了对<code>Eloquent model</code>的支持，如果你的数据源是支持<code>Model</code>的，那么只需继承<code>Dcat\Admin\Repositories\EloquentRepository</code>类即可实现对数据的<code>CURD</code>操作，如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">EloquentRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Movie</span> <span class="keyword">as</span> <span class="title">MovieModel</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">EloquentRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 这里设置你的模型类名即可</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$eloquentClass</span> = <span class="title class_">MovieModel</span>::<span class="variable language_">class</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过这个方法可以指定查询的字段，默认&quot;*&quot;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getGridColumns</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKeyName</span>(), <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过这个方法可以指定表单页查询的字段，默认&quot;*&quot;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormColumns</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKeyName</span>(), <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">// 通过这个方法可以指定数据详情页查询的字段，默认&quot;*&quot;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getDetailColumns</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;*&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="QueryBuilder"><a href="#QueryBuilder" class="headerlink" title="QueryBuilder"></a>QueryBuilder</h2><p>如果你的数据支持<code>QueryBuilder</code>查询，但不方便建模型类（比如需要动态查表数据），则可以继承<code>Dcat\Admin\Repositories\QueryBuilderRepository</code>类。</p>
<blockquote>
<p>{tip} 注意，<code>QueryBuilderRepository</code>默认是不支持<code>Model</code>的关联模型、软删除、模型树以及字段排序等功能，如果需要这些功能，请自定实现上述相关接口即可。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">QueryBuilderRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRepository</span> <span class="keyword">extends</span> <span class="title">QueryBuilderRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 设置你的主键名称</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$keyName</span> = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置创建时间字段</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$createdAtColumn</span> = <span class="string">&#x27;created_at&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">// 设置更新时间字段</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$updatedAtColumn</span> = <span class="string">&#x27;updated_at&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 返回表名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;your_table_name&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 返回你的主键名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getKeyName</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;keyName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过这个方法可以指定查询的字段，默认&quot;*&quot;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getGridColumns</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKeyName</span>(), <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过这个方法可以指定表单页查询的字段，默认&quot;*&quot;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormColumns</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKeyName</span>(), <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">// 通过这个方法可以指定数据详情页查询的字段，默认&quot;*&quot;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getDetailColumns</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;*&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-repository/" data-id="clpdpxfkl001xywnafrdqdxg1" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-show-extend" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-show-extend/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.979Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="详情字段显示扩展"><a href="#详情字段显示扩展" class="headerlink" title="详情字段显示扩展"></a>详情字段显示扩展</h1><p>这个功能用来扩展详情字段显示, 在内置的显示方法不满足需求的情况下，可以使用这个功能来实现</p>
<p>首先定义扩展类：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>\<span class="title class_">Show</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Show</span>\<span class="title">AbstractField</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnSerialize</span> <span class="keyword">extends</span> <span class="title">AbstractField</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 这个属性设置为false则不会转义HTML代码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$escape</span> = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"><span class="variable">$arg</span> = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 返回任意可被渲染的内容</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">unserialize</span>(<span class="variable">$this</span>-&gt;value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>app/Admin/bootstrap.php</code>中注册扩展类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Show</span>\<span class="title">Field</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Extensions</span>\<span class="title">Show</span>\<span class="title">UnSerialize</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Field</span>::<span class="title function_ invoke__">extend</span>(<span class="string">&#x27;unserialize&#x27;</span>, <span class="title class_">UnSerialize</span>::<span class="variable language_">class</span>);</span><br></pre></td></tr></table></figure>
<p>然后在控制器中使用这个扩展</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$show</span>-&gt;<span class="title function_ invoke__">column</span>()-&gt;<span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;xxx&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>传入unserialize()方法的参数会按顺序传入UnSerialize::render()方法中。</p>
<p>在父类<code>Dcat\Admin\Show\AbstractField</code>中可以看到几个常用的属性</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Field value.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Current field model.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> Fluent</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$model</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If this field show with a border.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$border</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If this field show escaped contents.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$escape</span> = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<p>其中<code>$value</code>和<code>$model</code>分别是当前字段值和当前详情内容的数据，在<code>render()</code>方法中可以用来获取你想要的数据。</p>
<p><code>$border</code>用来控制当前显示内容是否需要外边框，<code>$escape</code>分别用来设置当前显示内容要不要HTML转义。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-show-extend/" data-id="clpdpxfkl001yywnabg0o9z7a" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-json" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-json/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.978Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="JSON格式字段处理"><a href="#JSON格式字段处理" class="headerlink" title="JSON格式字段处理"></a>JSON格式字段处理</h1><p><code>dcat-admin</code>的表单提供了下面几个组件来处理<code>JSON</code>格式的字段，方便用来处理<code>JOSN</code>格式的对象、一维数组、二维数组等对象。</p>
<h2 id="键值对象-keyValue"><a href="#键值对象-keyValue" class="headerlink" title="键值对象 (keyValue)"></a>键值对象 (keyValue)</h2><p>![](&#x2F;assets&#x2F;img&#x2F;screenshots&#x2F;key-value.png)</p>
<p>如果你的字段存储的是不固定<code>键</code>的<code>&#123;&quot;field&quot;:&quot;value&quot;&#125;</code>格式，可以用<code>keyValue</code>组件:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">keyValue</span>(<span class="string">&#x27;column_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置校验规则</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">keyValue</span>(<span class="string">&#x27;column_name&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required|min:5&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>自定义键名以及键值标题翻译</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">keyValue</span>(...)-&gt;<span class="title function_ invoke__">setKeyLabel</span>(<span class="string">&#x27;键名&#x27;</span>)-&gt;<span class="title function_ invoke__">setValueLabel</span>(<span class="string">&#x27;键值&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="固定键值对象-embeds"><a href="#固定键值对象-embeds" class="headerlink" title="固定键值对象 (embeds)"></a>固定键值对象 (embeds)</h2><p>![](&#x2F;assets&#x2F;img&#x2F;screenshots&#x2F;embeds.png)</p>
<p>用于处理<code>mysql</code>的<code>JSON</code>类型字段数据或者<code>mongodb</code>的<code>object</code>类型数据，也可以将多个<code>field</code>的数据值以<code>JSON</code>字符串的形式存储在<code>mysql</code>的字符串类型字段中</p>
<p>适用于有固定键值的<code>JSON</code>类型字段</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">embeds</span>(<span class="string">&#x27;column_name&#x27;</span>, function (<span class="variable">$form</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;key1&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">email</span>(<span class="string">&#x27;key2&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">datetime</span>(<span class="string">&#x27;key3&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">dateRange</span>(<span class="string">&#x27;key4&#x27;</span>, <span class="string">&#x27;key5&#x27;</span>, <span class="string">&#x27;范围&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required&#x27;</span>);</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">saving</span>(<span class="title function_ invoke__">funtion</span> (<span class="variable">$v</span>) &#123;</span><br><span class="line">    // 转化为json格式存储</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$v</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义标题</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">embeds</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;字段标题&#x27;</span>, function (<span class="variable">$form</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>回调函数里面构建表单元素的方法调用和外面是一样的。</p>
<h2 id="一维数组-list"><a href="#一维数组-list" class="headerlink" title="一维数组 (list)"></a>一维数组 (list)</h2><p>![](&#x2F;assets&#x2F;img&#x2F;screenshots&#x2F;form-list.png)</p>
<p>如果你的字段是用来存储<code>[&quot;foo&quot;, &quot;Bar&quot;]</code>格式的一维数组, 可以使用<code>list</code>组件:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">list</span>(<span class="string">&#x27;column_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置校验规则</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">list</span>(<span class="string">&#x27;column_name&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required|min:5&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置最大和最小元素个数</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">list</span>(<span class="string">&#x27;column_name&#x27;</span>)-&gt;<span class="title function_ invoke__">max</span>(<span class="number">10</span>)-&gt;<span class="title function_ invoke__">min</span>(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<h2 id="二维数组-table"><a href="#二维数组-table" class="headerlink" title="二维数组 (table)"></a>二维数组 (table)</h2><p>![](&#x2F;assets&#x2F;img&#x2F;screenshots&#x2F;form-table.png)</p>
<p>如果某一个字段存储的是<code>json</code>格式的二维数组，可以使用<code>table</code>表单组件来实现快速的编辑：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;column_name&#x27;</span>, function (<span class="variable">$table</span>) &#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;key&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="string">&#x27;desc&#x27;</span>);</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$v</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这个组件类似于<code>hasMany</code>组件，不过是用来处理单个字段的情况，适用于简单的二维数据。</p>
<h2 id="二维数组-array"><a href="#二维数组-array" class="headerlink" title="二维数组 (array)"></a>二维数组 (array)</h2><p>![](&#x2F;assets&#x2F;img&#x2F;screenshots&#x2F;has-many.png)</p>
<p>如果某一个字段存储的是<code>json</code>格式的二维数组，并且字段比较多，可以使用<code>array</code>表单组件来实现快速的编辑：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">array</span>(<span class="string">&#x27;column_name&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;key&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="string">&#x27;desc&#x27;</span>);</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">saveAsJson</span>();</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-json/" data-id="clpdpxfkk001vywnaazf294ii" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-relationship" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-relationship/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.978Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单关联关系"><a href="#表单关联关系" class="headerlink" title="表单关联关系"></a>表单关联关系</h1><h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><p><code>users</code>表和<code>profiles</code>表通过<code>profiles.user_id</code>字段生成一对一关联</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">`id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`email` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">`updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `profiles` (</span><br><span class="line">`id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`user_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`age` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`gender` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">`updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br></pre></td></tr></table></figure>

<p>对应的数据模分别为:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">profile</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">hasOne</span>(<span class="title class_">Profile</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">belongsTo</span>(<span class="title class_">User</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的数据仓库为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">EloquentRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">User</span> <span class="keyword">as</span> <span class="title">UserModel</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> \<span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">EloquentRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$eloquentClass</span> = <span class="title class_">UserModel</span>::<span class="variable language_">class</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>通过下面的代码可以关联在一个form里面:</p>
<blockquote>
<p>{tip} 实例化数据仓库时需要传入关联模型定义的关联名称，相当于主动使用<code>Eloquent\Model::with</code>方法。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意这里实例化数据仓库`User`时必须传入&quot;profile&quot;，否则将无法关联&quot;profiles&quot;表数据</span></span><br><span class="line"><span class="variable">$form</span> = <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">User</span>::<span class="title function_ invoke__">with</span>(<span class="string">&#x27;profile&#x27;</span>), function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;email&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;profile.age&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;profile.gender&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">datetime</span>(<span class="string">&#x27;created_at&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">datetime</span>(<span class="string">&#x27;updated_at&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果你不想使用数据仓库，也可以直接使用模型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Models</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意这里是直接使用模型，没有使用数据仓库</span></span><br><span class="line"><span class="variable">$form</span> = <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">User</span>::<span class="title function_ invoke__">with</span>(<span class="string">&#x27;profile&#x27;</span>), function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><p>一对多的使用请参考文档<a href="model-form-fields.md#onemany">表单字段的使用-一对多</a></p>
<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><p>下面以项目内置的<code>角色管理</code>模块的<strong>角色绑定权限</strong>功能为例来演示多对多关联模型的用法</p>
<p>模型<code>Role</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Dcat</span>\<span class="title class_">Admin</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">HasDateTimeFormatter</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Relations</span>\<span class="title">BelongsToMany</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HasDateTimeFormatter</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义你的关联模型.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> BelongsToMany</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">permissions</span>(<span class="params"></span>): <span class="title">BelongsToMany</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$pivotTable</span> = <span class="string">&#x27;admin_role_permissions&#x27;</span>; <span class="comment">// 中间表</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$relatedModel</span> = <span class="title class_">Permission</span>::<span class="variable language_">class</span>; <span class="comment">// 关联模型类名</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">belongsToMany</span>(<span class="variable">$relatedModel</span>, <span class="variable">$pivotTable</span>, <span class="string">&#x27;role_id&#x27;</span>, <span class="string">&#x27;permission_id&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Models</span>\<span class="title">Permission</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化数据仓库时传入 permissions，则会自动关联关联模型的数据</span></span><br><span class="line"><span class="comment">// 这里传入 permissions 关联权限模型的数据</span></span><br><span class="line"><span class="variable">$repository</span> = <span class="title class_">Role</span>::<span class="title function_ invoke__">with</span>([<span class="string">&#x27;permissions&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$repository</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;ID&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;slug&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.slug&#x27;</span>))-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.name&#x27;</span>))-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这里的数据会自动保存到关联模型中</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tree</span>(<span class="string">&#x27;permissions&#x27;</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">nodes</span>(function () &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">Permission</span>())-&gt;<span class="title function_ invoke__">allNodes</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$v</span>) <span class="keyword">return</span> [];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 这一步非常重要，需要把数据库中查出来的二维数组转化成一维数组</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">array_column</span>(<span class="variable">$v</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果你不想使用数据仓库，也可以直接使用模型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Models</span>\<span class="title">Role</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意这里是直接使用模型，没有使用数据仓库</span></span><br><span class="line"><span class="variable">$form</span> = <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">Role</span>::<span class="title function_ invoke__">with</span>(<span class="string">&#x27;permissions&#x27;</span>), function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>最终效果如下</p>
<p><img src="https://cdn.learnku.com/uploads/images/202004/26/38389/aeYpYDrUQP.png!large"></p>
<h3 id="关联模型名称为驼峰风格"><a href="#关联模型名称为驼峰风格" class="headerlink" title="关联模型名称为驼峰风格"></a>关联模型名称为驼峰风格</h3><p>如果你的关联模型名称的命名是<strong>驼峰</strong>风格，那么使用的时候需要转化为<strong>下划线</strong>风格命名</p>
<p>例如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="title">extend</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">userProfile</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ...;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">User</span>::<span class="title function_ invoke__">with</span>([<span class="string">&#x27;userProfile&#x27;</span>]), function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注意这里必须使用下划线风格命名，否则将无法显示编辑数据</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;user_profile.postcode&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;user_profile.address&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-relationship/" data-id="clpdpxfkk001wywna5wjdfs0c" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-trans" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-trans/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.977Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表格字段翻译"><a href="#表格字段翻译" class="headerlink" title="表格字段翻译"></a>表格字段翻译</h1><p>数据表格中所有使用到字段的地方都会自动读取语言包中的翻译。</p>
<blockquote>
<p>{tip} 语言包的详细使用方法请参考<a><a href="trans.md">多语言</a></a>。</p>
</blockquote>
<h3 id="语言包名称"><a href="#语言包名称" class="headerlink" title="语言包名称"></a>语言包名称</h3><p>语言包名称需要与控制器名相对应，假如控制器名<code>UserProfileController</code>，则对应的语言包为<code>resources/lang/&#123;当前语言&#125;/user-profile.php</code>（需要转化为小写中划线风格）。</p>
<p>如果想要更改语言包的名称，可以通过下面两种方式进行更改</p>
<p>方式1</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">AdminController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">AdminController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定翻译文件名称</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$translation</span> = <span class="string">&#x27;user1&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方式2</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">translation</span>(<span class="string">&#x27;user1&#x27;</span>);</span><br></pre></td></tr></table></figure>




<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>现在假设语言包<code>resources/lang/zh_CN/user-profile.php</code>内容如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="string">&#x27;fields&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>  =&gt; <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>   =&gt; <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;class&#x27;</span> =&gt; <span class="string">&#x27;班级&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>控制器<code>UserProfileController</code>中设置的<code>Grid</code>字段会自动读取以上翻译：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不设置labael会自动读取语言包翻译</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>();</span><br><span class="line"><span class="variable">$grid</span>-&gt;name;</span><br><span class="line"><span class="variable">$grid</span>-&gt;age;</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="class"><span class="keyword">class</span>;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">$<span class="title">grid</span>-&gt;<span class="title">filter</span>(<span class="title">function</span> ($<span class="title">filter</span>) </span>&#123;</span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">gt</span>(<span class="string">&#x27;age&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面代码等同于</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;名称&#x27;</span>);</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">age</span>(<span class="string">&#x27;年龄&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可这样使用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>(<span class="title function_ invoke__">admin_trans_field</span>(<span class="string">&#x27;id&#x27;</span>));</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">name</span>(<span class="title function_ invoke__">admin_trans_field</span>(<span class="string">&#x27;name&#x27;</span>));</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">age</span>(<span class="title function_ invoke__">admin_trans_field</span>(<span class="string">&#x27;age&#x27;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="公共翻译"><a href="#公共翻译" class="headerlink" title="公共翻译"></a>公共翻译</h3><p>当<code>admin_trans_field</code>函数找不到当前控制器中对指定字段的翻译时，会去<code>global.php</code>中查找。如果某些字段是很多数据表中都有的，可以把这些翻译写在<code>resources/lang/&#123;当前语言&#125;/global.php</code>文件中。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">// 常用的字段放在 global.php 中可以所有控制器共用。</span></span><br><span class="line">    <span class="string">&#x27;fields&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>         =&gt; <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;created_at&#x27;</span> =&gt; <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;updated_at&#x27;</span> =&gt; <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-trans/" data-id="clpdpxfki001sywna14dj1kg7" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-tree" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-tree/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.977Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="树状表格"><a href="#树状表格" class="headerlink" title="树状表格"></a>树状表格</h1><p>树状表格支持分页和点击加载功能，特别适合用来展示数据量较大的多层级结构数据。</p>
<a href="http://103.39.211.179:8080/admin/tree" target="_blank">
    <img class="img img-full" src="/assets/img/screenshots/grid-tree.png">
</a>

<h3 id="表结构和模型"><a href="#表结构和模型" class="headerlink" title="表结构和模型"></a>表结构和模型</h3><p>要使用树状表格，要遵守约定的表结构：</p>
<blockquote>
<p>{tip} 此表结构和模型可完全兼容 <code><a href="model-tree.md">模型树</a></code> 。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `demo_categories` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `parent_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  `<span class="keyword">order</span>` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>, <span class="operator">/</span><span class="operator">/</span> <span class="keyword">order</span> 字段不是必须的，不设置也可以</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci</span><br></pre></td></tr></table></figure>
<p>上面的表格结构里面有三个必要的字段<code>parent_id</code>、<code>title</code>,其它字段没有要求。</p>
<p>对应的模型为<code>app/Models/Category.php</code>:</p>
<blockquote>
<p>{tip} 为了便于阅读，这里不再展示 <code>Repository</code> 代码。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>\<span class="title class_">Demo</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">ModelTree</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">ModelTree</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$table</span> = <span class="string">&#x27;demo_categories&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>表结构中的三个字段<code>parent_id</code>、<code>order</code>、<code>title</code>的字段名也是可以修改的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>\<span class="title class_">Demo</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">ModelTree</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">ModelTree</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$table</span> = <span class="string">&#x27;demo_categories&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$titleColumn</span> = <span class="string">&#x27;name&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$orderColumn</span> = <span class="string">&#x27;sort&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$parentColumn</span> = <span class="string">&#x27;pid&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你的数据表不需要 <code>order</code> 字段排序，则在模型中添加如下代码即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>\<span class="title class_">Demo</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">ModelTree</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">ModelTree</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$table</span> = <span class="string">&#x27;demo_categories&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 返回空值即可禁用 order 字段</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getOrderColumn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>通过调用 <code>Grid\Column::tree</code> 方法即可开启树状表格功能，开启之后默认只查询最顶级节点的数据，子节点数据需要点击加载</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Controllers</span>\<span class="title class_">Demo</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Category</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Controllers</span>\<span class="title">AdminController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CategoryController</span> <span class="keyword">extends</span> <span class="title">AdminController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Category</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Grid <span class="variable">$grid</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>(<span class="string">&#x27;ID&#x27;</span>)-&gt;<span class="title function_ invoke__">bold</span>()-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">            <span class="variable">$grid</span>-&gt;title-&gt;<span class="title function_ invoke__">tree</span>(); <span class="comment">// 开启树状表格功能 </span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;order;</span><br><span class="line">    </span><br><span class="line">            <span class="variable">$grid</span>-&gt;created_at;</span><br><span class="line">            <span class="variable">$grid</span>-&gt;updated_at-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function (Grid\Filter <span class="variable">$filter</span>) &#123;</span><br><span class="line">                <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;slug&#x27;</span>);</span><br><span class="line">                <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">                <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;http_path&#x27;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码执行的 <code>sql</code> 如下（默认只查询 <code>parent = 0</code> 的数据）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> aggregate <span class="keyword">from</span> `demo_categories` <span class="keyword">where</span> `parent_id` <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `demo_categories` <span class="keyword">where</span> `parent_id` <span class="operator">=</span> <span class="number">0</span> <span class="keyword">order</span> <span class="keyword">by</span> `<span class="keyword">order</span>` <span class="keyword">asc</span>, `id` <span class="keyword">asc</span> limit <span class="number">20</span> <span class="keyword">offset</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>


<p><code>Grid\Column::tree</code> 方法参数</p>
<ul>
<li><code>bool</code> <code>$showAll</code>  <code>false</code>  是否一次性展示下一层级的所有节点，默认分页展示</li>
<li><code>bool</code> <code>$sortable</code> <code>true</code>   是否开启排序功能</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用分页功能，一次性加载所有下一层级节点</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;title-&gt;<span class="title function_ invoke__">tree</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不需要 order 字段排序，第二个参数传 false 即可</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;title-&gt;<span class="title function_ invoke__">tree</span>(<span class="literal">false</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>


<h3 id="orderable排序"><a href="#orderable排序" class="headerlink" title="orderable排序"></a>orderable排序</h3><p><code>orderable</code> 排序功能依赖 <a href="https://github.com/spatie/eloquent-sortable" target="__blank">spatie&#x2F;eloquent-sortable</a> 组件，需要修改模型：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Spatie</span>\<span class="title">EloquentSortable</span>\<span class="title">Sortable</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span> <span class="keyword">extends</span> <span class="title">Model</span> <span class="keyword">implements</span> <span class="title">Sortable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">ModelTree</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置排序字段，默认order</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$orderColumn</span> = <span class="string">&#x27;sort&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是使用示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CategoryController</span> <span class="keyword">extends</span> <span class="title">AdminController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Category</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Grid <span class="variable">$grid</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>(<span class="string">&#x27;ID&#x27;</span>)-&gt;<span class="title function_ invoke__">bold</span>()-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">            <span class="variable">$grid</span>-&gt;title-&gt;<span class="title function_ invoke__">tree</span>(); <span class="comment">// 开启树状表格功能 </span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;order-&gt;<span class="title function_ invoke__">orderable</span>(); <span class="comment">// 开启排序功能</span></span><br><span class="line">    </span><br><span class="line">            ...;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关于数据搜索"><a href="#关于数据搜索" class="headerlink" title="关于数据搜索"></a>关于数据搜索</h3><p>如果在树状表格中使用了搜索功能（<code>Grid::filter</code>、<code>Grid\Column::filter</code>、<code>Grid::quickSearch</code>），为了让用户能搜索到想要的数据，则会<b>取消只查最顶级数据的操作</b>。</p>
<blockquote>
<p>{tip} 使用 <a href="model-grid-filters.md">查询过滤</a>、<a href="model-grid-column-filter.md">列过滤器</a>、<a href="model-grid-quick-search.md">快捷搜索</a> 等搜索功能都会<b>取消只查最顶级数据的操作</b>，只有 <a href="model-grid-selector.md">筛选器</a> 和 <a href="model-grid-filters.md#scope">范围查询scope</a> 等功能例外。</p>
</blockquote>
<p>例如下面的代码开启了快捷搜索</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CategoryController</span> <span class="keyword">extends</span> <span class="title">AdminController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Category</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Grid <span class="variable">$grid</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>(<span class="string">&#x27;ID&#x27;</span>)-&gt;<span class="title function_ invoke__">bold</span>()-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">            <span class="variable">$grid</span>-&gt;title-&gt;<span class="title function_ invoke__">tree</span>(); <span class="comment">// 开启树状表格功能 </span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;order-&gt;<span class="title function_ invoke__">orderable</span>(); <span class="comment">// 开启排序功能</span></span><br><span class="line">    </span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>([<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>]);</span><br><span class="line">            ...;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>且用户在浏览器中使用了快捷搜索，则产生<code>sql</code>如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> aggregate <span class="keyword">from</span> `demo_categories` <span class="keyword">where</span> `id` <span class="keyword">like</span> &quot;%xxx%&quot; <span class="keyword">or</span> `title` <span class="keyword">like</span> &quot;%xxx%&quot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `demo_categories` <span class="keyword">where</span> `id` <span class="keyword">like</span> &quot;%xxx%&quot; <span class="keyword">or</span> `title` <span class="keyword">like</span> &quot;%xxx%&quot; <span class="keyword">order</span> <span class="keyword">by</span> `<span class="keyword">order</span>` <span class="keyword">asc</span>, `id` <span class="keyword">asc</span> limit <span class="number">20</span> <span class="keyword">offset</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="与模型树功能的差别"><a href="#与模型树功能的差别" class="headerlink" title="与模型树功能的差别"></a>与模型树功能的差别</h3><p><a href="model-tree.md">模型树</a>同样可用于展示多层级结构数据，并且支持用拖拽的方式实现数据的层级、排序等操作，但是不支持分页和点击加载功能，只能一次性加载完所有数据，<br>因此<a href="model-tree.md">模型树</a>并不适合用来展示数据量较大的数据。</p>
<p>而树状表格支持分页和点击加载功能，适合用来展示数据量较大的多层级结构数据，但不支持用拖拽的方式实现数据的层级、排序操作。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-tree/" data-id="clpdpxfkj001tywnagn7tfymd" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.977Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表格基本使用"><a href="#表格基本使用" class="headerlink" title="表格基本使用"></a>表格基本使用</h1><h2 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h2><p><code>Dcat\Admin\Grid</code>类用于生成基于数据模型的表格，先来个例子，数据库中有<code>movies</code>表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `movies` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `director` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `<span class="keyword">describe</span>` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rate` tinyint unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `released` enum(<span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">  `release_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对应的数据模型为<code>App\Models\Movie</code>，对应的数据仓库为<code>App\Admin\Repositories\Movie</code>，数据仓库代码如下：</p>
<blockquote>
<p>{tip} 如果你的数据来自<code>MySQL</code>，则<code>数据仓库</code>不是必须的，你也可以直接使用<code>Model</code>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">EloquentRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Movie</span> <span class="keyword">as</span> <span class="title">MovieModel</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">EloquentRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$eloquentClass</span> = <span class="title class_">MovieModel</span>::<span class="variable language_">class</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置表格查询的字段，默认查询所有字段</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getGridColumns</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;director&#x27;</span>, <span class="string">&#x27;rate&#x27;</span>, ...];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面的代码可以生成表<code>movies</code>的数据表格：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Movie</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Controllers</span>\<span class="title">AdminController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieController</span> <span class="keyword">extends</span> <span class="title">AdminController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Movie</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Grid <span class="variable">$grid</span></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 第一列显示id字段，并将这一列设置为可排序列</span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;ID&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 第二列显示title字段，由于title字段名和Grid对象的title方法冲突，所以用Grid的column()方法代替</span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 第三列显示director字段，通过display($callback)方法设置这一列的显示内容为users表中对应的用户名</span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;director&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function(<span class="variable">$userId</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">User</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$userId</span>)-&gt;name;</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 第四列显示为describe字段</span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;describe&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 第五列显示为rate字段</span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;rate&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 第六列显示released字段，通过display($callback)方法来格式化显示输出</span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;released&#x27;</span>, <span class="string">&#x27;上映?&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function (<span class="variable">$released</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$released</span> ? <span class="string">&#x27;是&#x27;</span> : <span class="string">&#x27;否&#x27;</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 下面为三个时间字段的列显示</span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;release_at&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;created_at&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;updated_at&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// filter($callback)方法用来设置表格的简单搜索框</span></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function (<span class="variable">$filter</span>) &#123;</span><br><span class="line">                <span class="comment">// 设置created_at字段的范围查询</span></span><br><span class="line">                <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">between</span>(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;Created Time&#x27;</span>)-&gt;<span class="title function_ invoke__">datetime</span>();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="表格显示模式"><a href="#表格显示模式" class="headerlink" title="表格显示模式"></a>表格显示模式</h2><h3 id="table-collapse"><a href="#table-collapse" class="headerlink" title="table_collapse"></a>table_collapse</h3><p>在这个版本开始，默认的表格布局将会采用 <code>table_collapse</code> 模式，效果如下</p>
<a href="https://cdn.learnku.com/uploads/images/202007/24/38389/4bCfBdtvq5.png!large" target="_blank">
    <img class="img" src="https://cdn.learnku.com/uploads/images/202007/24/38389/4bCfBdtvq5.png!large" />
</a>
<a href="https://cdn.learnku.com/uploads/images/202007/24/38389/35KJXfVXib.png!large" target="_blank">
    <img class="img" src="https://cdn.learnku.com/uploads/images/202007/24/38389/35KJXfVXib.png!large" />
</a>    

<p>如果想要切换回旧版本的表格布局样式，可以在 <code>app/Admin/bootstrap.php</code>中加上</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Grid</span>::<span class="title function_ invoke__">resolving</span>(function (Grid <span class="variable">$grid</span>) &#123;</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tableCollapse</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="边框模式"><a href="#边框模式" class="headerlink" title="边框模式"></a>边框模式</h3><p>通过<code>withBorder</code>方式可以让表格显示边框</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">withBorder</span>();</span><br></pre></td></tr></table></figure>

<p>效果<br><img src="https://cdn.learnku.com/uploads/images/202004/26/38389/lKTZe0jwGg.png!large"></p>
<p>禁用边框模式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">withBorder</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>


<h2 id="基本使用方法"><a href="#基本使用方法" class="headerlink" title="基本使用方法"></a>基本使用方法</h2><h3 id="添加列-column"><a href="#添加列-column" class="headerlink" title="添加列 (column)"></a>添加列 (column)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加单列</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;用户名&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加多列</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">columns</span>(<span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;username&#x27;</span> ...);</span><br></pre></td></tr></table></figure>

<h3 id="修改来源数据"><a href="#修改来源数据" class="headerlink" title="修改来源数据"></a>修改来源数据</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">orderBy</span>(<span class="string">&#x27;profile.age&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回收站数据</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">onlyTrashed</span>();</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>同时也可以使用以下方式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">Model</span>::<span class="title function_ invoke__">with</span>(<span class="string">&#x27;...&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(...), function (Grid <span class="variable">$grid</span>) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其它查询方法可以参考<code>eloquent</code>的查询方法</p>
<h3 id="修改显示输出-display"><a href="#修改显示输出-display" class="headerlink" title="修改显示输出 (display)"></a>修改显示输出 (display)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;text&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function(<span class="variable">$text</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_limit</span>(<span class="variable">$text</span>, <span class="number">30</span>, <span class="string">&#x27;...&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许混合使用多个“display”方法</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function (<span class="variable">$name</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&quot;&lt;b&gt;<span class="subst">$name</span>&lt;/b&gt;&quot;</span>;</span><br><span class="line"> &#125;)-&gt;<span class="title function_ invoke__">display</span>(function (<span class="variable">$name</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;span class=&#x27;label&#x27;&gt;<span class="subst">$name</span>&lt;/span&gt;&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;email&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function (<span class="variable">$email</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;mailto:<span class="subst">$email</span>&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以直接写字符串</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;username&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;...&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加不存在的字段</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;column_not_in_table&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;blablabla....&#x27;</span>.<span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="显示序号-number"><a href="#显示序号-number" class="headerlink" title="显示序号 (number)"></a>显示序号 (number)</h3><p>通过<code>number</code>方法可以在表格中添加一列从<code>1</code>开始计算的行序号列</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">number</span>();</span><br></pre></td></tr></table></figure>

<h3 id="设置名称-setName"><a href="#设置名称-setName" class="headerlink" title="设置名称 (setName)"></a>设置名称 (setName)</h3><p>当页面存在多个<code>Grid</code>表格时，需要给表格设置不同的名称，否则部分功能可能会出现冲突的情况</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">setName</span>(<span class="string">&#x27;name1&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前行数据-row"><a href="#获取当前行数据-row" class="headerlink" title="获取当前行数据 (row)"></a>获取当前行数据 (row)</h3><p><code>display()</code>方法接收的匿名函数绑定了当前行的数据对象，可以在里面调用当前行的其它字段数据</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;first_name&#x27;</span>);</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;last_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不存的字段列</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;full_name&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;first_name.<span class="string">&#x27; &#x27;</span>.<span class="variable language_">$this</span>-&gt;last_name;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p><a name="outline"></a></p>
<h3 id="设置工具栏按钮样式"><a href="#设置工具栏按钮样式" class="headerlink" title="设置工具栏按钮样式"></a>设置工具栏按钮样式</h3><p>工具栏按钮默认显示<code>outline</code>模式，效果如下</p>
<p>用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">toolsWithOutline</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁止</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">toolsWithOutline</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>效果<br><img src="https://cdn.learnku.com/uploads/images/202005/23/38389/hKWC1crYHw.png!large"></p>
<p>禁用<code>outline</code>后的效果</p>
<p><img src="https://cdn.learnku.com/uploads/images/202005/23/38389/aaMdymSxoY.png!large"></p>
<p>如果你希望某个按钮不使用<code>outline</code>模式，可以在按钮的<code>class</code>属性中加上<code>disable-outline</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tools</span>(<span class="string">&#x27;&lt;a class=&quot;btn btn-primary disable-outline&quot;&gt;测试按钮&lt;/a&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="设置创建按钮"><a href="#设置创建按钮" class="headerlink" title="设置创建按钮"></a>设置创建按钮</h3><p>此功能默认开启</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableCreateButton</span>();</span><br><span class="line"><span class="comment">// 显示</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showCreateButton</span>();</span><br></pre></td></tr></table></figure>

<h4 id="开启弹窗创建表单"><a href="#开启弹窗创建表单" class="headerlink" title="开启弹窗创建表单"></a>开启弹窗创建表单</h4><p>此功能默认不开启</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">enableDialogCreate</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置弹窗宽高，默认值为 &#x27;700px&#x27;, &#x27;670px&#x27;</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">setDialogFormDimensions</span>(<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;50%&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="修改创建以及更新按钮的路由-setResource"><a href="#修改创建以及更新按钮的路由-setResource" class="headerlink" title="修改创建以及更新按钮的路由 (setResource)"></a>修改创建以及更新按钮的路由 (setResource)</h3><p>设置修改创建以及更新按钮的路由前缀</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">setResource</span>(<span class="string">&#x27;auth/users&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h3 id="设置查询过滤器"><a href="#设置查询过滤器" class="headerlink" title="设置查询过滤器"></a>设置查询过滤器</h3><p>此功能默认开启</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableFilter</span>();</span><br><span class="line"><span class="comment">// 显示</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showFilter</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用过滤器按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableFilterButton</span>();</span><br><span class="line"><span class="comment">// 显示过滤器按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showFilterButton</span>();</span><br></pre></td></tr></table></figure>


<h3 id="行选择器-rowSelector"><a href="#行选择器-rowSelector" class="headerlink" title="行选择器 (rowSelector)"></a>行选择器 (rowSelector)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableRowSelector</span>();</span><br><span class="line"><span class="comment">// 显示</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showRowSelector</span>();</span><br></pre></td></tr></table></figure>

<h4 id="设置选择中行的标题字段"><a href="#设置选择中行的标题字段" class="headerlink" title="设置选择中行的标题字段"></a>设置选择中行的标题字段</h4><p>设置选中后需要显示的字段，如不设置，默认取 <code>name</code>、 <code>title</code>、 <code>username</code>中的一个。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;full_name&#x27;</span>);</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;age&#x27;</span>);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">titleColumn</span>(<span class="string">&#x27;full_name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="设置选择中行的ID字段"><a href="#设置选择中行的ID字段" class="headerlink" title="设置选择中行的ID字段"></a>设置选择中行的ID字段</h4><p>设置选中后需要保存的字段，默认为 数据表主键(id) 字段</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;new_id&#x27;</span>);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">idColumn</span>(<span class="string">&#x27;new_id&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="设置checkbox选择框颜色"><a href="#设置checkbox选择框颜色" class="headerlink" title="设置checkbox选择框颜色"></a>设置checkbox选择框颜色</h4><p>默认 <code>primary</code>，支持：<code>default</code>、 <code>primary</code>、 <code>success</code>、 <code>info</code>、 <code>danger</code>、 <code>purple</code>、 <code>inverse</code>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">style</span>(<span class="string">&#x27;success&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="点击当前行任意位置选中"><a href="#点击当前行任意位置选中" class="headerlink" title="点击当前行任意位置选中"></a>点击当前行任意位置选中</h4><p>此功能默认不开启。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">click</span>();</span><br></pre></td></tr></table></figure>

<h4 id="设置选中行的背景颜色"><a href="#设置选中行的背景颜色" class="headerlink" title="设置选中行的背景颜色"></a>设置选中行的背景颜色</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">background</span>(<span class="title class_">Admin</span>::<span class="title function_ invoke__">color</span>()-&gt;<span class="title function_ invoke__">dark20</span>());</span><br></pre></td></tr></table></figure>

<h4 id="设置默认选中-check"><a href="#设置默认选中-check" class="headerlink" title="设置默认选中 (check)"></a>设置默认选中 (check)</h4><blockquote>
<p>Since <code>v2.0.21</code></p>
</blockquote>
<p>通过<code>check</code>方法可以设置默认选中的行，此方法接受一个<code>array</code>类型或<code>匿名函数</code>参数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置默认选中第 1/3/5 行</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">check</span>([<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传递闭包</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">check</span>(function () &#123;</span><br><span class="line">    <span class="comment">// 设置默认选中第 1/3/5 行</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">in_array</span>(<span class="variable">$this</span>-&gt;_index, [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在闭包中使用当前行其他字段</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">check</span>(function () &#123;</span><br><span class="line">    <span class="comment">// 设置默认选中 id &gt; 10 的行</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;id &gt; <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="禁止更改选中状态-disable"><a href="#禁止更改选中状态-disable" class="headerlink" title="禁止更改选中状态 (disable)"></a>禁止更改选中状态 (disable)</h4><blockquote>
<p>Since <code>v2.0.21</code></p>
</blockquote>
<p>通过<code>disable</code>方法可以设置禁止更改选中状态的行，此方法接受一个<code>array</code>类型或<code>匿名函数</code>参数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁止第 1/3/5 行更改选中状态</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">disable</span>([<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传递闭包</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">disable</span>(function () &#123;</span><br><span class="line">    <span class="comment">// 禁止第 1/3/5 行更改选中状态</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">in_array</span>(<span class="variable">$this</span>-&gt;_index, [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在闭包中使用当前行其他字段</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">disable</span>(function () &#123;</span><br><span class="line">    <span class="comment">// 禁止 id &gt; 10 的行更改选中状态</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;id &gt; <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// disable 可以和 check 方法一起使用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">rowSelector</span>()-&gt;<span class="title function_ invoke__">check</span>([<span class="number">2</span>, <span class="number">4</span>])-&gt;<span class="title function_ invoke__">disable</span>([<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>]);</span><br></pre></td></tr></table></figure>


<h3 id="设置行操作按钮"><a href="#设置行操作按钮" class="headerlink" title="设置行操作按钮"></a>设置行操作按钮</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableActions</span>();</span><br><span class="line"><span class="comment">// 显示</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showActions</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用详情按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableViewButton</span>();</span><br><span class="line"><span class="comment">// 显示详情按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showViewButton</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用编辑按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableEditButton</span>();</span><br><span class="line"><span class="comment">// 显示编辑按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showEditButton</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用快捷编辑按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableQuickEditButton</span>();</span><br><span class="line"><span class="comment">// 显示快捷编辑按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showQuickEditButton</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置弹窗宽高，默认值为 &#x27;700px&#x27;, &#x27;670px&#x27;</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">setDialogFormDimensions</span>(<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;50%&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用删除按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableDeleteButton</span>();</span><br><span class="line"><span class="comment">// 显示删除按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showDeleteButton</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="设置批量操作按钮-batchActions"><a href="#设置批量操作按钮-batchActions" class="headerlink" title="设置批量操作按钮 (batchActions)"></a>设置批量操作按钮 (batchActions)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableBatchActions</span>();</span><br><span class="line"><span class="comment">// 显示</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showBatchActions</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用批量删除按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableBatchDelete</span>();</span><br><span class="line"><span class="comment">// 显示批量删除按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showBatchDelete</span>();</span><br></pre></td></tr></table></figure>

<h3 id="设置工具栏-toolbar"><a href="#设置工具栏-toolbar" class="headerlink" title="设置工具栏 (toolbar)"></a>设置工具栏 (toolbar)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableToolbar</span>();</span><br><span class="line"><span class="comment">// 显示</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showToolbar</span>();</span><br></pre></td></tr></table></figure>

<h3 id="设置刷新按钮-refresh"><a href="#设置刷新按钮-refresh" class="headerlink" title="设置刷新按钮 (refresh)"></a>设置刷新按钮 (refresh)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableRefreshButton</span>();</span><br><span class="line"><span class="comment">// 显示</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showRefreshButton</span>();</span><br></pre></td></tr></table></figure>

<h3 id="设置分页功能-paginate"><a href="#设置分页功能-paginate" class="headerlink" title="设置分页功能 (paginate)"></a>设置分页功能 (paginate)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disablePagination</span>();</span><br><span class="line"><span class="comment">// 显示</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">showPagination</span>();</span><br></pre></td></tr></table></figure>

<h4 id="简化分页-simplePaginate"><a href="#简化分页-simplePaginate" class="headerlink" title="简化分页 (simplePaginate)"></a>简化分页 (simplePaginate)</h4><p>启用 <code>simplePaginate</code> 功能后会使用<code>Laravel</code>的<a target="_blank" rel="noopener" href="https://laravel.com/docs/8.x/pagination#simple-pagination">simplePaginate</a>功能进行分页，当数据量较大时可以大幅提升页面的响应速度，但需要注意的是，使用此功能后将不会查询数据表的<strong>总行数</strong>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">simplePaginate</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">simplePaginate</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>


<h4 id="设置每页显示行数"><a href="#设置每页显示行数" class="headerlink" title="设置每页显示行数"></a>设置每页显示行数</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认为每页20条</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">paginate</span>(<span class="number">15</span>);</span><br></pre></td></tr></table></figure>

<h4 id="设置分页选择器选项"><a href="#设置分页选择器选项" class="headerlink" title="设置分页选择器选项"></a>设置分页选择器选项</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">perPages</span>([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用分页选择器</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disablePerPages</span>();</span><br></pre></td></tr></table></figure>

<h3 id="addTableClass"><a href="#addTableClass" class="headerlink" title="addTableClass"></a>addTableClass</h3><p>通过<code>addTableClass</code>可以给表格的<code>table</code>添加<code>css</code>样式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">addTableClass</span>([<span class="string">&#x27;class1&#x27;</span>, <span class="string">&#x27;class2&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="设置表格文字居中-text-center"><a href="#设置表格文字居中-text-center" class="headerlink" title="设置表格文字居中 (text-center)"></a>设置表格文字居中 (text-center)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">addTableClass</span>([<span class="string">&#x27;table-text-center&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="显示横向滚动条-scrollbarX"><a href="#显示横向滚动条-scrollbarX" class="headerlink" title="显示横向滚动条 (scrollbarX)"></a>显示横向滚动条 (scrollbarX)</h3><p>显示表格横向滚动条，默认不显示</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">scrollbarX</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">scrollbarX</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>


<h3 id="设置表格外层容器"><a href="#设置表格外层容器" class="headerlink" title="设置表格外层容器"></a>设置表格外层容器</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 更改表格外层容器</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">wrap</span>(function (Renderable <span class="variable">$view</span>) &#123;</span><br><span class="line">    <span class="variable">$tab</span> = <span class="title class_">Tab</span>::<span class="title function_ invoke__">make</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$tab</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;示例&#x27;</span>, <span class="variable">$view</span>);</span><br><span class="line">    <span class="variable">$tab</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;代码&#x27;</span>, <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">code</span>(), <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$tab</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="关联模型"><a href="#关联模型" class="headerlink" title="关联模型"></a>关联模型</h2><p>参考<a href="model-grid-relationship.md">表格关联关系</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid/" data-id="clpdpxfkj001uywnafx6q8v1b" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-softdelete" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-softdelete/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.976Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="数据软删除"><a href="#数据软删除" class="headerlink" title="数据软删除"></a>数据软删除</h1><p>先参考<code>Laravel</code>文档实现模型的<a target="_blank" rel="noopener" href="https://learnku.com/docs/laravel/6.x/eloquent/5176#soft-deleting">软删除</a>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">SoftDeletes</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">SoftDeletes</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样在<code>grid</code>列表中显示的数据都是未被删除的数据</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Post</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Grid <span class="variable">$grid</span></span>) </span>&#123;</span><br><span class="line">	<span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>(<span class="string">&#x27;ID&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">	<span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;Title&#x27;</span>);</span><br><span class="line">	<span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">created_at</span>(<span class="string">&#x27;Created at&#x27;</span>);</span><br><span class="line">	<span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">updated_at</span>(<span class="string">&#x27;Updated at&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="回收站入口"><a href="#回收站入口" class="headerlink" title="回收站入口"></a>回收站入口</h2><p>接下来需要增加一个入口，能让我们看到被软删除的数据，这里可以使用<code>model-grid</code>的<a href="model-grid-filters.md#scope">范围过滤器</a>来实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function () &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 范围过滤器，调用模型的`onlyTrashed`方法，查询出被软删除的数据。</span></span><br><span class="line">    <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">scope</span>(<span class="string">&#x27;trashed&#x27;</span>, <span class="string">&#x27;回收站&#x27;</span>)-&gt;<span class="title function_ invoke__">onlyTrashed</span>();</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在表头的筛选按钮的下拉菜单中就会出现一个<code>回收站</code>按钮，点击它，就会调用模型的<code>onlyTrashed</code>方法，从表中查询出被删除的数据，也就是回收站中的数据。</p>
<img style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="40%" src="/assets/img/screenshots/trash-button.png">



<h2 id="行恢复操作"><a href="#行恢复操作" class="headerlink" title="行恢复操作"></a>行恢复操作</h2><p>按照下面的方法，我们可以在回收站中的每一行数据加上一个恢复操作，方便恢复数据</p>
<p>先定义操作类<code>app/Admin/Actions/Post/Restore.php</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Actions</span>\<span class="title class_">Post</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">RowAction</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Restore</span> <span class="keyword">extends</span> <span class="title">RowAction</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$title</span> = <span class="string">&#x27;恢复&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">	<span class="keyword">protected</span> <span class="variable">$model</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 注意构造方法的参数必须要有默认值</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$model</span> = <span class="literal">null</span></span>) </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;model = <span class="variable">$model</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKey</span>();</span><br><span class="line">        <span class="variable">$model</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;model&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$model</span>::<span class="title function_ invoke__">withTrashed</span>()-&gt;<span class="title function_ invoke__">findOrFail</span>(<span class="variable">$key</span>)-&gt;<span class="title function_ invoke__">restore</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;已恢复&#x27;</span>)-&gt;<span class="title function_ invoke__">refresh</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">confirm</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;确定恢复吗？&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parameters</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="string">&#x27;model&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;model,    </span><br><span class="line">		];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加到行操作:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Post</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Actions</span>\<span class="title">Post</span>\<span class="title">Restore</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">actions</span>(function (Grid\Displayers\Actions <span class="variable">$actions</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">request</span>(<span class="string">&#x27;_scope_&#x27;</span>) == <span class="string">&#x27;trashed&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="keyword">new</span> <span class="title class_">Restore</span>(<span class="title class_">Post</span>::<span class="variable language_">class</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="批量恢复操作"><a href="#批量恢复操作" class="headerlink" title="批量恢复操作"></a>批量恢复操作</h2><p>先定义操作类<code>app/Admin/Actions/Post/BatchRestore.php</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Actions</span>\<span class="title class_">Post</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">BatchAction</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BatchRestore</span> <span class="keyword">extends</span> <span class="title">BatchAction</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$title</span> = <span class="string">&#x27;恢复&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$model</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注意构造方法的参数必须要有默认值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$model</span> = <span class="literal">null</span></span>) </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;model = <span class="variable">$model</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$model</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;model&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> ((<span class="keyword">array</span>) <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKey</span>() <span class="keyword">as</span> <span class="variable">$key</span>) &#123;</span><br><span class="line">			<span class="variable">$model</span>::<span class="title function_ invoke__">withTrashed</span>()-&gt;<span class="title function_ invoke__">findOrFail</span>(<span class="variable">$key</span>)-&gt;<span class="title function_ invoke__">restore</span>();</span><br><span class="line">		&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;已恢复&#x27;</span>)-&gt;<span class="title function_ invoke__">refresh</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">confirm</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;确定恢复吗？&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parameters</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> [</span><br><span class="line">			<span class="string">&#x27;model&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;model,    </span><br><span class="line">		];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加到批量操作:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Post</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Actions</span>\<span class="title">Post</span>\<span class="title">BatchRestore</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">batchActions</span>(function (Grid\Tools\BatchActions <span class="variable">$batch</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">request</span>(<span class="string">&#x27;_scope_&#x27;</span>) == <span class="string">&#x27;trashed&#x27;</span>) &#123;</span><br><span class="line">		<span class="variable">$batch</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="keyword">new</span> <span class="title class_">BatchRestore</span>(<span class="title class_">Post</span>::<span class="variable language_">class</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-softdelete/" data-id="clpdpxfki001rywnadi7tc11l" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-quick-search" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-quick-search/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.975Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表格快捷搜索"><a href="#表格快捷搜索" class="headerlink" title="表格快捷搜索"></a>表格快捷搜索</h1><p>快捷搜索是除了<code>filter</code>之外的另一个表格数据搜索方式，用来快速过滤你想要的数据，开启方式如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置表单提示值</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>()-&gt;<span class="title function_ invoke__">placeholder</span>(<span class="string">&#x27;搜索...&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>这样表头会出现一个搜索框:<br><a href="/assets/img/screenshots/grid-quick-search.png" target="_blank"><br>    <img style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="100%" src="/assets/img/screenshots/grid-quick-search.png"><br></a></p>
<p>通过给<code>quickSearch</code>方法传入不同的参数，来设置不同的搜索方式，有下面几种使用方法</p>
<h2 id="Like搜索"><a href="#Like搜索" class="headerlink" title="Like搜索"></a>Like搜索</h2><p>第一种方式，通过设置字段名称来进行简单的like查询</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提交后模型会执行下面的查询</span></span><br><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">&#123;$input&#125;</span>%&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>或者对多个字段做like查询:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>, <span class="string">&#x27;content&#x27;</span>);</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>([<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>, <span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提交后模型会执行下面的查询</span></span><br><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">&#123;$input&#125;</span>%&quot;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">orWhere</span>(<span class="string">&#x27;desc&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">&#123;$input&#125;</span>%&quot;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">orWhere</span>(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">&#123;$input&#125;</span>%&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="关联关系"><a href="#关联关系" class="headerlink" title="关联关系"></a>关联关系</h3><p>如果安装了 <a target="_blank" rel="noopener" href="https://github.com/jqhph/laravel-wherehasin">dcat&#x2F;laravel-wherehasin</a>，则会优先使用<code>whereHasIn</code>方法进行查询操作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>(<span class="string">&#x27;user.name&#x27;</span>, <span class="string">&#x27;user.username&#x27;</span>, <span class="string">&#x27;content&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h2 id="自定义搜索"><a href="#自定义搜索" class="headerlink" title="自定义搜索"></a>自定义搜索</h2><p>第二种方式可以让你更灵活的控制搜索条件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>(function (<span class="variable">$model</span>, <span class="variable">$query</span>) &#123;</span><br><span class="line">    <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;title&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">orWhere</span>(<span class="string">&#x27;desc&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">&#123;$query&#125;</span>%&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>其中闭包的参数<code>$query</code>为你填入搜索框中的内容，提交之后进行闭包中的查询。</p>
<h2 id="快捷语法搜索"><a href="#快捷语法搜索" class="headerlink" title="快捷语法搜索"></a>快捷语法搜索</h2><p>第三种方式参考了<code>Github</code>的搜索语法，来进行快捷搜索，调用方式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不传参数</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>();</span><br></pre></td></tr></table></figure>
<p>填入搜索框的内容按照以下的语法，在提交之后会进行相应的查询 :</p>
<h3 id="比较查询"><a href="#比较查询" class="headerlink" title="比较查询"></a>比较查询</h3><p><code>title:foo</code> 、<code>title:!foo</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;!=&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>rate:&gt;10</code>、<code>rate:&lt;10</code>、<code>rate:&gt;=10</code>、<code>rate:&lt;=10</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;rate&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;rate&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;rate&#x27;</span>, <span class="string">&#x27;&gt;=&#x27;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;rate&#x27;</span>, <span class="string">&#x27;&lt;=&#x27;</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<h3 id="In、NotIn查询"><a href="#In、NotIn查询" class="headerlink" title="In、NotIn查询"></a>In、NotIn查询</h3><p><code>status:(1,2,3,4)</code>、<code>status:!(1,2,3,4)</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">whereIn</span>(<span class="string">&#x27;status&#x27;</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">whereNotIn</span>(<span class="string">&#x27;status&#x27;</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="Between查询"><a href="#Between查询" class="headerlink" title="Between查询"></a>Between查询</h3><p><code>score:[1,10]</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">whereBetween</span>(<span class="string">&#x27;score&#x27;</span>, [<span class="number">1</span>, <span class="number">10</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="时间日期函数查询"><a href="#时间日期函数查询" class="headerlink" title="时间日期函数查询"></a>时间日期函数查询</h3><p><code>created_at:date,2019-06-08</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">whereDate</span>(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;2019-06-08&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>created_at:time,09:57:45</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">whereTime</span>(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;09:57:45&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>created_at:day,08</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">whereDay</span>(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;08&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>created_at:month,06</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">whereMonth</span>(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;06&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>created_at:year,2019</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">whereYear</span>(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;2019&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Like查询"><a href="#Like查询" class="headerlink" title="Like查询"></a>Like查询</h3><p><code>content:%Laudantium%</code>、<code>content:Laud%</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;%Laudantium%&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laud%&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="正则查询"><a href="#正则查询" class="headerlink" title="正则查询"></a>正则查询</h3><p><code>username:/song/</code></p>
<blockquote>
<p>{tip} 这里请使用MYSQL正则语法</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;REGEXP&#x27;</span>, <span class="string">&#x27;song&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="多条件组合搜索"><a href="#多条件组合搜索" class="headerlink" title="多条件组合搜索"></a>多条件组合搜索</h3><p>用空格隔开多个搜索语句就可以实现多个字段的AND查询，比如<code>username:%song% status:(1,2,3)</code>, 提交之后会运行下面的搜索</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;%song%&#x27;</span>)-&gt;<span class="title function_ invoke__">whereIn</span>(<span class="string">&#x27;status&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure>

<p>如果某一个条件是<code>OR</code>查询, 只需要在语句单元前增加一个|符号即可： <code>username:%song% |status:(1,2,3)</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;%song%&#x27;</span>)-&gt;<span class="title function_ invoke__">orWhereIn</span>(<span class="string">&#x27;status&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>{tip} 如果填入的查询文字中包含空格，需要放在双引号里面：<code>updated_at:&quot;2019-06-08 09:57:45&quot;</code></p>
</blockquote>
<h3 id="Label作为查询字段名称"><a href="#Label作为查询字段名称" class="headerlink" title="Label作为查询字段名称"></a>Label作为查询字段名称</h3><p>不方便得到字段名的情况下，可以直接使用label名称作为查询字段</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 比如设置了`user_status`的表头列名为`用户状态`</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;user_status&#x27;</span>, <span class="string">&#x27;用户状态&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>那么可以填入<code>用户状态:(1,2,3)</code>来执行下面的查询</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$model</span>-&gt;<span class="title function_ invoke__">whereIn</span>(<span class="string">&#x27;user_status&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure>


<h2 id="禁止自动提交"><a href="#禁止自动提交" class="headerlink" title="禁止自动提交"></a>禁止自动提交</h2><p>快捷搜索默认是开启自动提交功能的，如果你不需要自动提交，可以通过以下方式禁用这个功能</p>
<blockquote>
<p>{tip} 禁用了自动提交功能之后需要通过按回车(<code>Enter</code>)键进行搜索。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>()-&gt;<span class="title function_ invoke__">auto</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-quick-search/" data-id="clpdpxfkg001oywna19k785ga" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-relationship" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-relationship/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.975Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表格关联关系"><a href="#表格关联关系" class="headerlink" title="表格关联关系"></a>表格关联关系</h1><h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><p><code>users</code>表和<code>profiles</code>表通过<code>profiles.user_id</code>字段生成一对一关联</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">`id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`email` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">`updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `profiles` (</span><br><span class="line">`id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`user_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`age` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`gender` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">`updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br></pre></td></tr></table></figure>

<p>对应的数据模以及数据仓库分别为:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">profile</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">hasOne</span>(<span class="title class_">Profile</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">belongsTo</span>(<span class="title class_">User</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数据仓库</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">EloquentRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">User</span> <span class="keyword">as</span> <span class="title">UserModel</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">EloquentRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$eloquentClass</span> = <span class="title class_">UserModel</span>::<span class="variable language_">class</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="relation"></a></p>
<h4 id="三种关联数据表的方法"><a href="#三种关联数据表的方法" class="headerlink" title="三种关联数据表的方法"></a>三种关联数据表的方法</h4><p>通过以下三种方式的代码可以关联<code>profile</code>表数据:</p>
<p>方式一：直接使用数据仓库关联</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关联 profile 表数据</span></span><br><span class="line"><span class="variable">$grid</span> = <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">User</span>::<span class="title function_ invoke__">with</span>([<span class="string">&#x27;profile&#x27;</span>]), function (Grid <span class="variable">$grid</span>) &#123;    </span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>(<span class="string">&#x27;ID&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">name</span>();</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">email</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 显示一对一数据</span></span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;profile.age&#x27;</span>);</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;profile.gender&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">created_at</span>();</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">updated_at</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>方式二：使用<code>Model::with</code>方法关联</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关联 profile 表数据</span></span><br><span class="line"><span class="variable">$grid</span> = <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">User</span>::<span class="title function_ invoke__">with</span>([<span class="string">&#x27;profile&#x27;</span>]), function (Grid <span class="variable">$grid</span>) &#123;    </span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>(<span class="string">&#x27;ID&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>方式三：使用<code>Grid\Model</code>方法关联</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span> = <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">User</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Grid <span class="variable">$grid</span></span>) </span>&#123;</span><br><span class="line">	<span class="comment">// 关联 profile 表数据</span></span><br><span class="line">	<span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">with</span>([<span class="string">&#x27;profile&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>(<span class="string">&#x27;ID&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><p><code>posts</code>表和<code>comments</code>表通过<code>comments.post_id</code>字段生成一对多关联</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `posts` (</span><br><span class="line">`id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`title` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`content` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">`updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `comments` (</span><br><span class="line">`id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`post_id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`content` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">`updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br></pre></td></tr></table></figure>

<p>对应的数据模和数据仓库分别为:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">comments</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">hasMany</span>(<span class="title class_">Comment</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">belongsTo</span>(<span class="title class_">Post</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Post</span> <span class="keyword">as</span> <span class="title">PostModel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">EloquentRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">EloquentRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$eloquentClass</span> = <span class="title class_">PostModel</span>::<span class="variable language_">class</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Comment</span> <span class="keyword">as</span> <span class="title">CommentModel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">EloquentRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span> <span class="keyword">extends</span> <span class="title">EloquentRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$eloquentClass</span> = <span class="title class_">CommentModel</span>::<span class="variable language_">class</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样这里支持上述的<a href="#relation">三种方式关联数据</a>，限于篇幅这里不再重复写所有用法</p>
<p>Post表格</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Post</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关联 comment 表数据</span></span><br><span class="line"><span class="variable">$grid</span> = <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">Post</span>::<span class="title function_ invoke__">with</span>([<span class="string">&#x27;comments&#x27;</span>]), function (Grid <span class="variable">$grid</span>) &#123;</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>(<span class="string">&#x27;id&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">title</span>();</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">content</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">comments</span>(<span class="string">&#x27;评论数&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function (<span class="variable">$comments</span>) &#123;</span><br><span class="line">        <span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$comments</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;span class=&#x27;label label-warning&#x27;&gt;<span class="subst">&#123;$count&#125;</span>&lt;/span&gt;&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">created_at</span>();</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">updated_at</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Comment表格</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Comment</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关联 post 表数据</span></span><br><span class="line"><span class="variable">$grid</span> = <span class="keyword">new</span> <span class="title class_">Grid</span>(<span class="title class_">Comment</span>::<span class="title function_ invoke__">with</span>([<span class="string">&#x27;post&#x27;</span>]));</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;post.title&#x27;</span>);</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;content&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">created_at</span>()-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">updated_at</span>();</span><br></pre></td></tr></table></figure>

<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><p><code>users</code>和<code>roles</code>表通过中间表<code>role_users</code>产生多对多关系</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">190</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">60</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `users_username_unique` (`username`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `roles` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `slug` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `roles_name_unique` (`name`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `role_users` (</span><br><span class="line">  `role_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `user_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  KEY `role_users_role_id_user_id_index` (`role_id`,`user_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci</span><br></pre></td></tr></table></figure>

<p>对应的数据模和数据仓库分别为:</p>
<p>User 模型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">roles</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">belongsToMany</span>(<span class="title class_">Role</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Role 模型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">users</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">belongsToMany</span>(<span class="title class_">User</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数据仓库</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">User</span> <span class="keyword">as</span> <span class="title">UserModel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">EloquentRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">EloquentRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$eloquentClass</span> = <span class="title class_">UserModel</span>::<span class="variable language_">class</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样这里支持上述的<a href="#relation">三种方式关联数据</a>，限于篇幅这里不再重复写所有用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关联 role 表数据</span></span><br><span class="line"><span class="variable">$grid</span> = <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">User</span>::<span class="title function_ invoke__">with</span>(<span class="string">&#x27;roles&#x27;</span>), function (Grid <span class="variable">$grid</span>) &#123;</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">id</span>(<span class="string">&#x27;ID&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">username</span>();</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">name</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">roles</span>()-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">label</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">created_at</span>();</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">updated_at</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-relationship/" data-id="clpdpxfkh001pywnae7lu1n6n" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-navbar/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-tab/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-table/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-tooltip/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-js/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>