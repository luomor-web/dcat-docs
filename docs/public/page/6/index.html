<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2.x/model-grid-combination" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-combination/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.970Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="组合表头"><a href="#组合表头" class="headerlink" title="组合表头"></a>组合表头</h1><p>通过 <code>Grid::combine</code> 方法可以很方便的把任意两个以上的字段组合成一级表头</p>
<a href="http://103.39.211.179:8080/admin/reports" target="_blank">
    <img style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="100%" src="/assets/img/screenshots/grid-combination.png">
</a>

<p>示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Report</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Grid <span class="variable">$grid</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 第一个参数为一级表头字段名称，第二个字段为二级表头字段名称，二级表头字段最少设置两个</span></span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">combine</span>(<span class="string">&#x27;avgCost&#x27;</span>, [<span class="string">&#x27;avgMonthCost&#x27;</span>, <span class="string">&#x27;avgQuarterCost&#x27;</span>, <span class="string">&#x27;avgYearCost&#x27;</span>]);</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">combine</span>(<span class="string">&#x27;avgVist&#x27;</span>, [<span class="string">&#x27;avgMonthVist&#x27;</span>, <span class="string">&#x27;avgQuarterVist&#x27;</span>, <span class="string">&#x27;avgYearVist&#x27;</span>]);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置样式</span></span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">combine</span>(<span class="string">&#x27;top&#x27;</span>, [<span class="string">&#x27;topCost&#x27;</span>, <span class="string">&#x27;topVist&#x27;</span>, <span class="string">&#x27;topIncr&#x27;</span>])-&gt;<span class="title function_ invoke__">style</span>(<span class="string">&#x27;color:#1867c0&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">50</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;cost&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;avgMonthCost&#x27;</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;avgQuarterCost&#x27;</span>)-&gt;<span class="title function_ invoke__">setHeaderAttributes</span>([<span class="string">&#x27;style&#x27;</span> =&gt; <span class="string">&#x27;color:#5b69bc&#x27;</span>]);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;avgYearCost&#x27;</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;avgMonthVist&#x27;</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;avgQuarterVist&#x27;</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;avgYearVist&#x27;</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;incrs&#x27;</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;avgVists&#x27;</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;topCost&#x27;</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;topVist&#x27;</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;topIncr&#x27;</span>);</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;date&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-combination/" data-id="clpdpxfjq001eywnaf64fb7d3" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-custom-tools" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-custom-tools/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.970Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="工具栏"><a href="#工具栏" class="headerlink" title="工具栏"></a>工具栏</h1><h2 id="工具按钮"><a href="#工具按钮" class="headerlink" title="工具按钮"></a>工具按钮</h2><p>在<code>model-grid</code>的头部默认有<code>批量删除</code>和<code>刷新</code>两个操作工具，如果有更多的操作需求，系统提供了自定义工具的功能,下面的示例添加一个性别分类选择的按钮组工具。</p>
<p><a name="outline"></a></p>
<h3 id="设置工具栏按钮样式"><a href="#设置工具栏按钮样式" class="headerlink" title="设置工具栏按钮样式"></a>设置工具栏按钮样式</h3><p>工具栏按钮默认显示<code>outline</code>模式，效果如下</p>
<p>用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">toolsWithOutline</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁止</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">toolsWithOutline</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>效果<br><a href="/assets/img/screenshots/outline.png" target="_blank"><br>    <img style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="100%" src="/assets/img/screenshots/outline.png"><br></a></p>
<p>禁用<code>outline</code>后的效果</p>
<a href="/assets/img/screenshots/n-outline.png" target="_blank">
    <img style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="100%" src="/assets/img/screenshots/n-outline.png">
</a>

<p>如果你希望某个按钮不使用<code>outline</code>模式，可以在按钮的<code>class</code>属性中加上<code>disable-outline</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tools</span>(<span class="string">&#x27;&lt;a class=&quot;btn btn-primary disable-outline&quot;&gt;测试按钮&lt;/a&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="自定义工具栏按钮"><a href="#自定义工具栏按钮" class="headerlink" title="自定义工具栏按钮"></a>自定义工具栏按钮</h3><p>先定义工具类<code>app/Admin/Extensions/Tools/UserGender.php</code>继承工具类的基类<code>Dcat\Admin\Grid\Tools\AbstractTool</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Grid</span>\<span class="title class_">Tools</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Tools</span>\<span class="title">AbstractTool</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserGender</span> <span class="keyword">extends</span> <span class="title">AbstractTool</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">script</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="title function_ invoke__">request</span>()-&gt;<span class="title function_ invoke__">fullUrlWithQuery</span>([<span class="string">&#x27;gender&#x27;</span> =&gt; <span class="string">&#x27;_gender_&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">$(&#x27;input:radio.user-gender&#x27;).change(function () &#123;</span></span><br><span class="line"><span class="string">    var url = &quot;<span class="subst">$url</span>&quot;.replace(&#x27;_gender_&#x27;, $(this).val());</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Dcat.reload(url);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">JS</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title class_">Admin</span>::<span class="title function_ invoke__">script</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">script</span>());</span><br><span class="line"></span><br><span class="line">        <span class="variable">$options</span> = [</span><br><span class="line">            <span class="string">&#x27;all&#x27;</span>   =&gt; <span class="string">&#x27;All&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;m&#x27;</span>     =&gt; <span class="string">&#x27;Male&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;f&#x27;</span>     =&gt; <span class="string">&#x27;Female&#x27;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;admin.tools.gender&#x27;</span>, <span class="title function_ invoke__">compact</span>(<span class="string">&#x27;options&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视图<code>admin.tools.gender</code>文件为<code>resources/views/admin/tools/gender.blade.php</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;buttons&quot;</span>&gt;</span></span><br><span class="line">    @foreach($options as $option =&gt; $label)</span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default &#123;&#123; request()-&gt;get(&#x27;gender&#x27;, &#x27;all&#x27;) == $option ? &#x27;active&#x27; : &#x27;&#x27; &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">class</span>=<span class="string">&quot;user-gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; $option &#125;&#125;&quot;</span>&gt;</span>&#123;&#123;$label&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    @endforeach</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在<code>Grid</code>引入这个工具：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tools</span>(<span class="keyword">new</span> <span class="title class_">UserGender</span>());</span><br></pre></td></tr></table></figure>

<p>在<code>model-grid</code>定义中接收到<code>gender</code>参数后，做好数据查询就可以了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$gender</span> = <span class="title function_ invoke__">request</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;gender&#x27;</span>), [<span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;f&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;gender&#x27;</span>, <span class="variable">$gender</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以参考上面的方式来添加自己的工具。</p>
<h3 id="进阶用法"><a href="#进阶用法" class="headerlink" title="进阶用法"></a>进阶用法</h3><p>如果你的工具按钮需要与后端API进行交互，则可以参考以下方式定义：</p>
<blockquote>
<p>{tip} <code>AbstractTool</code>类是属于<code>Dcat\Admin\Actions\Action</code>的子类，本质也是动作类的一种，更详细用法请参考<a href="action.md">动作类基本使用</a>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Grid</span>\<span class="title class_">Tools</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Tools</span>\<span class="title">AbstractTool</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendMessage</span> <span class="keyword">extends</span> <span class="title">AbstractTool</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按钮样式定义，默认 btn btn-white waves-effect</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$style</span> = <span class="string">&#x27;btn btn-white waves-effect&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按钮文本</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string|void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">title</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;发送提醒&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  确认弹窗，如果不需要则返回空即可</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array|string|void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">confirm</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 只显示标题</span></span><br><span class="line"><span class="comment">//        return &#x27;您确定要发送新的提醒消息吗？&#x27;;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 显示标题和内容</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;您确定要发送新的提醒消息吗？&#x27;</span>, <span class="string">&#x27;确认信息内容，如没有可以留空&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理请求</span></span><br><span class="line"><span class="comment">     * 如果你的类中包含了此方法，则点击按钮后会自动向后端发起ajax请求，并且会通过此方法处理请求逻辑</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 你的代码逻辑</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;发送成功&#x27;</span>)-&gt;<span class="title function_ invoke__">refresh</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置请求参数</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array|void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parameters</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            </span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Tools</span>\<span class="title">SendMessage</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tools</span>(<span class="keyword">new</span> <span class="title class_">SendMessage</span>());</span><br></pre></td></tr></table></figure>


<h3 id="添加工具类"><a href="#添加工具类" class="headerlink" title="添加工具类"></a>添加工具类</h3><p><code>Grid::tools</code> 方法允许传入 <code>string</code>，<code>array</code>, <code>AbstractTool</code> 和 <code>闭包</code>等类型参数，下面是演示。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传入字符串</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tools</span>(<span class="string">&#x27;&lt;a class=&quot;btn btn-sm btn-default&quot;&gt;工具按钮测试&lt;/a&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入数组</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tools</span>([</span><br><span class="line">	<span class="string">&#x27;&lt;a class=&quot;btn btn-sm btn-default&quot;&gt;工具按钮测试&lt;/a&gt;&#x27;</span>,</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">UserGender</span>(),</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入闭包</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tools</span>(function (Grid\Tools <span class="variable">$tools</span>) &#123;</span><br><span class="line">	<span class="variable">$tools</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="keyword">new</span> <span class="title class_">UserGender</span>());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a name="batch"></a></p>
<h2 id="批量操作"><a href="#批量操作" class="headerlink" title="批量操作"></a>批量操作</h2><h3 id="禁用批量删除"><a href="#禁用批量删除" class="headerlink" title="禁用批量删除"></a>禁用批量删除</h3><p>系统默认开启了批量删除操作的功能，如果要禁用批量删除操作：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tools</span>(function (<span class="variable">$tools</span>) &#123;</span><br><span class="line">    <span class="variable">$tools</span>-&gt;<span class="title function_ invoke__">batch</span>(function (<span class="variable">$batch</span>) &#123;</span><br><span class="line">        <span class="variable">$batch</span>-&gt;<span class="title function_ invoke__">disableDelete</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以这样</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableBatchDelete</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">batchActions</span>(function (Grid\Tools\BatchActions <span class="variable">$batch</span>) &#123;</span><br><span class="line">	<span class="variable">$batch</span>-&gt;<span class="title function_ invoke__">disableDelete</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="自定义批量操作"><a href="#自定义批量操作" class="headerlink" title="自定义批量操作"></a>自定义批量操作</h3><p>下面通过扩展一个对文章批量发布的功能来演示自定义批量操作的功能：</p>
<p>先定义操作类<code>app/Admin/Extensions/Tools/ReleasePost.php</code>，继承<code>Dcat\Admin\Grid\BatchAction</code>：</p>
<blockquote>
<p>{tip} <code>BatchAction</code>类是属于<code>Dcat\Admin\Actions\Action</code>的子类，本质也是动作类的一种，更详细用法请参考<a href="action.md">动作类基本使用</a>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>\<span class="title class_">Tools</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">BatchAction</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReleasePost</span> <span class="keyword">extends</span> <span class="title">BatchAction</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$action</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意action的构造方法参数一定要给默认值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$title</span> = <span class="literal">null</span>, <span class="variable">$action</span> = <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;title = <span class="variable">$title</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;action = <span class="variable">$action</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 确认弹窗信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">confirm</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;您确定要发布已选中的文章吗？&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理请求</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取选中的文章ID数组</span></span><br><span class="line">        <span class="variable">$keys</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKey</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取请求参数</span></span><br><span class="line">        <span class="variable">$action</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;action&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> (<span class="title class_">Post</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$keys</span>) <span class="keyword">as</span> <span class="variable">$post</span>) &#123;</span><br><span class="line">            <span class="variable">$post</span>-&gt;released = <span class="variable">$action</span>;</span><br><span class="line">            <span class="variable">$post</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$message</span> = <span class="variable">$action</span> ? <span class="string">&#x27;文章发布成功&#x27;</span> : <span class="string">&#x27;文章下线成功&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="variable">$message</span>)-&gt;<span class="title function_ invoke__">refresh</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置请求参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parameters</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="string">&#x27;action&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;action,</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看代码的实现，通过click操作发送一个post请求，把选中的行数据<code>id</code>通过数组的形式传给后端接口，后端接口拿到<code>id</code>列表和要修改的状态来更新数据，然后前端刷新页面(pjax reload)，并弹出<code>toastr</code>提示操作成功。</p>
<p>在<code>model-grid</code>中加入这个批量操作功能：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">batchActions</span>([</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">ReleasePost</span>(<span class="string">&#x27;发布文章&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">ReleasePost</span>(<span class="string">&#x27;文章下线&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">]);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以这么写</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">batchActions</span>(function (<span class="variable">$batch</span>) &#123;</span><br><span class="line">    <span class="variable">$batch</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="keyword">new</span> <span class="title class_">ReleasePost</span>(<span class="string">&#x27;发布文章&#x27;</span>, <span class="number">1</span>));</span><br><span class="line">    <span class="variable">$batch</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="keyword">new</span> <span class="title class_">ReleasePost</span>(<span class="string">&#x27;文章下线&#x27;</span>, <span class="number">0</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tools</span>(function (<span class="variable">$tools</span>) &#123;</span><br><span class="line">    <span class="variable">$tools</span>-&gt;<span class="title function_ invoke__">batch</span>(function (<span class="variable">$batch</span>) &#123;</span><br><span class="line">    	<span class="variable">$batch</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="keyword">new</span> <span class="title class_">ReleasePost</span>(<span class="string">&#x27;发布文章&#x27;</span>, <span class="number">1</span>));</span><br><span class="line">    	<span class="variable">$batch</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="keyword">new</span> <span class="title class_">ReleasePost</span>(<span class="string">&#x27;文章下线&#x27;</span>, <span class="number">0</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="获取复选框选中的ID数组"><a href="#获取复选框选中的ID数组" class="headerlink" title="获取复选框选中的ID数组"></a>获取复选框选中的ID数组</h4><p>通过<code>getSelectedKeysScript</code>方法可以获取到复选框选中的ID数组，用法如下</p>
<blockquote>
<p>{tip} <code>getSelectedKeysScript</code>方法返回的是<code>js</code>代码，只能在<code>js</code>代码中使用。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>\<span class="title class_">Tools</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">BatchAction</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReleasePost</span> <span class="keyword">extends</span> <span class="title">BatchAction</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$action</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$title</span>, <span class="variable">$action</span> = <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;title = <span class="variable">$title</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;action = <span class="variable">$action</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 确认弹窗信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">confirm</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;您确定要发布已选中的文章吗？&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理请求</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置动作发起请求前的回调函数，返回false可以中断请求. </span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionScript</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$warning</span> = <span class="title function_ invoke__">__</span>(<span class="string">&#x27;No data selected!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">function (data, target, action) &#123; </span></span><br><span class="line"><span class="string">    var key = <span class="subst">&#123;$this-&gt;getSelectedKeysScript()&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    if (key.length === 0) &#123;</span></span><br><span class="line"><span class="string">        Dcat.warning(&#x27;<span class="subst">&#123;$warning&#125;</span>&#x27;);</span></span><br><span class="line"><span class="string">        return false;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 设置主键为复选框选中的行ID数组</span></span><br><span class="line"><span class="string">    action.options.key = key;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">JS</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="表单弹窗"><a href="#表单弹窗" class="headerlink" title="表单弹窗"></a>表单弹窗</h3><p>请参考文档<a href="widgets-form.md#modal">工具表单 - 弹窗</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-custom-tools/" data-id="clpdpxfjr001fywna75bsapj4" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-column-display" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-column-display/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.969Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="列的显示和扩展"><a href="#列的显示和扩展" class="headerlink" title="列的显示和扩展"></a>列的显示和扩展</h1><p>数据表格内置了很多对于列的操作方法，可以通过这些方法很灵活的操作列数据。</p>
<h2 id="根据条件显示不同的组件"><a href="#根据条件显示不同的组件" class="headerlink" title="根据条件显示不同的组件"></a>根据条件显示不同的组件</h2><p>有些情况我们需要根据某个条件去判断是否使用列的某个显示功能：</p>
<blockquote>
<p>{tip} 需要注意的是，<code>Grid\Column::if</code>只对列的显示相关功能有效，其他方法如表头的相关操作都不能使用此方法！</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;config&#x27;</span>)</span><br><span class="line">    -&gt;<span class="keyword">if</span>(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$column</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 获取当前行其他字段值</span></span><br><span class="line">        <span class="variable">$username</span> = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">        </span><br><span class="line">    	<span class="comment">// $column-&gt;getValue() 是当前字段的值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$column</span>-&gt;<span class="title function_ invoke__">getValue</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">display</span>(<span class="variable">$view</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">copyable</span>()</span><br><span class="line">    -&gt;<span class="keyword">else</span>()</span><br><span class="line">    -&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>上面写法等同于</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;config&#x27;</span>)</span><br><span class="line">    -&gt;<span class="keyword">if</span>(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$column</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$column</span>-&gt;<span class="title function_ invoke__">getValue</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">then</span>(function (Grid\Column <span class="variable">$column</span>) &#123;</span><br><span class="line">        <span class="variable">$column</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="variable">$view</span>)-&gt;<span class="title function_ invoke__">copyable</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    -&gt;<span class="keyword">else</span>(<span class="function"><span class="keyword">function</span> (<span class="params">Grid\Column <span class="variable">$column</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$column</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>支持多个<code>if</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;config&#x27;</span>)</span><br><span class="line">    -&gt;<span class="keyword">if</span>(...)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">then</span>(...)</span><br><span class="line">    -&gt;<span class="keyword">else</span>(...)</span><br><span class="line">    </span><br><span class="line">    -&gt;<span class="keyword">if</span>(...)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">then</span>(...)</span><br><span class="line">    -&gt;<span class="keyword">else</span>(...);</span><br></pre></td></tr></table></figure>

<p>终结条件判断<code>end</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;status&#x27;</span>)</span><br><span class="line">    -&gt;<span class="keyword">if</span>(...) <span class="comment">// 条件1</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">display</span>(...)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">display</span>(...)</span><br><span class="line">    </span><br><span class="line">    -&gt;<span class="keyword">if</span>(...) <span class="comment">// 条件2</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">display</span>(...)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">display</span>(...)</span><br><span class="line">    </span><br><span class="line">    -&gt;<span class="title function_ invoke__">end</span>() <span class="comment">// 终结前面的条件判断</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">display</span>(...); <span class="comment">// 所有条件都能生效</span></span><br></pre></td></tr></table></figure>


<h2 id="列显示"><a href="#列显示" class="headerlink" title="列显示"></a>列显示</h2><p><code>model-grid</code>内置了若干方法来帮助你扩展列功能</p>
<h3 id="display"><a href="#display" class="headerlink" title="display"></a>display</h3><p><code>Dcat\Admin\Grid\Column</code>对象内置了<code>display()</code>方法来通过传入的回调函数来处理当前列的值，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function (<span class="variable">$title</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;span style=&#x27;color:blue&#x27;&gt;<span class="subst">$title</span>&lt;/span&gt;&quot;</span>;</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在传入的匿名函数中可以通过任何方式对数据进行处理，另外匿名函数绑定了当前列的数据作为父对象，可以在函数中调用当前行的数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;first_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;last_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不存在的`full_name`字段</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;full_name&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;first_name . <span class="string">&#x27; &#x27;</span> . <span class="variable language_">$this</span>-&gt;last_name;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置列的HTML属性"><a href="#设置列的HTML属性" class="headerlink" title="设置列的HTML属性"></a>设置列的HTML属性</h3><p>设列的<code>html</code>属性</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">setAttributes</span>([<span class="string">&#x27;style&#x27;</span> =&gt; <span class="string">&#x27;font-size:14px&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="列视图"><a href="#列视图" class="headerlink" title="列视图"></a>列视图</h3><p><code>view</code>方法可以引入一个视图文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">view</span>(<span class="string">&#x27;admin.fields.content&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>默认会传入视图的三个变量：</p>
<ul>
<li><code>$model</code> 当前行数据</li>
<li><code>$name</code> 字段名称</li>
<li><code>$value</code> 为当前列的值</li>
</ul>
<p>模板代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;label&gt;名称：&#123;&#123; $name &#125;&#125;&lt;/label&gt;</span><br><span class="line">&lt;label&gt;值：&#123;&#123; $value &#125;&#125;&lt;/label&gt;</span><br><span class="line">&lt;label&gt;其他字段：&#123;&#123; $model-&gt;title &#125;&#125;&lt;/label&gt;</span><br></pre></td></tr></table></figure>



<h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;picture&#x27;</span>)-&gt;<span class="title function_ invoke__">image</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置服务器和宽高</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;picture&#x27;</span>)-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;http://xxx.com&#x27;</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示多图</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;pictures&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function (<span class="variable">$pictures</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_decode</span>(<span class="variable">$pictures</span>, <span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;http://xxx.com&#x27;</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<h3 id="显示label标签"><a href="#显示label标签" class="headerlink" title="显示label标签"></a>显示label标签</h3><p>支持<code>Dcat\Admin\Color</code>类中内置的所有颜色</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">label</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置颜色，直接传别名</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">label</span>(<span class="string">&#x27;danger&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以这样使用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">label</span>(<span class="title class_">Admin</span>::<span class="title function_ invoke__">color</span>()-&gt;<span class="title function_ invoke__">danger</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以直接传颜色代码</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">label</span>(<span class="string">&#x27;#222&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>给不同的值设置不同的颜色</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;state&#x27;</span>)-&gt;<span class="title function_ invoke__">using</span>([<span class="number">1</span> =&gt; <span class="string">&#x27;未处理&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;已处理&#x27;</span>, ...])-&gt;<span class="title function_ invoke__">label</span>([</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span> =&gt; <span class="string">&#x27;primary&#x27;</span>, // 设置默认颜色，不设置则默认为 <span class="keyword">default</span></span><br><span class="line">    </span><br><span class="line">	<span class="number">1</span> =&gt; <span class="string">&#x27;primary&#x27;</span>,</span><br><span class="line">	<span class="number">2</span> =&gt; <span class="string">&#x27;danger&#x27;</span>,</span><br><span class="line">	<span class="number">3</span> =&gt; <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">	<span class="number">4</span> =&gt; <span class="title class_">Admin</span>::<span class="title function_ invoke__">color</span>()-&gt;<span class="title function_ invoke__">info</span>(),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="显示badge标签"><a href="#显示badge标签" class="headerlink" title="显示badge标签"></a>显示badge标签</h3><p>支持<code>Dcat\Admin\Color</code>类中内置的所有颜色</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">badge</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置颜色，直接传别名</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">badge</span>(<span class="string">&#x27;danger&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以这样使用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">badge</span>(<span class="title class_">Admin</span>::<span class="title function_ invoke__">color</span>()-&gt;<span class="title function_ invoke__">danger</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以直接传颜色代码</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">badge</span>(<span class="string">&#x27;#222&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>给不同的值设置不同的颜色</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;state-&gt;<span class="title function_ invoke__">using</span>([<span class="number">1</span> =&gt; <span class="string">&#x27;未处理&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;已处理&#x27;</span>, ...])-&gt;<span class="title function_ invoke__">badge</span>([</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span> =&gt; <span class="string">&#x27;primary&#x27;</span>, // 设置默认颜色，不设置则默认为 <span class="keyword">default</span>	</span><br><span class="line">    </span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&#x27;primary&#x27;</span>,</span><br><span class="line">	<span class="number">2</span> =&gt; <span class="string">&#x27;danger&#x27;</span>,</span><br><span class="line">	<span class="number">3</span> =&gt; <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">	<span class="number">4</span> =&gt; <span class="title class_">Admin</span>::<span class="title function_ invoke__">color</span>()-&gt;<span class="title function_ invoke__">info</span>(),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p><a name="bool"></a></p>
<h3 id="布尔值显示-bool"><a href="#布尔值显示-bool" class="headerlink" title="布尔值显示 (bool)"></a>布尔值显示 (bool)</h3><p>将这一列转为<code>bool</code>值之后显示为<code>✓</code>和<code>✗</code>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;approved&#x27;</span>)-&gt;<span class="keyword">bool</span>();</span><br></pre></td></tr></table></figure>

<p>你也可以按照这一列的值指定显示，比如字段的值为<code>Y</code>和<code>N</code>表示<code>true</code>和<code>false</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;approved&#x27;</span>)-&gt;<span class="keyword">bool</span>([<span class="string">&#x27;Y&#x27;</span> =&gt; <span class="literal">true</span>, <span class="string">&#x27;N&#x27;</span> =&gt; <span class="literal">false</span>]);</span><br></pre></td></tr></table></figure>

<p>效果<br><img src="https://cdn.learnku.com/uploads/images/202007/12/38389/U0OSrJwzyt.png!large"></p>
<h3 id="圆点前缀-dot"><a href="#圆点前缀-dot" class="headerlink" title="圆点前缀 (dot)"></a>圆点前缀 (dot)</h3><p>通过<code>dot</code>方法可以在列文字前面加上一个带颜色的圆点</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;state&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">using</span>([<span class="number">1</span> =&gt; <span class="string">&#x27;未处理&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;已处理&#x27;</span>, ...])</span><br><span class="line">	-&gt;<span class="title function_ invoke__">dot</span>(</span><br><span class="line">		[</span><br><span class="line">			<span class="number">1</span> =&gt; <span class="string">&#x27;primary&#x27;</span>,</span><br><span class="line">			<span class="number">2</span> =&gt; <span class="string">&#x27;danger&#x27;</span>,</span><br><span class="line">			<span class="number">3</span> =&gt; <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">			<span class="number">4</span> =&gt; <span class="title class_">Admin</span>::<span class="title function_ invoke__">color</span>()-&gt;<span class="title function_ invoke__">info</span>(),</span><br><span class="line">		], </span><br><span class="line">	    <span class="string">&#x27;primary&#x27;</span> // 第二个参数为默认值</span><br><span class="line">	);</span><br></pre></td></tr></table></figure>

<p>效果<br><img src="https://cdn.learnku.com/uploads/images/202004/30/38389/ByUqo6bZc8.png!large"></p>
<p><a name="expand"></a></p>
<h3 id="列展开-expand"><a href="#列展开-expand" class="headerlink" title="列展开 (expand)"></a>列展开 (expand)</h3><p><code>expand</code>方法可以把内容隐藏，点击按钮的时候显示在表格下一行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;详情&#x27;</span>) <span class="comment">// 设置按钮名称</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">expand</span>(function () &#123;</span><br><span class="line">        <span class="comment">// 返回显示的详情</span></span><br><span class="line">        <span class="comment">// 这里返回 content 字段内容，并用 Card 包裹起来</span></span><br><span class="line">        <span class="variable">$card</span> = <span class="keyword">new</span> <span class="title class_">Card</span>(<span class="literal">null</span>, <span class="variable language_">$this</span>-&gt;content);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;div style=&#x27;padding:10px 10px 0&#x27;&gt;<span class="subst">$card</span>&lt;/div&gt;&quot;</span>;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>也可以通过以下方式设置按钮</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">expand</span>(function (Grid\Displayers\Expand <span class="variable">$expand</span>) &#123;</span><br><span class="line">    <span class="comment">// 设置按钮名称</span></span><br><span class="line">    <span class="variable">$expand</span>-&gt;<span class="title function_ invoke__">button</span>(<span class="string">&#x27;详情&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回显示的详情</span></span><br><span class="line">    <span class="comment">// 这里返回 content 字段内容，并用 Card 包裹起来</span></span><br><span class="line">    <span class="variable">$card</span> = <span class="keyword">new</span> <span class="title class_">Card</span>(<span class="literal">null</span>, <span class="variable language_">$this</span>-&gt;content);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;div style=&#x27;padding:10px 10px 0&#x27;&gt;<span class="subst">$card</span>&lt;/div&gt;&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h4 id="异步加载"><a href="#异步加载" class="headerlink" title="异步加载"></a>异步加载</h4><blockquote>
<p>{tip} 更多用法请参考文档<a href="lazy.md">异步加载</a></p>
</blockquote>
<p>定义渲染类，继承<code>Dcat\Admin\Support\LazyRenderable</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Post</span> <span class="keyword">as</span> <span class="title">PostModel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Table</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取ID</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取其他自定义参数</span></span><br><span class="line">        <span class="variable">$type</span> = <span class="variable language_">$this</span>-&gt;post_type;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="title class_">PostModel</span>::<span class="title function_ invoke__">where</span>(<span class="string">&#x27;user_id&#x27;</span>, <span class="variable">$id</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;type&#x27;</span>, <span class="variable">$type</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">get</span>([<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>])</span><br><span class="line">            -&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$titles</span> = [</span><br><span class="line">            <span class="string">&#x27;User ID&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Title&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Body&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Created At&#x27;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Table</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$titles</span>, <span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;post-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;View&#x27;</span>)-&gt;<span class="title function_ invoke__">expand</span>(<span class="title class_">Post</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;post_type&#x27;</span> =&gt; <span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以在闭包内返回异步加载类的实例</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;post-&gt;<span class="title function_ invoke__">expand</span>(function () &#123;</span><br><span class="line">    <span class="comment">// 允许在比包内返回异步加载类的实例</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Post</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;title&#x27;</span> =&gt; <span class="variable">$this</span>-&gt;title]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src="https://cdn.learnku.com/uploads/images/202006/14/38389/KMHagem4OZ.gif!large"></p>
<h4 id="异步加载工具表单"><a href="#异步加载工具表单" class="headerlink" title="异步加载工具表单"></a>异步加载工具表单</h4><p>定义<a href="widgets-form.md">工具表单</a>类如下</p>
<blockquote>
<p>{tip} 更多用法请参考<a href="lazy.md">异步加载</a></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Forms</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Contracts</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">LazyWidget</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span> <span class="keyword">extends</span> <span class="title">Form</span> <span class="keyword">implements</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">LazyWidget</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$input</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 接收外部传递参数</span></span><br><span class="line">		<span class="variable">$type</span> = <span class="variable language_">$this</span>-&gt;payload[<span class="string">&#x27;type&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;保存成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">form</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 接收外部传递参数</span></span><br><span class="line">        <span class="variable">$type</span> = <span class="variable language_">$this</span>-&gt;payload[<span class="string">&#x27;type&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.name&#x27;</span>))-&gt;<span class="title function_ invoke__">required</span>()-&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;用户昵称&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;avatar&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.avatar&#x27;</span>))-&gt;<span class="title function_ invoke__">autoUpload</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;old_password&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.old_password&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.password&#x27;</span>))</span><br><span class="line">            -&gt;<span class="title function_ invoke__">minLength</span>(<span class="number">5</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">maxLength</span>(<span class="number">20</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$v</span> == <span class="variable language_">$this</span>-&gt;password) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$v</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;请输入5-20个字符&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password_confirmation&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.password_confirmation&#x27;</span>))</span><br><span class="line">            -&gt;<span class="title function_ invoke__">same</span>(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;请输入确认密码&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;user-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;View&#x27;</span>)-&gt;<span class="title function_ invoke__">expand</span>(<span class="title class_">UserProfile</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;type&#x27;</span> =&gt; <span class="number">1</span>]));</span><br></pre></td></tr></table></figure>


<p><a name="modal"></a></p>
<h3 id="弹出模态框-modal"><a href="#弹出模态框-modal" class="headerlink" title="弹出模态框 (modal)"></a>弹出模态框 (modal)</h3><p><code>modal</code>方法可以把内容隐藏，点击按钮的时候显示在表格下一行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;查看&#x27;</span>) <span class="comment">// 设置按钮名称</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">modal</span>(function (<span class="variable">$modal</span>) &#123;</span><br><span class="line">        <span class="comment">// 设置弹窗标题</span></span><br><span class="line">        <span class="variable">$modal</span>-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;标题 &#x27;</span>.<span class="variable">$this</span>-&gt;username);</span><br><span class="line">        </span><br><span class="line">       <span class="comment">// 自定义图标</span></span><br><span class="line">       <span class="variable">$modal</span>-&gt;<span class="title function_ invoke__">icon</span>(<span class="string">&#x27;feather icon-x&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="variable">$card</span> = <span class="keyword">new</span> <span class="title class_">Card</span>(<span class="literal">null</span>, <span class="variable language_">$this</span>-&gt;content);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;div style=&#x27;padding:10px 10px 0&#x27;&gt;<span class="subst">$card</span>&lt;/div&gt;&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以通过这种方式设置弹窗标题</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;查看&#x27;</span>) <span class="comment">// 设置按钮名称</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">modal</span>(<span class="string">&#x27;弹窗标题&#x27;</span>, ...);</span><br></pre></td></tr></table></figure>


<h4 id="异步加载-1"><a href="#异步加载-1" class="headerlink" title="异步加载"></a>异步加载</h4><blockquote>
<p>{tip}  关于异步加载的更具体用法，请参考文档<a href="lazy.md">异步加载</a>       </p>
</blockquote>
<p>定义渲染类，继承<code>Dcat\Admin\Support\LazyRenderable</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Post</span> <span class="keyword">as</span> <span class="title">PostModel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Table</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取ID</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取其他自定义参数</span></span><br><span class="line">        <span class="variable">$type</span> = <span class="variable language_">$this</span>-&gt;post_type;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="title class_">PostModel</span>::<span class="title function_ invoke__">where</span>(<span class="string">&#x27;user_id&#x27;</span>, <span class="variable">$id</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;type&#x27;</span>, <span class="variable">$type</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">get</span>([<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>])</span><br><span class="line">            -&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$titles</span> = [</span><br><span class="line">            <span class="string">&#x27;User ID&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Title&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Body&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Created At&#x27;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Table</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$titles</span>, <span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;post-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;View&#x27;</span>)-&gt;<span class="title function_ invoke__">modal</span>(<span class="string">&#x27;Post&#x27;</span>, <span class="title class_">Post</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;post_type&#x27;</span> =&gt; <span class="number">2</span>]));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以在闭包内返回异步加载类的实例</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;post-&gt;<span class="title function_ invoke__">modal</span>(function (<span class="variable">$modal</span>) &#123;</span><br><span class="line">    <span class="variable">$modal</span>-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;自定义弹窗标题&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 允许在比包内返回异步加载类的实例</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Post</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;title&#x27;</span> =&gt; <span class="variable">$this</span>-&gt;title]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果<br><img src="https://cdn.learnku.com/uploads/images/202006/14/38389/DvvyZUTXpG.gif!large"></p>
<h4 id="异步加载工具表单-1"><a href="#异步加载工具表单-1" class="headerlink" title="异步加载工具表单"></a>异步加载工具表单</h4><p>定义<a href="widgets-form.md">工具表单</a>类如下</p>
<blockquote>
<p>{tip} 更多用法请参考<a href="lazy.md">异步加载</a></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Forms</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Contracts</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">LazyWidget</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span> <span class="keyword">extends</span> <span class="title">Form</span> <span class="keyword">implements</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">LazyWidget</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$input</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 接收外部传递参数</span></span><br><span class="line">		<span class="variable">$type</span> = <span class="variable language_">$this</span>-&gt;payload[<span class="string">&#x27;type&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;保存成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">form</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 接收外部传递参数</span></span><br><span class="line">        <span class="variable">$type</span> = <span class="variable language_">$this</span>-&gt;payload[<span class="string">&#x27;type&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.name&#x27;</span>))-&gt;<span class="title function_ invoke__">required</span>()-&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;用户昵称&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;avatar&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.avatar&#x27;</span>))-&gt;<span class="title function_ invoke__">autoUpload</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;old_password&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.old_password&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.password&#x27;</span>))</span><br><span class="line">            -&gt;<span class="title function_ invoke__">minLength</span>(<span class="number">5</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">maxLength</span>(<span class="number">20</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$v</span> == <span class="variable language_">$this</span>-&gt;password) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$v</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;请输入5-20个字符&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password_confirmation&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.password_confirmation&#x27;</span>))</span><br><span class="line">            -&gt;<span class="title function_ invoke__">same</span>(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;请输入确认密码&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;user-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;View&#x27;</span>)-&gt;<span class="title function_ invoke__">modal</span>(<span class="title class_">UserProfile</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;type&#x27;</span> =&gt; <span class="number">1</span>]));</span><br></pre></td></tr></table></figure>


<h3 id="进度条-progressBar"><a href="#进度条-progressBar" class="headerlink" title="进度条 (progressBar)"></a>进度条 (progressBar)</h3><p><code>progressBar</code>进度条</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;rate-&gt;<span class="title function_ invoke__">progressBar</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置颜色，默认`primary`,可选`danger`、`warning`、`info`、`primary`、`success`</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;rate-&gt;<span class="title function_ invoke__">progressBar</span>(<span class="string">&#x27;success&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置进度条尺寸和最大值</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;rate-&gt;<span class="title function_ invoke__">progressBar</span>(<span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;sm&#x27;</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<h3 id="showTreeInDialog"><a href="#showTreeInDialog" class="headerlink" title="showTreeInDialog"></a>showTreeInDialog</h3><p><code>showTreeInDialog</code>方法可以把一个带有层级关系的数组呈现为树形弹窗，比如权限就可以用此方法展示</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查出所有的权限数据</span></span><br><span class="line"><span class="variable">$nodes</span> = (<span class="keyword">new</span> <span class="variable">$permissionModel</span>)-&gt;<span class="title function_ invoke__">allNodes</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入二维数组（未分层级）</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;permissions-&gt;<span class="title function_ invoke__">showTreeInDialog</span>(<span class="variable">$nodes</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以传入闭包</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;permissions-&gt;<span class="title function_ invoke__">showTreeInDialog</span>(function (Grid\Displayers\DialogTree <span class="variable">$tree</span>) <span class="keyword">use</span> (&amp;$<span class="title">nodes</span>, $<span class="title">roleModel</span>) &#123;</span><br><span class="line">    // 设置所有节点</span><br><span class="line">    $<span class="title">tree</span>-&gt;<span class="title">nodes</span>($<span class="title">nodes</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置节点数据字段名称，默认&quot;id&quot;，&quot;name&quot;，&quot;parent_id&quot;</span></span><br><span class="line">    <span class="variable">$tree</span>-&gt;<span class="title function_ invoke__">setIdColumn</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="variable">$tree</span>-&gt;<span class="title function_ invoke__">setTitleColumn</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">    <span class="variable">$tree</span>-&gt;<span class="title function_ invoke__">setParentColumn</span>(<span class="string">&#x27;parent_id&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $this-&gt;roles 可以获取当前行的字段值</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="title function_ invoke__">array_column</span>(<span class="variable">$this</span>-&gt;roles, <span class="string">&#x27;slug&#x27;</span>) <span class="keyword">as</span> <span class="variable">$slug</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$roleModel</span>::<span class="title function_ invoke__">isAdministrator</span>(<span class="variable">$slug</span>)) &#123;</span><br><span class="line">            <span class="comment">// 选中所有节点</span></span><br><span class="line">            <span class="variable">$tree</span>-&gt;<span class="title function_ invoke__">checkAll</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.learnku.com/uploads/images/202004/26/38389/s1htW08Iko.png!large"></p>
<h3 id="内容映射-using"><a href="#内容映射-using" class="headerlink" title="内容映射 (using)"></a>内容映射 (using)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;status-&gt;<span class="title function_ invoke__">using</span>([<span class="number">0</span> =&gt; <span class="string">&#x27;未激活&#x27;</span>, <span class="number">1</span> =&gt; <span class="string">&#x27;正常&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个参数为默认值</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;gender-&gt;<span class="title function_ invoke__">using</span>([<span class="number">1</span> =&gt; <span class="string">&#x27;男&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;女&#x27;</span>], <span class="string">&#x27;未知&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="字符串分割为数组"><a href="#字符串分割为数组" class="headerlink" title="字符串分割为数组"></a>字符串分割为数组</h3><p><code>explode</code>方法可以把字符串分割为数组。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;tag-&gt;<span class="title function_ invoke__">explode</span>()-&gt;<span class="title function_ invoke__">label</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以指定分隔符，默认&quot;,&quot;</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;tag-&gt;<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;|&#x27;</span>)-&gt;<span class="title function_ invoke__">label</span>();</span><br></pre></td></tr></table></figure>

<h3 id="prepend"><a href="#prepend" class="headerlink" title="prepend"></a>prepend</h3><p><code>prepend</code> 方法用于给 <code>string</code> 或 <code>array</code> 类型的值前面插入内容。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当字段值是一个字符串</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;email-&gt;<span class="title function_ invoke__">prepend</span>(<span class="string">&#x27;mailto:&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当字段值是一个数组</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;arr-&gt;<span class="title function_ invoke__">prepend</span>(<span class="string">&#x27;first item&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>prepend</code>方法允许传入闭包参数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;email-&gt;<span class="title function_ invoke__">prepend</span>(function (<span class="variable">$value</span>, <span class="variable">$original</span>) &#123;</span><br><span class="line">    <span class="comment">// $value 是当前字段值</span></span><br><span class="line">    <span class="comment">// $original 是当前字段从数据库中查询出来的原始值</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取其他字段值</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;[<span class="subst">&#123;$username&#125;</span>]&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="append"><a href="#append" class="headerlink" title="append"></a>append</h3><p><code>append</code> 方法用于给 <code>string</code> 或 <code>array</code> 类型的值后面插入内容。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当字段值是一个字符串</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;email-&gt;<span class="title function_ invoke__">append</span>(<span class="string">&#x27;@gmail.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当字段值是一个数组</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;arr-&gt;<span class="title function_ invoke__">append</span>(<span class="string">&#x27;last item&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>append</code>方法允许传入闭包参数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;email-&gt;<span class="title function_ invoke__">append</span>(function (<span class="variable">$value</span>, <span class="variable">$original</span>) &#123;</span><br><span class="line">    <span class="comment">// $value 是当前字段值</span></span><br><span class="line">    <span class="comment">// $original 是当前字段从数据库中查询出来的原始值</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取其他字段值</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;[<span class="subst">&#123;$username&#125;</span>]&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="字符串或数组截取-limit"><a href="#字符串或数组截取-limit" class="headerlink" title="字符串或数组截取 (limit)"></a>字符串或数组截取 (limit)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最多显示50个字符</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">50</span>, <span class="string">&#x27;...&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果字段值是数组也支持</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;tags-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h3 id="列二维码-qrcode"><a href="#列二维码-qrcode" class="headerlink" title="列二维码 (qrcode)"></a>列二维码 (qrcode)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;website-&gt;<span class="title function_ invoke__">qrcode</span>(function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;url;</span><br><span class="line">&#125;, <span class="number">200</span>, <span class="number">200</span>);</span><br></pre></td></tr></table></figure>

<h3 id="可复制-copyable"><a href="#可复制-copyable" class="headerlink" title="可复制 (copyable)"></a>可复制 (copyable)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;website-&gt;<span class="title function_ invoke__">copyable</span>();</span><br></pre></td></tr></table></figure>


<h3 id="可排序-orderable"><a href="#可排序-orderable" class="headerlink" title="可排序 (orderable)"></a>可排序 (orderable)</h3><p>通过<code>Column::orderable</code>可以开启字段可排序功能，此功能需要在你的模型类中<code>use ModelTree</code>或<code>use SortableTrait</code>，并且需要继承<code>Spatie\EloquentSortable\Sortable</code>接口。</p>
<h4 id="SortableTrait"><a href="#SortableTrait" class="headerlink" title="SortableTrait"></a>SortableTrait</h4><p>如果你的数据不是层级结构数据，可以直接使用<code>use SortableTrait</code>，更多用法可参考<a target="_blank" rel="noopener" href="https://github.com/spatie/eloquent-sortable">eloquent-sortable</a>。</p>
<p>模型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Spatie</span>\<span class="title">EloquentSortable</span>\<span class="title">Sortable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Spatie</span>\<span class="title">EloquentSortable</span>\<span class="title">SortableTrait</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModel</span> <span class="keyword">extends</span> <span class="title">Model</span> <span class="keyword">implements</span> <span class="title">Sortable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">SortableTrait</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$sortable</span> = [</span><br><span class="line">        <span class="comment">// 设置排序字段名称</span></span><br><span class="line">        <span class="string">&#x27;order_column_name&#x27;</span> =&gt; <span class="string">&#x27;order&#x27;</span>,</span><br><span class="line">        <span class="comment">// 是否在创建时自动排序，此参数建议设置为true</span></span><br><span class="line">        <span class="string">&#x27;sort_when_creating&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">orderBy</span>(<span class="string">&#x27;order&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;order-&gt;<span class="title function_ invoke__">orderable</span>();</span><br></pre></td></tr></table></figure>

<h4 id="ModelTree"><a href="#ModelTree" class="headerlink" title="ModelTree"></a>ModelTree</h4><p>如果你的数据是层级结构数据，可以直接使用<code>use Model</code>，下面以权限模型为例来演示用法</p>
<blockquote>
<p>{tip} <code>ModelTree</code>实际上也是继承了<a target="_blank" rel="noopener" href="https://github.com/spatie/eloquent-sortable">eloquent-sortable</a>的功能。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Dcat</span>\<span class="title class_">Admin</span>\<span class="title class_">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">HasDateTimeFormatter</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">ModelTree</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Spatie</span>\<span class="title">EloquentSortable</span>\<span class="title">Sortable</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Permission</span> <span class="keyword">extends</span> <span class="title">Model</span> <span class="keyword">implements</span> <span class="title">Sortable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HasDateTimeFormatter</span>,</span><br><span class="line">        <span class="title">ModelTree</span> &#123;</span><br><span class="line">            <span class="title">ModelTree</span>::<span class="title">boot</span> <span class="keyword">as</span> <span class="title">treeBoot</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    ...    </span><br><span class="line">&#125;        </span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;order-&gt;<span class="title function_ invoke__">orderable</span>();</span><br></pre></td></tr></table></figure>



<h3 id="链接-link"><a href="#链接-link" class="headerlink" title="链接 (link)"></a>链接 (link)</h3><p>将字段显示为一个链接。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// link方法不传参数时，链接的`href`和`text`都是当前列的值</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;homepage&#x27;</span>)-&gt;<span class="title function_ invoke__">link</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入闭包</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;homepage&#x27;</span>)-&gt;<span class="title function_ invoke__">link</span>(function (<span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">admin_url</span>(<span class="string">&#x27;users/&#x27;</span>.<span class="variable">$value</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a name="action"></a></p>
<h3 id="行操作-action"><a href="#行操作-action" class="headerlink" title="行操作 (action)"></a>行操作 (action)</h3><blockquote>
<p>{tip} 在使用这个方法之前，请先阅读<a href="model-grid-actions.md">自定义操作-行操作</a></p>
</blockquote>
<p>这个功能可以将某一列显示为一个<strong>行操作</strong>的按钮，比如下面所示是一个标星和取消标星的列操作，<br>点击这一列的星标图标之后, 后台会切换字段的状态，页面图标也跟着切换，具体实现代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>\<span class="title class_">Grid</span>\<span class="title class_">RowAction</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">RowAction</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Star</span> <span class="keyword">extends</span> <span class="title">RowAction</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">html</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$icon</span> = (<span class="variable language_">$this</span>-&gt;row-&gt;&#123;<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getColumnName</span>()&#125;) ? <span class="string">&#x27;fa-star&#x27;</span> : <span class="string">&#x27;fa-star-o&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&lt;&lt;&lt;HTML</span></span><br><span class="line"><span class="string">&lt;i class=&quot;<span class="subst">&#123;$this-&gt;getElementClass()&#125;</span> fa <span class="subst">&#123;$icon&#125;</span>&quot;&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="string">HTML</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$class</span> = <span class="variable">$request</span>-&gt;<span class="class"><span class="keyword">class</span>;</span></span><br><span class="line"><span class="class">            $<span class="title">column</span> = $<span class="title">request</span>-&gt;<span class="title">column</span>;</span></span><br><span class="line"><span class="class">            $<span class="title">id</span> = $<span class="title">this</span>-&gt;<span class="title">getKey</span>();</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            $<span class="title">model</span> = $<span class="title">class</span>::<span class="title">find</span>($<span class="title">id</span>);</span></span><br><span class="line"><span class="class">            $<span class="title">model</span>-&gt;</span>&#123;<span class="variable">$column</span>&#125; = (<span class="keyword">int</span>) !<span class="variable">$model</span>-&gt;&#123;<span class="variable">$column</span>&#125;;</span><br><span class="line">            <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&quot;success&quot;</span>)-&gt;<span class="title function_ invoke__">refresh</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">error</span>(<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parameters</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">modelClass</span>(),</span><br><span class="line">            <span class="string">&#x27;column&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getColumnName</span>(),</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getColumnName</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;column-&gt;<span class="title function_ invoke__">getName</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">modelClass</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">get_class</span>(<span class="variable">$this</span>-&gt;<span class="built_in">parent</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">repository</span>()-&gt;<span class="title function_ invoke__">model</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$grid</span> = <span class="keyword">new</span> <span class="title class_">Grid</span>(<span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">model</span>());</span><br><span class="line"></span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;star&#x27;</span>, <span class="string">&#x27;-&#x27;</span>)-&gt;<span class="title function_ invoke__">action</span>(<span class="title class_">Star</span>::<span class="variable language_">class</span>);  <span class="comment">// here</span></span><br><span class="line">    <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;ID&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>()-&gt;<span class="title function_ invoke__">bold</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$grid</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src="https://cdn.learnku.com/uploads/images/202005/17/38389/g8F7p8gnsE.png!large"></p>
<h2 id="帮助方法"><a href="#帮助方法" class="headerlink" title="帮助方法"></a>帮助方法</h2><h3 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h3><p>如果当前里的输出数据为字符串，那么可以通过链式方法调用<code>Illuminate\Support\Str</code>的方法。</p>
<p>比如有如下一列，显示<code>title</code>字段的字符串值:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">title</span>();</span><br></pre></td></tr></table></figure>

<p>在<code>title</code>列输出的字符串基础上调用<code>Str::title()</code>方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">title</span>()-&gt;<span class="title function_ invoke__">title</span>();</span><br></pre></td></tr></table></figure>
<p>调用方法之后输出的还是字符串，所以可以继续调用<code>Illuminate\Support\Str</code>的方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">title</span>()-&gt;<span class="title function_ invoke__">title</span>()-&gt;<span class="title function_ invoke__">ucfirst</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">title</span>()-&gt;<span class="title function_ invoke__">title</span>()-&gt;<span class="title function_ invoke__">ucfirst</span>()-&gt;<span class="title function_ invoke__">substr</span>(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="数组操作"><a href="#数组操作" class="headerlink" title="数组操作"></a>数组操作</h3><p>如果当前列输出的是数组，可以直接链式调用<code>Illuminate\Support\Collection</code>方法。</p>
<p>比如<code>tags</code>列是从一对多关系取出来的数组数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tags</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span> (</span><br><span class="line">  <span class="number">0</span> =&gt; </span><br><span class="line">  <span class="keyword">array</span> (</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span> =&gt; <span class="string">&#x27;16&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;php&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;created_at&#x27;</span> =&gt; <span class="string">&#x27;2016-11-13 14:03:03&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;updated_at&#x27;</span> =&gt; <span class="string">&#x27;2016-12-25 04:29:35&#x27;</span>,</span><br><span class="line">    </span><br><span class="line">  ),</span><br><span class="line">  <span class="number">1</span> =&gt; </span><br><span class="line">  <span class="keyword">array</span> (</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span> =&gt; <span class="string">&#x27;17&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;python&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;created_at&#x27;</span> =&gt; <span class="string">&#x27;2016-11-13 14:03:09&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;updated_at&#x27;</span> =&gt; <span class="string">&#x27;2016-12-25 04:30:27&#x27;</span>,</span><br><span class="line">  ),</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>调用<code>Collection::pluck()</code>方法取出数组的中的<code>name</code>列</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tags</span>()-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span> (</span><br><span class="line">    <span class="number">0</span> =&gt; <span class="string">&#x27;php&#x27;</span>,</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&#x27;python&#x27;</span>,</span><br><span class="line">  ),</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>取出<code>name</code>列之后输出的还是数组，还能继续调用用<code>Illuminate\Support\Collection</code>的方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tags</span>()-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">map</span>(<span class="string">&#x27;ucwords&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span> (</span><br><span class="line">    <span class="number">0</span> =&gt; <span class="string">&#x27;Php&#x27;</span>,</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&#x27;Python&#x27;</span>,</span><br><span class="line">  ),</span><br></pre></td></tr></table></figure>
<p>将数组输出为字符串</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">tags</span>()-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">map</span>(<span class="string">&#x27;ucwords&#x27;</span>)-&gt;<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;Php-Python&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="混合使用"><a href="#混合使用" class="headerlink" title="混合使用"></a>混合使用</h3><p>在上面两种类型的方法调用中，只要上一步输出的是确定类型的值，便可以调用类型对应的方法，所以可以很灵活的混合使用。</p>
<p>比如<code>images</code>字段是存储多图片地址数组的JSON格式字符串类型：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">images</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;[&#x27;foo.jpg&#x27;, &#x27;bar.png&#x27;]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 链式方法调用来显示多图</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">images</span>()-&gt;<span class="title function_ invoke__">display</span>(function (<span class="variable">$images</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_decode</span>(<span class="variable">$images</span>, <span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">map</span>(function (<span class="variable">$path</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;http://localhost/images/&#x27;</span>. <span class="variable">$path</span>;</span><br><span class="line">    </span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">image</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="扩展列的显示功能"><a href="#扩展列的显示功能" class="headerlink" title="扩展列的显示功能"></a>扩展列的显示功能</h2><p>可以通过两种方式扩展列功能，第一种是通过匿名函数的方式。</p>
<blockquote>
<p>扩展列功能方法后IDE默认是不会自动补全的，这时候可以通过<code>php artisan admin:ide-helper</code>生成IDE提示文件。</p>
</blockquote>
<h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><p>在<code>app/Admin/bootstrap.php</code>加入以下代码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Column</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个参数是自定义参数</span></span><br><span class="line"><span class="title class_">Column</span>::<span class="title function_ invoke__">extend</span>(<span class="string">&#x27;color&#x27;</span>, function (<span class="variable">$value</span>, <span class="variable">$color</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;span style=&#x27;color: <span class="subst">$color</span>&#x27;&gt;<span class="subst">$value</span>&lt;/span&gt;&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后在<code>model-grid</code>中使用这个扩展：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">title</span>()-&gt;<span class="title function_ invoke__">color</span>(<span class="string">&#x27;#ccc&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="扩展类"><a href="#扩展类" class="headerlink" title="扩展类"></a>扩展类</h3><p>如果列显示逻辑比较复杂，可以通过扩展类来实现。</p>
<p>扩展类<code>app/Admin/Extensions/Popover.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Displayers</span>\<span class="title">AbstractDisplayer</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Popover</span> <span class="keyword">extends</span> <span class="title">AbstractDisplayer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"><span class="variable">$placement</span> = <span class="string">&#x27;left&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title class_">Admin</span>::<span class="title function_ invoke__">script</span>(<span class="string">&quot;$(&#x27;[data-toggle=\&quot;popover\&quot;]&#x27;).popover()&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&lt;&lt;&lt;EOT</span></span><br><span class="line"><span class="string">&lt;button type=&quot;button&quot;</span></span><br><span class="line"><span class="string">    class=&quot;btn btn-secondary&quot;</span></span><br><span class="line"><span class="string">    title=&quot;popover&quot;</span></span><br><span class="line"><span class="string">    data-container=&quot;body&quot;</span></span><br><span class="line"><span class="string">    data-toggle=&quot;popover&quot;</span></span><br><span class="line"><span class="string">    data-placement=&quot;<span class="subst">$placement</span>&quot;</span></span><br><span class="line"><span class="string">    data-content=&quot;<span class="subst">&#123;$this-&gt;value&#125;</span>&quot;</span></span><br><span class="line"><span class="string">    &gt;</span></span><br><span class="line"><span class="string">  弹出提示</span></span><br><span class="line"><span class="string">&lt;/button&gt;</span></span><br><span class="line"><span class="string">EOT</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>app/Admin/bootstrap.php</code>注册扩展类：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Column</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Extensions</span>\<span class="title">Popover</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Column</span>::<span class="title function_ invoke__">extend</span>(<span class="string">&#x27;popover&#x27;</span>, <span class="title class_">Popover</span>::<span class="variable language_">class</span>);</span><br></pre></td></tr></table></figure>
<p>然后就能在<code>model-grid</code>中使用了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">desciption</span>()-&gt;<span class="title function_ invoke__">popover</span>(<span class="string">&#x27;right&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="指定列名"><a href="#指定列名" class="headerlink" title="指定列名"></a>指定列名</h3><p>出了上述两种方式扩展列功能，我们还可以通过指定列名称的方式扩展列功能</p>
<p>在<code>app/Admin/bootstrap.php</code>加入以下代码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">Column</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个扩展方法等同于</span></span><br><span class="line"><span class="comment">// $grid-&gt;title()-&gt;display(function ($value) &#123;</span></span><br><span class="line"><span class="comment">//    return &quot;&lt;span style=&#x27;color:red&#x27;&gt;$value&lt;/span&gt;&quot;</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="title class_">Column</span>::<span class="title function_ invoke__">define</span>(<span class="string">&#x27;title&#x27;</span>, function (<span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;<span class="subst">$value</span>&lt;/span&gt;&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个扩展方法等同于</span></span><br><span class="line"><span class="comment">// $grid-&gt;status()-&gt;switch();</span></span><br><span class="line"><span class="title class_">Column</span>::<span class="title function_ invoke__">define</span>(<span class="string">&#x27;status&#x27;</span>, <span class="title class_">Dcat\Admin\Grid\Displayers\SwitchDisplay</span>::<span class="variable language_">class</span>);</span><br></pre></td></tr></table></figure>
<p>然后在<code>model-grid</code>中<code>title</code>和<code>status</code>字段会自动使用以上扩展：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">title</span>();</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">status</span>();</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-column-display/" data-id="clpdpxfjn001bywna00ec8pp1" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-column-filter" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-column-filter/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.969Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="列过滤器"><a href="#列过滤器" class="headerlink" title="列过滤器"></a>列过滤器</h1><p>这个功能可以给表格的列设置一个过滤器，可以更方便的根据这一列进行数据表格过滤操作</p>
<p>![](&#x2F;assets&#x2F;img&#x2F;screenshots&#x2F;column-filter.png)</p>
<h2 id="字符串比较查询"><a href="#字符串比较查询" class="headerlink" title="字符串比较查询"></a>字符串比较查询</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WHERE `username` = &quot;$input&quot;</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;username-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Equal</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>上面的调用可以给 <code>username</code> 这一列的头部加上一个 <code>input</code> 类型的过滤器，点击过滤器图标展开过滤器，输入查询提交后，会对这一列执行 <code>等于</code> 查询。</p>
<h3 id="开启字段值查询"><a href="#开启字段值查询" class="headerlink" title="开启字段值查询"></a>开启字段值查询</h3><p>这个功能可以给每一列字段的值设置一个过滤器，点击该列字段的值就可以进行数据表格过滤操作，非常方便。</p>
<blockquote>
<p>{tip} 开启此功能之后会把这个字段的原始值作为搜索内容，不会受 <code>display</code> 方法影响。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置为 label 或调用 display 方法不会影响查询内容</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;ip-&gt;<span class="title function_ invoke__">label</span>()-&gt;<span class="title function_ invoke__">filter</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;ip-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Equal</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">valueFilter</span>()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>鼠标移动到开启了值查询功能的列上面，右边会显示一个“放大镜”图标<br><a href="/assets/img/screenshots/column-value-filter-1.png" target="_blank"><br>    <img class="img" width="400px" src="/assets/img/screenshots/column-value-filter-1.png"><br></a></p>
<p>点击列之后，表头会出现“重置”按钮，点击可以取消筛选</p>
<a href="/assets/img/screenshots/column-value-filter-search.png" target="_blank">
    <img class="img" width="400px" src="/assets/img/screenshots/column-value-filter-search.png">
</a>

<h4 id="设置值的字段名称"><a href="#设置值的字段名称" class="headerlink" title="设置值的字段名称"></a>设置值的字段名称</h4><p>如果当前列的值并非用户想要搜索的值，可以通过以下方法更改字段名称。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;<span class="title function_ invoke__">with</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实际搜索的会是 name 字段的值</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;username-&gt;<span class="title function_ invoke__">filter</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 二维数组</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;user_id-&gt;<span class="title function_ invoke__">filter</span>(<span class="string">&#x27;user.id&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 闭包</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;user_id-&gt;<span class="title function_ invoke__">filter</span>(function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="隐藏表头的筛选器图标"><a href="#隐藏表头的筛选器图标" class="headerlink" title="隐藏表头的筛选器图标"></a>隐藏表头的筛选器图标</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;user_id-&gt;<span class="title function_ invoke__">filterByValue</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;user_id-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Equal</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">        -&gt;<span class="title function_ invoke__">valueFilter</span>()</span><br><span class="line">        -&gt;<span class="title function_ invoke__">hide</span>()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>效果如下</p>
<a href="/assets/img/screenshots/column-value-filter.png" target="_blank">
    <img class="img" width="400px" src="/assets/img/screenshots/column-value-filter.png">
</a>



<h3 id="其余Input表单类型过滤器"><a href="#其余Input表单类型过滤器" class="headerlink" title="其余Input表单类型过滤器"></a>其余Input表单类型过滤器</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WHERE `username` LIKE &quot;%&#123;$input&#125;%&quot;</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;username-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Like</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// WHERE `username` LIKE &quot;&#123;$input&#125;%&quot;</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;username-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\StartWith</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// WHERE `username` &gt; &quot;$input&quot;</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;username-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Gt</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// WHERE `username` &lt;= &quot;$input&quot;</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;username-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Ngt</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// WHERE `username` &lt; &quot;$input&quot;</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;username-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Lt</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// WHERE `username` &gt;= &quot;$input&quot;</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;username-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Nlt</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="时间日期"><a href="#时间日期" class="headerlink" title="时间日期"></a>时间日期</h3><p>如果字段是时间、日期相关的字段，可以使用下面的方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">date</span>()-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Equal</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">date</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">time</span>()-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Like</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">time</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">datetime</span>()-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Gt</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">datetime</span>(<span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<a href="/assets/img/screenshots/grid-column-filter-between.png" target="_blank">
    <img class="img" width="400px" src="/assets/img/screenshots/grid-column-filter-between.png">
</a>


<h2 id="多选查询"><a href="#多选查询" class="headerlink" title="多选查询"></a>多选查询</h2><p>假设需要在表格数据中通过 <code>status</code> 字段过滤一个或者多个状态的数据，使用多选过滤可以非常方便的实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;状态&#x27;</span>)-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\In</span>::<span class="title function_ invoke__">make</span>([</span><br><span class="line">        <span class="number">0</span> =&gt; <span class="string">&#x27;未知&#x27;</span>,</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="string">&#x27;已下单&#x27;</span>,</span><br><span class="line">        <span class="number">2</span> =&gt; <span class="string">&#x27;已付款&#x27;</span>,</span><br><span class="line">        <span class="number">3</span> =&gt; <span class="string">&#x27;已取消&#x27;</span>,</span><br><span class="line">    ])</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h2><p>假设需要通过 <code>price</code> 字段过滤出某个价格范围内的数据</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;price&#x27;</span>)-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Between</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>或者是时间、日期范围的过滤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">date</span>()-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Between</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">date</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">time</span>()-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Between</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">time</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">datetime</span>()-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Between</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">datetime</span>()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="指定查询字段名"><a href="#指定查询字段名" class="headerlink" title="指定查询字段名"></a>指定查询字段名</h2><p>通过<code>setColumnName</code>方法可以指定查询字段的名称</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Equal</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">setColumnName</span>(<span class="string">&#x27;custom_column&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="查询json字段"><a href="#查询json字段" class="headerlink" title="查询json字段"></a>查询json字段</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Equal</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">setColumnName</span>(<span class="string">&#x27;json_column-&gt;label&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<h3 id="关联关系字段查询"><a href="#关联关系字段查询" class="headerlink" title="关联关系字段查询"></a>关联关系字段查询</h3><p>如果安装了 <a target="_blank" rel="noopener" href="https://github.com/jqhph/laravel-wherehasin">dcat&#x2F;laravel-wherehasin</a>，则会优先使用<code>whereHasIn</code>方法进行查询操作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;user.name&#x27;</span>)-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Equal</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;user_name&#x27;</span>)-&gt;<span class="title function_ invoke__">filter</span>(</span><br><span class="line">    <span class="title class_">Grid\Column\Filter\Equal</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">setColumnName</span>(<span class="string">&#x27;user.name&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-column-filter/" data-id="clpdpxfjo001cywna3k5jcdvw" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-actions" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-actions/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.968Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="行的使用和扩展"><a href="#行的使用和扩展" class="headerlink" title="行的使用和扩展"></a>行的使用和扩展</h1><h3 id="启用或禁用默认操作按钮"><a href="#启用或禁用默认操作按钮" class="headerlink" title="启用或禁用默认操作按钮"></a>启用或禁用默认操作按钮</h3><p><code>model-grid</code>默认有四个行操作<code>编辑</code>、<code>快捷编辑</code>、<code>删除</code>和<code>详情</code>，可以通过下面的方式关闭它们：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"> <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">actions</span>(function (Grid\Displayers\Actions <span class="variable">$actions</span>) &#123;</span><br><span class="line">    <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">disableDelete</span>();</span><br><span class="line">    <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">disableEdit</span>();</span><br><span class="line">    <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">disableQuickEdit</span>();</span><br><span class="line">    <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">disableView</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以通过以下方式启用或禁用按钮</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableDeleteButton</span>();</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableEditButton</span>();</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableQuickEditButton</span>();</span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableViewButton</span>();</span><br></pre></td></tr></table></figure>

<h3 id="切换行操作按钮显示方式"><a href="#切换行操作按钮显示方式" class="headerlink" title="切换行操作按钮显示方式"></a>切换行操作按钮显示方式</h3><p>全局默认的行操作按钮显示方式可以通过配置参数<code>admin.grid.grid_action_class</code>参数进行配置，目前支持的行操作按钮显示方式有以下两种：</p>
<ul>
<li><code>Dcat\Admin\Grid\Displayers\DropdownActions</code> 下拉菜单方式</li>
<li><code>Dcat\Admin\Grid\Displayers\Actions</code> 图标展开方式</li>
<li><code>Dcat\Admin\Grid\Displayers\ContextMenuActions</code> 鼠标右键显示下拉菜单</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;grid&#x27;</span> =&gt; [</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    |--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">    | The global Grid action display class.</span></span><br><span class="line"><span class="comment">    |--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="string">&#x27;grid_action_class&#x27;</span> =&gt; <span class="title class_">Dcat\Admin\Grid\Displayers\DropdownActions</span>::<span class="variable language_">class</span>,</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>在控制器中切换显示方式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">Grid</span>(<span class="keyword">new</span> <span class="title class_">Model</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Grid <span class="variable">$grid</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">setActionClass</span>(<span class="title class_">Grid\Displayers\Actions</span>::<span class="variable language_">class</span>);</span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取行序号-index"><a href="#获取行序号-index" class="headerlink" title="获取行序号 (index)"></a>获取行序号 (index)</h3><p>序号从 <code>0</code> 开始计算</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 display 回调中使用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;序号&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;_index + <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在行操作 action 中使用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">actions</span>(function (<span class="variable">$actions</span>) &#123;</span><br><span class="line">    <span class="variable">$index</span> = <span class="variable language_">$this</span>-&gt;_index;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前行数据"><a href="#获取当前行数据" class="headerlink" title="获取当前行数据"></a>获取当前行数据</h3><p>可以通过传入的<code>$actions</code>参数来获取当前行的数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">actions</span>(function (Grid\Displayers\Actions <span class="variable">$actions</span>) &#123;</span><br><span class="line">    <span class="comment">// 当前行的数据数组</span></span><br><span class="line">    <span class="variable">$rowArray</span> = <span class="variable">$actions</span>-&gt;row-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 当前行的某个字段的数据</span></span><br><span class="line">    <span class="variable">$email</span> = <span class="variable">$actions</span>-&gt;row-&gt;email;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取当前行主键值</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">getKey</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="添加自定义按钮"><a href="#添加自定义按钮" class="headerlink" title="添加自定义按钮"></a>添加自定义按钮</h3><p>如果有自定义的操作按钮，可以通过下面的方式添加：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">actions</span>(function (Grid\Displayers\Actions <span class="variable">$actions</span>) &#123;</span><br><span class="line">    <span class="comment">// append一个操作</span></span><br><span class="line">    <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="string">&#x27;&lt;a href=&quot;&quot;&gt;&lt;i class=&quot;fa fa-eye&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// append一个复杂操作</span></span><br><span class="line">    <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="keyword">new</span> <span class="title class_">Copy</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// prepend一个操作</span></span><br><span class="line">    <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">prepend</span>(<span class="string">&#x27;&lt;a href=&quot;&quot;&gt;&lt;i class=&quot;fa fa-paper-plane&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="添加复杂操作按钮"><a href="#添加复杂操作按钮" class="headerlink" title="添加复杂操作按钮"></a>添加复杂操作按钮</h3><p>如果有比较复杂的操作，可以参考下面的方式：</p>
<p>先定义行操作类继承<code>Dcat\Admin\Grid\RowAction</code></p>
<blockquote>
<p>{tip} 动作类更详细的用法，请参考<a href="action.md">动作基本使用</a>以及<a href="action-grid.md">数据表格动作</a>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">RowAction</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CheckRow</span> <span class="keyword">extends</span> <span class="title">RowAction</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回字段标题</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">title</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Check row&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加JS</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">script</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">$(&#x27;.grid-check-row&#x27;).on(&#x27;click&#x27;, function () &#123;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    // Your code.</span></span><br><span class="line"><span class="string">    console.log($(this).data(&#x27;id&#x27;));</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">JS</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">html</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取当前行数据ID</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKey</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取当前行数据的用户名</span></span><br><span class="line">        <span class="variable">$username</span> = <span class="variable language_">$this</span>-&gt;row-&gt;username;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 这里需要添加一个class, 和上面script方法对应</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setHtmlAttribute</span>([<span class="string">&#x27;data-id&#x27;</span> =&gt; <span class="variable">$id</span>, <span class="string">&#x27;email&#x27;</span> =&gt; <span class="variable">$username</span>, <span class="string">&#x27;class&#x27;</span> =&gt; <span class="string">&#x27;grid-check-row&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">parent</span>::<span class="title function_ invoke__">html</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后添加操作：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">actions</span>([<span class="keyword">new</span> <span class="title class_">CheckRow</span>()]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以通过这种方式添加</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">actions</span>(function (Grid\Displayers\Actions <span class="variable">$actions</span>) &#123;</span><br><span class="line">    <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="keyword">new</span> <span class="title class_">CheckRow</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="操作按钮需要与API交互"><a href="#操作按钮需要与API交互" class="headerlink" title="操作按钮需要与API交互"></a>操作按钮需要与API交互</h3><p>如果你的操作类需要与后台接口交互，则可以在你的操作类中加上<code>handle</code>方法，这样就可以很方便的在同一个类里面处理完所有逻辑</p>
<blockquote>
<p>{tip} 动作类更详细的用法，请参考<a href="action.md">动作基本使用</a>以及<a href="action-grid.md">数据表格动作</a>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">RowActions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">RowAction</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Copy</span> <span class="keyword">extends</span> <span class="title">RowAction</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$model</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;model = <span class="variable">$model</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标题</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">title</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Copy&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置确认弹窗信息，如果返回空值，则不会弹出弹窗</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 允许返回字符串或数组类型</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array|string|void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">confirm</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="comment">// 确认弹窗 title</span></span><br><span class="line">            <span class="string">&quot;您确定要复制这行数据吗？&quot;</span>,</span><br><span class="line">            <span class="comment">// 确认弹窗 content</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;row-&gt;username,</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理请求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Dcat\Admin\Actions\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取当前行ID</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKey</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 parameters 方法传递的参数</span></span><br><span class="line">        <span class="variable">$username</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">        <span class="variable">$model</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;model&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 复制数据</span></span><br><span class="line">        <span class="variable">$model</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$id</span>)-&gt;<span class="title function_ invoke__">replicate</span>()-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回响应结果并刷新页面</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&quot;复制成功: [<span class="subst">&#123;$username&#125;</span>]&quot;</span>)-&gt;<span class="title function_ invoke__">refresh</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置要POST到接口的数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parameters</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="comment">// 发送当前行 username 字段数据到接口</span></span><br><span class="line">            <span class="string">&#x27;username&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;row-&gt;username,</span><br><span class="line">            <span class="comment">// 把模型类名传递到接口</span></span><br><span class="line">            <span class="string">&#x27;model&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;model,</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">actions</span>([<span class="keyword">new</span> <span class="title class_">Copy</span>(<span class="title class_">User</span>::<span class="variable language_">class</span>)]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以通过这种方式添加</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">actions</span>(function (Grid\Displayers\Actions <span class="variable">$actions</span>) &#123;</span><br><span class="line">    <span class="variable">$actions</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="keyword">new</span> <span class="title class_">Copy</span>(<span class="title class_">User</span>::<span class="variable language_">class</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="表单弹窗"><a href="#表单弹窗" class="headerlink" title="表单弹窗"></a>表单弹窗</h2><p>请参考文档<a href="widgets-form.md#modal">工具表单 - 弹窗</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-actions/" data-id="clpdpxfjl0019ywnadp8aaicv" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-grid-async" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-grid-async/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.968Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表格异步渲染"><a href="#表格异步渲染" class="headerlink" title="表格异步渲染"></a>表格异步渲染</h1><p>当页面的表格展示的数据特别多（列多行多），并且加载的组件也较多时，可能会出现卡顿的现象，此时可以使用表格异步渲染功能，可以有效地减轻页面卡顿的情况：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启用表格异步渲染功能</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">async</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁用</span></span><br><span class="line"><span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">async</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否是异步渲染请求</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">isAsyncRequest</span>()) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是，如果页面没有出现明显的卡顿现象，则无需启用此功能。并且如果页面中存在多个数据表格，那么也无法使用此功能。</p>
</blockquote>
<p>开启此功能之后，表格<strong>工具栏</strong>(<code>toolbar</code>)以下的位置都会采用异步的方式进行渲染，换句话说，<strong>工具栏</strong>(<code>toolbar</code>)以及以上的位置只会刷新一次！在实际编码过程中需要注意有无特殊影响。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-grid-async/" data-id="clpdpxfjm001aywnabbpn3fb9" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form-validation" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-validation/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.967Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a>表单验证</h1><h3 id="rule"><a href="#rule" class="headerlink" title="rule"></a>rule</h3><p><code>model-form</code>使用laravel的验证规则来验证表单提交的数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required|min:3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复杂的验证规则可以在回调里面实现</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果不是编辑状态，则添加字段唯一验证</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$id</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;id) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;unique:users,email_address&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>也可以给验证规则自定义错误提示消息：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;code&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required|regex:/^\d+$/|min:10&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;regex&#x27;</span> =&gt; <span class="string">&#x27;code必须全部为数字&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;min&#x27;</span>   =&gt; <span class="string">&#x27;code不能少于10个字符&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>如果要允许字段为空，首先要在数据库的表里面对该字段设置为<code>NULL</code>，然后</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;nullable&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>更多规则请参考<a target="_blank" rel="noopener" href="https://laravel.com/docs/5.5/validation">Validation</a>。</p>
<h3 id="creationRules"><a href="#creationRules" class="headerlink" title="creationRules"></a>creationRules</h3><p>此方法用法和<code>Form\Field::rule</code>用法完全一致，不同的是此方法只有在新增数据时才有效。</p>
<blockquote>
<p>{tip} 如果调用了<code>creationRules</code>方法，则<code>rule</code>方法设置的验证规则将会被忽略。</p>
</blockquote>
<h3 id="updateRules"><a href="#updateRules" class="headerlink" title="updateRules"></a>updateRules</h3><p>此方法用法和<code>Form\Field::rule</code>用法完全一致，不同的是此方法只有在更新数据时才有效。</p>
<blockquote>
<p>{tip} 如果调用了<code>updateRules</code>方法，则<code>rule</code>方法设置的验证规则将会被忽略。</p>
</blockquote>
<h2 id="responseValidationMessages"><a href="#responseValidationMessages" class="headerlink" title="responseValidationMessages"></a>responseValidationMessages</h2><p>通过<code>Form::responseValidationMessages</code>方法可以返回自定义验证错误信息，并中断后续逻辑，用法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 编辑提交时是“PUT”方法</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">request</span>()-&gt;<span class="title function_ invoke__">getMethod</span>() == <span class="string">&#x27;PUT&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (...) &#123; <span class="comment">// 你的验证逻辑</span></span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">responseValidationMessages</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;title格式错误&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如有多个错误信息，第二个参数可以传数组</span></span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">responseValidationMessages</span>(<span class="string">&#x27;content&#x27;</span>, [<span class="string">&#x27;content格式错误&#x27;</span>, <span class="string">&#x27;content不能为空&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;content&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>也可以在<code>submitted</code>事件中使用这个方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">submitted</span>(function (<span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (...) &#123; <span class="comment">// 你的验证逻辑</span></span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">responseValidationMessages</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;title格式错误&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如有多个错误信息，第二个参数可以传数组</span></span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">responseValidationMessages</span>(<span class="string">&#x27;content&#x27;</span>, [<span class="string">&#x27;content格式错误&#x27;</span>, <span class="string">&#x27;content不能为空&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="前端验证"><a href="#前端验证" class="headerlink" title="前端验证"></a>前端验证</h2><p>系统继承了<a href="https://github.com/1000hz/bootstrap-validator" target="_blank">bootstrap-validator</a>进行前端表单验证，支持H5表单类型的验证。</p>
<blockquote>
<p>{tip} 不支持H5的浏览器也可以使用前端验证，系统已经做好了兼容。大部分表单都支持前端和后端验证，两者可以同时工作不冲突，少部分表单前端验证无效。</p>
</blockquote>
<h3 id="H5验证"><a href="#H5验证" class="headerlink" title="H5验证"></a>H5验证</h3><h4 id="required"><a href="#required" class="headerlink" title="required"></a>required</h4><p>必填</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br></pre></td></tr></table></figure>

<h4 id="number"><a href="#number" class="headerlink" title="number"></a>number</h4><p>只允许输入数字</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;age&#x27;</span>)-&gt;<span class="title function_ invoke__">type</span>(<span class="string">&#x27;number&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>限制范围</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只允许输入 10-60 范围内的数字</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">type</span>(<span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">attribute</span>(<span class="string">&#x27;min&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">attribute</span>(<span class="string">&#x27;max&#x27;</span>, <span class="number">60</span>);</span><br></pre></td></tr></table></figure>

<h4 id="email"><a href="#email" class="headerlink" title="email"></a>email</h4><p>邮箱</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">email</span>(<span class="string">&#x27;email&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="url"><a href="#url" class="headerlink" title="url"></a>url</h4><p>链接</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;website&#x27;</span>)-&gt;<span class="title function_ invoke__">type</span>(<span class="string">&#x27;url&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><h4 id="minLength"><a href="#minLength" class="headerlink" title="minLength"></a>minLength</h4><p>限制字符最小长度</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">minLength</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置错误信息</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">minLength</span>(<span class="number">20</span>, <span class="string">&#x27;最少输入20个字符&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="maxLength"><a href="#maxLength" class="headerlink" title="maxLength"></a>maxLength</h4><p>限制字符最大长度</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">maxLength</span>(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置错误信息</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">minLength</span>(<span class="number">50</span>, <span class="string">&#x27;不能超过50个字符&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="same"><a href="#same" class="headerlink" title="same"></a>same</h4><p>限制当前字段值必须与给定字段的值相等，常用于密码确认</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password_confirm&#x27;</span>)-&gt;<span class="title function_ invoke__">same</span>(<span class="string">&#x27;password&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置错误信息</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password_confirm&#x27;</span>)-&gt;<span class="title function_ invoke__">same</span>(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;两次密码输入不一致&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h3><p>开发者可以通过以下方法自定义前端验证规则。</p>
<p>在 <code>app/Admin/bootstrap.php</code> 中添加以下代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>\<span class="title">Field</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Field\Text</span>::<span class="title function_ invoke__">macro</span>(<span class="string">&#x27;len&#x27;</span>, function (<span class="keyword">int</span> <span class="variable">$length</span>, ?<span class="keyword">string</span> <span class="variable">$error</span> = <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// 前端验证逻辑扩展</span></span><br><span class="line">    <span class="title class_">Admin</span>::<span class="title function_ invoke__">script</span>(</span><br><span class="line">                <span class="string">&lt;&lt;&lt;&#x27;JS&#x27;</span></span><br><span class="line"><span class="string">Dcat.validator.extend(&#x27;len&#x27;, function ($el) &#123;</span></span><br><span class="line"><span class="string">    return $el.val().length != $el.attr(&#x27;data-len&#x27;);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 同时添加后端验证逻辑，这个可以看需要</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;size:&#x27;</span>.<span class="variable">$length</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">attribute</span>([</span><br><span class="line">            <span class="string">&#x27;data-len&#x27;</span>       =&gt; <span class="variable">$length</span>,</span><br><span class="line">            <span class="string">&#x27;data-len-error&#x27;</span> =&gt; <span class="title function_ invoke__">str_replace</span>(</span><br><span class="line">                [<span class="string">&#x27;:attribute&#x27;</span>, <span class="string">&#x27;:len&#x27;</span>],</span><br><span class="line">                [<span class="variable">$this</span>-&gt;label, <span class="variable">$length</span>],</span><br><span class="line">                <span class="variable">$error</span> ?: <span class="string">&quot;只能输入:len个字符&quot;</span></span><br><span class="line">            ),</span><br><span class="line">        ]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">len</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-validation/" data-id="clpdpxfji0016ywnac7z3c4v5" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form-when" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-when/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.967Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单字段动态显示"><a href="#表单字段动态显示" class="headerlink" title="表单字段动态显示"></a>表单字段动态显示</h1><blockquote>
<p>{tip} 此功能在<a href="widgets-form.md">工具表单</a>中一样有效</p>
</blockquote>
<p>表单字段动态显示是指，在选择表单项的指定的选项时，联动显示其他的表单项。</p>
<a href="/assets/img/screenshots/form-when.gif" target="_blank">
    <img class="img" src="/assets/img/screenshots/form-when.gif" />
</a>    


<p>目前支持的表单联动的组件有：</p>
<ul>
<li><code>select</code></li>
<li><code>multipleSelect</code></li>
<li><code>radio</code></li>
<li><code>checkbox</code></li>
</ul>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>可以将上面的组件分为单选和多选两种类型，其中<code>select</code>、<code>radio</code>为单选组件，其它为多选组件</p>
<h3 id="单选组件"><a href="#单选组件" class="headerlink" title="单选组件"></a>单选组件</h3><p>下面的例子中，选择不同的国籍类型，将会切换选择不同的联动表单项：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">radio</span>(<span class="string">&#x27;radio&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">when</span>([<span class="number">1</span>, <span class="number">4</span>], function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">        <span class="comment">// 值为1和4时显示文本框</span></span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;text1&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;text2&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;text3&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">when</span>(<span class="number">2</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;editor&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">when</span>(<span class="number">3</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;image&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">options</span>([</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="string">&#x27;显示文本框&#x27;</span>,</span><br><span class="line">        <span class="number">2</span> =&gt; <span class="string">&#x27;显示编辑器&#x27;</span>,</span><br><span class="line">        <span class="number">3</span> =&gt; <span class="string">&#x27;显示文件上传&#x27;</span>,</span><br><span class="line">        <span class="number">4</span> =&gt; <span class="string">&#x27;还是显示文本框&#x27;</span>,</span><br><span class="line">    ])</span><br><span class="line">    -&gt;<span class="keyword">default</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>上例中，方法<code>when(1, $callback)</code>等效于<code>when(&#39;=&#39;, 1, $callback)</code>, 如果用操作符<code>=</code>，则可以省略这个参数</p>
<p>同时也支持这些操作符，<code>=</code>、<code>&gt;</code>、<code>&gt;=</code>、<code>&lt;</code>、<code>&lt;=</code>、<code>!=</code>使用方法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">radio</span>(<span class="string">&#x27;check&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">when</span>(<span class="string">&#x27;&gt;&#x27;</span>, <span class="number">1</span>, function () &#123;</span><br><span class="line"></span><br><span class="line">    &#125;)-&gt;<span class="title function_ invoke__">when</span>(<span class="string">&#x27;&gt;=&#x27;</span>, <span class="number">2</span>, function () &#123;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p><code>select</code> 组件的使用方法和<code>radio</code>是一样的。</p>
<p>另外需要注意的是，如果使用动态显示功能之后表单不能使用<code>required</code>方法，应该使用<code>required_if</code>代替，如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">radio</span>(<span class="string">&#x27;type&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">when</span>([<span class="number">1</span>, <span class="number">4</span>], function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;text1&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required_if:type,1,4&#x27;</span>) <span class="comment">// 使用required_if</span></span><br><span class="line">            -&gt;<span class="title function_ invoke__">setLabelClass</span>([<span class="string">&#x27;asterisk&#x27;</span>]); <span class="comment">// 显示 * 号</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="多选组件"><a href="#多选组件" class="headerlink" title="多选组件"></a>多选组件</h3><p>多选组件支持两个操作符：<code>in</code>、<code>notIn</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">checkbox</span>(<span class="string">&#x27;nationality&#x27;</span>, <span class="string">&#x27;国籍&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">options</span>([</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="string">&#x27;中国&#x27;</span>,</span><br><span class="line">        <span class="number">2</span> =&gt; <span class="string">&#x27;外国&#x27;</span>,</span><br><span class="line">    ])-&gt;<span class="title function_ invoke__">when</span>([<span class="number">1</span>, <span class="number">2</span>], function (Form <span class="variable">$form</span>) &#123; </span><br><span class="line"></span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;姓名&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;idcard&#x27;</span>, <span class="string">&#x27;身份证&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;)-&gt;<span class="title function_ invoke__">when</span>(<span class="string">&#x27;notIn&#x27;</span>, <span class="number">2</span>, function (Form <span class="variable">$form</span>) &#123; </span><br><span class="line"></span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;姓名&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;passport&#x27;</span>, <span class="string">&#x27;护照&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p><code>multipleSelect</code>组件的使用方法和<code>checkbox</code>是一样的。</p>
<h3 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h3><p>表单动态显示功能支持结合<code>column</code>以及<code>tab</code>布局功能一起使用，用法如下</p>
<p><code>tab</code>布局</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tab</span>(<span class="string">&#x27;Radio&#x27;</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">value</span>(<span class="string">&#x27;单选框动态展示&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">radio</span>(<span class="string">&#x27;radio&#x27;</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">when</span>([<span class="number">1</span>, <span class="number">4</span>], function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;text1&#x27;</span>);</span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;text2&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">when</span>(<span class="number">2</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;editor&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">options</span>(<span class="variable">$this</span>-&gt;options)</span><br><span class="line">        -&gt;<span class="keyword">default</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>column</code>布局</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="number">6</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">radio</span>(<span class="string">&#x27;radio&#x27;</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">when</span>([<span class="number">1</span>, <span class="number">4</span>], function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;text1&#x27;</span>);</span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;text2&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">when</span>(<span class="number">2</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;editor&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">options</span>(<span class="variable">$this</span>-&gt;options)</span><br><span class="line">        -&gt;<span class="keyword">default</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-when/" data-id="clpdpxfjj0017ywnafbithqud" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.967Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单基本使用"><a href="#表单基本使用" class="headerlink" title="表单基本使用"></a>表单基本使用</h1><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p><code>Dcat\Admin\Form</code>类用于快速生成表单页面，先来个例子，数据库中有<code>movies</code>表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `movies` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `director` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `<span class="keyword">describe</span>` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rate` tinyint unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `released` enum(<span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">  `release_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对应的数据模型为<code>App\Models\Movie</code>，数据仓库为<code>App\Admin\Repositories\Movie</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Movie</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span> = <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Movie</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Form <span class="variable">$form</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 显示记录id</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;ID&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加text类型的input框</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;电影标题&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$directors</span> = [</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">        <span class="number">2</span> =&gt; <span class="string">&#x27;Smith&#x27;</span>,</span><br><span class="line">        <span class="number">3</span> =&gt; <span class="string">&#x27;Kate&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;director&#x27;</span>, <span class="string">&#x27;导演&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>(<span class="variable">$directors</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加describe的textarea输入框</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="string">&#x27;describe&#x27;</span>, <span class="string">&#x27;简介&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 数字输入框</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">number</span>(<span class="string">&#x27;rate&#x27;</span>, <span class="string">&#x27;打分&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加开关操作</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="keyword">switch</span>(<span class="string">&#x27;released&#x27;</span>, <span class="string">&#x27;发布？&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加日期时间选择框</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">datetime</span>(<span class="string">&#x27;release_at&#x27;</span>, <span class="string">&#x27;发布时间&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 两个时间显示</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;创建时间&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;updated_at&#x27;</span>, <span class="string">&#x27;修改时间&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="数据仓库"><a href="#数据仓库" class="headerlink" title="数据仓库"></a>数据仓库</h2><p>数据仓库(<code>Repository</code>)是一个可以提供特定接口对数据进行读写操作的类，通过数据仓库的引入，可以让页面的构建不再关心数据读写功能的具体实现，开发者只需要实现特定的操作接口即可轻松切换数据源。关于数据仓库的详细用法请参考文档<a href="model-repository.md">数据仓库</a>。</p>
<h2 id="表单定义"><a href="#表单定义" class="headerlink" title="表单定义"></a>表单定义</h2><p>推荐使用以下方式构建表单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Movie</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span> = <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Movie</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="comment">// 显示记录id</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;ID&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;director&#x27;</span>, <span class="string">&#x27;导演&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>(<span class="variable">$directors</span>);</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取当前模型数据"><a href="#获取当前模型数据" class="headerlink" title="获取当前模型数据"></a>获取当前模型数据</h3><p>在闭包内可以获取到当前模型的数据（编辑）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Movie</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="comment">// 显示记录id</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;ID&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取模型数据，如果&quot;status == 1&quot;则显示&quot;rate&quot;字段</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;status == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">number</span>(<span class="string">&#x27;rate&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;director&#x27;</span>, <span class="string">&#x27;导演&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>(<span class="variable">$directors</span>);</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h2 id="自定义工具"><a href="#自定义工具" class="headerlink" title="自定义工具"></a>自定义工具</h2><p>表单右上角默认有返回和跳转列表两个按钮工具, 可以使用下面的方式修改它:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tools</span>(function (Form\Tools <span class="variable">$tools</span>) &#123;</span><br><span class="line">    <span class="comment">// 去掉跳转列表按钮</span></span><br><span class="line">    <span class="variable">$tools</span>-&gt;<span class="title function_ invoke__">disableList</span>();</span><br><span class="line">    <span class="comment">// 去掉跳转详情页按钮</span></span><br><span class="line">    <span class="variable">$tools</span>-&gt;<span class="title function_ invoke__">disableView</span>();</span><br><span class="line">    <span class="comment">// 去掉删除按钮</span></span><br><span class="line">    <span class="variable">$tools</span>-&gt;<span class="title function_ invoke__">disableDelete</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加一个按钮, 参数可以是字符串, 匿名函数, 或者实现了Renderable或Htmlable接口的对象实例</span></span><br><span class="line">    <span class="variable">$tools</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="string">&#x27;&lt;a class=&quot;btn btn-sm btn-danger&quot;&gt;&lt;i class=&quot;fa fa-trash&quot;&gt;&lt;/i&gt;&amp;nbsp;&amp;nbsp;delete&lt;/a&gt;&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除整个工具栏内容</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableHeader</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以通过以下方式去除工具栏的默认按钮</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableListButton</span>();</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableViewButton</span>();</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableDeleteButton</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="自定义复杂工具按钮"><a href="#自定义复杂工具按钮" class="headerlink" title="自定义复杂工具按钮"></a>自定义复杂工具按钮</h3><p>请参考文档<a href="action-form.md">表单动作</a></p>
<h2 id="表单底部"><a href="#表单底部" class="headerlink" title="表单底部"></a>表单底部</h2><p>使用下面的方法去掉form底部的元素</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">footer</span>(function (<span class="variable">$footer</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 去掉`重置`按钮</span></span><br><span class="line">    <span class="variable">$footer</span>-&gt;<span class="title function_ invoke__">disableReset</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 去掉`提交`按钮</span></span><br><span class="line">    <span class="variable">$footer</span>-&gt;<span class="title function_ invoke__">disableSubmit</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 去掉`查看`checkbox</span></span><br><span class="line">    <span class="variable">$footer</span>-&gt;<span class="title function_ invoke__">disableViewCheck</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 去掉`继续编辑`checkbox</span></span><br><span class="line">    <span class="variable">$footer</span>-&gt;<span class="title function_ invoke__">disableEditingCheck</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 去掉`继续创建`checkbox</span></span><br><span class="line">    <span class="variable">$footer</span>-&gt;<span class="title function_ invoke__">disableCreatingCheck</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置`查看`默认选中</span></span><br><span class="line">	<span class="variable">$footer</span>-&gt;<span class="title function_ invoke__">defaultViewChecked</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置`继续编辑`默认选中</span></span><br><span class="line">	<span class="variable">$footer</span>-&gt;<span class="title function_ invoke__">defaultEditingChecked</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 设置`继续创建`默认选中</span></span><br><span class="line">	<span class="variable">$footer</span>-&gt;<span class="title function_ invoke__">defaultCreatingChecked</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除整个底部内容</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableFooter</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以通过以下方式去底部元素</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableSubmitButton</span>();</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableResetButton</span>();</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableViewCheck</span>();</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableEditingCheck</span>();</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableCreatingCheck</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置`查看`默认选中</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">defaultViewChecked</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置`继续编辑`默认选中</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">defaultEditingChecked</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置`继续创建`默认选中</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">defaultCreatingChecked</span>();</span><br></pre></td></tr></table></figure>

<p>自定义视图</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">footer</span>(function (<span class="variable">$footer</span>) &#123;</span><br><span class="line">    <span class="variable">$footer</span>-&gt;<span class="title function_ invoke__">view</span>(<span class="string">&#x27;...&#x27;</span>, [...]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><h3 id="表单布局"><a href="#表单布局" class="headerlink" title="表单布局"></a>表单布局</h3><p>请参考<a href="model-form-layout.md">表单布局</a></p>
<h3 id="返回字段验证出错信息-responseValidationMessages"><a href="#返回字段验证出错信息-responseValidationMessages" class="headerlink" title="返回字段验证出错信息 (responseValidationMessages)"></a>返回字段验证出错信息 (responseValidationMessages)</h3><p>通过<code>responseValidationMessages</code>方法可以很方便的返回字段验证出错信息，而不需要使用<code>Laravel validation</code>功能。</p>
<p>普通使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">form</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Model</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Form <span class="variable">$form</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (...) &#123; <span class="comment">// 验证逻辑</span></span><br><span class="line">			<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">responseValidationMessages</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;title格式错误&#x27;</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 如有多个错误信息，第二个参数可以传数组</span></span><br><span class="line">			<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">responseValidationMessages</span>(<span class="string">&#x27;content&#x27;</span>, [<span class="string">&#x27;content格式错误&#x27;</span>, <span class="string">&#x27;content不能为空&#x27;</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在事件中使用</p>
<blockquote>
<p>{tip} 此方法仅在<code>submitted</code>事件中可用</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">submitted</span>(function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">	<span class="comment">// 接收表单参数</span></span><br><span class="line">	<span class="variable">$title</span> = <span class="variable">$form</span>-&gt;title;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (...) &#123; <span class="comment">// 验证逻辑</span></span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">responseValidationMessages</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;title格式错误&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如有多个错误信息，第二个参数可以传数组</span></span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">responseValidationMessages</span>(<span class="string">&#x27;content&#x27;</span>, [<span class="string">&#x27;content格式错误&#x27;</span>, <span class="string">&#x27;content不能为空&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="移除提交按钮"><a href="#移除提交按钮" class="headerlink" title="移除提交按钮"></a>移除提交按钮</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去掉提交按钮</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableSubmitButton</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 去掉重置按钮</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableResetButton</span>();</span><br></pre></td></tr></table></figure>

<h3 id="忽略掉不需要保存的字段-ignore"><a href="#忽略掉不需要保存的字段-ignore" class="headerlink" title="忽略掉不需要保存的字段 (ignore)"></a>忽略掉不需要保存的字段 (ignore)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">ignore</span>([<span class="string">&#x27;column1&#x27;</span>, <span class="string">&#x27;column2&#x27;</span>, <span class="string">&#x27;column3&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消已忽略的字段</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">removeIgnoredFields</span>([<span class="string">&#x27;column1&#x27;</span>,]);</span><br></pre></td></tr></table></figure>

<h3 id="设置宽度-width"><a href="#设置宽度-width" class="headerlink" title="设置宽度 (width)"></a>设置宽度 (width)</h3><p>此处的宽度值是一个<code>1-12</code>之间的数字，第一个参数为 <code>field</code> 的宽，第二个参数为 <code>label</code> 的宽可省略</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">width</span>(<span class="number">10</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<h3 id="设置表单提交的action"><a href="#设置表单提交的action" class="headerlink" title="设置表单提交的action"></a>设置表单提交的action</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">action</span>(<span class="string">&#x27;auth/users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="判断是否是新增-isCreating"><a href="#判断是否是新增-isCreating" class="headerlink" title="判断是否是新增 (isCreating)"></a>判断是否是新增 (isCreating)</h3><p>新增页面和保存新增数据都可以用这个方法判断</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">isCreating</span>()) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="判断是否是编辑-isEditing"><a href="#判断是否是编辑-isEditing" class="headerlink" title="判断是否是编辑 (isEditing)"></a>判断是否是编辑 (isEditing)</h3><p>编辑页面和保存编辑数据都可以用这个方法判断</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">isEditing</span>()) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="判断是否是删除-isDeleting"><a href="#判断是否是删除-isDeleting" class="headerlink" title="判断是否是删除 (isDeleting)"></a>判断是否是删除 (isDeleting)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">isDeleting</span>()) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取ID-getKey"><a href="#获取ID-getKey" class="headerlink" title="获取ID (getKey)"></a>获取ID (getKey)</h3><p>新增页面无效，必须在闭包里面使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">User</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getKey</span>();</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取编辑数据-model"><a href="#获取编辑数据-model" class="headerlink" title="获取编辑数据 (model)"></a>获取编辑数据 (model)</h3><p>新增页面无效，必须在闭包里面使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">User</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">model</span>()-&gt;xxx;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="获取表单提交的数据-input"><a href="#获取表单提交的数据-input" class="headerlink" title="获取表单提交的数据 (input)"></a>获取表单提交的数据 (input)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">saving</span>(function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$form</span>-&gt;username;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 等同于</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="修改或删除表单提交的数据"><a href="#修改或删除表单提交的数据" class="headerlink" title="修改或删除表单提交的数据"></a>修改或删除表单提交的数据</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">saving</span>(function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="comment">// 修改</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;Marry&#x27;</span>);</span><br><span class="line">    <span class="comment">// 或</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;username = <span class="string">&#x27;Marry&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">deleteInput</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h3 id="获取最终保存的数据-updates"><a href="#获取最终保存的数据-updates" class="headerlink" title="获取最终保存的数据 (updates)"></a>获取最终保存的数据 (updates)</h3><p>此方法仅在<code>saved</code>回调有效。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">saved</span>(function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">updates</span>();</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a name="redirect"></a></p>
<h3 id="页面跳转-redirect"><a href="#页面跳转-redirect" class="headerlink" title="页面跳转 (redirect)"></a>页面跳转 (redirect)</h3><p>跳转到指定页面，此方法仅在<a href="model-form-callback.md">表单回调</a>事件内可用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跳转并提示成功信息</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">saved</span>(function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;保存成功&#x27;</span>)-&gt;<span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;auth/user&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳转并提示错误信息</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">saving</span>(function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;系统错误&#x27;</span>)-&gt;<span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;auth/user&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a name="confirm"></a></p>
<h3 id="显示确认弹窗-confirm"><a href="#显示确认弹窗-confirm" class="headerlink" title="显示确认弹窗 (confirm)"></a>显示确认弹窗 (confirm)</h3><p>点击表单提交按钮时弹出确认弹窗，如果是在普通数据表单中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">confirm</span>(<span class="string">&#x27;您确定要提交表单吗？&#x27;</span>, <span class="string">&#x27;content&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h3 id="设置外层容器-wrap"><a href="#设置外层容器-wrap" class="headerlink" title="设置外层容器 (wrap)"></a>设置外层容器 (wrap)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 更改表格外层容器</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">wrap</span>(function (Renderable <span class="variable">$view</span>) &#123;</span><br><span class="line">    <span class="variable">$tab</span> = <span class="title class_">Tab</span>::<span class="title function_ invoke__">make</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$tab</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;示例&#x27;</span>, <span class="variable">$view</span>);</span><br><span class="line">    <span class="variable">$tab</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;代码&#x27;</span>, <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">code</span>(), <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$tab</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a name="saving"></a></p>
<h3 id="修改待保存的表单输入值-saving"><a href="#修改待保存的表单输入值-saving" class="headerlink" title="修改待保存的表单输入值 (saving)"></a>修改待保存的表单输入值 (saving)</h3><p>通过<code>saving</code>方法可以更改待保存数据的格式。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">Helper</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">mutipleFile</span>(<span class="string">&#x27;files&#x27;</span>)-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$paths</span>) &#123;</span><br><span class="line">    <span class="variable">$paths</span> = <span class="title class_">Helper</span>::<span class="keyword">array</span>(<span class="variable">$paths</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取数据库当前行的其他字段</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 最终转化为json保存到数据库</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$paths</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a name="customFormat"></a></p>
<h3 id="修改表单数据显示-customFormat"><a href="#修改表单数据显示-customFormat" class="headerlink" title="修改表单数据显示 (customFormat)"></a>修改表单数据显示 (customFormat)</h3><p>通过<code>customFormat</code>方法可以改变从外部注入到表单的字段值。</p>
<p>如下例子中，<code>mutipleFile</code>字段要求待渲染的字段值为数组格式，我们可以通过<code>customFormat</code>方法把从数据库查出的字段值转化为<code>array</code>格式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">Helper</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">mutipleFile</span>(<span class="string">&#x27;files&#x27;</span>)-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$paths</span>) &#123;</span><br><span class="line">    <span class="variable">$paths</span> = <span class="title class_">Helper</span>::<span class="keyword">array</span>(<span class="variable">$paths</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$paths</span>);</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$paths</span>) &#123;</span><br><span class="line">	<span class="comment">// 获取数据库当前行的其他字段</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 转为数组</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Helper</span>::<span class="keyword">array</span>(<span class="variable">$paths</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form/" data-id="clpdpxfjk0018ywna07fqg8bn" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form-trans" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-trans/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.966Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单字段翻译"><a href="#表单字段翻译" class="headerlink" title="表单字段翻译"></a>表单字段翻译</h1><p>数据表单表单中所有使用到字段的地方都会自动读取语言包中的翻译。</p>
<blockquote>
<p>{tip} 语言包的详细使用方法请参考<a><a href="trans.md">多语言</a></a>。</p>
</blockquote>
<h3 id="语言包名称"><a href="#语言包名称" class="headerlink" title="语言包名称"></a>语言包名称</h3><p>语言包名称需要与控制器名相对应，假如控制器名<code>UserProfileController</code>，则对应的语言包为<code>resources/lang/&#123;当前语言&#125;/user-profile.php</code>（需要转化为小写中划线风格）。</p>
<p>如果想要更改语言包的名称，可以通过下面两种方式进行更改</p>
<p>方式1</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">AdminController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">AdminController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定翻译文件名称</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$translation</span> = <span class="string">&#x27;user1&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方式2</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">translation</span>(<span class="string">&#x27;user1&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>现在假设语言包<code>resources/lang/zh_CN/user-profile.php</code>内容如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="string">&#x27;fields&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>  =&gt; <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>   =&gt; <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;class&#x27;</span> =&gt; <span class="string">&#x27;班级&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>控制器<code>UserProfileController</code>中设置的<code>Form</code>字段会自动读取以上翻译：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不设置labael会自动读取语言包翻译</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;age&#x27;</span>);</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;class&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="公共翻译"><a href="#公共翻译" class="headerlink" title="公共翻译"></a>公共翻译</h3><p>当<code>admin_trans_field</code>函数找不到当前控制器中对指定字段的翻译时，会去<code>global.php</code>中查找。如果某些字段是很多数据表中都有的，可以把这些翻译写在<code>resources/lang/&#123;当前语言&#125;/global.php</code>文件中。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">// 常用的字段放在 global.php 中可以所有控制器共用。</span></span><br><span class="line">    <span class="string">&#x27;fields&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>         =&gt; <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;created_at&#x27;</span> =&gt; <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;updated_at&#x27;</span> =&gt; <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-trans/" data-id="clpdpxfjh0014ywna1h2rh7mi" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-navbar/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-tab/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-table/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-tooltip/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-js/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>