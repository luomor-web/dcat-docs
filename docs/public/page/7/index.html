<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/7/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2.x/model-form-upload" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-upload/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.966Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="图片-文件上传"><a href="#图片-文件上传" class="headerlink" title="图片&#x2F;文件上传"></a>图片&#x2F;文件上传</h1><p><a href="model-form.md">数据表单</a>通过以下的调用来生成图片&#x2F;文件上传表单，支持本地和云存储的文件上传。上传组件是基于<a target="_blank" rel="noopener" href="https://fex.baidu.com/webuploader/">webuploader</a>实现的，具体的使用配置可参考<a target="_blank" rel="noopener" href="https://fex.baidu.com/webuploader/document.html">webuploader官方文档</a>。</p>
<blockquote>
<p>{tip} 文件或图片上传表单字段请不要在模型中设置<strong>访问器</strong>和<strong>修改器</strong>拼接域名，如有相关需求可参考<a href="#withhost">文件&#x2F;图片域名拼接</a>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file_column&#x27;</span>);</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;image_column&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="local"></a></p>
<h2 id="本地上传"><a href="#本地上传" class="headerlink" title="本地上传"></a>本地上传</h2><p>先添加存储配置，<code>config/filesystems.php</code> 添加一项<code>disk</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&#x27;disks&#x27;</span> =&gt; [</span><br><span class="line">    ... ,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;local&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;root&#x27;</span> =&gt; <span class="title function_ invoke__">public_path</span>(<span class="string">&#x27;uploads&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;visibility&#x27;</span> =&gt; <span class="string">&#x27;public&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;url&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;APP_URL&#x27;</span>).<span class="string">&#x27;/uploads&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">],</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>设置上传的路径为<code>public/uploads</code>(public_path(‘uploads’))。</p>
<p>然后选择上传的<code>disk</code>，打开<code>config/admin.php</code>找到：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line"><span class="string">&#x27;upload&#x27;</span>  =&gt; [</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;disk&#x27;</span> =&gt; <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;directory&#x27;</span>  =&gt; [</span><br><span class="line">        <span class="string">&#x27;image&#x27;</span>  =&gt; <span class="string">&#x27;images&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file&#x27;</span>   =&gt; <span class="string">&#x27;files&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">],</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将<code>disk</code>设置为上面添加的<code>admin</code>，<code>directory.image</code>和<code>directory.file</code>分别为用<code>$form-&gt;image($column)</code>和<code>$form-&gt;file($column)</code>上传的图片和文件的上传目录。</p>
<p>当然你也可以在代码中指定<code>disk</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;your disk name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="oss"></a></p>
<h2 id="云盘上传"><a href="#云盘上传" class="headerlink" title="云盘上传"></a>云盘上传</h2><p>如果需要上传到云存储，需要安装对应<code>laravel storage</code>的适配器，拿七牛云存储举例</p>
<p>首先安装 <a target="_blank" rel="noopener" href="https://github.com/zgldh/qiniu-laravel-storage">zgldh&#x2F;qiniu-laravel-storage</a></p>
<p>同样配置好disk，在<code>config/filesystems.php</code> 添加一项:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;disks&#x27;</span> =&gt; [</span><br><span class="line">    ... ,</span><br><span class="line">    <span class="string">&#x27;qiniu&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;driver&#x27;</span>  =&gt; <span class="string">&#x27;qiniu&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;domains&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;default&#x27;</span>   =&gt; <span class="string">&#x27;xxxxx.com1.z0.glb.clouddn.com&#x27;</span>, <span class="comment">//你的七牛域名</span></span><br><span class="line">            <span class="string">&#x27;https&#x27;</span>     =&gt; <span class="string">&#x27;dn-yourdomain.qbox.me&#x27;</span>,         <span class="comment">//你的HTTPS域名</span></span><br><span class="line">            <span class="string">&#x27;custom&#x27;</span>    =&gt; <span class="string">&#x27;static.abc.com&#x27;</span>,                <span class="comment">//你的自定义域名</span></span><br><span class="line">         ],</span><br><span class="line">        <span class="string">&#x27;access_key&#x27;</span>=&gt; <span class="string">&#x27;&#x27;</span>,  <span class="comment">//AccessKey</span></span><br><span class="line">        <span class="string">&#x27;secret_key&#x27;</span>=&gt; <span class="string">&#x27;&#x27;</span>,  <span class="comment">//SecretKey</span></span><br><span class="line">        <span class="string">&#x27;bucket&#x27;</span>    =&gt; <span class="string">&#x27;&#x27;</span>,  <span class="comment">//Bucket名字</span></span><br><span class="line">        <span class="string">&#x27;notify_url&#x27;</span>=&gt; <span class="string">&#x27;&#x27;</span>,  <span class="comment">//持久化处理回调地址</span></span><br><span class="line">        <span class="string">&#x27;url&#x27;</span>       =&gt; <span class="string">&#x27;http://of8kfibjo.bkt.clouddn.com/&#x27;</span>,  <span class="comment">// 填写文件访问根url</span></span><br><span class="line">    ],</span><br><span class="line">],</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后修改<code>dcat-admin</code>的上传配置，打开<code>config/admin.php</code>找到：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&#x27;upload&#x27;</span>  =&gt; [</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;disk&#x27;</span> =&gt; <span class="string">&#x27;qiniu&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;directory&#x27;</span>  =&gt; [</span><br><span class="line">        <span class="string">&#x27;image&#x27;</span>  =&gt; <span class="string">&#x27;image&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file&#x27;</span>   =&gt; <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">],</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>disk</code>选择上面配置的<code>qiniu</code>，或：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;qiniu&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="public"></a></p>
<h2 id="公共方法"><a href="#公共方法" class="headerlink" title="公共方法"></a>公共方法</h2><h3 id="缩略图-thumbnail"><a href="#缩略图-thumbnail" class="headerlink" title="缩略图 (thumbnail)"></a>缩略图 (thumbnail)</h3><p>上传图片的同时生成缩略图</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">thumbnail</span>(<span class="string">&#x27;small&#x27;</span>, <span class="variable">$width</span> = <span class="number">300</span>, <span class="variable">$height</span> = <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成多张缩略图</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">thumbnail</span>([</span><br><span class="line">    <span class="string">&#x27;small1&#x27;</span> =&gt; [<span class="number">100</span>, <span class="number">100</span>],</span><br><span class="line">    <span class="string">&#x27;small2&#x27;</span> =&gt; [<span class="number">200</span>, <span class="number">200</span>],</span><br><span class="line">    <span class="string">&#x27;small3&#x27;</span> =&gt; [<span class="number">300</span>, <span class="number">300</span>],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">Resizable</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Photo</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Resizable</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// To access thumbnail</span></span><br><span class="line"><span class="variable">$photo</span>-&gt;<span class="title function_ invoke__">thumbnail</span>(<span class="string">&#x27;small&#x27;</span>, <span class="string">&#x27;photo_column&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="disk"></a></p>
<h3 id="存储驱动-disk"><a href="#存储驱动-disk" class="headerlink" title="存储驱动 (disk)"></a>存储驱动 (disk)</h3><p>修改文件上传源</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;your disk name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="move"></a></p>
<h3 id="上传路径-move"><a href="#上传路径-move" class="headerlink" title="上传路径 (move)"></a>上传路径 (move)</h3><p>修改上传路径</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">move</span>(<span class="string">&#x27;public/upload/image1/&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="name"></a></p>
<h3 id="文件名称-name"><a href="#文件名称-name" class="headerlink" title="文件名称 (name)"></a>文件名称 (name)</h3><p>修改上传文件名称</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;test.text&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;picture&#x27;</span>)-&gt;<span class="title function_ invoke__">name</span>(function (<span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;test.&#x27;</span>.<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">guessExtension</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a name="uniqueName"></a></p>
<h3 id="随机名称-uniqueName"><a href="#随机名称-uniqueName" class="headerlink" title="随机名称 (uniqueName)"></a>随机名称 (uniqueName)</h3><p>使用随机生成文件名 (md5(uniqid()).extension)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;picture&#x27;</span>)-&gt;<span class="title function_ invoke__">uniqueName</span>();</span><br></pre></td></tr></table></figure>

<p><a name="removable"></a></p>
<h3 id="禁止页面删除文件-替换上传"><a href="#禁止页面删除文件-替换上传" class="headerlink" title="禁止页面删除文件 (替换上传)"></a>禁止页面删除文件 (替换上传)</h3><p>通过<code>removable</code>方法可以禁止用户从页面点击删除服务器上的文件，可以实现图片覆盖上传效果。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">removable</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>


<p><a name="autoUpload"></a></p>
<h3 id="自动上传-autoUpload"><a href="#自动上传-autoUpload" class="headerlink" title="自动上传 (autoUpload)"></a>自动上传 (autoUpload)</h3><p>开启这个功能之后选择完文件之后会立即自动上传，页面将不再显示<code>上传</code>按钮，使用方法如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">autoUpload</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;img&#x27;</span>)-&gt;<span class="title function_ invoke__">autoUpload</span>();</span><br></pre></td></tr></table></figure>

<p><a name="retainable"></a></p>
<h3 id="禁止删除-retainable"><a href="#禁止删除-retainable" class="headerlink" title="禁止删除 (retainable)"></a>禁止删除 (retainable)</h3><p>开启这个功能之后文件将不会从服务器删除</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">retainable</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;img&#x27;</span>)-&gt;<span class="title function_ invoke__">retainable</span>();</span><br></pre></td></tr></table></figure>


<p><a name="storagePermission"></a></p>
<h3 id="storagePermission"><a href="#storagePermission" class="headerlink" title="storagePermission"></a>storagePermission</h3><p>设置上传文件的权限</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;picture&#x27;</span>)-&gt;<span class="title function_ invoke__">storagePermission</span>(<span class="number">777</span>);</span><br></pre></td></tr></table></figure>


<p><a name="accept"></a></p>
<h3 id="限制上传文件类型"><a href="#限制上传文件类型" class="headerlink" title="限制上传文件类型"></a>限制上传文件类型</h3><p>限制上传文件的类型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">accept</span>(<span class="string">&#x27;jpg,png,gif,jpeg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以指定 mimeTypes， 多个用逗号分割</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">accept</span>(<span class="string">&#x27;jpg,png,gif,jpeg&#x27;</span>, <span class="string">&#x27;image/*&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="chunked"></a></p>
<h3 id="分块上传-chunked"><a href="#分块上传-chunked" class="headerlink" title="分块上传 (chunked)"></a>分块上传 (chunked)</h3><p>启用分块上传</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">chunked</span>();</span><br></pre></td></tr></table></figure>

<p><a name="chunkSize"></a></p>
<h3 id="分块大小-chunkSize"><a href="#分块大小-chunkSize" class="headerlink" title="分块大小(chunkSize)"></a>分块大小(chunkSize)</h3><p>设置分块大小，单位为<code>KB</code>，默认<code>5MB</code></p>
<blockquote>
<p>{tip} 调用这个方法会自动启用分块上传</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置为 1MB</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">chunkSize</span>(<span class="number">1024</span>);</span><br></pre></td></tr></table></figure>

<p><a name="maxSize"></a></p>
<h3 id="文件大小-maxSize"><a href="#文件大小-maxSize" class="headerlink" title="文件大小(maxSize)"></a>文件大小(maxSize)</h3><p>设置单个文件最大大小，单位为<code>Kb</code>，默认大小为<code>10M</code>。</p>
<blockquote>
<p>{tip} 同时应该保证<code>php.ini</code>配置文件的<code>upload_max_filesize</code>参数值必须大于这个方法设置的值。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置单个文件最大为1Mb</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">maxSize</span>(<span class="number">1024</span>);</span><br></pre></td></tr></table></figure>

<p><a name="threads"></a></p>
<h3 id="并发上传线程数-threads"><a href="#并发上传线程数-threads" class="headerlink" title="并发上传线程数 (threads)"></a>并发上传线程数 (threads)</h3><p>设置并发上传线程数，默认<code>3</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">threads</span>(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<p><a name="url"></a></p>
<h3 id="自定义上传接口-url"><a href="#自定义上传接口-url" class="headerlink" title="自定义上传接口 (url)"></a>自定义上传接口 (url)</h3><p>通过<code>url</code>可以设置自定义上传接口</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">url</span>(<span class="string">&#x27;users/files&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>系统提供了<code>Dcat\Admin\Traits\HasUploadedFile</code>这个<code>trait</code>来帮助开发者更轻松地处理上传文件，用法如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">HasUploadedFile</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HasUploadedFile</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$disk</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;local&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 判断是否是删除文件请求</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isDeleteRequest</span>()) &#123;</span><br><span class="line">            <span class="comment">// 删除文件并响应</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">deleteFileAndResponse</span>(<span class="variable">$disk</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取上传的文件</span></span><br><span class="line">        <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">file</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取上传的字段名称</span></span><br><span class="line">        <span class="variable">$column</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">uploader</span>()-&gt;upload_column;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$dir</span> = <span class="string">&#x27;my-images&#x27;</span>;</span><br><span class="line">        <span class="variable">$newName</span> = <span class="variable">$column</span>.<span class="string">&#x27;-我的文件名称.&#x27;</span>.<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalExtension</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$disk</span>-&gt;<span class="title function_ invoke__">putFileAs</span>(<span class="variable">$dir</span>, <span class="variable">$file</span>, <span class="variable">$newName</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$path</span> = <span class="string">&quot;<span class="subst">&#123;$dir&#125;</span>/<span class="subst">$newName</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span></span><br><span class="line">            ? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">responseUploaded</span>(<span class="variable">$path</span>, <span class="variable">$disk</span>-&gt;<span class="title function_ invoke__">url</span>(<span class="variable">$path</span>))</span><br><span class="line">            : <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">responseErrorMessage</span>(<span class="string">&#x27;文件上传失败&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在你的路由文件<code>app\Admin\routes.php</code>中加上</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;<span class="title function_ invoke__">any</span>(<span class="string">&#x27;users/files&#x27;</span>, <span class="string">&#x27;FileController@handle&#x27;</span>);</span><br></pre></td></tr></table></figure>


<p><a name="deleteUrl"></a></p>
<h3 id="deleteUrl"><a href="#deleteUrl" class="headerlink" title="deleteUrl"></a>deleteUrl</h3><p>修改删除已上传文件路径，此方法一般不需要修改</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">deleteUrl</span>(<span class="string">&#x27;file/delete&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="autoSave"></a></p>
<h3 id="自动保存字段值-autoSave"><a href="#自动保存字段值-autoSave" class="headerlink" title="自动保存字段值 (autoSave)"></a>自动保存字段值 (autoSave)</h3><p>设置上传文件后是否自动保存文件路径到数据库，此方法默认启用，一般不需要修改</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">autoSave</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p><a name="options"></a></p>
<h3 id="配置-options"><a href="#配置-options" class="headerlink" title="配置 (options)"></a>配置 (options)</h3><p>自定义<a target="_blank" rel="noopener" href="https://fex.baidu.com/webuploader/document.html">webuploader</a>配置</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>([<span class="string">&#x27;disableGlobalDnd&#x27;</span> =&gt; <span class="literal">true</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="可排序-sortable"><a href="#可排序-sortable" class="headerlink" title="可排序 (sortable)"></a>可排序 (sortable)</h3><p>此方法仅针对多图&#x2F;文件上传表单有效</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleImage</span>(<span class="string">&#x27;images&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br></pre></td></tr></table></figure>


<h3 id="压缩图片-compress"><a href="#压缩图片-compress" class="headerlink" title="压缩图片 (compress)"></a>压缩图片 (compress)</h3><p>默认不启用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启用图片压缩功能</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleImage</span>(<span class="string">&#x27;images&#x27;</span>)-&gt;<span class="title function_ invoke__">compress</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;avatar&#x27;</span>)-&gt;<span class="title function_ invoke__">compress</span>([</span><br><span class="line">	<span class="string">&#x27;width&#x27;</span> =&gt; <span class="number">1600</span>,</span><br><span class="line">	<span class="string">&#x27;height&#x27;</span> =&gt; <span class="number">1600</span>,</span><br><span class="line"></span><br><span class="line">	// 图片质量，只有type为`image/jpeg`的时候才有效。</span><br><span class="line">	<span class="string">&#x27;quality&#x27;</span> =&gt; <span class="number">90</span>,</span><br><span class="line"></span><br><span class="line">	// 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为<span class="literal">false</span>.</span><br><span class="line">	<span class="string">&#x27;allowMagnify&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">	// 是否允许裁剪。</span><br><span class="line">	<span class="string">&#x27;crop&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">	// 是否保留头部meta信息。</span><br><span class="line">	<span class="string">&#x27;preserveHeaders&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">	// 如果发现压缩后文件大小比原来还大，则使用原来图片</span><br><span class="line">	// 此属性可能会影响图片自动纠正功能</span><br><span class="line">	<span class="string">&#x27;noCompressIfLarger&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">	// 单位字节，如果图片大小小于此值，不会采用压缩。</span><br><span class="line">	<span class="string">&#x27;compressSize&#x27;</span> =&gt; <span class="number">0</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="监听WebUploader文件上传事件-on"><a href="#监听WebUploader文件上传事件-on" class="headerlink" title="监听WebUploader文件上传事件 (on)"></a>监听WebUploader文件上传事件 (on)</h3><p>通过 <code>on</code> 方法可以监听 <a target="_blank" rel="noopener" href="http://fex.baidu.com/webuploader/doc/index.html#WebUploader_Uploader_events">WebUploader文件上传相关事件</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;...&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">on</span>(<span class="string">&#x27;startUpload&#x27;</span>, <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">		function () &#123;</span></span><br><span class="line"><span class="string">			console.log(&#x27;文件开始上传...&#x27;, this);</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">			// 上传文件前附加自定义参数到文件上传接口</span></span><br><span class="line"><span class="string">			this.uploader.options.formData[&#x27;custom_field&#x27;] = &#x27;...&#x27;;</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line">    )</span><br><span class="line">	-&gt;<span class="title function_ invoke__">on</span>(<span class="string">&#x27;uploadFinished&#x27;</span>, <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">    	function () &#123;</span></span><br><span class="line"><span class="string">    		console.log(&#x27;文件上传完毕&#x27;);</span></span><br><span class="line"><span class="string">    	&#125;</span></span><br><span class="line"><span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line">    );</span><br></pre></td></tr></table></figure>


<p><a name="withhost"></a></p>
<h3 id="文件-图片域名拼接"><a href="#文件-图片域名拼接" class="headerlink" title="文件&#x2F;图片域名拼接"></a>文件&#x2F;图片域名拼接</h3><p>文件或图片上传表单字段请不要在模型中设置<strong>访问器</strong>和<strong>修改器</strong>拼接域名，如果你需要在访问的时候拼接完整域名，可以在模型中定义一个<code>public</code>方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Str</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Storage</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YourModel</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 定义一个public方法访问图片或文件</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getImage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="title class_">Str</span>::<span class="title function_ invoke__">contains</span>(<span class="variable">$this</span>-&gt;image, <span class="string">&#x27;//&#x27;</span>)) &#123;</span><br><span class="line">		    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;image;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="title class_">Storage</span>::<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;admin&#x27;</span>)-&gt;<span class="title function_ invoke__">url</span>(<span class="variable">$this</span>-&gt;image);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="保存域名"><a href="#保存域名" class="headerlink" title="保存域名"></a>保存域名</h3><p>如果你需要保存文件域名到数据表，可以使用<code>saveFullUrl</code>方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;avatar&#x27;</span>)-&gt;<span class="title function_ invoke__">saveFullUrl</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;...&#x27;</span>)-&gt;<span class="title function_ invoke__">saveFullUrl</span>();</span><br></pre></td></tr></table></figure>

<h3 id="监听文件上传变动-change"><a href="#监听文件上传变动-change" class="headerlink" title="监听文件上传变动 (change)"></a>监听文件上传变动 (change)</h3><p>通过以下方法可以监听文件<strong>上传成功</strong>或文件<strong>被删除</strong>时产生的变动</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;...&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">script</span>(</span><br><span class="line">	<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">$(&#x27;<span class="subst">&#123;$file-&gt;getElementClassSelector()&#125;</span> .file-input&#x27;).on(&#x27;change&#x27;, function () &#123;</span></span><br><span class="line"><span class="string">	console.log(&#x27;文件发生变动&#x27;, this.value);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><a name="override"></a></p>
<h3 id="覆盖上传-override"><a href="#覆盖上传-override" class="headerlink" title="覆盖上传 (override)"></a>覆盖上传 (override)</h3><p>通过 <code>override</code> 方法可以实现文件覆盖上传。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">override</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;img&#x27;</span>)-&gt;<span class="title function_ invoke__">override</span>();</span><br></pre></td></tr></table></figure>


<p><a name="imagefun"></a></p>
<h2 id="图片上传内置方法"><a href="#图片上传内置方法" class="headerlink" title="图片上传内置方法"></a>图片上传内置方法</h2><p><a name="intervention"></a></p>
<h3 id="压缩、裁切、添加水印等"><a href="#压缩、裁切、添加水印等" class="headerlink" title="压缩、裁切、添加水印等"></a>压缩、裁切、添加水印等</h3><p>可以使用压缩、裁切、添加水印等各种方法,需要先安装<a target="_blank" rel="noopener" href="http://image.intervention.io/getting_started/installation">intervention&#x2F;image</a>.</p>
<p>更多使用方法请参考[<a target="_blank" rel="noopener" href="http://image.intervention.io/getting_started/introduction">Intervention</a>]：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改图片上传路径和文件名</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">move</span>(<span class="variable">$dir</span>, <span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 剪裁图片</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">crop</span>(<span class="keyword">int</span> <span class="variable">$width</span>, <span class="keyword">int</span> <span class="variable">$height</span>, [<span class="keyword">int</span> <span class="variable">$x</span>, <span class="keyword">int</span> <span class="variable">$y</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加水印</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">insert</span>(<span class="variable">$watermark</span>, <span class="string">&#x27;center&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="dimensions"></a></p>
<h3 id="限制上传图片的尺寸"><a href="#限制上传图片的尺寸" class="headerlink" title="限制上传图片的尺寸"></a>限制上传图片的尺寸</h3><p>设置文件上传尺寸限制</p>
<p>参数： <code>array</code> 单位为像素</p>
<ul>
<li><code>width</code> 指定宽度</li>
<li><code>height</code> 指定高度</li>
<li><code>min_width</code> 最小宽度</li>
<li><code>min_height</code> 最小高度</li>
<li><code>max_width</code> 最大宽度</li>
<li><code>max_height</code> 最大高度</li>
<li><code>ratio</code> 宽高比 (width&#x2F;height)</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上传宽度为100-300像素之间的图片</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;img&#x27;</span>)-&gt;<span class="title function_ invoke__">dimensions</span>([<span class="string">&#x27;min_width&#x27;</span> = <span class="number">100</span>, <span class="string">&#x27;max_width&#x27;</span> =&gt; <span class="number">300</span>]);</span><br></pre></td></tr></table></figure>
<p><a name="referer"></a></p>
<h2 id="把图片-文件路径保存在其他数据表"><a href="#把图片-文件路径保存在其他数据表" class="headerlink" title="把图片&#x2F;文件路径保存在其他数据表"></a>把图片&#x2F;文件路径保存在其他数据表</h2><p>通过下面的方法可以把图片或文件的路径保存在单独的附件表，而当前的图片&#x2F;文件字段只保存ID</p>
<blockquote>
<p>{tip} 这里的示例用的是单图上传表单，如果是多图的话可以按这个思路自行调整。</p>
</blockquote>
<p>图片&#x2F;文件表结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `images` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `path` <span class="type">varchar</span>(<span class="number">191</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>MyISAM AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;image1&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$value</span>) <span class="keyword">use</span> ($<span class="title">form</span>) &#123;</span><br><span class="line">        <span class="title">if</span> ($<span class="title">form</span>-&gt;<span class="title">isEditing</span>() &amp;&amp; ! $<span class="title">value</span>) &#123;</span><br><span class="line">            // 编辑页面，删除图片逻辑</span><br><span class="line">            <span class="title">Image</span>::<span class="title">destroy</span>($<span class="title">form</span>-&gt;<span class="title">model</span>()-&gt;<span class="title">image1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新增或编辑页面上传图片</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="variable">$model</span> = <span class="title class_">Image</span>::<span class="title function_ invoke__">where</span>(<span class="string">&#x27;path&#x27;</span>, <span class="variable">$value</span>)-&gt;<span class="title function_ invoke__">first</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$model</span>)) &#123;</span><br><span class="line">            <span class="variable">$model</span> = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$model</span>-&gt;path = <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$model</span>-&gt;<span class="title function_ invoke__">getKey</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="variable">$v</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Image</span>::<span class="title function_ invoke__">find</span>((<span class="keyword">array</span>) <span class="variable">$v</span>)-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;path&#x27;</span>)-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>


<h2 id="文件上传失败或无法访问？"><a href="#文件上传失败或无法访问？" class="headerlink" title="文件上传失败或无法访问？"></a>文件上传失败或无法访问？</h2><p>如果你发现无法上传文件，那么通常有几下几点原因：</p>
<ol>
<li><code>Laravel</code>文件上传配置不正确，请检查<code>admin.upload.disk</code>参数。如果你不了解<code>laravel</code>文件上传功能，请阅读文档<a target="_blank" rel="noopener" href="https://learnku.com/docs/laravel/7.x/filesystem/7485">Laravel - 文件存储</a></li>
<li>文件过大，需要调整<code>php.ini</code>的<code>upload_max_filesize</code>参数</li>
<li>文件上传目录没有写权限</li>
<li><code>php</code>没有安装或没有开启<code>fileinfo</code>扩展</li>
</ol>
<p>如果你的文件上传成功了，却无法正常访问，那么可能是<code>.env</code>配置文件中的<code>APP_URL</code>参数没有设置正确。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-upload/" data-id="clpdpxfjh0015ywnagckq3vfd" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form-layout" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-layout/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.965Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单布局"><a href="#表单布局" class="headerlink" title="表单布局"></a>表单布局</h1><h3 id="多列布局-column"><a href="#多列布局-column" class="headerlink" title="多列布局 (column)"></a>多列布局 (column)</h3><a href="/assets/img/screenshots/form-column.png" target="_blank">
    <img class="img" src="/assets/img/screenshots/form-column.png" />
</a>   

<p>类似于上图的左右两列布局方式，可以参考下面的代码来实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一列占据1/2的页面宽度</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="number">6</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="string">&#x27;born&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;education&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>([...])-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;nation&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;native&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;job&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;code&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;phone&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;work&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;census&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二列占据1/2的页面宽度</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="number">6</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;avatar&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">decimal</span>(<span class="string">&#x27;wages&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">decimal</span>(<span class="string">&#x27;fund&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">decimal</span>(<span class="string">&#x27;pension&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">decimal</span>(<span class="string">&#x27;fee&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">decimal</span>(<span class="string">&#x27;business&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">decimal</span>(<span class="string">&#x27;other&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;area&#x27;</span>)-&gt;<span class="keyword">default</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="string">&#x27;illness&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="string">&#x27;comment&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调整所有表单的宽度</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">width</span>(<span class="number">9</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>以上布局功能使用了<code>bootstrap</code>的栅格布局系统，所有列的宽度总和不得超出<code>12</code>，并且也支持在<code>hasMany</code>和<code>array</code>表单中使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">hasMany</span>(<span class="string">&#x27;jobs&#x27;</span>, function (<span class="variable">$form</span>) &#123;</span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="number">6</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">         <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">         <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="string">&#x27;born&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">     &#125;);</span><br><span class="line">     </span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="number">6</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">         <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;avatar&#x27;</span>);</span><br><span class="line">         <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">decimal</span>(<span class="string">&#x27;wages&#x27;</span>);</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>




<h3 id="多行布局-row"><a href="#多行布局-row" class="headerlink" title="多行布局 (row)"></a>多行布局 (row)</h3><p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">row</span>(function (Form\Row <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">width</span>(<span class="number">4</span>)-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;username&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">	<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">width</span>(<span class="number">3</span>)-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">	...</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">row</span>(function (Form\Row <span class="variable">$form</span>) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>效果<br><a href="/assets/img/screenshots/form-rows.png" target="_blank"><br>    <img class="img img-full" src="/assets/img/screenshots/form-rows.png"><br></a></p>
<p>并且也支持在<code>hasMany</code>和<code>array</code>表单中使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">hasMany</span>(<span class="string">&#x27;jobs&#x27;</span>, function (<span class="variable">$form</span>) &#123;</span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">row</span>(function (Form\Row <span class="variable">$form</span>) &#123;</span><br><span class="line">     	...</span><br><span class="line">     &#125;);</span><br><span class="line">     </span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">row</span>(function (Form\Row <span class="variable">$form</span>) &#123;</span><br><span class="line">     	...</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><a name="tab"></a></p>
<h3 id="选项卡表单-tab"><a href="#选项卡表单-tab" class="headerlink" title="选项卡表单 (tab)"></a>选项卡表单 (tab)</h3><p>如果表单元素太多,会导致表单页面太长, 这种情况下可以使用<code>tab</code>方法来分隔表单:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tab</span>(<span class="string">&#x27;Basic info&#x27;</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">email</span>(<span class="string">&#x27;email&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">tab</span>(<span class="string">&#x27;Profile&#x27;</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">                       </span><br><span class="line">   <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;avatar&#x27;</span>);</span><br><span class="line">   <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;address&#x27;</span>);</span><br><span class="line">   <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">mobile</span>(<span class="string">&#x27;phone&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">tab</span>(<span class="string">&#x27;Jobs&#x27;</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">                         </span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">hasMany</span>(<span class="string">&#x27;jobs&#x27;</span>, function (<span class="variable">$form</span>) &#123;</span><br><span class="line">         <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;company&#x27;</span>);</span><br><span class="line">         <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="string">&#x27;start_date&#x27;</span>);</span><br><span class="line">         <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="string">&#x27;end_date&#x27;</span>);</span><br><span class="line">     &#125;);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>同时，<code>tab</code> 布局中也允许嵌套使用<code>column</code>和<code>row</code>布局</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tab</span>(<span class="string">&#x27;Basic info&#x27;</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="number">6</span>, function (Form\BlockForm <span class="variable">$form</span>) &#123;</span><br><span class="line">		<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">		<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="number">6</span>, function (Form\BlockForm <span class="variable">$form</span>) &#123;</span><br><span class="line">		<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>设置默认显示的 <code>Tab</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认显示标题为 标题2 的 Tab</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getTab</span>()-&gt;<span class="title function_ invoke__">active</span>(<span class="string">&#x27;标题2&#x27;</span>);</span><br><span class="line"><span class="comment">// 也可以指定偏移量</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getTab</span>()-&gt;<span class="title function_ invoke__">activeByIndex</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tab</span>(<span class="string">&#x27;标题1&#x27;</span>, function (<span class="variable">$form</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tab</span>(<span class="string">&#x27;标题2&#x27;</span>, function (<span class="variable">$form</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h4 id="Fieldset布局"><a href="#Fieldset布局" class="headerlink" title="Fieldset布局"></a>Fieldset布局</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">fieldset</span>(<span class="string">&#x27;分组&#x27;</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;company&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="string">&#x27;start_date&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="string">&#x27;end_date&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果想要默认收起</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">fieldset</span>(<span class="string">&#x27;分组&#x27;</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">collapsed</span>();</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src="https://cdn.learnku.com/uploads/images/202005/12/38389/B0tXWUxHDp.png!large"></p>
<h3 id="分块布局-block"><a href="#分块布局-block" class="headerlink" title="分块布局 (block)"></a>分块布局 (block)</h3><p>如果你的表单中字段非常多，那么可以通过以下方式让你的表单分块布局，并且允许嵌套使用<code>column</code>和<code>row</code>布局</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">block</span>(<span class="number">8</span>, function (Form\BlockForm <span class="variable">$form</span>) &#123;</span><br><span class="line">	<span class="comment">// 设置标题</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;基本设置&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 显示底部提交按钮</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">showFooter</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置字段宽度</span></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">width</span>(<span class="number">9</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="number">6</span>, function (Form\BlockForm <span class="variable">$form</span>) &#123;</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">email</span>(<span class="string">&#x27;email&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;avatar&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="number">6</span>, function (Form\BlockForm <span class="variable">$form</span>) &#123;</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">email</span>(<span class="string">&#x27;mobile&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="string">&#x27;description&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">block</span>(<span class="number">4</span>, function (Form\BlockForm <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;分块2&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;nickname&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">number</span>(<span class="string">&#x27;age&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">radio</span>(<span class="string">&#x27;status&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>([<span class="string">&#x27;1&#x27;</span> =&gt; <span class="string">&#x27;默认&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;冻结&#x27;</span>])-&gt;<span class="keyword">default</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">next</span>(function (Form\BlockForm <span class="variable">$form</span>) &#123;</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;分块3&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="string">&#x27;birthday&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="string">&#x27;created_at&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果<br><a href="https://cdn.learnku.com/uploads/images/202010/19/38389/AMCtHBcmSQ.jpg!large" target="_blank"><br>    <img class="img img-full" src="https://cdn.learnku.com/uploads/images/202010/19/38389/AMCtHBcmSQ.jpg!large"><br></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-layout/" data-id="clpdpxfje0011ywnaabmu4f4q" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form-modal" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-modal/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.965Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单弹窗"><a href="#表单弹窗" class="headerlink" title="表单弹窗"></a>表单弹窗</h1><h2 id="数据表单弹窗"><a href="#数据表单弹窗" class="headerlink" title="数据表单弹窗"></a>数据表单弹窗</h2><p>通过<code>Form::dialog</code>方法可以快速构建一个基于数据表单的表单弹窗，仅需增加数行代码。</p>
<blockquote>
<p>{tip} 表单弹窗的实现原理是：通过<code>create</code>和<code>edit</code>页面获取构建好的表单<code>HTML</code>字符，然后使用弹窗插件把这部分<code>HTML</code>字符渲染出来。<br>如果期间需要加载新的<code>js</code>脚本，则会等待脚本加载完毕再执行表单初始化<code>js</code>代码。</p>
</blockquote>
<h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><h4 id="开启表单弹窗"><a href="#开启表单弹窗" class="headerlink" title="开启表单弹窗"></a>开启表单弹窗</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Layout</span>\<span class="title">Content</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModalFormController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Content <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$content</span></span><br><span class="line">            -&gt;<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Modal Form&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">body</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">build</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">build</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;新增角色&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;.create-form&#x27;</span>) <span class="comment">// 绑定点击按钮</span></span><br><span class="line">            -&gt;<span class="title function_ invoke__">url</span>(<span class="string">&#x27;auth/roles/create&#x27;</span>) <span class="comment">// 表单页面链接，此参数会被按钮中的 “data-url” 属性替换。。</span></span><br><span class="line">            -&gt;<span class="title function_ invoke__">width</span>(<span class="string">&#x27;700px&#x27;</span>) <span class="comment">// 指定弹窗宽度，可填写百分比，默认 720px</span></span><br><span class="line">            -&gt;<span class="title function_ invoke__">height</span>(<span class="string">&#x27;650px&#x27;</span>) <span class="comment">// 指定弹窗高度，可填写百分比，默认 690px</span></span><br><span class="line">            -&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;Dcat.reload()&#x27;</span>); <span class="comment">// 新增成功后刷新页面</span></span><br><span class="line"></span><br><span class="line">        <span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;编辑角色&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;.edit-form&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;Dcat.reload()&#x27;</span>); <span class="comment">// 编辑成功后刷新页面</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当需要在同个“class”的按钮中绑定不同的链接时，把链接放到按钮的“data-url”属性中即可</span></span><br><span class="line">        <span class="variable">$editPage</span> = <span class="title function_ invoke__">admin_base_path</span>(<span class="string">&#x27;auth/roles/1/edit&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">&lt;div style=&#x27;padding:30px 0&#x27;&gt;</span></span><br><span class="line"><span class="string">    &lt;span class=&#x27;btn btn-success create-form&#x27;&gt; 新增表单弹窗 &lt;/span&gt; &amp;nbsp;&amp;nbsp;</span></span><br><span class="line"><span class="string">    &lt;span class=&#x27;btn btn-blue edit-form&#x27; data-url=&#x27;<span class="subst">&#123;$editPage&#125;</span>&#x27;&gt; 编辑表单弹窗 &lt;/span&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="表单构建以及保存数据"><a href="#表单构建以及保存数据" class="headerlink" title="表单构建以及保存数据"></a>表单构建以及保存数据</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Role</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Controllers</span>\<span class="title">HasResourceActions</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Layout</span>\<span class="title">Content</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoleController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HasResourceActions</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Edit interface.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> mixed   $id</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> Content $content</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> Content</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span>(<span class="params"><span class="variable">$id</span>, Content <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$content</span></span><br><span class="line">                -&gt;<span class="title function_ invoke__">header</span>(<span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.roles&#x27;</span>))</span><br><span class="line">                -&gt;<span class="title function_ invoke__">description</span>(<span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.edit&#x27;</span>))</span><br><span class="line">                -&gt;<span class="title function_ invoke__">body</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">form</span>()-&gt;<span class="title function_ invoke__">edit</span>(<span class="variable">$id</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Create interface.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> Content $content</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> Content</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">Content <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$content</span></span><br><span class="line">                -&gt;<span class="title function_ invoke__">header</span>(<span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.roles&#x27;</span>))</span><br><span class="line">                -&gt;<span class="title function_ invoke__">description</span>(<span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.create&#x27;</span>))</span><br><span class="line">                -&gt;<span class="title function_ invoke__">body</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">form</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Make a form builder.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Form</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">form</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Role</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Form <span class="variable">$form</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;ID&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;slug&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.slug&#x27;</span>))-&gt;<span class="title function_ invoke__">required</span>()-&gt;<span class="title function_ invoke__">prepareForSave</span>(function (<span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.name&#x27;</span>))-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    </span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tree</span>(<span class="string">&#x27;permissions&#x27;</span>)</span><br><span class="line">                -&gt;<span class="title function_ invoke__">nodes</span>(function () &#123;</span><br><span class="line">                    <span class="variable">$permissionModel</span> = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;admin.database.permissions_model&#x27;</span>);</span><br><span class="line">                    <span class="variable">$permissionModel</span> = <span class="keyword">new</span> <span class="variable">$permissionModel</span>;</span><br><span class="line">    </span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$permissionModel</span>-&gt;<span class="title function_ invoke__">allNodes</span>();</span><br><span class="line">                &#125;)</span><br><span class="line">                -&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="variable">$v</span>) <span class="keyword">return</span> [];</span><br><span class="line">    </span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_ invoke__">array_column</span>(<span class="variable">$v</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">    </span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;created_at&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.created_at&#x27;</span>));</span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;updated_at&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.updated_at&#x27;</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><a href="/assets/img/screenshots/form-modal.png" target="_blank">
    <img style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="100%" src="/assets/img/screenshots/form-modal.png">
</a>

<h3 id="功能接口"><a href="#功能接口" class="headerlink" title="功能接口"></a>功能接口</h3><p>表单弹窗必须绑定一个可点击的页面元素，通过点击这个元素弹出弹窗。</p>
<h4 id="设置弹窗标题"><a href="#设置弹窗标题" class="headerlink" title="设置弹窗标题"></a>设置弹窗标题</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$modal</span> = <span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;标题&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="绑定点击按钮"><a href="#绑定点击按钮" class="headerlink" title="绑定点击按钮"></a>绑定点击按钮</h4><p>通过<code>ModalForm::click</code>方法可以绑定点击按钮，绑定后当点击该按钮时会弹出弹窗</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;标题&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;#click-button&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="设置URL"><a href="#设置URL" class="headerlink" title="设置URL"></a>设置URL</h4><p>如果是创建类型的表单，则可以通过以下方法设置获取表单模板的url</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;新增角色&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;.create-form&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">url</span>(<span class="string">&#x27;auth/roles/create&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>如果是编辑类型的表单，则需要多个url，因为点击每个按钮弹出弹窗的表单内容是不同的，所以每个按钮的链接也不同。</p>
<p>这个时候通过<code>ModalForm::url</code>方法设置的一个链接已经无法满足需求了，因而需要在点击按钮的<code>data-url</code>属性上保存url：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;编辑角色&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;.edit-form&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;Dcat.reload()&#x27;</span>); <span class="comment">// 编辑成功后刷新页面</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当需要在同个“class”的按钮中绑定不同的链接时，把链接放到按钮的“data-url”属性中即可</span></span><br><span class="line">    <span class="variable">$editPage1</span> = <span class="title function_ invoke__">admin_base_path</span>(<span class="string">&#x27;auth/roles/1/edit&#x27;</span>);</span><br><span class="line">    <span class="variable">$editPage2</span> = <span class="title function_ invoke__">admin_base_path</span>(<span class="string">&#x27;auth/roles/2/edit&#x27;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">&lt;div style=&#x27;padding:30px 0&#x27;&gt;</span></span><br><span class="line"><span class="string">    &lt;span class=&#x27;btn btn-blue edit-form&#x27; data-url=&#x27;<span class="subst">&#123;$editPage1&#125;</span>&#x27;&gt; 编辑表单弹窗1 &lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;span class=&#x27;btn btn-blue edit-form&#x27; data-url=&#x27;<span class="subst">&#123;$editPage2&#125;</span>&#x27;&gt; 编辑表单弹窗2 &lt;/span&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="表单保存成功回调"><a href="#表单保存成功回调" class="headerlink" title="表单保存成功回调"></a>表单保存成功回调</h4><p>通过<code>success</code>方法可以设置表单保存成功之后执行的<code>js</code>代码，在这段<code>js</code>代码作用域内有一个<code>response</code>变量，通过这个变量可以获取服务端返回的<code>json</code>数据。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;编辑角色&#x27;</span>)</span><br><span class="line">   -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;.edit-form&#x27;</span>)</span><br><span class="line">   -&gt;<span class="title function_ invoke__">success</span>(</span><br><span class="line">       <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">// 打印服务端响应数据             </span></span><br><span class="line"><span class="string">console.log(response);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 提示成功信息</span></span><br><span class="line"><span class="string">Dcat.success(response.message || &#x27;保存成功&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 保存成功之后刷新页面</span></span><br><span class="line"><span class="string">Dcat.reload();</span></span><br><span class="line"><span class="string">JS</span>        </span><br><span class="line">   );</span><br></pre></td></tr></table></figure>

<h4 id="表单保存失败回调"><a href="#表单保存失败回调" class="headerlink" title="表单保存失败回调"></a>表单保存失败回调</h4><p>通过<code>error</code>方法可以设置表单保存失败之后执行的<code>js</code>代码，在这段<code>js</code>代码作用域内有一个<code>response</code>变量，通过这个变量可以获取服务端返回的<code>json</code>数据。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;编辑角色&#x27;</span>)</span><br><span class="line">   -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;.edit-form&#x27;</span>)</span><br><span class="line">   -&gt;<span class="title function_ invoke__">error</span>(</span><br><span class="line">       <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">// 打印服务端响应数据       </span></span><br><span class="line"><span class="string">console.log(response);</span></span><br><span class="line"><span class="string">JS</span>        </span><br><span class="line">   );</span><br></pre></td></tr></table></figure>

<h4 id="表单保存之后回调"><a href="#表单保存之后回调" class="headerlink" title="表单保存之后回调"></a>表单保存之后回调</h4><p>通过<code>saved</code>方法可以设置表单保存之后执行的<code>js</code>代码，在这段<code>js</code>代码作用域内有两个<code>js</code>变量：</p>
<ul>
<li><code>success</code> 值为真表示保存成功，否则失败</li>
<li><code>response</code> 服务端返回的<code>json</code>数据</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;编辑角色&#x27;</span>)</span><br><span class="line">   -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;.edit-form&#x27;</span>)</span><br><span class="line">   -&gt;<span class="title function_ invoke__">saved</span>(</span><br><span class="line">       <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">// 打印服务端响应数据       </span></span><br><span class="line"><span class="string">console.log(response);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if (success) &#123;</span></span><br><span class="line"><span class="string">    console.log(&#x27;保存成功&#x27;);</span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">    console.log(&#x27;保存失败&#x27;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">JS</span>        </span><br><span class="line">   );</span><br></pre></td></tr></table></figure>

<h4 id="强制刷新"><a href="#强制刷新" class="headerlink" title="强制刷新"></a>强制刷新</h4><p>每次点击按钮都重新从服务端拉取新的模板数据</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;编辑角色&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;.edit-form&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">forceRefresh</span>();</span><br></pre></td></tr></table></figure>

<h4 id="设置弹窗宽高"><a href="#设置弹窗宽高" class="headerlink" title="设置弹窗宽高"></a>设置弹窗宽高</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;编辑角色&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;.edit-form&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">dimensions</span>(<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;400px&#x27;</span>);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">dialog</span>(<span class="string">&#x27;编辑角色&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">click</span>(<span class="string">&#x27;.edit-form&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">width</span>(<span class="string">&#x27;50%&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">height</span>(<span class="string">&#x27;400px&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h2 id="工具表单弹窗"><a href="#工具表单弹窗" class="headerlink" title="工具表单弹窗"></a>工具表单弹窗</h2><p>数据表单的弹窗功能通常需要结合一个资源控制器去实现，相对会比较复杂一点，所以系统也内置了另外一种更简便的表单弹窗功能，使用方法请参考<a href="widgets-form.md#modal">工具表单-弹窗</a>。</p>
<a href="/assets/img/screenshots/modal-widget-form.png" target="_blank">
    <img class="img img-full" src="/assets/img/screenshots/modal-widget-form.png">
</a>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-modal/" data-id="clpdpxfjf0012ywnafshr7f54" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form-step" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-step/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.965Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="分步表单"><a href="#分步表单" class="headerlink" title="分步表单"></a>分步表单</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>前往<a target="_blank" rel="noopener" href="https://github.com/dcat-admin/form-step">https://github.com/dcat-admin/form-step</a>下载分步表单扩展，然后安装并启用。</p>
<blockquote>
<p>{tip} 扩展安装请参考文档<a href="extension-f.md">扩展基本使用</a>章节。</p>
</blockquote>
<h2 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">form</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Model</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Form <span class="variable">$form</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;分步表单&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">action</span>(<span class="string">&#x27;step&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableListButton</span>();</span><br><span class="line">    </span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()</span><br><span class="line">            -&gt;<span class="title function_ invoke__">remember</span>() <span class="comment">// 记住表单步骤，默认不开启</span></span><br><span class="line">            -&gt;<span class="title function_ invoke__">width</span>(<span class="string">&#x27;950px&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;基本信息&#x27;</span>, function (<span class="variable">$step</span>) &#123;</span><br><span class="line">                <span class="variable">$info</span> = <span class="string">&#x27;&lt;i class=&quot;fa fa-exclamation-circle&quot;&gt;&lt;/i&gt; 表单字段支持前端验证和后端验证混用，前端验证支持H5表单验证以及自定义验证。&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">html</span>(<span class="title class_">Alert</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$info</span>)-&gt;<span class="title function_ invoke__">info</span>());</span><br><span class="line">    </span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;姓名&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>()-&gt;<span class="title function_ invoke__">maxLength</span>(<span class="number">20</span>);</span><br><span class="line">                <span class="comment">// h5 表单验证</span></span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;年龄&#x27;</span>)</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">required</span>()</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">type</span>(<span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">attribute</span>(<span class="string">&#x27;max&#x27;</span>, <span class="number">150</span>)</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;前端验证&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">radio</span>(<span class="string">&#x27;sex&#x27;</span>, <span class="string">&#x27;性别&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>([<span class="string">&#x27;未知&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>])-&gt;<span class="keyword">default</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">                <span class="comment">// 后端验证</span></span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;birthplace&#x27;</span>, <span class="string">&#x27;籍贯&#x27;</span>)</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required&#x27;</span>)</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;演示后端字段验证&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">url</span>(<span class="string">&#x27;homepage&#x27;</span>, <span class="string">&#x27;个人主页&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="string">&#x27;description&#x27;</span>, <span class="string">&#x27;简介&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;兴趣爱好&#x27;</span>, function (<span class="variable">$step</span>) &#123;</span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">tags</span>(<span class="string">&#x27;hobbies&#x27;</span>, <span class="string">&#x27;爱好&#x27;</span>)</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">options</span>([<span class="string">&#x27;唱&#x27;</span>, <span class="string">&#x27;跳&#x27;</span>, <span class="string">&#x27;RAP&#x27;</span>, <span class="string">&#x27;踢足球&#x27;</span>])</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line">    </span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;books&#x27;</span>, <span class="string">&#x27;书籍&#x27;</span>);</span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;music&#x27;</span>, <span class="string">&#x27;音乐&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">                <span class="comment">// 事件</span></span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">shown</span>(function () &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">    Dcat.info(&#x27;兴趣爱好&#x27;);</span></span><br><span class="line"><span class="string">    console.log(&#x27;兴趣爱好&#x27;, args);</span></span><br><span class="line"><span class="string">    JS</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">    </span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;地址&#x27;</span>, function (<span class="variable">$step</span>) &#123;</span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;address&#x27;</span>, <span class="string">&#x27;街道地址&#x27;</span>);</span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;post_code&#x27;</span>, <span class="string">&#x27;邮政编码&#x27;</span>);</span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">tel</span>(<span class="string">&#x27;tel&#x27;</span>, <span class="string">&#x27; 联系电话&#x27;</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">done</span>(function () <span class="keyword">use</span> ($<span class="title">form</span>) &#123;</span><br><span class="line">                $<span class="title">resource</span> = $<span class="title">form</span>-&gt;<span class="title">getResource</span>(0);</span><br><span class="line">    </span><br><span class="line">                <span class="variable">$data</span> = [</span><br><span class="line">                    <span class="string">&#x27;title&#x27;</span>       =&gt; <span class="string">&#x27;操作成功&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;description&#x27;</span> =&gt; <span class="string">&#x27;恭喜您成为第10086位用户&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;createUrl&#x27;</span>   =&gt; <span class="variable">$resource</span>,</span><br><span class="line">                    <span class="string">&#x27;backUrl&#x27;</span>     =&gt; <span class="variable">$resource</span>,</span><br><span class="line">                ];</span><br><span class="line">    </span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;admin::form.done-step&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<a href="/assets/img/screenshots/step-form-1.png" target="_blank">
    <img style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="100%" src="/assets/img/screenshots/step-form-1.png">
</a>

<h2 id="运行逻辑"><a href="#运行逻辑" class="headerlink" title="运行逻辑"></a>运行逻辑</h2><p>分步表单的使用很简单，运行逻辑也与普通表单没有太大区别，下面简单说说分步表单的运行逻辑。</p>
<blockquote>
<p>{tip} 分步表单没有 <code>update</code> 的概念。</p>
</blockquote>
<h4 id="参数验证"><a href="#参数验证" class="headerlink" title="参数验证"></a>参数验证</h4><p>当用户点击 <code>下一步</code> 时，会向后端发起请求验证参数是否正确，如果参数不符合要求则显示错误信息，验证通过才会进入下一个步骤。</p>
<h4 id="表单提交"><a href="#表单提交" class="headerlink" title="表单提交"></a>表单提交</h4><p>当进行到最后一步时，会对所有步骤的表单参数一起提交到后端并进行验证，如果参数不符合要求则显示错误信息，验证通过则保存表单数据，保存的方法与普通表单完全一致。</p>
<blockquote>
<p>{tip} 最后保存表单的方法是 <code>Form::store</code>。</p>
</blockquote>
<h4 id="完成页面"><a href="#完成页面" class="headerlink" title="完成页面"></a>完成页面</h4><p>表单保存完成之后会显示完成页面，此步骤无法忽略。</p>
<h2 id="编辑表单"><a href="#编辑表单" class="headerlink" title="编辑表单"></a>编辑表单</h2><p>分步表单默认是没有编辑功能的，用户输入了长步骤的表单之后不需要再分步编辑，因此如果需要对分步表单进行编辑，可以参考以下方式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">form</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">MyRepository</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Form <span class="variable">$form</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 判断是否是编辑页面</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$form</span>-&gt;<span class="title function_ invoke__">isEditing</span>()) &#123;</span><br><span class="line">            <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;年龄&#x27;</span>)</span><br><span class="line">                 -&gt;<span class="title function_ invoke__">required</span>()</span><br><span class="line">                 -&gt;<span class="title function_ invoke__">type</span>(<span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">                 -&gt;<span class="title function_ invoke__">attribute</span>(<span class="string">&#x27;max&#x27;</span>, <span class="number">150</span>)</span><br><span class="line">                 -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;前端验证&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">            ...</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()</span><br><span class="line">            -&gt;<span class="title function_ invoke__">remember</span>()</span><br><span class="line">            -&gt;<span class="title function_ invoke__">width</span>(<span class="string">&#x27;950px&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;基本信息&#x27;</span>, function (Form\StepForm <span class="variable">$step</span>) &#123;</span><br><span class="line">                <span class="variable">$info</span> = <span class="string">&#x27;&lt;i class=&quot;fa fa-exclamation-circle&quot;&gt;&lt;/i&gt; 表单字段支持前端验证和后端验证混用，前端验证支持H5表单验证以及自定义验证。&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">html</span>(<span class="title class_">Alert</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$info</span>)-&gt;<span class="title function_ invoke__">info</span>());</span><br><span class="line">    </span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;姓名&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>()-&gt;<span class="title function_ invoke__">maxLength</span>(<span class="number">20</span>);</span><br><span class="line">                <span class="comment">// h5 表单验证</span></span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;年龄&#x27;</span>)</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">required</span>()</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">type</span>(<span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">attribute</span>(<span class="string">&#x27;max&#x27;</span>, <span class="number">150</span>)</span><br><span class="line">                    -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;前端验证&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">                <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">radio</span>(<span class="string">&#x27;sex&#x27;</span>, <span class="string">&#x27;性别&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>([<span class="string">&#x27;未知&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>])-&gt;<span class="keyword">default</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">                ...</span><br><span class="line">    </span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;兴趣爱好&#x27;</span>, function (Form\StepForm <span class="variable">$step</span>) &#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">done</span>(function () <span class="keyword">use</span> ($<span class="title">form</span>) &#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="功能接口"><a href="#功能接口" class="headerlink" title="功能接口"></a>功能接口</h2><h3 id="设置容器最大宽度"><a href="#设置容器最大宽度" class="headerlink" title="设置容器最大宽度"></a>设置容器最大宽度</h3><p>默认 <code>1000px</code>。</p>
<blockquote>
<p>{tip} 此方法只针对大屏幕，手机端页面会自动调节大小。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()-&gt;<span class="title function_ invoke__">width</span>(<span class="string">&#x27;900px&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="记住表单数据"><a href="#记住表单数据" class="headerlink" title="记住表单数据"></a>记住表单数据</h3><p>开启此功能之后，当用户点击 <code>下一步</code> 按钮并且参数验证通过后，会把表单数据保存在 <code>session</code> 中，直到整个分步表单保存完毕之后才会销毁。</p>
<blockquote>
<p>{tip} 此功能默认不开启。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()-&gt;<span class="title function_ invoke__">remember</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()-&gt;<span class="title function_ invoke__">remember</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h3 id="设置容器间距"><a href="#设置容器间距" class="headerlink" title="设置容器间距"></a>设置容器间距</h3><p>默认值 <code>30px 18px 30px</code>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()-&gt;<span class="title function_ invoke__">padding</span>(<span class="string">&#x27;30px 18px 30px&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="监听页面离开事件"><a href="#监听页面离开事件" class="headerlink" title="监听页面离开事件"></a>监听页面离开事件</h3><p>监听所有步骤表单页面离开事件，可添加多个。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()-&gt;<span class="title function_ invoke__">leaving</span>(<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">     // 获取当前页面的步骤索引</span></span><br><span class="line"><span class="string">     var index = args.index; </span></span><br><span class="line"><span class="string">                 </span></span><br><span class="line"><span class="string">     Dcat.info(&quot;你将要离开第 &quot; + (index + 1) + &quot; 个页面&quot;);</span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     // args变量是一个js对象，包含当前事件对象、当前步骤选项、表单对象和表单值等字段。</span></span><br><span class="line"><span class="string">     console.log(&quot;leaving&quot;, args);</span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     // 获取当前事件对象</span></span><br><span class="line"><span class="string">     var evt = args.event;</span></span><br><span class="line"><span class="string">     // 获取步骤表单标题tap对象</span></span><br><span class="line"><span class="string">     var tab = args.tab;</span></span><br><span class="line"><span class="string">     // 获取动向是前往上一步还是下一步页面：&quot;forward&quot;、&quot;backward&quot;</span></span><br><span class="line"><span class="string">     var direction = args.direction;</span></span><br><span class="line"><span class="string">     // 获取当前步骤的表单JQ对象</span></span><br><span class="line"><span class="string">     var <span class="subst">$form</span> = args.form;</span></span><br><span class="line"><span class="string">     // 获取当前步骤页的表单值</span></span><br><span class="line"><span class="string">     var formArray = args.formArray;</span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     // 获取指定步骤的表单JQ对象</span></span><br><span class="line"><span class="string">     var <span class="subst">$firstForm</span> = args.getForm(0);</span></span><br><span class="line"><span class="string">     // 获取指定步骤的表单值</span></span><br><span class="line"><span class="string">     var firstFormArray = args.getFormArray(0);</span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     // 停止离开当前页面</span></span><br><span class="line"><span class="string">     return false;</span></span><br><span class="line"><span class="string">JS</span>    </span><br><span class="line">)-&gt;<span class="title function_ invoke__">leaving</span>(...);</span><br></pre></td></tr></table></figure>

<h3 id="监听页面显示事件"><a href="#监听页面显示事件" class="headerlink" title="监听页面显示事件"></a>监听页面显示事件</h3><p>监听所有步骤表单页面显示事件，可添加多个。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()-&gt;<span class="title function_ invoke__">shown</span>(<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">     // 获取当前页面的步骤索引</span></span><br><span class="line"><span class="string">     var index = args.index; </span></span><br><span class="line"><span class="string">                 </span></span><br><span class="line"><span class="string">     Dcat.info(&quot;当前显示的是第 &quot; + (index + 1) + &quot; 个页面&quot;);</span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     // args变量的值与“leaving”事件的值相同。</span></span><br><span class="line"><span class="string">     console.log(&quot;shown&quot;, args);</span></span><br><span class="line"><span class="string">JS</span>    </span><br><span class="line">)-&gt;<span class="title function_ invoke__">shown</span>(...);</span><br></pre></td></tr></table></figure>

<h3 id="增加步骤表单"><a href="#增加步骤表单" class="headerlink" title="增加步骤表单"></a>增加步骤表单</h3><p>步骤表单支持所有表单字段。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;标题&#x27;</span>, function (Form\StepForm <span class="variable">$step</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;username&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="监听步骤页面离开事件"><a href="#监听步骤页面离开事件" class="headerlink" title="监听步骤页面离开事件"></a>监听步骤页面离开事件</h4><p>监听当前步骤页面离开事件，支持监听多次。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;基本信息&#x27;</span>, function (Form\StepForm <span class="variable">$step</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">leaving</span>(<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Dcat.info(&quot;你将要离开 基本信息 页面&quot;);</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    // args变量是一个js对象，包含当前事件对象、当前步骤选项、表单对象和表单值等字段。</span></span><br><span class="line"><span class="string">    console.log(&quot;离开 基本信息&quot;, args);</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    // 获取当前事件对象</span></span><br><span class="line"><span class="string">    var evt = args.event;</span></span><br><span class="line"><span class="string">    // 获取当前页面的步骤索引</span></span><br><span class="line"><span class="string">    var index = args.index;</span></span><br><span class="line"><span class="string">    // 获取步骤表单标题tap对象</span></span><br><span class="line"><span class="string">    var tab = args.tab;</span></span><br><span class="line"><span class="string">    // 获取动向是前往上一步还是下一步页面：&quot;forward&quot;、&quot;backward&quot;</span></span><br><span class="line"><span class="string">    var direction = args.direction;</span></span><br><span class="line"><span class="string">    // 获取当前步骤的表单JQ对象</span></span><br><span class="line"><span class="string">    var <span class="subst">$form</span> = args.form;</span></span><br><span class="line"><span class="string">    // 获取当前步骤页的表单值</span></span><br><span class="line"><span class="string">    var formArray = args.formArray;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    // 获取指定步骤的表单JQ对象</span></span><br><span class="line"><span class="string">    var <span class="subst">$firstForm</span> = args.getForm(0);</span></span><br><span class="line"><span class="string">    // 获取指定步骤的表单值</span></span><br><span class="line"><span class="string">    var firstFormArray = args.getFormArray(0);</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    // 停止离开当前页面</span></span><br><span class="line"><span class="string">    return false;</span></span><br><span class="line"><span class="string">JS</span>    </span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听多次</span></span><br><span class="line">    <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">leaving</span>(...);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="监听步骤页面显示事件"><a href="#监听步骤页面显示事件" class="headerlink" title="监听步骤页面显示事件"></a>监听步骤页面显示事件</h4><p>监听当前步骤页面显示事件，支持监听多次。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;基本信息&#x27;</span>, function (Form\StepForm <span class="variable">$step</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">shown</span>(<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Dcat.info(&quot;当前步骤是 基本信息&quot;);</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    // args变量的值与“leaving”事件的值相同。</span></span><br><span class="line"><span class="string">    console.log(&quot;显示 基本信息&quot;, args);</span></span><br><span class="line"><span class="string">JS</span>    </span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听多次</span></span><br><span class="line">    <span class="variable">$step</span>-&gt;<span class="title function_ invoke__">shown</span>(...);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="设置完成页面"><a href="#设置完成页面" class="headerlink" title="设置完成页面"></a>设置完成页面</h3><p>当所有步骤都完成之后会显示完成页面，系统提供一个默认的完成页面，开发者也可以通过以下方法自定义完成页面要显示的内容。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSteps</span>()-&gt;<span class="title function_ invoke__">done</span>(function (Form\DoneStep <span class="variable">$done</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取新增ID</span></span><br><span class="line">    <span class="comment">// 由 Repository::store 返回的值</span></span><br><span class="line">    <span class="variable">$newId</span> = <span class="variable">$done</span>-&gt;<span class="title function_ invoke__">getNewId</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 返回你要显示的内容，可以使一个视图也可以是一个字符串。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(...);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-step/" data-id="clpdpxfjg0013ywna0hifa2ei" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form-fields" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-fields/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.964Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单字段的使用"><a href="#表单字段的使用" class="headerlink" title="表单字段的使用"></a>表单字段的使用</h1><p>在<code>model-form</code>中内置了大量的form组件来帮助你快速的构建form表单</p>
<p><a name="public"></a></p>
<h2 id="公共方法"><a href="#公共方法" class="headerlink" title="公共方法"></a>公共方法</h2><p><a name="value"></a></p>
<h3 id="设置表单值-value"><a href="#设置表单值-value" class="headerlink" title="设置表单值 (value)"></a>设置表单值 (value)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">value</span>(<span class="string">&#x27;text...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="default"></a></p>
<h3 id="设置默认值-default"><a href="#设置默认值-default" class="headerlink" title="设置默认值 (default)"></a>设置默认值 (default)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="keyword">default</span>(<span class="string">&#x27;text...&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>此方法仅在<strong>新增页面</strong>有效，如果<strong>编辑页面</strong>也需要设置默认值，可以参考以下方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;xxx&#x27;</span>)-&gt;<span class="keyword">default</span>(<span class="string">&#x27;默认值&#x27;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p><a name="help"></a></p>
<h3 id="设置提示信息-help"><a href="#设置提示信息-help" class="headerlink" title="设置提示信息 (help)"></a>设置提示信息 (help)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;help...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="attr"></a></p>
<h3 id="设置属性-attribute"><a href="#设置属性-attribute" class="headerlink" title="设置属性 (attribute)"></a>设置属性 (attribute)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">attribute</span>([<span class="string">&#x27;data-title&#x27;</span> =&gt; <span class="string">&#x27;title...&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">attribute</span>(<span class="string">&#x27;data-title&#x27;</span>, <span class="string">&#x27;title...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="required"></a></p>
<h3 id="设置为必填-required"><a href="#设置为必填-required" class="headerlink" title="设置为必填 (required)"></a>设置为必填 (required)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不显示&quot;*&quot;号</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">required</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p><a name="disable"></a></p>
<h3 id="设置为不可编辑-disable"><a href="#设置为不可编辑-disable" class="headerlink" title="设置为不可编辑 (disable)"></a>设置为不可编辑 (disable)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">disable</span>();</span><br></pre></td></tr></table></figure>

<p><a name="placeholder"></a></p>
<h3 id="设置占位符-placeholder"><a href="#设置占位符-placeholder" class="headerlink" title="设置占位符 (placeholder)"></a>设置占位符 (placeholder)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">placeholder</span>(<span class="string">&#x27;请输入。。。&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="setWidth"></a></p>
<h3 id="设置宽度-width"><a href="#设置宽度-width" class="headerlink" title="设置宽度 (width)"></a>设置宽度 (width)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="number">8</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p><a name="rules"></a></p>
<h3 id="设置验证规则-rules"><a href="#设置验证规则-rules" class="headerlink" title="设置验证规则 (rules)"></a>设置验证规则 (rules)</h3><p>具体使用可参考<a href="model-form-validation.md">表单验证</a>。</p>
<p><a name="saving"></a></p>
<h3 id="修改待保存的表单输入值-saving"><a href="#修改待保存的表单输入值-saving" class="headerlink" title="修改待保存的表单输入值 (saving)"></a>修改待保存的表单输入值 (saving)</h3><p>通过<code>saving</code>方法可以更改待保存数据的格式。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">Helper</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleFile</span>(<span class="string">&#x27;files&#x27;</span>)-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$paths</span>) &#123;</span><br><span class="line">    <span class="variable">$paths</span> = <span class="title class_">Helper</span>::<span class="keyword">array</span>(<span class="variable">$paths</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取数据库当前行的其他字段</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 最终转化为json保存到数据库</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$paths</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a name="customFormat"></a></p>
<h3 id="修改表单数据显示-customFormat"><a href="#修改表单数据显示-customFormat" class="headerlink" title="修改表单数据显示 (customFormat)"></a>修改表单数据显示 (customFormat)</h3><p>通过<code>customFormat</code>方法可以改变从外部注入到表单的字段值。</p>
<p>如下例子中，<code>multipleFile</code>字段要求待渲染的字段值为数组格式，我们可以通过<code>customFormat</code>方法把从数据库查出的字段值转化为<code>array</code>格式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">Helper</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleFile</span>(<span class="string">&#x27;files&#x27;</span>)-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$paths</span>) &#123;</span><br><span class="line">    <span class="variable">$paths</span> = <span class="title class_">Helper</span>::<span class="keyword">array</span>(<span class="variable">$paths</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$paths</span>);</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$paths</span>) &#123;</span><br><span class="line">	<span class="comment">// 获取数据库当前行的其他字段</span></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 转为数组</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Helper</span>::<span class="keyword">array</span>(<span class="variable">$paths</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="在弹窗中隐藏"><a href="#在弹窗中隐藏" class="headerlink" title="在弹窗中隐藏"></a>在弹窗中隐藏</h3><p>如果不想在弹窗中显示某个字段，可以使用<code>Form\Field::hideInDialog</code>方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="string">&#x27;contents&#x27;</span>)-&gt;<span class="title function_ invoke__">hideInDialog</span>();</span><br></pre></td></tr></table></figure>

<h3 id="保存为字符串类型-saveAsString"><a href="#保存为字符串类型-saveAsString" class="headerlink" title="保存为字符串类型 saveAsString"></a>保存为字符串类型 <code>saveAsString</code></h3><p><code>saveAsString</code>方法可以把表单值转化为<code>string</code>类型保存，当保存的数据库字段值不允许为<code>null</code>时非常有用；</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;nickname&#x27;</span>)-&gt;<span class="title function_ invoke__">saveAsString</span>();</span><br></pre></td></tr></table></figure>

<h3 id="保存为json类型-saveAsJson"><a href="#保存为json类型-saveAsJson" class="headerlink" title="保存为json类型 saveAsJson"></a>保存为json类型 <code>saveAsJson</code></h3><p><code>saveAsJson</code>可以把表单值保存为<code>json</code>格式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;nickname&#x27;</span>)-&gt;<span class="title function_ invoke__">saveAsJson</span>();</span><br></pre></td></tr></table></figure>


<p><a name="text"></a></p>
<h2 id="文本-text"><a href="#文本-text" class="headerlink" title="文本 (text)"></a>文本 (text)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="variable">$column</span>, [<span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加提交验证规则</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="variable">$column</span>, [<span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required|min:10&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="hidden"></a></p>
<h2 id="隐藏字段-hidden"><a href="#隐藏字段-hidden" class="headerlink" title="隐藏字段 (hidden)"></a>隐藏字段 (hidden)</h2><p>通过<code>hidden</code>方法可以给你的表单设置一个隐藏字段。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">hidden</span>(<span class="string">&#x27;author_id&#x27;</span>)-&gt;<span class="title function_ invoke__">value</span>(<span class="title class_">Admin</span>::<span class="title function_ invoke__">user</span>()-&gt;<span class="title function_ invoke__">getKey</span>());</span><br></pre></td></tr></table></figure>

<p>通常可以结合<code>saving</code>事件使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">hidden</span>(<span class="string">&#x27;author_id&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">saving</span>(function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;author_id = <span class="title class_">Admin</span>::<span class="title function_ invoke__">user</span>()-&gt;<span class="title function_ invoke__">getKey</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p><a name="select"></a></p>
<h2 id="下拉选框单选-select"><a href="#下拉选框单选-select" class="headerlink" title="下拉选框单选 (select)"></a>下拉选框单选 (select)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>([<span class="number">1</span> =&gt; <span class="string">&#x27;foo&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;val&#x27;</span> =&gt; <span class="string">&#x27;Option name&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>或者从api中获取选项列表：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>(<span class="string">&#x27;/api/users&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用ajax并显示所选项目</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>(<span class="title class_">Model</span>::<span class="variable language_">class</span>)-&gt;<span class="title function_ invoke__">ajax</span>(<span class="string">&#x27;/api/users&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或指定名称和ID</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>(<span class="title class_">Model</span>::<span class="variable language_">class</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>)-&gt;<span class="title function_ invoke__">ajax</span>(<span class="string">&#x27;/api/users&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>其中api接口的格式必须为下面格式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>: <span class="string">&quot;xxx&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">21</span>,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>: <span class="string">&quot;xxx&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>如果选项过多，可通过ajax方式动态分页载入选项：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;user_id&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>(function (<span class="variable">$id</span>) &#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title class_">User</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$user</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$user</span>-&gt;id =&gt; <span class="variable">$user</span>-&gt;name];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">ajax</span>(<span class="string">&#x27;api/users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>使用model方法在編輯時載入資料：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;user_id&#x27;</span>)-&gt;<span class="title function_ invoke__">model</span>(<span class="title class_">User</span>::<span class="variable language_">class</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>上面的代碼跟下面這個是一樣的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;user_id&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>(function (<span class="variable">$id</span>) &#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title class_">User</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$user</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$user</span>-&gt;id =&gt; <span class="variable">$user</span>-&gt;name];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p>API <code>/admin/api/users</code>接口的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">users</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$q</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;q&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">User</span>::<span class="title function_ invoke__">where</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">$q</span>%&quot;</span>)-&gt;<span class="title function_ invoke__">paginate</span>(<span class="literal">null</span>, [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name as text&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接口返回的数据结构为</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;per_page&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;current_page&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;last_page&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;next_page_url&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;prev_page_url&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">21</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">42</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">48</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><a name="selectload"></a></p>
<h2 id="下拉选框联动-load"><a href="#下拉选框联动-load" class="headerlink" title="下拉选框联动 (load)"></a>下拉选框联动 (load)</h2><p><code>select</code>组件支持父子关系的单向联动：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;province&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>(...)-&gt;<span class="title function_ invoke__">load</span>(<span class="string">&#x27;city&#x27;</span>, <span class="string">&#x27;/api/city&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;city&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>其中<code>load(&#39;city&#39;, &#39;/api/city&#39;);</code>的意思是，在当前select的选项切换之后，会把当前选项的值通过参数<code>q</code>, 调用接口<code>/api/city</code>，并把api返回的数据填充为city选择框的选项，其中api<code>/api/city</code>返回的数据格式必须符合:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>: <span class="string">&quot;xxx&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">21</span>,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>: <span class="string">&quot;xxx&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>控制器action的代码示例如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">city</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$provinceId</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;q&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">ChinaArea</span>::<span class="title function_ invoke__">city</span>()-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;parent_id&#x27;</span>, <span class="variable">$provinceId</span>)-&gt;<span class="title function_ invoke__">get</span>([<span class="string">&#x27;id&#x27;</span>, DB::<span class="title function_ invoke__">raw</span>(<span class="string">&#x27;name as text&#x27;</span>)]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>selectTable</code>、<code>multipleSelectTable</code>、<code>radio</code>、<code>checkbox</code>也可以使用<code>load</code>方法联动<code>select</code>和<code>multipleSelect</code>表单，用法和上面的示例一致。</p>
<h3 id="联动多个字段-loads"><a href="#联动多个字段-loads" class="headerlink" title="联动多个字段 (loads)"></a>联动多个字段 (loads)</h3><p>使用<code>loads</code>方法可以联动多个字段，用法如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;status&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">options</span>(...)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">loads</span>([<span class="string">&#x27;field1&#x27;</span>, <span class="string">&#x27;field2&#x27;</span>], [<span class="string">&#x27;/api/field1&#x27;</span>, <span class="string">&#x27;/api/field2&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;field1&#x27;</span>);</span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;field2&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>api</code>返回的数据格式与<code>load</code>方法一致，<code>selectTable</code>、<code>multipleSelectTable</code>、<code>radio</code>、<code>checkbox</code>也可以使用<code>loads</code>方法联动。</p>
<p><a name="multipleSelect"></a></p>
<h2 id="下拉选框多选-multipleSelect"><a href="#下拉选框多选-multipleSelect" class="headerlink" title="下拉选框多选 (multipleSelect)"></a>下拉选框多选 (multipleSelect)</h2><blockquote>
<p>{tip} 注入这个字段的数据（从数据库查出来的）可以是一个以<code>,</code>隔开的字符串，也可以是<code>json</code>字符串或<code>array</code>数组。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSelect</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])</span><br><span class="line">	-&gt;<span class="title function_ invoke__">options</span>([<span class="number">1</span> =&gt; <span class="string">&#x27;foo&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;val&#x27;</span> =&gt; <span class="string">&#x27;Option name&#x27;</span>])</span><br><span class="line">	-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$value</span>) &#123;</span><br><span class="line">		<span class="comment">// 转化成json字符串保存到数据库</span></span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$value</span>);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用ajax并显示所选项目：</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSelect</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>(<span class="title class_">Model</span>::<span class="variable language_">class</span>)-&gt;<span class="title function_ invoke__">ajax</span>(<span class="string">&#x27;ajax_url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或指定名称和ID</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSelect</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>(<span class="title class_">Model</span>::<span class="variable language_">class</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>)-&gt;<span class="title function_ invoke__">ajax</span>(<span class="string">&#x27;ajax_url&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>多选框可以处理两种情况，第一种是<code>ManyToMany</code>的关系。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Models</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">belongsToMany</span>(<span class="title class_">Tag</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">Post</span>::<span class="title function_ invoke__">with</span>(<span class="string">&#x27;tags&#x27;</span>), function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSelect</span>(<span class="string">&#x27;tags&#x27;</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">options</span>(<span class="title class_">Tag</span>::<span class="title function_ invoke__">all</span>()-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>))</span><br><span class="line">        -&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (! <span class="variable">$v</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> [];</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 从数据库中查出的二维数组中转化成ID</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">array_column</span>(<span class="variable">$v</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第二种是将选项数组存储到单字段中，如果字段是字符串类型，那就需要在模型里面为该字段定义<a target="_blank" rel="noopener" href="https://laravel.com/docs/5.5/eloquent-mutators">访问器和修改器</a>来存储和读取了。</p>
<p>如果选项过多，可通过ajax方式动态分页载入选项：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;friends&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>(function (<span class="variable">$ids</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">User</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$ids</span>)-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">ajax</span>(<span class="string">&#x27;api/users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>API <code>/admin/api/users</code>接口的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">users</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$q</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;q&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">User</span>::<span class="title function_ invoke__">where</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">$q</span>%&quot;</span>)-&gt;<span class="title function_ invoke__">paginate</span>(<span class="literal">null</span>, [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name as text&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接口返回的数据结构为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;total&quot;: 4,</span><br><span class="line">    &quot;per_page&quot;: 15,</span><br><span class="line">    &quot;current_page&quot;: 1,</span><br><span class="line">    &quot;last_page&quot;: 1,</span><br><span class="line">    &quot;next_page_url&quot;: null,</span><br><span class="line">    &quot;prev_page_url&quot;: null,</span><br><span class="line">    &quot;from&quot;: 1,</span><br><span class="line">    &quot;to&quot;: 3,</span><br><span class="line">    &quot;data&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: 9,</span><br><span class="line">            &quot;text&quot;: &quot;xxx&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: 21,</span><br><span class="line">            &quot;text&quot;: &quot;xxx&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: 42,</span><br><span class="line">            &quot;text&quot;: &quot;xxx&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: 48,</span><br><span class="line">            &quot;text&quot;: &quot;xxx&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="select-table"></a></p>
<h2 id="表格选择器-selectTable"><a href="#表格选择器-selectTable" class="headerlink" title="表格选择器 (selectTable)"></a>表格选择器 (selectTable)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">UserTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Models</span>\<span class="title">Administrator</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">selectTable</span>(<span class="variable">$field</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;弹窗标题&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">dialogWidth</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 弹窗宽度，默认 800px</span></span><br><span class="line">	-&gt;<span class="keyword">from</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getKey</span>()])) <span class="comment">// 设置渲染类实例，并传递自定义参数</span></span><br><span class="line">	-&gt;<span class="title function_ invoke__">model</span>(<span class="title class_">Administrator</span>::<span class="variable language_">class</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>); <span class="comment">// 设置编辑数据显示</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">// 上面的代码等同于</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">selectTable</span>(<span class="variable">$field</span>)</span><br><span class="line">	-&gt;<span class="keyword">from</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getKey</span>()])) <span class="comment">// 设置渲染类实例，并传递自定义参数</span></span><br><span class="line">	-&gt;<span class="title function_ invoke__">options</span>(function (<span class="variable">$v</span>) &#123; <span class="comment">// 设置编辑数据显示</span></span><br><span class="line">		<span class="keyword">if</span> (! <span class="variable">$v</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> [];</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="title class_">Administrator</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$v</span>)-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>

<p>定义渲染类如下，需要继承<code>Dcat\Admin\Grid\LazyRenderable</code></p>
<blockquote>
<p>{tip} 这里使用了数据表格异步加载功能，详细用法请参考<a href="lazy.md">异步加载</a></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Renderable</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Models</span>\<span class="title">Administrator</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserTable</span> <span class="keyword">extends</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>): <span class="title">Grid</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取外部传递的参数</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">Administrator</span>::<span class="title function_ invoke__">where</span>(<span class="string">&#x27;xxx_id&#x27;</span>, <span class="variable">$id</span>), function (Grid <span class="variable">$grid</span>) &#123;</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;created_at&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;updated_at&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>([<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">paginate</span>(<span class="number">10</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableActions</span>();</span><br><span class="line"></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function (Grid\Filter <span class="variable">$filter</span>) &#123;</span><br><span class="line">                <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;username&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="number">4</span>);</span><br><span class="line">                <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="number">4</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<a href="https://cdn.learnku.com/uploads/images/202008/23/38389/P5hZXiqAj9.gif!large" target="_blank">
![](https://cdn.learnku.com/uploads/images/202008/23/38389/P5hZXiqAj9.gif!large)
</a>

<h3 id="设置选中后将保存到表单的字段和显示的字段"><a href="#设置选中后将保存到表单的字段和显示的字段" class="headerlink" title="设置选中后将保存到表单的字段和显示的字段"></a>设置选中后将保存到表单的字段和显示的字段</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">selectTable</span>(<span class="variable">$field</span>)</span><br><span class="line">	-&gt;<span class="keyword">from</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getKey</span>()]))</span><br><span class="line">	-&gt;<span class="title function_ invoke__">options</span>(function (<span class="variable">$v</span>) &#123; <span class="comment">// 设置编辑数据显示</span></span><br><span class="line">		<span class="keyword">if</span> (! <span class="variable">$v</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> [];</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="title class_">Administrator</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$v</span>)-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">	&#125;)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>); <span class="comment">// 第一个参数为显示的字段，第二个参数为选中后将保存到表单的字段</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">// 上面的代码也可以简化为</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">selectTable</span>(<span class="variable">$field</span>)</span><br><span class="line">	-&gt;<span class="keyword">from</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getKey</span>()]))</span><br><span class="line">	-&gt;<span class="title function_ invoke__">model</span>(<span class="title class_">Administrator</span>::<span class="variable language_">class</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>); <span class="comment">// 设置编辑数据显示</span></span><br></pre></td></tr></table></figure>



<h3 id="多选-multipleSelectTable"><a href="#多选-multipleSelectTable" class="headerlink" title="多选 (multipleSelectTable)"></a>多选 (multipleSelectTable)</h3><p>多选的用法与上述<code>selectTable</code>方法一致</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleSelectTable</span>(<span class="variable">$field</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">max</span>(<span class="number">10</span>) <span class="comment">// 最多选择 10 个选项，不传则不限制</span></span><br><span class="line">	-&gt;<span class="keyword">from</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">getKey</span>()])) <span class="comment">// 设置渲染类实例，并传递自定义参数</span></span><br><span class="line">	-&gt;<span class="title function_ invoke__">model</span>(<span class="title class_">Administrator</span>::<span class="variable language_">class</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)  <span class="comment">// 设置编辑数据显示</span></span><br><span class="line">	-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="comment">// $v 是表单提交的字段值，默认是数组类型，这里需要手动转换一下</span></span><br><span class="line">		<span class="comment">// 保存为以 &quot;,&quot; 隔开的字符串，如果是多对多关联关系，则不需要转换。</span></span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$v</span>);</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>


<h2 id="多选盒-listbox"><a href="#多选盒-listbox" class="headerlink" title="多选盒 (listbox)"></a>多选盒 (listbox)</h2><p>使用方法和<code>multipleSelect</code>类似。</p>
<blockquote>
<p>{tip} 注入这个字段的数据（从数据库查出来的）可以是一个以<code>,</code>隔开的字符串，也可以是<code>json</code>字符串或<code>array</code>数组。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">listbox</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>([<span class="number">1</span> =&gt; <span class="string">&#x27;foo&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;val&#x27;</span> =&gt; <span class="string">&#x27;Option name&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="textarea"></a></p>
<h2 id="长文本-textarea"><a href="#长文本-textarea" class="headerlink" title="长文本 (textarea)"></a>长文本 (textarea)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">rows</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p><a name="radio"></a></p>
<h2 id="单选-radio"><a href="#单选-radio" class="headerlink" title="单选 (radio)"></a>单选 (radio)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">radio</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>([<span class="string">&#x27;m&#x27;</span> =&gt; <span class="string">&#x27;Female&#x27;</span>, <span class="string">&#x27;f&#x27;</span>=&gt; <span class="string">&#x27;Male&#x27;</span>])-&gt;<span class="keyword">default</span>(<span class="string">&#x27;m&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="checkbox"></a></p>
<h2 id="多选-checkbox"><a href="#多选-checkbox" class="headerlink" title="多选 (checkbox)"></a>多选 (checkbox)</h2><p><code>options()</code>方法用来设置选择项:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">checkbox</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])</span><br><span class="line">	-&gt;<span class="title function_ invoke__">options</span>([<span class="number">1</span> =&gt; <span class="string">&#x27;foo&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;val&#x27;</span> =&gt; <span class="string">&#x27;Option name&#x27;</span>])</span><br><span class="line">	-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$value</span>) &#123;</span><br><span class="line">		<span class="comment">// 转化成json字符串保存到数据库</span></span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$value</span>);</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>


<p>启用选中全部功能</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">checkbox</span>(<span class="string">&#x27;column&#x27;</span>)-&gt;<span class="title function_ invoke__">canCheckAll</span>();</span><br></pre></td></tr></table></figure>

<p><a name="autocomplete"></a></p>
<h2 id="autocomplete"><a href="#autocomplete" class="headerlink" title="autocomplete"></a>autocomplete</h2><p>此表单可以在填写表单时进行对表单值进行搜索，并把结果展示在下拉列表中，用法如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">autocomplete</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, ...]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置分组名称</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">autocomplete</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">groups</span>([</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;label&#x27;</span> =&gt; <span class="string">&#x27;group name&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;options&#x27;</span> =&gt; [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, ...],</span><br><span class="line">    ],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>效果如下<br><img src="https://cdn.learnku.com/uploads/images/202112/12/38389/ArVNSvChag.png!large"></p>
<h3 id="从远程API获取数据"><a href="#从远程API获取数据" class="headerlink" title="从远程API获取数据"></a>从远程API获取数据</h3><p>也可以从远程API中获取数据</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ajax 函数的第一个参数为 ajax url, 第二个参数为 valueField（可选）, 第三个参数为 groupField（可选）</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">autocomplete</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">ajax</span>(<span class="string">&#x27;/countries&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;region&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>远程API 服务端的请求参数为query，示例代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountryController</span> <span class="keyword">extends</span> <span class="title">AdminController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$countries</span> = <span class="title class_">Country</span>::<span class="title function_ invoke__">when</span>(<span class="title function_ invoke__">request</span>(<span class="string">&#x27;query&#x27;</span>), function (<span class="variable">$query</span>, <span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">&#123;$value&#125;</span>%&quot;</span>);</span><br><span class="line">        &#125;)-&gt;<span class="title function_ invoke__">get</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Admin</span>::<span class="title function_ invoke__">json</span>(<span class="variable">$countries</span>-&gt;<span class="title function_ invoke__">toArray</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义-autocomplete-的设置："><a href="#自定义-autocomplete-的设置：" class="headerlink" title="自定义 autocomplete 的设置："></a>自定义 autocomplete 的设置：</h3><p>详细设置请参考： <a target="_blank" rel="noopener" href="https://github.com/devbridge/jQuery-Autocomplete">devbridge&#x2F;jQuery-Autocomplete</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$js = &lt;&lt;&lt;JS</span><br><span class="line">    function (suggestion) &#123;</span><br><span class="line">        alert(&#x27;You selected: &#x27; + suggestion.value + &#x27;, &#x27; + suggestion.data);</span><br><span class="line">    &#125;</span><br><span class="line">JS;</span><br><span class="line"></span><br><span class="line">$form-&gt;autocomplete($column[, $label])-&gt;configs([</span><br><span class="line">    &#x27;minChars&#x27; =&gt; 5,</span><br><span class="line">    &#x27;noCache&#x27; =&gt; true,</span><br><span class="line">    &#x27;onSelect&#x27; =&gt; JavaScript::make($js),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>configs 同样也支持闭包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$form-&gt;autocomplete($column[, $label])-&gt;configs(function($model, $value)&#123;</span><br><span class="line">    return [</span><br><span class="line">        ....</span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="表单联动"><a href="#表单联动" class="headerlink" title="表单联动"></a>表单联动</h3><p>autocomplete 的联动逻辑和select的刚好相反。<br>depends 需要写在受影响的字段，不限上级字段类型，上级字段的值将同时上传到API。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$form-&gt;select(&#x27;region&#x27;)-&gt;options([</span><br><span class="line">    &#x27;asia&#x27;,</span><br><span class="line">    &#x27;Africa&#x27;,</span><br><span class="line">    &#x27;America&#x27;,</span><br><span class="line">    &#x27;Europe&#x27;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$form-&gt;autocomplete(&#x27;country&#x27;)-&gt;ajax(&#x27;/countries&#x27;, &#x27;name&#x27;, &#x27;region&#x27;);</span><br><span class="line"></span><br><span class="line">// 将会发出 /states?query=&#123;query&#125;&amp;region=&#123;region&#125;&amp;country=&#123;country&#125;  的请求</span><br><span class="line">$form-&gt;autocomplete(&#x27;addr&#x27;)-&gt;ajax(&#x27;/states&#x27;, &#x27;name&#x27;)-&gt;depends([&#x27;region&#x27;, &#x27;country&#x27;]);</span><br></pre></td></tr></table></figure>


<p><a name="email"></a></p>
<h2 id="邮箱-email"><a href="#邮箱-email" class="headerlink" title="邮箱 (email)"></a>邮箱 (email)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">email</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="password"></a></p>
<h2 id="密码-password"><a href="#密码-password" class="headerlink" title="密码 (password)"></a>密码 (password)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="url"></a></p>
<h2 id="链接-url"><a href="#链接-url" class="headerlink" title="链接 (url)"></a>链接 (url)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">url</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="ip"></a></p>
<h2 id="IP地址-ip"><a href="#IP地址-ip" class="headerlink" title="IP地址 (ip)"></a>IP地址 (ip)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">ip</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="mobile"></a></p>
<h2 id="手机-mobile"><a href="#手机-mobile" class="headerlink" title="手机 (mobile)"></a>手机 (mobile)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">mobile</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>([<span class="string">&#x27;mask&#x27;</span> =&gt; <span class="string">&#x27;999 9999 9999&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="color"></a></p>
<h2 id="颜色选择器-color"><a href="#颜色选择器-color" class="headerlink" title="颜色选择器 (color)"></a>颜色选择器 (color)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">color</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="time"></a></p>
<h2 id="时间-time"><a href="#时间-time" class="headerlink" title="时间 (time)"></a>时间 (time)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">time</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置时间格式，更多格式参考http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">time</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;HH:mm:ss&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="date"></a></p>
<h2 id="日期-date"><a href="#日期-date" class="headerlink" title="日期 (date)"></a>日期 (date)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置日期格式，更多格式参考http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">date</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;YYYY-MM-DD&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="datetime"></a></p>
<h2 id="时间日期-datetime"><a href="#时间日期-datetime" class="headerlink" title="时间日期 (datetime)"></a>时间日期 (datetime)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">datetime</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置日期格式，更多格式参考http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">datetime</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="timeRange"></a></p>
<h2 id="时间范围-timeRange"><a href="#时间范围-timeRange" class="headerlink" title="时间范围 (timeRange)"></a>时间范围 (timeRange)</h2><p><code>$startTime</code>、<code>$endTime</code>为开始和结束时间字段:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">timeRange</span>(<span class="variable">$startTime</span>, <span class="variable">$endTime</span>, <span class="string">&#x27;Time Range&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="dateRange"></a></p>
<h2 id="日期范围-dateRange"><a href="#日期范围-dateRange" class="headerlink" title="日期范围 (dateRange)"></a>日期范围 (dateRange)</h2><p><code>$startDate</code>、<code>$endDate</code>为开始和结束日期字段:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">dateRange</span>(<span class="variable">$startDate</span>, <span class="variable">$endDate</span>, <span class="string">&#x27;Date Range&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="datetimeRange"></a></p>
<h2 id="时间日期范围-datetimeRange"><a href="#时间日期范围-datetimeRange" class="headerlink" title="时间日期范围 (datetimeRange)"></a>时间日期范围 (datetimeRange)</h2><p><code>$startDateTime</code>、<code>$endDateTime</code>为开始和结束时间日期:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">datetimeRange</span>(<span class="variable">$startDateTime</span>, <span class="variable">$endDateTime</span>, <span class="string">&#x27;DateTime Range&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="范围-range"><a href="#范围-range" class="headerlink" title="范围 (range)"></a>范围 (range)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">range</span>(<span class="string">&#x27;start_column&#x27;</span>, <span class="string">&#x27;end_column&#x27;</span>, <span class="string">&#x27;范围&#x27;</span>);</span><br></pre></td></tr></table></figure>


<p><a name="file"></a></p>
<h2 id="文件上传-file"><a href="#文件上传-file" class="headerlink" title="文件上传 (file)"></a>文件上传 (file)</h2><p>使用文件上传功能之前需要先完成上传配置。文件上传配置以及内置方法请参考:<a href="model-form-upload.md">图片&#x2F;文件上传</a>.</p>
<p>文件上传目录在文件<code>config/admin.php</code>中的<code>upload.file</code>中配置，如果目录不存在，需要创建该目录并开放写权限。</p>
<blockquote>
<p>{tip} 文件或图片上传表单字段请不要在模型中设置<strong>访问器</strong>和<strong>修改器</strong>拼接域名，如有相关需求可参考<a href="model-form-upload.md#withhost">文件&#x2F;图片域名拼接</a>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改文件上传路径和文件名</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">move</span>(<span class="variable">$dir</span>, <span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 并设置上传文件类型</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;mimes:doc,docx,xlsx&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加文件删除按钮</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">removable</span>();</span><br></pre></td></tr></table></figure>

<p><a name="image"></a></p>
<h2 id="图片上传-image"><a href="#图片上传-image" class="headerlink" title="图片上传 (image)"></a>图片上传 (image)</h2><p>使用图片上传功能之前需要先完成上传配置。图片上传配置以及内置方法请参考:<a href="model-form-upload.md">图片&#x2F;文件上传</a>.</p>
<p>图片上传目录在文件<code>config/admin.php</code>中的<code>upload.image</code>中配置，如果目录不存在，需要创建该目录并开放写权限。</p>
<p>可以使用压缩、裁切、添加水印等各种方法,需要先安装<a target="_blank" rel="noopener" href="http://image.intervention.io/getting_started/installation">intervention&#x2F;image</a>。</p>
<p>更多使用方法请参考[<a target="_blank" rel="noopener" href="http://image.intervention.io/getting_started/introduction">Intervention</a>]：</p>
<blockquote>
<p>{tip} 文件或图片上传表单字段请不要在模型中设置<strong>访问器</strong>和<strong>修改器</strong>拼接域名，如有相关需求可参考<a href="model-form-upload.md#withhost">文件&#x2F;图片域名拼接</a>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改图片上传路径和文件名</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">move</span>(<span class="variable">$dir</span>, <span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 剪裁图片</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">crop</span>(<span class="keyword">int</span> <span class="variable">$width</span>, <span class="keyword">int</span> <span class="variable">$height</span>, [<span class="keyword">int</span> <span class="variable">$x</span>, <span class="keyword">int</span> <span class="variable">$y</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加水印</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">insert</span>(<span class="variable">$watermark</span>, <span class="string">&#x27;center&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="multipleImage"></a></p>
<h2 id="多图和多文件上传-multipleImage-multipleFile"><a href="#多图和多文件上传-multipleImage-multipleFile" class="headerlink" title="多图和多文件上传 (multipleImage&#x2F;multipleFile)"></a>多图和多文件上传 (multipleImage&#x2F;multipleFile)</h2><p>多图片上传表单继承自单图上传表单，多文件上传表单继承自单文件上传表单。</p>
<blockquote>
<p>{tip} 注入这个字段的数据（从数据库查出来的）可以是一个以<code>,</code>隔开的字符串，也可以是<code>json</code>字符串或<code>array</code>数组。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多图</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleImage</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 限制最大上传数量</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleImage</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多文件</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleFile</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 限制最大上传数量</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleFile</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<p>多图&#x2F;文件上传的时候提交的数据是一个<code>array</code>数组，你可以通过以下方式把数据在保存进数据库之前改为你想要的格式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转化为json格式保存到数据库</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleFile</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$paths</span>) &#123;</span><br><span class="line">    <span class="comment">// 可以转化为由 , 隔开的字符串格式</span></span><br><span class="line">    <span class="comment">// return implode(&#x27;,&#x27;, $paths);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 也可以转化为json</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$paths</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当然，如果你想保存为其他任意格式都是可以的，只是如果要保存其他格式，需要通过用<code>customFormat</code>方法把数据转化为一维数组展示，如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleFile</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])</span><br><span class="line">    -&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$paths</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">collect</span>(<span class="variable">$paths</span>)-&gt;<span class="title function_ invoke__">map</span>(function (<span class="variable">$value</span>) &#123;</span><br><span class="line">        	<span class="keyword">return</span> <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125;)-&gt;<span class="title function_ invoke__">flatten</span>()-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$paths</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$paths</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>


<p>启用可排序功能</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">multipleImage</span>(<span class="string">&#x27;images&#x27;</span>)-&gt;<span class="title function_ invoke__">sortable</span>();</span><br></pre></td></tr></table></figure>


<p><a name="editor"></a></p>
<h2 id="富文本编辑器-editor"><a href="#富文本编辑器-editor" class="headerlink" title="富文本编辑器 (editor)"></a>富文本编辑器 (editor)</h2><p>系统集成了<code>TinyMCE</code>编辑器作为内置编辑器。</p>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="设置语言包"><a href="#设置语言包" class="headerlink" title="设置语言包"></a>设置语言包</h4><p>默认支持简体中文和英文两种语言，如需其他语言可以通过以下方式设置语言包地址。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">languageUrl</span>(<span class="title function_ invoke__">url</span>(<span class="string">&#x27;TinyMCE/langs/de.js&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="编辑器配置"><a href="#编辑器配置" class="headerlink" title="编辑器配置"></a>编辑器配置</h4><p>具体配置等的使用可以参考<a target="_blank" rel="noopener" href="https://www.tiny.cloud/docs">官方文档</a>或<a target="_blank" rel="noopener" href="http://tinymce.ax-z.cn/">中文文档</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">JavaScript</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>([</span><br><span class="line">    <span class="string">&#x27;toolbar&#x27;</span> =&gt; [],</span><br><span class="line">    <span class="string">&#x27;setup&#x27;</span> =&gt; <span class="title class_">JavaScript</span>::<span class="title function_ invoke__">make</span>(</span><br><span class="line">        <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">function (editor) &#123;</span></span><br><span class="line"><span class="string">    console.log(&#x27;编辑器初始化成功&#x27;, editor)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line">    ),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h4 id="设置高度"><a href="#设置高度" class="headerlink" title="设置高度"></a>设置高度</h4><p>默认值为<code>400</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">height</span>(<span class="string">&#x27;600&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h4 id="只读"><a href="#只读" class="headerlink" title="只读"></a>只读</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">readOnly</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">disable</span>();</span><br></pre></td></tr></table></figure>

<h4 id="图片上传"><a href="#图片上传" class="headerlink" title="图片上传"></a>图片上传</h4><p>设置图片上传<code>disk</code>配置，默认上传到<code>admin.upload.disk</code>指定的配置</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上传到oss</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;oss&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>设置图片上传目录，默认为<code>tinymce/images</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">imageDirectory</span>(<span class="string">&#x27;editor/images&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>自定义上传接口，接口返回格式需要是<code>&#123;&quot;location&quot;: &quot;图片url&quot;&#125;</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">imageUrl</span>(<span class="string">&#x27;editor/upload-image&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h4 id="全局设置"><a href="#全局设置" class="headerlink" title="全局设置"></a>全局设置</h4><p>如果你需要对编辑器进行全局设置，可以在<code>app\Admin\bootstrap.php</code>加上以下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>\<span class="title">Field</span>\<span class="title">Editor</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Editor</span>::<span class="title function_ invoke__">resolving</span>(function (Editor <span class="variable">$editor</span>) &#123;</span><br><span class="line">    <span class="comment">// 设置默认配置</span></span><br><span class="line">    <span class="variable">$editor</span>-&gt;<span class="title function_ invoke__">options</span>([...]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置编辑器图片默认上传到七牛云</span></span><br><span class="line">    <span class="variable">$editor</span>-&gt;<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;qiniu&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><a name="markdown"></a></p>
<h2 id="Markdown编辑器-markdown"><a href="#Markdown编辑器-markdown" class="headerlink" title="Markdown编辑器 (markdown)"></a>Markdown编辑器 (markdown)</h2><p>系统集成了<code>editor-md</code>编辑器作为内置Markdown编辑器。</p>
<h4 id="基本使用-1"><a href="#基本使用-1" class="headerlink" title="基本使用"></a>基本使用</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">markdown</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="设置语言包-1"><a href="#设置语言包-1" class="headerlink" title="设置语言包"></a>设置语言包</h4><p>默认支持简体中文和英文两种语言，如需其他语言可以通过以下方式设置语言包地址。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">markdown</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">languageUrl</span>(<span class="title function_ invoke__">admin_asset</span>(<span class="string">&#x27;@admin/dcat/plugins/editor-md/languages/zh-tw.js&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="编辑器配置-1"><a href="#编辑器配置-1" class="headerlink" title="编辑器配置"></a>编辑器配置</h4><p>具体配置等的使用可以参考<a target="_blank" rel="noopener" href="https://pandao.github.io/editor.md/">官方文档</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">JavaScript</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">markdown</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>([</span><br><span class="line">    <span class="string">&#x27;onpreviewing&#x27;</span> =&gt; <span class="title class_">JavaScript</span>::<span class="title function_ invoke__">make</span>(</span><br><span class="line">        <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">function() &#123;</span></span><br><span class="line"><span class="string">	// console.log(&quot;onpreviewing =&gt;&quot;, this, this.id, this.settings);</span></span><br><span class="line"><span class="string">	// on previewing you can custom css .editormd-preview-active</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line">    ),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h4 id="设置高度-1"><a href="#设置高度-1" class="headerlink" title="设置高度"></a>设置高度</h4><p>默认值为<code>500</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">markdown</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">height</span>(<span class="string">&#x27;600&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h4 id="只读-1"><a href="#只读-1" class="headerlink" title="只读"></a>只读</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">markdown</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">readOnly</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">markdown</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">disable</span>();</span><br></pre></td></tr></table></figure>


<h4 id="图片上传-1"><a href="#图片上传-1" class="headerlink" title="图片上传"></a>图片上传</h4><p>设置图片上传<code>disk</code>配置，默认上传到<code>admin.upload.disk</code>指定的配置</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上传到oss</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">markdown</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;oss&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>设置图片上传目录，默认为<code>markdown/images</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">markdown</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">imageDirectory</span>(<span class="string">&#x27;markdown/images&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>自定义上传接口，接口返回格式需要是<code>&#123;&quot;success&quot;: 1, &quot;url&quot;: &quot;图片url&quot;&#125;</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">markdown</span>(<span class="string">&#x27;content&#x27;</span>)-&gt;<span class="title function_ invoke__">imageUrl</span>(<span class="string">&#x27;markdown/upload-image&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="全局设置-1"><a href="#全局设置-1" class="headerlink" title="全局设置"></a>全局设置</h4><p>如果你需要对编辑器进行全局设置，可以在<code>app\Admin\bootstrap.php</code>加上以下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>\<span class="title">Field</span>\<span class="title">Markdown</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Markdown</span>::<span class="title function_ invoke__">resolving</span>(function (Markdown <span class="variable">$markdown</span>) &#123;</span><br><span class="line">    <span class="comment">// 设置默认配置</span></span><br><span class="line">    <span class="variable">$markdown</span>-&gt;<span class="title function_ invoke__">options</span>([...]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置编辑器图片默认上传到七牛云</span></span><br><span class="line">    <span class="variable">$markdown</span>-&gt;<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;qiniu&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a name="switch"></a></p>
<h2 id="开关-switch"><a href="#开关-switch" class="headerlink" title="开关 (switch)"></a>开关 (switch)</h2><p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">switch</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br></pre></td></tr></table></figure>

<p>开关表单保存到数据库的默认值为<code>1</code>和<code>0</code>，如果需要更改保存到数据库的值，可以这样使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="keyword">switch</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])</span><br><span class="line">	-&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$v</span> == <span class="string">&#x27;打开&#x27;</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">	&#125;)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$v</span> ? <span class="string">&#x27;打开&#x27;</span> : <span class="string">&#x27;关闭&#x27;</span>;</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>


<p><a name="map"></a></p>
<h2 id="地图-map"><a href="#地图-map" class="headerlink" title="地图 (map)"></a>地图 (map)</h2><p>地图控件，用来选择经纬度,<code>$latitude</code>, <code>$longitude</code>为经纬度字段。</p>
<p>使用这个功能需要在 <code>config/admin.php</code> 文件中修改 <code>map_provider</code> 的值（目前支持的地图为：”tencent”, “google”, “yandex”，不同地图需要自己申请相应的 KEY 并在 .env 文件中配置，然后需要在<code>app/Admin/bootstrap.php</code>中加入以下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Form\Field\Map</span>::<span class="title function_ invoke__">requireAssets</span>();</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">map</span>(<span class="variable">$latitude</span>, <span class="variable">$longitude</span>, <span class="variable">$label</span>);</span><br></pre></td></tr></table></figure>


<p><a name="slider"></a></p>
<h2 id="滑动条-slider"><a href="#滑动条-slider" class="headerlink" title="滑动条 (slider)"></a>滑动条 (slider)</h2><p>可以用来数字类型字段的选择，比如年龄：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">slider</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">options</span>([<span class="string">&#x27;max&#x27;</span> =&gt; <span class="number">100</span>, <span class="string">&#x27;min&#x27;</span> =&gt; <span class="number">1</span>, <span class="string">&#x27;step&#x27;</span> =&gt; <span class="number">1</span>, <span class="string">&#x27;postfix&#x27;</span> =&gt; <span class="string">&#x27;years old&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>更多options请参考:<a target="_blank" rel="noopener" href="https://github.com/IonDen/ion.rangeSlider#settings">https://github.com/IonDen/ion.rangeSlider#settings</a></p>
<p><a name="display"></a></p>
<h2 id="仅显示-display"><a href="#仅显示-display" class="headerlink" title="仅显示 (display)"></a>仅显示 (display)</h2><p>只显示字段，不做任何操作：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//更复杂的显示</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">with</span>(function (<span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;img src=&quot;</span><span class="variable">$value</span><span class="string">&quot; /&gt;&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p><a name="currency"></a></p>
<h2 id="单位符号-currency"><a href="#单位符号-currency" class="headerlink" title="单位符号 (currency)"></a>单位符号 (currency)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">currency</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置单位符号</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">currency</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>])-&gt;<span class="title function_ invoke__">symbol</span>(<span class="string">&#x27;￥&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="number"></a></p>
<h2 id="数字-number"><a href="#数字-number" class="headerlink" title="数字 (number)"></a>数字 (number)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">number</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="rate"></a></p>
<h2 id="费率-rate"><a href="#费率-rate" class="headerlink" title="费率 (rate)"></a>费率 (rate)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">rate</span>(<span class="variable">$column</span>[, <span class="variable">$label</span>]);</span><br></pre></td></tr></table></figure>

<p><a name="divider"></a></p>
<h2 id="分割线-divider"><a href="#分割线-divider" class="headerlink" title="分割线 (divider)"></a>分割线 (divider)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">divider</span>();</span><br></pre></td></tr></table></figure>

<p><a name="html"></a></p>
<h2 id="自定义内容-html"><a href="#自定义内容-html" class="headerlink" title="自定义内容 (html)"></a>自定义内容 (html)</h2><p>插入html内容，参数可以是实现了<code>Htmlable</code>、<code>Renderable</code>或者实现了<code>__toString()</code>方法的类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">html</span>(<span class="string">&#x27;你的html内容&#x27;</span>, <span class="variable">$label</span> = <span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="tags"></a></p>
<h2 id="标签-tags"><a href="#标签-tags" class="headerlink" title="标签 (tags)"></a>标签 (tags)</h2><p>插入逗号(,)隔开的字符串<code>tags</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tags</span>(<span class="string">&#x27;keywords&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>tags</code>同样支持<code>ManyToMany</code>的关系，示例如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tags</span>(<span class="string">&#x27;tags&#x27;</span>, <span class="string">&#x27;文章标签&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>) <span class="comment">// name 为需要显示的 Tag 模型的字段，id 为主键</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">options</span>(<span class="title class_">Tag</span>::<span class="title function_ invoke__">all</span>());<span class="comment">// 下拉框选项</span></span><br></pre></td></tr></table></figure>

<p>注意：处理<code>ManyToMany</code>关系时必须调用<code>pluck</code>方法，指定显示的字段名和主键。<br>此外 <code>options</code> 方法传入一个<code>Collection</code>对象时，<code>options</code>会自动调用该对象的<code>pluck</code>方法转为<code>[&#39;主键名&#39; =&gt; &#39;显示字段名&#39;]</code> 数组，作为下拉框选项。或者可以直接使用<code>[&#39;主键名&#39; =&gt; &#39;显示字段名&#39;]</code>这样的数组作为参数。</p>
<p><code>tags</code>还支持<code>saving</code>方法用于处理提交的数据，示例如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tags</span>(<span class="string">&#x27;tags&#x27;</span>, <span class="string">&#x27;文章标签&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">options</span>(<span class="title class_">Tag</span>::<span class="title function_ invoke__">all</span>())</span><br><span class="line">    -&gt;<span class="title function_ invoke__">saving</span>(function (<span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p><code>saving</code> 方法接收一个「参数为 tags 的提交值，返回值为修改后的 tags 提交值」的闭包，可以用于实现自动创建新 tag 或其它功能。</p>
<p>如果选项过多，可通过ajax方式动态分页载入选项：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tags</span>(<span class="string">&#x27;friends&#x27;</span>)-&gt;<span class="title function_ invoke__">options</span>(function (<span class="variable">$ids</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">User</span>::<span class="title function_ invoke__">find</span>((<span class="keyword">array</span>) <span class="variable">$ids</span>)-&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">ajax</span>(<span class="string">&#x27;api/users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>API <code>/admin/api/users</code>接口的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">users</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$q</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;q&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">User</span>::<span class="title function_ invoke__">where</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&quot;%<span class="subst">$q</span>%&quot;</span>)-&gt;<span class="title function_ invoke__">paginate</span>(<span class="literal">null</span>, [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name as text&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口返回的数据结构为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;total&quot;: 4,</span><br><span class="line">    &quot;per_page&quot;: 15,</span><br><span class="line">    &quot;current_page&quot;: 1,</span><br><span class="line">    &quot;last_page&quot;: 1,</span><br><span class="line">    &quot;next_page_url&quot;: null,</span><br><span class="line">    &quot;prev_page_url&quot;: null,</span><br><span class="line">    &quot;from&quot;: 1,</span><br><span class="line">    &quot;to&quot;: 3,</span><br><span class="line">    &quot;data&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: 9,</span><br><span class="line">            &quot;text&quot;: &quot;xxx&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: 21,</span><br><span class="line">            &quot;text&quot;: &quot;xxx&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: 42,</span><br><span class="line">            &quot;text&quot;: &quot;xxx&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: 48,</span><br><span class="line">            &quot;text&quot;: &quot;xxx&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><a name="icon"></a></p>
<h2 id="图标选择器-icon"><a href="#图标选择器-icon" class="headerlink" title="图标选择器 (icon)"></a>图标选择器 (icon)</h2><p>选择<code>font-awesome</code>图标</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">icon</span>(<span class="string">&#x27;icon&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a name="tree"></a></p>
<h2 id="树形选择器-tree"><a href="#树形选择器-tree" class="headerlink" title="树形选择器 (tree)"></a>树形选择器 (tree)</h2><p>树形结构表单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tree</span>(<span class="string">&#x27;permissions&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">nodes</span>(<span class="title class_">Model</span>::<span class="title function_ invoke__">get</span>()-&gt;<span class="title function_ invoke__">toArray</span>()) <span class="comment">// 设置所有节点</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123; <span class="comment">// 格式化外部注入的值</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$v</span>) <span class="keyword">return</span> [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">array_column</span>(<span class="variable">$v</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改节点的字段名称</span></span><br><span class="line"><span class="comment">// 默认 “id” “name” “parent_id”</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tree</span>(<span class="string">&#x27;permissions&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">nodes</span>(<span class="variable">$permissionModel</span>-&gt;<span class="title function_ invoke__">allNodes</span>())</span><br><span class="line">    -&gt;<span class="title function_ invoke__">setIdColumn</span>(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">setTitleColumn</span>(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">setParentColumn</span>(<span class="string">&#x27;parent&#x27;</span>); </span><br><span class="line">    </span><br><span class="line"><span class="comment">// 默认是不保存父节点的值的，因为一般来说父节点只是作为标题的形式存在</span></span><br><span class="line"><span class="comment">// 禁止过滤父节点的值</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tree</span>(<span class="string">&#x27;permissions&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">nodes</span>(<span class="variable">$permissionModel</span>-&gt;<span class="title function_ invoke__">allNodes</span>())</span><br><span class="line">    -&gt;<span class="title function_ invoke__">exceptParentNode</span>(<span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 默认收缩子节点</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tree</span>(<span class="string">&#x27;permissions&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">nodes</span>(<span class="variable">$permissionModel</span>-&gt;<span class="title function_ invoke__">allNodes</span>())</span><br><span class="line">    -&gt;<span class="title function_ invoke__">expand</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p><code>tree</code>表单默认不允许单独选中父节点，可以通过<code>treeState(false)</code>开启这个功能</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tree</span>(<span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">treeState</span>(<span class="literal">false</span>) <span class="comment"># 允许单独选择父节点</span></span><br><span class="line">    -&gt;<span class="title function_ invoke__">setTitleColumn</span>(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">nodes</span>(...);</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src="https://cdn.learnku.com/uploads/images/202104/30/38389/oChwzky2BT.gif!large"></p>
<p><a name="table"></a></p>
<h2 id="表格表单-table"><a href="#表格表单-table" class="headerlink" title="表格表单 (table)"></a>表格表单 (table)</h2><p>如果某一个字段存储的是json格式的二维数组，可以使用table表单组件来实现快速的编辑：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;extra&#x27;</span>, function (NestedForm <span class="variable">$table</span>) &#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;key&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;desc&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>同时在模型里面给这个字段增加访问器和修改器:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getExtraAttribute</span>(<span class="params"><span class="variable">$extra</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">array_values</span>(<span class="title function_ invoke__">json_decode</span>(<span class="variable">$extra</span>, <span class="literal">true</span>) ?: []);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setExtraAttribute</span>(<span class="params"><span class="variable">$extra</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;attributes[<span class="string">&#x27;extra&#x27;</span>] = <span class="title function_ invoke__">json_encode</span>(<span class="title function_ invoke__">array_values</span>(<span class="variable">$extra</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个组件类似于hasMany组件，不过是用来处理单个字段的情况，适用于简单的二维数据。</p>
<p><a name="onemany"></a></p>
<h2 id="一对多-hasMany"><a href="#一对多-hasMany" class="headerlink" title="一对多 (hasMany)"></a>一对多 (hasMany)</h2><p>一对多内嵌表格，用于处理一对多的关系，下面是个简单的例子：</p>
<p>有两张表是一对多关系：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `demo_painters` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `bio` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `demo_paintings` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `painter_id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `body` text <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `completed_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  `created_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  `updated_at` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY painter_id (`painter_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br></pre></td></tr></table></figure>

<p>表的模型为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>\<span class="title class_">Demo</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Painter</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">paintings</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">hasMany</span>(<span class="title class_">Painting</span>::<span class="variable language_">class</span>, <span class="string">&#x27;painter_id&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Models</span>\<span class="title class_">Demo</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Painting</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$fillable</span> = [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;completed_at&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">painter</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">belongsTo</span>(<span class="title class_">Painter</span>::<span class="variable language_">class</span>, <span class="string">&#x27;painter_id&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构建表单代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Demo</span>\<span class="title">Painter</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里需要显式地指定关联关系</span></span><br><span class="line"><span class="variable">$builder</span> = <span class="title class_">Painter</span>::<span class="title function_ invoke__">with</span>(<span class="string">&#x27;paintings&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果你使用的是数据仓库，则可以这样指定关联关系</span></span><br><span class="line"><span class="comment">// $repository = new Painter([&#x27;paintings&#x27;]);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Form</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$builder</span>, function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;ID&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;username&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="string">&#x27;bio&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">hasMany</span>(<span class="string">&#x27;paintings&#x27;</span>, function (Form\NestedForm <span class="variable">$form</span>) &#123;</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">textarea</span>(<span class="string">&#x27;body&#x27;</span>);</span><br><span class="line">        <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">datetime</span>(<span class="string">&#x27;completed_at&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;Created At&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;updated_at&#x27;</span>, <span class="string">&#x27;Updated At&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 也可以设置label</span></span><br><span class="line">    <span class="comment">// $form-&gt;hasMany(&#x27;paintings&#x27;, &#x27;画作&#x27;, function (Form\NestedForm $form) &#123;</span></span><br><span class="line">    <span class="comment">//    ...</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p>![](&#x2F;assets&#x2F;img&#x2F;screenshots&#x2F;has-many.png)</p>
<p><a name="has-many-table"></a></p>
<h3 id="表格模式-table"><a href="#表格模式-table" class="headerlink" title="表格模式 (table)"></a>表格模式 (table)</h3><p>如果你想要显示表格模式，可以这样使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">Helper</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">hasMany</span>(<span class="string">&#x27;paintings&#x27;</span>, function (Form\NestedForm <span class="variable">$form</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">useTable</span>();</span><br></pre></td></tr></table></figure>
<p>效果</p>
<a href="/assets/img/screenshots/has-many-table.png" target="_blank">
    <img  src="/assets/img/screenshots/has-many-table.png" style="box-shadow:0 1px 6px 1px rgba(0, 0, 0, 0.12)" width="100%">
</a>


<p><a name="embeds"></a></p>
<h2 id="内嵌-embeds"><a href="#内嵌-embeds" class="headerlink" title="内嵌 (embeds)"></a>内嵌 (embeds)</h2><blockquote>
<p>{tip} 内嵌表单不支持图片和文件上传表单。</p>
</blockquote>
<p>用于处理<code>mysql</code>的<code>JSON</code>类型字段数据或者<code>mongodb</code>的<code>object</code>类型数据，也可以将多个field的数据值以<code>JSON</code>字符串的形式存储在<code>mysql</code>的字符串类型字段中</p>
<p>比如<code>orders</code>表中的<code>JSON</code>或字符串类型的<code>extra</code>字段，用来存储多个field的数据，先定义model:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$casts</span> = [</span><br><span class="line">        <span class="string">&#x27;extra&#x27;</span> =&gt; <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在form中使用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">embeds</span>(<span class="string">&#x27;extra&#x27;</span>, function (<span class="variable">$form</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;extra1&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">email</span>(<span class="string">&#x27;extra2&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">mobile</span>(<span class="string">&#x27;extra3&#x27;</span>);</span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">datetime</span>(<span class="string">&#x27;extra4&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">dateRange</span>(<span class="string">&#x27;extra5&#x27;</span>, <span class="string">&#x27;extra6&#x27;</span>, <span class="string">&#x27;范围&#x27;</span>)-&gt;<span class="title function_ invoke__">rules</span>(<span class="string">&#x27;required&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义标题</span></span><br><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">embeds</span>(<span class="string">&#x27;extra&#x27;</span>, <span class="string">&#x27;附加信息&#x27;</span>, function (<span class="variable">$form</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>回调函数里面构建表单元素的方法调用和外面是一样的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-fields/" data-id="clpdpxfja000zywnad5b8781x" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form-init" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-init/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.964Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单初始化"><a href="#表单初始化" class="headerlink" title="表单初始化"></a>表单初始化</h1><p>通过<code>Form::resolving</code>方法设置的回调函数会在<code>Dcat\Admin\Form</code>类被实例化时触发；</p>
<p>通过<code>Form::composing</code>方法设置的回调函数会在<code>render()</code>方法被调用时（渲染页面时）触发；</p>
<p>开发者可以在这两个事件中改变<code>Form</code>的一些设置或行为，比如需要禁用掉某些操作，可以在<code>app/Admin/bootstrap.php</code>加入下面的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">resolving</span>(function (Form <span class="variable">$form</span>) &#123;</span><br><span class="line"></span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableEditingCheck</span>();</span><br><span class="line">    </span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableCreatingCheck</span>();</span><br><span class="line">    </span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">disableViewCheck</span>();</span><br><span class="line">    </span><br><span class="line">     <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">tools</span>(function (Form\Tools <span class="variable">$tools</span>) &#123;</span><br><span class="line">          <span class="variable">$tools</span>-&gt;<span class="title function_ invoke__">disableDelete</span>();</span><br><span class="line">          <span class="variable">$tools</span>-&gt;<span class="title function_ invoke__">disableView</span>();</span><br><span class="line">          <span class="variable">$tools</span>-&gt;<span class="title function_ invoke__">disableList</span>();</span><br><span class="line">     &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样就不用在每一个控制器的代码中来设置了。</p>
<p>如果全局设置后，要在其中某一个表单中开启设置，比如开启显示<code>继续编辑</code>的checkbox，在对应的实例上调用<code>$form-&gt;disableEditingCheck(false);</code>就可以了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-init/" data-id="clpdpxfjb0010ywnaeu7u37kn" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form-data" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-data/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.963Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单数据源"><a href="#表单数据源" class="headerlink" title="表单数据源"></a>表单数据源</h1><h2 id="模型与数据仓库"><a href="#模型与数据仓库" class="headerlink" title="模型与数据仓库"></a>模型与数据仓库</h2><p>数据仓库(<code>Repository</code>)是一个可以提供特定接口对数据进行读写操作的类，通过数据仓库的引入，可以让页面的构建不再关心数据读写功能的具体实现，开发者只需要实现特定的操作接口即可轻松切换数据源。关于数据仓库的详细用法请参考文档<a href="model-repository.md">数据仓库</a>。</p>
<h2 id="数据来自模型"><a href="#数据来自模型" class="headerlink" title="数据来自模型"></a>数据来自模型</h2><blockquote>
<p>{tip} 如果你的数据来自<code>Model</code>，那么你也可以直接使用<code>Model</code>实例，底层会自动把<code>Model</code>转化为数据仓库实例。</p>
</blockquote>
<p>当数据源支持模型时，只需创建一个非常简单的<code>Repository</code>类既可：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">EloquentRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Movie</span> <span class="keyword">as</span> <span class="title">MovieModel</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">EloquentRepository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 这里定义你的模型类名</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$eloquentClass</span> = <span class="title class_">MovieModel</span>::<span class="variable language_">class</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过这个方法可以指定表单页查询的字段，默认&quot;*&quot;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormColumns</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getKeyName</span>(), <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Movie</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span> = <span class="keyword">new</span> <span class="title class_">Form</span>(<span class="keyword">new</span> <span class="title class_">Movie</span>);</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="数据来自外部API"><a href="#数据来自外部API" class="headerlink" title="数据来自外部API"></a>数据来自外部API</h2><p>下面以<code>豆瓣电影</code>的API为例子，来展示<code>Repository</code>的表单数据读写操作相关接口的用法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Repositories</span>\<span class="title">Repository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComingSoon</span> <span class="keyword">extends</span> <span class="title">Repository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$api</span> = <span class="string">&#x27;https://api.douban.com/v2/movie/coming_soon&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 返回你的id字段名称，默认“id”</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$keyName</span> = <span class="string">&#x27;_id&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询编辑页数据</span></span><br><span class="line">    <span class="comment">// 这个方法需要返回一个数组</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span>(<span class="params">Form <span class="variable">$form</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取id</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">builder</span>()-&gt;<span class="title function_ invoke__">getResourceId</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;http://api.douban.com/v2/movie/subject/<span class="subst">$id</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">json_decode</span>(<span class="variable">$data</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这个方法用于在修改数据前查询原记录</span></span><br><span class="line">    <span class="comment">// 如果使用了文件上传表单，当文件发生变更时会根据这个原始记录自动删除旧文件</span></span><br><span class="line">     <span class="comment">// 如果不需要此数据返回空数组即可</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">updating</span>(<span class="params">Form <span class="variable">$form</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取id</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">builder</span>()-&gt;<span class="title function_ invoke__">getResourceId</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改操作</span></span><br><span class="line">    <span class="comment">// 返回一个bool类型的数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">Form <span class="variable">$form</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取id</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">builder</span>()-&gt;<span class="title function_ invoke__">getResourceId</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取要修改的数据</span></span><br><span class="line">        <span class="variable">$attributes</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">updates</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">        <span class="comment">// 这里写你的修改逻辑</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这个方法用于在修改数据前查询原始数据</span></span><br><span class="line">    <span class="comment">// 如果使用了文件上传表单，会根据这个数据自动删除文件</span></span><br><span class="line">    <span class="comment">// 如果不需要此数据返回空数组即可</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleting</span>(<span class="params">Form <span class="variable">$form</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">builder</span>()-&gt;<span class="title function_ invoke__">getResourceId</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        $data = file_get_contents(&quot;http://api.douban.com/v2/movie/subject/$id&quot;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        return json_decode($data, true);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除数据</span></span><br><span class="line">    <span class="comment">// $deletingData 是由 getDataWhenDeleting 方法返回的数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span>(<span class="params">Form <span class="variable">$form</span>, <span class="variable">$deletingData</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 注意这里的id可能是多个</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$form</span>-&gt;<span class="title function_ invoke__">builder</span>()-&gt;<span class="title function_ invoke__">getResourceId</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 当使用批量删除功能时，这里的id是用“,”隔开的字符串</span></span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line"><span class="comment">//        var_dump($id, $deletingData);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-data/" data-id="clpdpxfj7000xywnafdhebjen" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/model-form-field-management" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/model-form-field-management/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.963Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="表单字段的管理"><a href="#表单字段的管理" class="headerlink" title="表单字段的管理"></a>表单字段的管理</h1><h2 id="扩展自定义组件"><a href="#扩展自定义组件" class="headerlink" title="扩展自定义组件"></a>扩展自定义组件</h2><p>在开始扩展表单组件之前需要先了解<a href="js.md#init">动态监听元素生成 (init)</a>功能，表单组件的<code>JS</code>代码建议都使用<code>Dcat.init</code>方法监听并初始化，否则可能无法兼容<code>Form::hasMany</code>以及<code>Form::array</code>等动态生成字段的表单类型。</p>
<h3 id="集成富文本编辑器wangEditor"><a href="#集成富文本编辑器wangEditor" class="headerlink" title="集成富文本编辑器wangEditor"></a>集成富文本编辑器wangEditor</h3><p><a target="_blank" rel="noopener" href="http://www.wangeditor.com/">wangEditor</a>是一个优秀的国产的轻量级富文本编辑器，如果<code>dcat-admin</code>自带的基于<code>ckeditor</code>的编辑器组件使用上有问题，可以通过下面的步骤可以集成它，并覆盖掉默认的<code>editor</code>：</p>
<blockquote>
<p>为了方便演示，示例中直接使用CDN链接。实际开发中需要先下载前端库文件<a target="_blank" rel="noopener" href="https://github.com/wangfupeng1988/wangEditor/releases">wangEditor</a>到服务器，解压到目录<code>public/vendor/wangEditor-4.7.1</code>。</p>
</blockquote>
<p>新建组件类<code>app/Admin/Extensions/Form/WangEditor.php</code>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>\<span class="title class_">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>\<span class="title">Field</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WangEditor</span> <span class="keyword">extends</span> <span class="title">Field</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$view</span> = <span class="string">&#x27;admin.wang-editor&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建视图文件<code>resources/views/admin/wang-editor.blade.php</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;form-group&#x27;]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;label&#x27;]&#125;&#125; control-label&quot;</span>&gt;</span>&#123;&#123;$label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;field&#x27;]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        @include(&#x27;admin::form.error&#x27;)</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> &#123;!! $<span class="attr">attributes</span> !!&#125; <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 100%;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;!! $value !!&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;$name&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; old($column, $value) &#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        @include(&#x27;admin::form.help-block&#x27;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- script标签加上 &quot;init&quot; 属性后会自动使用 Dcat.init() 方法动态监听元素生成 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">require</span>=<span class="string">&quot;@wang-editor&quot;</span> <span class="attr">init</span>=<span class="string">&quot;&#123;!! $selector !!&#125;&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> E = <span class="variable language_">window</span>.<span class="property">wangEditor</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// id 变量是 Dcat.init() 自动生成的，是一个唯一的随机字符串</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> editor = <span class="keyword">new</span> <span class="title function_">E</span>(<span class="string">&#x27;#&#x27;</span> + id);</span></span><br><span class="line"><span class="language-javascript">    editor.<span class="property">config</span>.<span class="property">zIndex</span> = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">    editor.<span class="property">config</span>.<span class="property">uploadImgShowBase64</span> = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    editor.<span class="property">config</span>.<span class="property">onchange</span> = <span class="keyword">function</span> (<span class="params">html</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $this.<span class="title function_">parents</span>(<span class="string">&#x27;.form-field&#x27;</span>).<span class="title function_">find</span>(<span class="string">&#x27;input[type=&quot;hidden&quot;]&#x27;</span>).<span class="title function_">val</span>(html);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    editor.<span class="title function_">create</span>()</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后注册进<code>dcat-admin</code>，在<code>app/Admin/bootstrap.php</code>中添加以下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Extensions</span>\<span class="title">Form</span>\<span class="title">WangEditor</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册前端组件别名</span></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">asset</span>()-&gt;<span class="title function_ invoke__">alias</span>(<span class="string">&#x27;@wang-editor&#x27;</span>, [</span><br><span class="line">    // 为了方便演示效果，这里直接加载CDN链接，实际开发中可以下载到服务器加载</span><br><span class="line">    <span class="string">&#x27;js&#x27;</span> =&gt; [<span class="string">&#x27;https://cdn.jsdelivr.net/npm/wangeditor@4.7.1/dist/wangEditor.min.js&#x27;</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">extend</span>(<span class="string">&#x27;editor&#x27;</span>, <span class="title class_">WangEditor</span>::<span class="variable language_">class</span>);</span><br></pre></td></tr></table></figure>

<p>调用:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">editor</span>(<span class="string">&#x27;body&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="集成富文本编辑器ckeditor"><a href="#集成富文本编辑器ckeditor" class="headerlink" title="集成富文本编辑器ckeditor"></a>集成富文本编辑器ckeditor</h3><p>先下载<a target="_blank" rel="noopener" href="http://ckeditor.com/download">ckeditor</a> 并解压到&#x2F;public目录，比如放在<code>/public/packages/</code>目录下。</p>
<p>然后新建扩展文件<code>app/Admin/Extensions/Form/CKEditor.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>\<span class="title class_">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>\<span class="title">Field</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CKEditor</span> <span class="keyword">extends</span> <span class="title">Field</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$view</span> = <span class="string">&#x27;admin.ckeditor&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建view <code>resources/views/admin/ckeditor.blade.php</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;form-group&#x27;]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;label&#x27;]&#125;&#125; control-label&quot;</span>&gt;</span>&#123;&#123;$label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;field&#x27;]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        @include(&#x27;admin::form.error&#x27;)</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123; $name&#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&#123;&#123; $placeholder &#125;&#125;&quot;</span> &#123;!! $<span class="attr">attributes</span> !!&#125; &gt;</span>&#123;!! $value !!&#125;<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        @include(&#x27;admin::form.help-block&#x27;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">require</span>=<span class="string">&quot;@ckeditor&quot;</span> <span class="attr">init</span>=<span class="string">&quot;&#123;!! $selector !!&#125;&quot;</span>&gt;</span></span><br><span class="line">    $this.ckeditor();</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在<code>app/Admin/bootstrap.php</code>中引入扩展：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Extensions</span>\<span class="title">Form</span>\<span class="title">CKEditor</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册前端组件别名</span></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">asset</span>()-&gt;<span class="title function_ invoke__">alias</span>(<span class="string">&#x27;@ckeditor&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;js&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;/packages/ckeditor/ckeditor.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;/packages/ckeditor/adapters/jquery.js&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Form</span>::<span class="title function_ invoke__">extend</span>(<span class="string">&#x27;ckeditor&#x27;</span>, <span class="title class_">CKEditor</span>::<span class="variable language_">class</span>);</span><br></pre></td></tr></table></figure>

<p>然后就能在form中使用了:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$form</span>-&gt;<span class="title function_ invoke__">ckeditor</span>(<span class="string">&#x27;content&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="集成PHP-editor"><a href="#集成PHP-editor" class="headerlink" title="集成PHP editor"></a>集成PHP editor</h3><p>通过下面的步骤来扩展一个基于<a target="_blank" rel="noopener" href="http://codemirror.net/index.html">codemirror</a>的PHP代码编辑器，效果参考<a target="_blank" rel="noopener" href="http://codemirror.net/mode/php/">PHP mode</a>。</p>
<p>先将<a target="_blank" rel="noopener" href="http://codemirror.net/codemirror.zip">codemirror</a>库下载并解压到前端资源目录下，比如放在<code>public/packages/codemirror-5.20.2</code>目录下。</p>
<p>新建组件类<code>app/Admin/Extensions/Form/PHPEditor.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Extensions</span>\<span class="title class_">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Form</span>\<span class="title">Field</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PHPEditor</span> <span class="keyword">extends</span> <span class="title">Field</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$view</span> = <span class="string">&#x27;admin.php-editor&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>{tip} 类中的静态资源也同样可以从外部引入，参考<a target="_blank" rel="noopener" href="https://github.com/jqhph/dcat-admin/blob/master/src/Form/Field/Editor.php">Editor.php</a></p>
</blockquote>
<p>创建视图<code>resources/views/admin/php-editor.blade.php</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;form-group&#x27;]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;label&#x27;]&#125;&#125; control-label&quot;</span>&gt;</span>&#123;&#123;$label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;field&#x27;]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        @include(&#x27;admin::form.error&#x27;)</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123; $class &#125;&#125;&quot;</span>   &#123;!! $<span class="attr">attributes</span> !!&#125; &gt;</span>&#123;!! $value !!&#125;<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;$name&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; old($column, $value) &#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        @include(&#x27;admin::form.help-block&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">require</span>=<span class="string">&quot;@phpeditor&quot;</span> <span class="attr">init</span>=<span class="string">&quot;&#123;!! $selector !!&#125;&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">Editor</span> = <span class="title class_">CodeMirror</span>.<span class="title function_">fromTextArea</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(id), &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">lineNumbers</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">mode</span>: <span class="string">&quot;text/x-php&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">extraKeys</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;Tab&quot;</span>: <span class="keyword">function</span>(<span class="params">cm</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                cm.<span class="title function_">replaceSelection</span>(<span class="string">&quot;    &quot;</span> , <span class="string">&quot;end&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Editor</span>.<span class="title function_">on</span>(<span class="string">&quot;change&quot;</span>, <span class="keyword">function</span> (<span class="params">Editor, changes</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> val = <span class="title class_">Editor</span>.<span class="title function_">getValue</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//console.log(val);</span></span></span><br><span class="line"><span class="language-javascript">        $this.<span class="title function_">parents</span>(<span class="string">&#x27;.form-field&#x27;</span>).<span class="title function_">find</span>(<span class="string">&#x27;input[type=&quot;hidden&quot;]&#x27;</span>).<span class="title function_">val</span>(val);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后找到文件<code>app/Admin/bootstrap.php</code>,如果文件不存在，请更新<code>dcat-admin</code>，然后新建该文件,添加下面代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">use App\Admin\Extensions\Form\PHPEditor;</span><br><span class="line">use Dcat\Admin\Form;</span><br><span class="line"></span><br><span class="line">Admin::asset()-&gt;alias(&#x27;@phpeditor&#x27;, [</span><br><span class="line">    &#x27;js&#x27; =&gt; [</span><br><span class="line">        &#x27;/packages/codemirror-5.20.2/lib/codemirror.js&#x27;,</span><br><span class="line">        &#x27;/packages/codemirror-5.20.2/addon/edit/matchbrackets.js&#x27;,</span><br><span class="line">        &#x27;/packages/codemirror-5.20.2/mode/htmlmixed/htmlmixed.js&#x27;,</span><br><span class="line">        &#x27;/packages/codemirror-5.20.2/mode/xml/xml.js&#x27;,</span><br><span class="line">        &#x27;/packages/codemirror-5.20.2/mode/javascript/javascript.js&#x27;,</span><br><span class="line">        &#x27;/packages/codemirror-5.20.2/mode/css/css.js&#x27;,</span><br><span class="line">        &#x27;/packages/codemirror-5.20.2/mode/clike/clike.js&#x27;,</span><br><span class="line">        &#x27;/packages/codemirror-5.20.2/mode/php/php.js&#x27;,</span><br><span class="line">    ],</span><br><span class="line">    &#x27;css&#x27; =&gt; &#x27;/packages/codemirror-5.20.2/lib/codemirror.css&#x27;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">Form::extend(&#x27;php&#x27;, PHPEditor::class);</span><br></pre></td></tr></table></figure>

<p>这样就能在<a href="model-form.md">model-form</a>中使用PHP编辑器了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$form-&gt;php(&#x27;code&#x27;);</span><br></pre></td></tr></table></figure>

<p>通过这种方式，可以添加任意你想要添加的<code>form</code>组件。</p>
<h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><p>表单组件是<code>Dcat Admin</code>中最为复杂的组件，下面列一些在扩展表单组件中可能需要用到的方法</p>
<h3 id="处理用户输入的表单值-prepareInputValue"><a href="#处理用户输入的表单值-prepareInputValue" class="headerlink" title="处理用户输入的表单值 (prepareInputValue)"></a>处理用户输入的表单值 (prepareInputValue)</h3><p>通过<code>prepareInputValue</code>方法可以处理用户输入的表单值，默认不做任何处理。此方法在<code>Form</code>表单的<code>saving</code>事件触发之后，表单字段的<code>saving</code>方法之前执行</p>
<blockquote>
<p>{tip} 这个功能类似<code>Laravel model</code>中的<strong>修改器</strong>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PHPEditor</span> <span class="keyword">extends</span> <span class="title">Field</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 把用户输入的表单值转化为 string 格式保存到数据库</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">prepareInputValue</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">string</span>) <span class="variable">$value</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理待显示的字段值-formatFieldData"><a href="#处理待显示的字段值-formatFieldData" class="headerlink" title="处理待显示的字段值 (formatFieldData)"></a>处理待显示的字段值 (formatFieldData)</h3><p>通过<code>formatFieldData</code>方法可以处理处理待显示的字段值。此方法在表单字段的<code>customFormat</code>方法之前执行</p>
<blockquote>
<p>{tip} 这个功能类似<code>Laravel model</code>中的<strong>访问器</strong>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PHPEditor</span> <span class="keyword">extends</span> <span class="title">Field</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 把字段值转化为数组格式</span></span><br><span class="line">	<span class="comment">// $data是当前表单的编辑数据，数据格式是 array</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">formatFieldData</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	    <span class="comment">// 获取到当前字段值</span></span><br><span class="line">		<span class="variable">$value</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">formatFieldData</span>(<span class="variable">$data</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 处理字段值</span></span><br><span class="line">		...</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取元素CSS选择器-getElementClassSelector"><a href="#获取元素CSS选择器-getElementClassSelector" class="headerlink" title="获取元素CSS选择器 (getElementClassSelector)"></a>获取元素CSS选择器 (getElementClassSelector)</h3><p>表单组件类实例化后会根据字段名称生成一个<code>css class</code>，然后传递到模板中，我们通常可以通过这个<code>class</code>获取到当前表单的元素对象</p>
<p>模板</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;form-group&#x27;]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123; $viewClass[&#x27;label&#x27;] &#125;&#125; control-label&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;!! $label !!&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;field&#x27;]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        @include(&#x27;admin::form.error&#x27;)</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;$name&#125;&#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;$name&#125;&#125;&quot;</span> &#123;!! $<span class="attr">attributes</span> !!&#125; &gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">		   @foreach($options as $select =&gt; $option)</span><br><span class="line">			   <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;$select&#125;&#125;&quot;</span> &#123;&#123; <span class="attr">Dcat</span>\<span class="attr">Admin</span>\<span class="attr">Support</span>\<span class="attr">Helper::equal</span>($<span class="attr">select</span>, $<span class="attr">value</span>) ?&#x27;<span class="attr">selected</span>&#x27;<span class="attr">:</span>&#x27;&#x27; &#125;&#125;&gt;</span>&#123;&#123;$option&#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">		   @endforeach</span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        @include(&#x27;admin::form.help-block&#x27;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">require</span>=<span class="string">&quot;...&quot;</span> <span class="attr">init</span>=<span class="string">&quot;&#123;!! $selector !!&#125;&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 这里的 $selector 即是当前字段的 css选择器</span></span></span><br><span class="line"><span class="language-javascript">    $this.<span class="title function_">select2</span>($configs);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="JS代码"><a href="#JS代码" class="headerlink" title="JS代码"></a>JS代码</h3><p>为了让扩展的表单组件能够兼容<code>HasMany</code>、<code>array</code>以及<code>Table</code>表单，我们必须使用<a href="js.md#init">动态监听元素生成 (init)</a>功能</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;$viewClass[&#x27;form-group&#x27;]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">require</span>=<span class="string">&quot;...&quot;</span> <span class="attr">init</span>=<span class="string">&quot;&#123;!! $selector !!&#125;&quot;</span>&gt;</span></span><br><span class="line">    $this.select2($configs);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/model-form-field-management/" data-id="clpdpxfj9000yywna9i4l36q2" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/lazy" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/lazy/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.962Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="异步加载基本使用"><a href="#异步加载基本使用" class="headerlink" title="异步加载基本使用"></a>异步加载基本使用</h1><blockquote>
<p>{tip} 异步加载功能支持<strong>静态资源按需加载</strong>的特性，目前内置的<strong>所有组件</strong>都支持使用异步渲染功能，并且支持在页面的<strong>任意位置</strong>中使用</p>
</blockquote>
<p>通过异步加载功能可以让页面中的整体或局部组件使用<code>ajax</code>异步渲染，从而提高页面加载效率（例如弹窗异步加载表单）。</p>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><p>下面通过一个简单的示例来演示异步加载功能的用法</p>
<p>先定义一个异步渲染类，继承<code>Dcat\Admin\Support\LazyRenderable</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Renderable</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Charts</span>\<span class="title">Bar</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostChart</span> <span class="keyword">extends</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="comment">// 获取外部传递的参数</span></span><br><span class="line">    	<span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">        </span><br><span class="line">    	<span class="comment">// 查询数据逻辑</span></span><br><span class="line">    	<span class="variable">$data</span> = [...];</span><br><span class="line">    	</span><br><span class="line">    	<span class="comment">// 这里可以返回内置组件，也可以返回视图文件或HTML字符串</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Bar</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$data</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后需要把渲染类实例传入<code>Dcat\Admin\Widgets\Lazy</code>对象中，才能最终实现异步渲染的效果</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">PostChart</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Lazy</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Layout</span>\<span class="title">Content</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Content <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 实例化异步渲染类并传递自定义参数</span></span><br><span class="line">    <span class="variable">$chart</span> = <span class="title class_">PostChart</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; ...]);</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$content</span>-&gt;<span class="title function_ invoke__">body</span>(<span class="title class_">Lazy</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$chart</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以放在内置组件中</p>
<blockquote>
<p>{tip} 如果是 <code>Dcat\Admin\Widgets\Card</code>、<code>Dcat\Admin\Widgets\Box</code>、<code>Dcat\Admin\Widgets\Modal</code>、<code>Dcat\Admin\Widgets\Tab</code>等组件，则可以略过<code>Dcat\Admin\Widgets\Lazy</code>组件，直接传递渲染类实例</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">PostChart</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Card</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Layout</span>\<span class="title">Content</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Content <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$chart</span> = <span class="title class_">PostChart</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; ...]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Card 组件支持直接传递 LazyRenderable 实例，可以略过 Lazy 对象</span></span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$content</span>-&gt;<span class="title function_ invoke__">body</span>(<span class="title class_">Card</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$chart</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果是 Modal、Box 等等都可以直接略过 Lazy</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Modal</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$chart</span> = <span class="title class_">PostChart</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; ...]);</span><br><span class="line"> </span><br><span class="line"><span class="variable">$modal</span> = <span class="title class_">Modal</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">	-&gt;<span class="title function_ invoke__">lg</span>()</span><br><span class="line">	-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;标题&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">delay</span>(<span class="number">300</span>) <span class="comment">// 如果是异步渲染图表则需要设置一个延迟时间，否则可能导致图表渲染异常</span></span><br><span class="line">	-&gt;<span class="title function_ invoke__">body</span>(<span class="variable">$chart</span>);</span><br></pre></td></tr></table></figure>

<p>当然也可以防止在视图或者是<code>HTML</code>代码中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">PostChart</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Lazy</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Layout</span>\<span class="title">Content</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Content <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$chart</span> = <span class="title class_">Lazy</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">PostChart</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;id&#x27;</span> =&gt; ...]));</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$content</span>-&gt;<span class="title function_ invoke__">body</span>(<span class="title function_ invoke__">view</span>(<span class="string">&#x27;admin.xxx&#x27;</span>, [<span class="string">&#x27;chart&#x27;</span> =&gt; <span class="variable">$chart</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<a href="https://cdn.learnku.com/uploads/images/202008/20/38389/Z1X46kZLtM.gif!large" target="_blank">
![](https://cdn.learnku.com/uploads/images/202008/20/38389/Z1X46kZLtM.gif!large)
</a>


<h3 id="Dcat-Admin-Support-LazyRenderable"><a href="#Dcat-Admin-Support-LazyRenderable" class="headerlink" title="Dcat\Admin\Support\LazyRenderable"></a>Dcat\Admin\Support\LazyRenderable</h3><h4 id="参数传递-payload"><a href="#参数传递-payload" class="headerlink" title="参数传递 (payload)"></a>参数传递 (payload)</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">PostChart</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">PostChart</span>::<span class="title function_ invoke__">make</span>([<span class="string">&#x27;key1&#x27;</span> =&gt; <span class="string">&#x27;值&#x27;</span>, ...]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以通过 payload 方法传递</span></span><br><span class="line"><span class="title class_">PostChart</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">payload</span>([<span class="string">&#x27;key1&#x27;</span> =&gt; <span class="string">&#x27;值&#x27;</span>, ...]);</span><br></pre></td></tr></table></figure>

<p>获取参数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostChart</span> <span class="keyword">extends</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$title</span> = [<span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;标题&#x27;</span>, <span class="string">&#x27;内容&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="comment">// 获取外部传递的参数</span></span><br><span class="line">    	<span class="variable">$key1</span> = <span class="variable language_">$this</span>-&gt;key1;</span><br><span class="line">    	<span class="variable">$key2</span> = <span class="variable language_">$this</span>-&gt;key2;</span><br><span class="line">        </span><br><span class="line">    	...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="载入JS和CSS"><a href="#载入JS和CSS" class="headerlink" title="载入JS和CSS"></a>载入JS和CSS</h4><p>异步加载功能同样支持<strong>静态资源按需加载</strong>的特性，并且用法也很简单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Renderable</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Support</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomView</span> <span class="keyword">extends</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 这里写入需要加载的js和css文件路径</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$js</span> = [</span><br><span class="line">    	<span class="string">&#x27;xxx/xxx1.js&#x27;</span>,</span><br><span class="line">    	<span class="string">&#x27;xxx/xxx2.js&#x27;</span>,     </span><br><span class="line">	];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$css</span> = [</span><br><span class="line">        <span class="string">&#x27;xxx/xxx1.css&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;xxx/xxx2.css&#x27;</span>, </span><br><span class="line">	];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">addScript</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title class_">Admin</span>::<span class="title function_ invoke__">script</span>(</span><br><span class="line">            <span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">		console.log(&#x27;JS</span>脚本都加载完了~<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line"><span class="string">        );</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    public function render()</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        // 添加你的 JS 代码</span></span><br><span class="line"><span class="string">        $this-&gt;addScript();</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">     	return view(&#x27;</span>admin.custom<span class="string">&#x27;, [&#x27;</span>...<span class="string">&#x27;]);   </span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>模板文件代码示例，注意不要包含<code>body</code>和<code>html</code>等标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;custom&quot;</span> <span class="attr">class</span>=<span class="string">&quot;custom&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span>&gt;</span>异步加载功能<span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="title class_">Dcat</span>.<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// JS 代码也可以放在模板文件中</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;模板文件执行js~&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="Dcat-Admin-Widgets-Lazy"><a href="#Dcat-Admin-Widgets-Lazy" class="headerlink" title="Dcat\Admin\Widgets\Lazy"></a>Dcat\Admin\Widgets\Lazy</h3><h4 id="onLoad"><a href="#onLoad" class="headerlink" title="onLoad"></a>onLoad</h4><p>通过此方法可以监听异步加载完成事件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">PostChart</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Lazy</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$chart</span> = <span class="title class_">Lazy</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">PostChart</span>::<span class="title function_ invoke__">make</span>())-&gt;<span class="title function_ invoke__">onLoad</span>(</span><br><span class="line">	<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">console.log(&#x27;组件渲染完成&#x27;);	</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="load"><a href="#load" class="headerlink" title="load"></a>load</h4><p>此方法可以控制是否立即渲染异步组件，默认值是<code>true</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">PostChart</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Lazy</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$lazy</span> = <span class="title class_">Lazy</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">PostChart</span>::<span class="title function_ invoke__">make</span>())-&gt;<span class="title function_ invoke__">load</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">script</span>(</span><br><span class="line">	<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">setTimeout(function () &#123;</span></span><br><span class="line"><span class="string">	// 3秒后自动触发异步渲染事件</span></span><br><span class="line"><span class="string">	<span class="subst">&#123;$lazy-&gt;getLoadScript()&#125;</span></span></span><br><span class="line"><span class="string">&#125;, 3000);	</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="JS事件"><a href="#JS事件" class="headerlink" title="JS事件"></a>JS事件</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">PostChart</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Lazy</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$lazy</span> = <span class="title class_">Lazy</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">PostChart</span>::<span class="title function_ invoke__">make</span>());</span><br><span class="line"></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">script</span>(</span><br><span class="line">	<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">// 手动触发异步渲染事件	</span></span><br><span class="line"><span class="string">$(&#x27;<span class="subst">&#123;$lazy-&gt;getElementSelector()&#125;</span>&#x27;).trigger(&#x27;lazy:load&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 监听渲染完成事件</span></span><br><span class="line"><span class="string">$(&#x27;<span class="subst">&#123;$lazy-&gt;getElementSelector()&#125;</span>&#x27;).on(&#x27;lazy:loaded&#x27;, function () &#123;</span></span><br><span class="line"><span class="string">	console.log(&#x27;组件渲染完成了&#x27;)</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<p><a name="lazy-table"></a></p>
<h2 id="异步加载数据表格"><a href="#异步加载数据表格" class="headerlink" title="异步加载数据表格"></a>异步加载数据表格</h2><p>如果需要异步异步加载数据表格，则定义渲染类时需要继承<code>Dcat\Admin\Grid\LazyRenderable</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Renderable</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Grid</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Models</span>\<span class="title">Administrator</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserTable</span> <span class="keyword">extends</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 指定翻译文件名称</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$translation</span> = <span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span>(<span class="params"></span>): <span class="title">Grid</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Grid</span>::<span class="title function_ invoke__">make</span>(<span class="keyword">new</span> <span class="title class_">Administrator</span>(), <span class="function"><span class="keyword">function</span> (<span class="params">Grid <span class="variable">$grid</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;created_at&#x27;</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;updated_at&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">quickSearch</span>([<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">paginate</span>(<span class="number">10</span>);</span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">disableActions</span>();</span><br><span class="line"></span><br><span class="line">            <span class="variable">$grid</span>-&gt;<span class="title function_ invoke__">filter</span>(function (Grid\Filter <span class="variable">$filter</span>) &#123;</span><br><span class="line">                <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;username&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="number">4</span>);</span><br><span class="line">                <span class="variable">$filter</span>-&gt;<span class="title function_ invoke__">like</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">width</span>(<span class="number">4</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">UserTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Modal</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Layout</span>\<span class="title">Content</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Content <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$modal</span> = <span class="title class_">Modal</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">		-&gt;<span class="title function_ invoke__">lg</span>()</span><br><span class="line">		-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;异步加载 - 表格&#x27;</span>)</span><br><span class="line">		-&gt;<span class="title function_ invoke__">body</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>()) <span class="comment">// Modal 组件支持直接传递 渲染类实例</span></span><br><span class="line">		-&gt;<span class="title function_ invoke__">button</span>(<span class="string">&#x27;打开表格&#x27;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$content</span>-&gt;<span class="title function_ invoke__">body</span>(<span class="variable">$modal</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<a href="https://cdn.learnku.com/uploads/images/202008/23/38389/HiAMIvKext.gif!large" target="_blank">
    ![](https://cdn.learnku.com/uploads/images/202008/23/38389/HiAMIvKext.gif!large)
</a>



<p>同样渲染类的实例也可以附加到 <code>Dcat\Admin\Widgets\Card</code>、<code>Dcat\Admin\Widgets\Box</code>、<code>Dcat\Admin\Widgets\Tab</code>等组件中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">UserTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Card</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$table</span> = <span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$card</span> = <span class="title class_">Card</span>::<span class="title function_ invoke__">make</span>(<span class="string">&#x27;标题&#x27;</span>, <span class="variable">$table</span>)-&gt;<span class="title function_ invoke__">withHeaderBorder</span>();</span><br></pre></td></tr></table></figure>

<p>以上代码渲染<code>UserTable</code>实例时，其实是底层自动加上了<code>Dcat\Admin\Widgets\LazyTable</code>类实例，以上代码等同于</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">UserTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Card</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">LazyTable</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$table</span> = <span class="title class_">LazyTable</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">simple</span>());</span><br><span class="line"></span><br><span class="line"><span class="variable">$card</span> = <span class="title class_">Card</span>::<span class="title function_ invoke__">make</span>(<span class="string">&#x27;标题&#x27;</span>, <span class="variable">$table</span>)-&gt;<span class="title function_ invoke__">withHeaderBorder</span>();</span><br></pre></td></tr></table></figure>

<h3 id="Dcat-Admin-Grid-LazyRenderable"><a href="#Dcat-Admin-Grid-LazyRenderable" class="headerlink" title="Dcat\Admin\Grid\LazyRenderable"></a>Dcat\Admin\Grid\LazyRenderable</h3><p><code>Dcat\Admin\Grid\LazyRenderable</code>用于异步渲染数据表格，是<code>Dcat\Admin\Support\LazyRenderable</code>的子类</p>
<h4 id="简化模式"><a href="#简化模式" class="headerlink" title="简化模式"></a>简化模式</h4><p>此功能会去除简化一些数据表格默认开启的功能，默认不启用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">UserTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">LazyTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Layout</span>\<span class="title">Content</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Content <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$table</span> = <span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">simple</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$content</span>-&gt;<span class="title function_ invoke__">body</span>(<span class="title class_">LazyTable</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$table</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，如果把渲染类实例直接注入到<code>Dcat\Admin\Widgets\Card</code>、<code>Dcat\Admin\Widgets\Box</code>、<code>Dcat\Admin\Widgets\Tab</code>和<code>Dcat\Admin\Widgets\Modal</code>等组件时，则会自动启用<code>simple</code>模式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">UserTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Card</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里会自动启用 simple 模式</span></span><br><span class="line"><span class="variable">$card</span> = <span class="title class_">Card</span>::<span class="title function_ invoke__">make</span>(<span class="string">&#x27;标题&#x27;</span>, <span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>())-&gt;<span class="title function_ invoke__">withHeaderBorder</span>();</span><br></pre></td></tr></table></figure>

<p>如果你不希望启用 simple 模式，可以传入 LazyTable 实例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">UserTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Card</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">LazyTable</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$table</span> = <span class="title class_">LazyTable</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>());</span><br><span class="line"></span><br><span class="line"><span class="variable">$card</span> = <span class="title class_">Card</span>::<span class="title function_ invoke__">make</span>(<span class="string">&#x27;标题&#x27;</span>, <span class="variable">$table</span>)-&gt;<span class="title function_ invoke__">withHeaderBorder</span>();</span><br></pre></td></tr></table></figure>

<h3 id="Dcat-Admin-Widgets-LazyTable"><a href="#Dcat-Admin-Widgets-LazyTable" class="headerlink" title="Dcat\Admin\Widgets\LazyTable"></a>Dcat\Admin\Widgets\LazyTable</h3><h4 id="onLoad-1"><a href="#onLoad-1" class="headerlink" title="onLoad"></a>onLoad</h4><p>通过此方法可以监听异步加载完成事件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">PostChart</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Lazy</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$chart</span> = <span class="title class_">Lazy</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">PostChart</span>::<span class="title function_ invoke__">make</span>())-&gt;<span class="title function_ invoke__">onLoad</span>(</span><br><span class="line">	<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">console.log(&#x27;组件渲染完成&#x27;);	</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="load-1"><a href="#load-1" class="headerlink" title="load"></a>load</h4><p>此方法可以控制是否立即渲染异步组件，默认值是<code>true</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">UserTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">LazyTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$lazy</span> = <span class="title class_">LazyTable</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>())-&gt;<span class="title function_ invoke__">load</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">script</span>(</span><br><span class="line">	<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">setTimeout(function () &#123;</span></span><br><span class="line"><span class="string">	// 3秒后自动触发异步渲染事件</span></span><br><span class="line"><span class="string">	<span class="subst">&#123;$lazy-&gt;getLoadScript()&#125;</span></span></span><br><span class="line"><span class="string">&#125;, 3000);	</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="JS事件-1"><a href="#JS事件-1" class="headerlink" title="JS事件"></a>JS事件</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Renderable</span>\<span class="title">UserTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">LazyTable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$lazy</span> = <span class="title class_">LazyTable</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">UserTable</span>::<span class="title function_ invoke__">make</span>());</span><br><span class="line"></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">script</span>(</span><br><span class="line">	<span class="string">&lt;&lt;&lt;JS</span></span><br><span class="line"><span class="string">// 手动触发异步渲染事件	</span></span><br><span class="line"><span class="string">$(&#x27;<span class="subst">&#123;$lazy-&gt;getElementSelector()&#125;</span>&#x27;).trigger(&#x27;table:load&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 监听渲染完成事件</span></span><br><span class="line"><span class="string">$(&#x27;<span class="subst">&#123;$lazy-&gt;getElementSelector()&#125;</span>&#x27;).on(&#x27;table:loaded&#x27;, function () &#123;</span></span><br><span class="line"><span class="string">	console.log(&#x27;组件渲染完成了&#x27;)</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">JS</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<p><a name="lazy-form"></a></p>
<h2 id="异步加载工具表单"><a href="#异步加载工具表单" class="headerlink" title="异步加载工具表单"></a>异步加载工具表单</h2><p>定义工具表单类，实现<code>Dcat\Admin\Contracts\LazyRenderable</code>，并载入<code>Dcat\Admin\Traits\LazyWidget</code>这个<code>trait</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Forms</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Contracts</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">LazyWidget</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span> <span class="keyword">extends</span> <span class="title">Form</span> <span class="keyword">implements</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">LazyWidget</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 指定翻译文件名称</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$translation</span> = <span class="string">&#x27;user-profile&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$input</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;保存成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">form</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.name&#x27;</span>))-&gt;<span class="title function_ invoke__">required</span>()-&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;用户昵称&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;avatar&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.avatar&#x27;</span>))-&gt;<span class="title function_ invoke__">autoUpload</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;old_password&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.old_password&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.password&#x27;</span>))</span><br><span class="line">            -&gt;<span class="title function_ invoke__">minLength</span>(<span class="number">5</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">maxLength</span>(<span class="number">20</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$v</span> == <span class="variable language_">$this</span>-&gt;password) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$v</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;请输入5-20个字符&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password_confirmation&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.password_confirmation&#x27;</span>))</span><br><span class="line">            -&gt;<span class="title function_ invoke__">same</span>(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;请输入确认密码&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Forms</span>\<span class="title">UserProfile</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Modal</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Layout</span>\<span class="title">Content</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Content <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$modal</span> = <span class="title class_">Modal</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">		-&gt;<span class="title function_ invoke__">lg</span>()</span><br><span class="line">		-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;异步加载 - 表单&#x27;</span>)</span><br><span class="line">		-&gt;<span class="title function_ invoke__">body</span>(<span class="title class_">UserProfile</span>::<span class="title function_ invoke__">make</span>()) <span class="comment">// Modal 组件支持直接传递渲染类实例</span></span><br><span class="line">		-&gt;<span class="title function_ invoke__">button</span>(<span class="string">&#x27;打开表单&#x27;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$content</span>-&gt;<span class="title function_ invoke__">body</span>(<span class="variable">$modal</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src="https://cdn.learnku.com/uploads/images/202008/20/38389/C8InwPTsQG.gif!large"></p>
<p>当然异步表单实例，也可以在其他组件中使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Forms</span>\<span class="title">UserProfile</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Lazy</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Card</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$form</span> = <span class="title class_">UserProfile</span>::<span class="title function_ invoke__">make</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接传递到 Card 组件中</span></span><br><span class="line"><span class="variable">$card</span> = <span class="title class_">Card</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$form</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="variable">$card</span> = <span class="title class_">Card</span>::<span class="title function_ invoke__">make</span>(<span class="title class_">Lazy</span>::<span class="title function_ invoke__">make</span>(<span class="variable">$form</span>));</span><br></pre></td></tr></table></figure>


<h3 id="传递自定义参数"><a href="#传递自定义参数" class="headerlink" title="传递自定义参数"></a>传递自定义参数</h3><p>给异步表单传递参数非常简单，修改上面表单类如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Forms</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Contracts</span>\<span class="title">LazyRenderable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Traits</span>\<span class="title">LazyWidget</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Widgets</span>\<span class="title">Form</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span> <span class="keyword">extends</span> <span class="title">Form</span> <span class="keyword">implements</span> <span class="title">LazyRenderable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">LazyWidget</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$input</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取外部传递的参数</span></span><br><span class="line">        <span class="variable">$key1</span> = <span class="variable language_">$this</span>-&gt;payload[<span class="string">&#x27;key1&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">        <span class="variable">$key2</span> = <span class="variable language_">$this</span>-&gt;payload[<span class="string">&#x27;key1&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;保存成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">form</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取外部传递的参数</span></span><br><span class="line">		<span class="variable">$key1</span> = <span class="variable language_">$this</span>-&gt;payload[<span class="string">&#x27;key1&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">		<span class="variable">$key2</span> = <span class="variable language_">$this</span>-&gt;payload[<span class="string">&#x27;key1&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;name&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.name&#x27;</span>))-&gt;<span class="title function_ invoke__">required</span>()-&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;用户昵称&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">image</span>(<span class="string">&#x27;avatar&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.avatar&#x27;</span>))-&gt;<span class="title function_ invoke__">autoUpload</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;old_password&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.old_password&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.password&#x27;</span>))</span><br><span class="line">            -&gt;<span class="title function_ invoke__">minLength</span>(<span class="number">5</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">maxLength</span>(<span class="number">20</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">customFormat</span>(function (<span class="variable">$v</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$v</span> == <span class="variable language_">$this</span>-&gt;password) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$v</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;请输入5-20个字符&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">password</span>(<span class="string">&#x27;password_confirmation&#x27;</span>, <span class="title function_ invoke__">trans</span>(<span class="string">&#x27;admin.password_confirmation&#x27;</span>))</span><br><span class="line">            -&gt;<span class="title function_ invoke__">same</span>(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">help</span>(<span class="string">&#x27;请输入确认密码&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">default</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取外部传递的参数</span></span><br><span class="line">		<span class="variable">$key1</span> = <span class="variable language_">$this</span>-&gt;payload[<span class="string">&#x27;key1&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">		<span class="variable">$key2</span> = <span class="variable language_">$this</span>-&gt;payload[<span class="string">&#x27;key1&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">		];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>传递参数代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传递自定义参数</span></span><br><span class="line"><span class="variable">$form</span> = <span class="title class_">UserProfile</span>::<span class="title function_ invoke__">make</span>()-&gt;<span class="title function_ invoke__">payload</span>([<span class="string">&#x27;key1&#x27;</span> =&gt; <span class="string">&#x27;...&#x27;</span>, <span class="string">&#x27;key2&#x27;</span> =&gt; <span class="string">&#x27;...&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$modal</span> = <span class="title class_">Modal</span>::<span class="title function_ invoke__">make</span>()</span><br><span class="line">	-&gt;<span class="title function_ invoke__">lg</span>()</span><br><span class="line">	-&gt;<span class="title function_ invoke__">title</span>(<span class="string">&#x27;异步加载 - 表单&#x27;</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">body</span>(<span class="variable">$form</span>)</span><br><span class="line">	-&gt;<span class="title function_ invoke__">button</span>(<span class="string">&#x27;打开表单&#x27;</span>);</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/lazy/" data-id="clpdpxfj4000uywna1tgt70is" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2.x/menu" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/2.x/menu/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T07:16:44.962Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="菜单"><a href="#菜单" class="headerlink" title="菜单"></a>菜单</h1><p><code>Dcat Admin</code>的菜单是保存在数据表<code>admin_menu</code>上的，开发者可以在后台菜单管理页面对菜单进行管理。</p>
<h3 id="菜单权限"><a href="#菜单权限" class="headerlink" title="菜单权限"></a>菜单权限</h3><p>每个菜单都可以与权限或角色进行绑定，如果不设置则为公共菜单，所有账号都能看到。</p>
<p>通过<code>admin.menu.bind_permission</code>配置参数可以设置是否允许绑定权限。</p>
<blockquote>
<p>{tip} 默认一个菜单最多能绑定一个权限和一个角色。</p>
</blockquote>
<h3 id="菜单翻译"><a href="#菜单翻译" class="headerlink" title="菜单翻译"></a>菜单翻译</h3><p>在您的语言文件的menu_titles索引中追加菜单标题。 例如“工作单位”标题：</p>
<p>在<code>resources/lang/&#123;当前语言&#125;/admin.php</code>中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="string">&#x27;menu_titles&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;work_units&#x27;</span> =&gt; <span class="string">&#x27;Unidades de trabajo&#x27;</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<h3 id="菜单缓存"><a href="#菜单缓存" class="headerlink" title="菜单缓存"></a>菜单缓存</h3><p>通过<code>admin.menu.cache.enable</code>配置参数可以开启或关闭菜单缓存，建议开启。</p>
<h3 id="通过Menu-add接口动态添加菜单"><a href="#通过Menu-add接口动态添加菜单" class="headerlink" title="通过Menu::add接口动态添加菜单"></a>通过Menu::add接口动态添加菜单</h3><p><code>Dcat Admin</code>还提供了通过数组的方式在代码中即时添加菜单。</p>
<p>在<code>app\Admin\bootstrap.php</code>中添加如下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Admin</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Dcat</span>\<span class="title">Admin</span>\<span class="title">Layout</span>\<span class="title">Menu</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Admin</span>::<span class="title function_ invoke__">menu</span>(function (Menu <span class="variable">$menu</span>) &#123;</span><br><span class="line">    <span class="variable">$menu</span>-&gt;<span class="title function_ invoke__">add</span>([</span><br><span class="line">        [</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>            =&gt; <span class="string">&#x27;1&#x27;</span>, // 此id只要保证当前的数组中是唯一的即可</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span>         =&gt; <span class="string">&#x27;测试菜单&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;icon&#x27;</span>          =&gt; <span class="string">&#x27;fa-file-text-o&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;uri&#x27;</span>           =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;parent_id&#x27;</span>     =&gt; <span class="number">0</span>, </span><br><span class="line">            <span class="string">&#x27;permission_id&#x27;</span> =&gt; <span class="string">&#x27;test&#x27;</span>, // 与权限绑定</span><br><span class="line">            <span class="string">&#x27;roles&#x27;</span>         =&gt; <span class="string">&#x27;test-roles&#x27;</span>, // 与角色绑定</span><br><span class="line">        ],  </span><br><span class="line">        [</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>            =&gt; <span class="string">&#x27;2&#x27;</span>, // 此id只要保证当前的数组中是唯一的即可</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span>         =&gt; <span class="string">&#x27;测试菜单2&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;icon&#x27;</span>          =&gt; <span class="string">&#x27;fa-file-text-o&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;uri&#x27;</span>           =&gt; <span class="string">&#x27;test-menu2&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;parent_id&#x27;</span>     =&gt; <span class="string">&#x27;1&#x27;</span>, </span><br><span class="line">        ],  </span><br><span class="line">    ]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="为何没有权限的菜单不会自动隐藏？"><a href="#为何没有权限的菜单不会自动隐藏？" class="headerlink" title="为何没有权限的菜单不会自动隐藏？"></a>为何没有权限的菜单不会自动隐藏？</h3><p>这个问题是因为你没有给菜单绑定权限或者角色，给你想要无权不显示的菜单绑定权限或者角色即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/2.x/menu/" data-id="clpdpxfj5000vywna905og7zj" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/8/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-navbar/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-tab/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-table/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-tooltip/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/11/25/2.x/widgets-js/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>